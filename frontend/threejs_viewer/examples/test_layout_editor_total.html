<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout Editor - SHERLOCK_SKY_3DSIM (Phase 5)</title>
    
    <!-- Konva.js CDN -->
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    
    <!-- âœ… ì „ì—­ ê°ì²´ ë°©ì‹ìœ¼ë¡œ ë¡œë“œ (ì˜ì¡´ì„± ìˆœì„œ ì¤‘ìš”) -->
    <script src="../src/layout-editor/canvas/LayerManager.js"></script>
    <script src="../src/layout-editor/canvas/CanvasRenderer.js"></script>
    <script src="../src/layout-editor/canvas/CanvasEventHandler.js"></script>
    
    <!-- âœ… Handle ëª¨ë“ˆ (PowerPoint ìŠ¤íƒ€ì¼ 8ê°œ í•¸ë“¤ + íšŒì „) -->
    <script src="../src/layout-editor/handles/ResizeHandle.js"></script>
    <script src="../src/layout-editor/handles/RotateHandle.js"></script>
    <script src="../src/layout-editor/handles/HandleManager.js"></script>
    
    <!-- âœ… Smart Guides ëª¨ë“ˆ (ì •ë ¬ ê°€ì´ë“œë¼ì¸) -->
    <script src="../src/layout-editor/guides/AlignmentGuide.js"></script>
    <script src="../src/layout-editor/guides/DistributionGuide.js"></script>
    <script src="../src/layout-editor/guides/SmartGuideManager.js"></script>
    
    <!-- âœ… Snap ëª¨ë“ˆ (MICE ìŠ¤ëƒ… í¬ì¸íŠ¸) -->
    <script src="../src/layout-editor/snap/GridSnap.js"></script>
    <script src="../src/layout-editor/snap/MICESnapPoints.js"></script>
    <script src="../src/layout-editor/snap/SnapManager.js"></script>
    
    <!-- âœ… Selection ëª¨ë“ˆ (Window/Crossing ë°•ìŠ¤ ì„ íƒ) -->
    <script src="../src/layout-editor/selection/SelectionRenderer.js"></script>
    <script src="../src/layout-editor/selection/Selection2DManager.js"></script>
    <script src="../src/layout-editor/selection/FenceSelection.js"></script>
    
    <!-- âœ… Phase 1: Command ëª¨ë“ˆ (ES6 export ì œê±°ë¨, script íƒœê·¸ ë¡œë“œ ê°€ëŠ¥) -->
    <script src="../src/layout-editor/commands/Command.js"></script>
    <script src="../src/layout-editor/commands/CommandManager.js"></script>
    
    <!-- âœ… Export ëª¨ë“ˆ ì¶”ê°€ -->
    <script src="../src/layout-editor/export/LayoutExporter.js"></script>

    <script src="../src/layout-editor/components/Canvas2DEditor.js"></script>
    <script src="../src/layout-editor/controllers/ZoomController.js"></script>
    <!-- âœ… Phase 5: InfiniteGridZoomController (ì™¸ë¶€ ëª¨ë“ˆ) -->
    <script src="../src/layout-editor/controllers/InfiniteGridZoomController.js"></script>
    
    <script src="../src/layout-editor/tools/ObjectSelectionTool.js"></script>
    <script src="../src/layout-editor/tools/AlignmentTool.js"></script>
    <script src="../src/layout-editor/tools/WallDrawTool.js"></script>
    <script src="../src/layout-editor/tools/EquipmentArrayTool.js"></script>
    <script src="../src/layout-editor/managers/RoomSizeManager.js"></script>
    <script src="../src/layout-editor/components/PropertyPanel.js"></script>
    
    <!-- âœ… Phase 3: GroupingTool ì¶”ê°€ -->
    <script src="../src/layout-editor/tools/GroupingTool.js"></script>
    
    <!-- âœ… Phase 5.1: Config + State ëª¨ë“ˆ (Appë³´ë‹¤ ë¨¼ì € ë¡œë“œ) -->
    <script src="../src/layout-editor/config/LayoutEditorConfig.js"></script>
    <script src="../src/layout-editor/state/LayoutEditorState.js"></script>
    
    <!-- âœ… Phase 5: ì™¸ë¶€ App ëª¨ë“ˆ (JS ë¶„ë¦¬) -->
    <script src="../src/layout-editor/app/LayoutEditorApp.js"></script>
    
    <!-- âœ… Phase 5: ì™¸ë¶€ CSS íŒŒì¼ ë¡œë“œ (ê¸°ì¡´ CSS í™œìš© + ì‹ ê·œ) -->
    <link rel="stylesheet" href="../src/styles/layout_editor.css">
    <link rel="stylesheet" href="../src/styles/canvas-editor.css">
    <link rel="stylesheet" href="../src/styles/layout-editor-ui.css">
</head>

<body>
    <div id="loading-indicator"><div class="spinner"></div><div>Layout Editor ë¡œë”© ì¤‘...</div></div>

    <div class="header">
        <h1>ğŸ—ï¸ Layout Editor - Phase 5 (Undo/Redo + JS ë¶„ë¦¬)</h1>
        <div class="header-actions">
            <button class="header-btn btn-secondary" id="btn-undo" disabled>â†¶ Undo</button>
            <button class="header-btn btn-secondary" id="btn-redo" disabled>â†· Redo</button>
            <button class="header-btn btn-secondary" id="btn-help">â“</button>
            <button class="header-btn btn-secondary" id="btn-export-png">ğŸ–¼ï¸ PNG</button>
            <button class="header-btn btn-primary" id="btn-save">ğŸ’¾ Save</button>
        </div>
    </div>

    <div class="layout-container">
        <div class="toolbar-container" id="toolbar-container">
            <div class="toolbar">
                <button class="toolbar-btn active" id="tool-select" title="ì„ íƒ (V)">ğŸ‘†</button>
                <button class="toolbar-btn" id="tool-room" title="Room Size">ğŸ“</button>
                <button class="toolbar-btn" id="tool-wall" title="ë²½ ê·¸ë¦¬ê¸° (W)">ğŸ§±</button>
                <button class="toolbar-btn" id="component-btn" title="ì»´í¬ë„ŒíŠ¸ (C)">ğŸ¨</button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" id="tool-grid" title="Grid (G)">ğŸ”²</button>
                <button class="toolbar-btn" id="tool-snap" title="Snap (S)">ğŸ§²</button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn zoom" id="tool-zoom-in" title="Zoom In (+)">â•</button>
                <button class="toolbar-btn zoom" id="tool-zoom-out" title="Zoom Out (-)">â–</button>
                <button class="toolbar-btn zoom reset" id="tool-zoom-reset" title="Reset (0)">ğŸ¯</button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" id="tool-select-all" title="ì „ì²´ì„ íƒ (âŒ˜A)">âœ…</button>
                <button class="toolbar-btn danger" id="tool-delete" title="ì‚­ì œ (Del)">ğŸ—‘ï¸</button>
                <button class="toolbar-btn" id="tool-deselect" title="í•´ì œ (Esc)">âŒ</button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" id="align-btn" title="ì •ë ¬ (L)">ğŸ“</button>
                <button class="toolbar-btn" id="tool-rotate" title="íšŒì „ (R)">ğŸ”„</button>
                <div class="toolbar-divider"></div>
                <!-- âœ… Phase 3: Equipment Array + ê·¸ë£¹í™” ë²„íŠ¼ -->
                <button class="toolbar-btn" id="tool-eq-array" title="Equipment Array (A)">ğŸ­</button>
                <button class="toolbar-btn group" id="tool-group" title="ê·¸ë£¹í™” (âŒ˜G)">ğŸ“¦</button>
                <button class="toolbar-btn group" id="tool-ungroup" title="ê·¸ë£¹í•´ì œ (â‡§âŒ˜G)">ğŸ“¤</button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" id="tool-sample" title="ìƒ˜í”Œ ë¡œë“œ">ğŸ“</button>
            </div>
            <div class="component-submenu" id="component-submenu">
                <div class="submenu-content">
                    <div class="submenu-header">ğŸ¨ Components</div>
                    <div class="submenu-item" draggable="true" data-component="equipment"><span class="submenu-item-icon">âš™ï¸</span><div class="submenu-item-info"><div class="submenu-item-name">Equipment</div><div class="submenu-item-size">1.5 Ã— 3.0m</div></div></div>
                    <div class="submenu-item" draggable="true" data-component="partition"><span class="submenu-item-icon">ğŸšª</span><div class="submenu-item-info"><div class="submenu-item-name">Partition</div><div class="submenu-item-size">3.0 Ã— 2.5m</div></div></div>
                    <div class="submenu-item" draggable="true" data-component="desk"><span class="submenu-item-icon">ğŸª‘</span><div class="submenu-item-info"><div class="submenu-item-name">Desk</div><div class="submenu-item-size">1.6 Ã— 0.8m</div></div></div>
                    <div class="submenu-item" draggable="true" data-component="pillar"><span class="submenu-item-icon">ğŸ›ï¸</span><div class="submenu-item-info"><div class="submenu-item-name">Pillar</div><div class="submenu-item-size">0.3 Ã— 0.3m</div></div></div>
                    <div class="submenu-item" draggable="true" data-component="office"><span class="submenu-item-icon">ğŸ¢</span><div class="submenu-item-info"><div class="submenu-item-name">Office</div><div class="submenu-item-size">12 Ã— 20m</div></div></div>
                </div>
            </div>
        </div>
        <div class="canvas-area">
            <div id="canvas-container"></div>
            <div class="drop-guide" id="drop-guide">ğŸ“¦ ë“œë¡­í•˜ì—¬ ìƒì„±!</div>
        </div>
        <div class="property-panel" id="property-panel">
            <div class="property-panel-content">
                <div class="property-panel-header">ğŸ“‹ ì†ì„±</div>
                <div class="property-panel-empty"><div class="property-panel-empty-icon">ğŸ‘†</div><div>ê°ì²´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div></div>
            </div>
        </div>
    </div>

    <div class="align-popup" id="align-popup">
        <div class="align-popup-header">ğŸ“ ì •ë ¬ & íšŒì „</div>
        <div class="align-popup-section">
            <div class="align-popup-section-title">ì •ë ¬</div>
            <button class="align-popup-btn" id="align-left"><span class="icon">â¬…ï¸</span> ì¢Œì¸¡</button>
            <button class="align-popup-btn" id="align-right"><span class="icon">â¡ï¸</span> ìš°ì¸¡</button>
            <button class="align-popup-btn" id="align-top"><span class="icon">â¬†ï¸</span> ìƒë‹¨</button>
            <button class="align-popup-btn" id="align-bottom"><span class="icon">â¬‡ï¸</span> í•˜ë‹¨</button>
            <button class="align-popup-btn" id="align-center-h"><span class="icon">â†”ï¸</span> ìˆ˜í‰ì¤‘ì•™</button>
            <button class="align-popup-btn" id="align-center-v"><span class="icon">â†•ï¸</span> ìˆ˜ì§ì¤‘ì•™</button>
        </div>
        <div class="align-popup-section">
            <div class="align-popup-section-title">ë¶„ë°°</div>
            <button class="align-popup-btn" id="distribute-h"><span class="icon">â‡”</span> ìˆ˜í‰ë¶„ë°°</button>
            <button class="align-popup-btn" id="distribute-v"><span class="icon">â‡•</span> ìˆ˜ì§ë¶„ë°°</button>
        </div>
        <div class="align-popup-section">
            <div class="align-popup-section-title">íšŒì „</div>
            <button class="align-popup-btn" id="rotate-cw"><span class="icon">ğŸ”ƒ</span> 90Â° CW<span class="shortcut">R</span></button>
            <button class="align-popup-btn" id="rotate-ccw"><span class="icon">ğŸ”„</span> 90Â° CCW<span class="shortcut">â‡§R</span></button>
            <button class="align-popup-btn" id="rotate-reset"><span class="icon">â†©ï¸</span> ì´ˆê¸°í™”</button>
        </div>
    </div>

    <!-- âœ… Phase 3: ìƒíƒœë°” ì „ì²´ ì—…ë°ì´íŠ¸ -->
    <div class="status-bar">
        <span class="status-item">ğŸ”§ <span id="status-tool">ì„ íƒ</span></span>
        <span class="status-item zoom-display">ğŸ” <span id="status-zoom">100%</span></span>
        <span class="status-item history">â†¶ <span id="status-undo">0</span> / â†· <span id="status-redo">0</span></span>
        <span class="status-item">Grid: <span id="status-grid">ON</span></span>
        <span class="status-item">Snap: <span id="status-snap">ON</span></span>
        <span class="status-item mice">ğŸª MICE: <span id="status-mice-snap">OFF</span></span>
        <span class="status-item guides">ğŸ“ Guides: <span id="status-smart-guides">ON</span></span>
        <span class="status-item">ğŸ“¦ <span id="status-objects">0</span></span>
        <span class="status-item">âš™ï¸ Eq: <span id="status-equipment">0</span></span>
        <span class="status-item groups">ğŸ“ Groups: <span id="status-groups">0</span></span>
        <span class="status-item">âœ… <span id="status-selected">0</span></span>
    </div>

    <!-- âœ… Phase 3: ë‹¨ì¶•í‚¤ ë„ì›€ë§ ì „ì²´ ì—…ë°ì´íŠ¸ -->
    <div class="shortcuts-help" id="shortcuts-help">
        <h4>âŒ¨ï¸ ë‹¨ì¶•í‚¤</h4>
        <ul>
            <li><kbd>V</kbd> ì„ íƒ</li>
            <li><kbd>W</kbd> ë²½</li>
            <li><kbd>C</kbd> ì»´í¬ë„ŒíŠ¸</li>
            <li><kbd>G</kbd> Grid</li>
            <li><kbd>S</kbd> Snap</li>
            <li><kbd>M</kbd> MICE Snap</li>
            <li><kbd>R</kbd> íšŒì „</li>
            <li><kbd>L</kbd> ì •ë ¬</li>
            <li><kbd>Del</kbd> ì‚­ì œ</li>
            <li><kbd>âŒ˜A</kbd> ì „ì²´ì„ íƒ</li>
            <li><kbd>âŒ˜Z</kbd> Undo</li>
            <li><kbd>âŒ˜Y</kbd> Redo</li>
            <li><kbd>âŒ˜D</kbd> ë³µì œ</li>
            <li><kbd>Esc</kbd> í•´ì œ</li>
        </ul>
        <div class="section-title">ğŸ¯ ì´ë™ (Phase 1)</div>
        <ul>
            <li><kbd>â†‘â†“â†â†’</kbd> 1px ì´ë™</li>
            <li><kbd>â‡§+ë°©í–¥</kbd> 10px ì´ë™</li>
        </ul>
        <div class="section-title">ğŸ“‹ Phase 2</div>
        <ul>
            <li><kbd>âŒ˜D</kbd> ë³µì œ (+20px)</li>
            <li><kbd>M</kbd> MICE Snap</li>
        </ul>
        <div class="section-title">ğŸ­ Phase 3</div>
        <ul>
            <li><kbd>A</kbd> Equipment Array</li>
            <li><kbd>âŒ˜G</kbd> ê·¸ë£¹í™”</li>
            <li><kbd>â‡§âŒ˜G</kbd> ê·¸ë£¹ í•´ì œ</li>
        </ul>
        <div class="section-title">âœ¨ Phase 4</div>
        <ul>
            <li><kbd>H</kbd> Smart Guides</li>
            <li><kbd>[</kbd> ë’¤ë¡œ ë³´ë‚´ê¸°</li>
            <li><kbd>]</kbd> ì•ìœ¼ë¡œ ë³´ë‚´ê¸°</li>
            <li><kbd>â‡§[</kbd> ë§¨ ë’¤ë¡œ</li>
            <li><kbd>â‡§]</kbd> ë§¨ ì•ìœ¼ë¡œ</li>
        </ul>
    </div>

    <div class="modal" id="room-size-modal">
        <div class="modal-content">
            <h2>ğŸ“ Room Size ì„¤ì •</h2>
            <div class="form-group"><label>Width (m)</label><input type="number" id="room-width" value="130" min="10" step="1"></div>
            <div class="form-group"><label>Depth (m)</label><input type="number" id="room-depth" value="90" min="10" step="1"></div>
            <div class="form-group"><label>Height (m)</label><input type="number" id="room-height" value="3" min="2" step="0.1"></div>
            <div class="modal-actions"><button class="btn-secondary" id="room-cancel">ì·¨ì†Œ</button><button class="btn-primary" id="room-apply">ì ìš©</button></div>
        </div>
    </div>

    <!-- âœ… Phase 3: Equipment Array ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal" id="eq-array-modal">
        <div class="modal-content" style="min-width: 400px;">
            <h2>ğŸ­ Equipment Array ì„¤ì •</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group">
                    <label>Rows (í–‰)</label>
                    <input type="number" id="eq-array-rows" value="6" min="1" max="20" step="1">
                </div>
                <div class="form-group">
                    <label>Cols (ì—´)</label>
                    <input type="number" id="eq-array-cols" value="26" min="1" max="50" step="1">
                </div>
                <div class="form-group">
                    <label>ì¥ë¹„ í­ (m)</label>
                    <input type="number" id="eq-array-width" value="1.5" min="0.5" max="5" step="0.1">
                </div>
                <div class="form-group">
                    <label>ì¥ë¹„ ê¹Šì´ (m)</label>
                    <input type="number" id="eq-array-depth" value="3.0" min="0.5" max="10" step="0.1">
                </div>
                <div class="form-group">
                    <label>ì¥ë¹„ ê°„ê²© (m)</label>
                    <input type="number" id="eq-array-spacing" value="0.3" min="0" max="2" step="0.1">
                </div>
                <div class="form-group">
                    <label>ë³µë„ ì—´ ìœ„ì¹˜</label>
                    <input type="text" id="eq-array-corridor-cols" value="13" placeholder="ì˜ˆ: 13 ë˜ëŠ” 10,20">
                </div>
                <div class="form-group">
                    <label>ë³µë„ ì—´ í­ (m)</label>
                    <input type="number" id="eq-array-corridor-col-width" value="3.0" min="1" max="10" step="0.5">
                </div>
                <div class="form-group">
                    <label>ë³µë„ í–‰ ìœ„ì¹˜</label>
                    <input type="text" id="eq-array-corridor-rows" value="3" placeholder="ì˜ˆ: 3 ë˜ëŠ” 2,4">
                </div>
                <div class="form-group">
                    <label>ë³µë„ í–‰ í­ (m)</label>
                    <input type="number" id="eq-array-corridor-row-width" value="2.0" min="1" max="10" step="0.5">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="eq-array-cancel">ì·¨ì†Œ</button>
                <button class="btn-primary" id="eq-array-apply">ìƒì„±</button>
            </div>
        </div>
    </div>

    <!-- âœ… Phase 5: ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ (LayoutEditorApp.jsì—ì„œ ë¡œë“œë¨) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('âœ… DOM ë¡œë“œ ì™„ë£Œ');
            try { 
                window.editorApp = new LayoutEditorApp(); 
            }
            catch (error) { 
                console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error); 
                document.getElementById('loading-indicator').innerHTML = `<div style="color: red;">âŒ ë¡œë“œ ì‹¤íŒ¨</div><div style="margin-top: 10px; font-size: 12px;">${error.message}</div>`; 
            }
        });
    </script>
</body>
</html>