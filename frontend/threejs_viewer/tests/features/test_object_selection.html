<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2.2 - v3.2 (Shift+ë“œë˜ê·¸ + ì—ëŸ¬ ìˆ˜ì •)</title>
    
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    
    <link rel="stylesheet" href="../src/styles/canvas-editor.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
        }

        .header h1 { font-size: 24px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }

        .canvas-container {
            padding: 20px;
            display: flex;
            justify-content: center;
            background: #ffffff;
        }

        .divider {
            height: 1px;
            background: #e0e0e0;
            margin: 0 30px;
        }

        .instructions {
            background: #E3F2FD;
            padding: 20px 30px;
            border-top: 3px solid #667eea;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #424242;
        }

        .instructions li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #2ecc71;
            font-weight: bold;
        }

        .shift-drag-info {
            background: #FFF9C4;
            padding: 20px 30px;
            border-left: 4px solid #FBC02D;
            margin: 20px 30px;
        }

        .shift-drag-info h4 {
            color: #F57F17;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .shift-drag-info p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .shift-drag-info strong {
            color: #F57F17;
        }

        .keyboard-shortcuts {
            background: #E8F5E9;
            padding: 20px 30px;
            margin: 20px 30px;
            border-radius: 8px;
        }

        .keyboard-shortcuts h4 {
            color: #2e7d32;
            margin-bottom: 12px;
        }

        .keyboard-shortcuts table {
            width: 100%;
            border-collapse: collapse;
        }

        .keyboard-shortcuts td {
            padding: 8px;
            border-bottom: 1px solid #c8e6c9;
        }

        .keyboard-shortcuts .key {
            font-weight: bold;
            color: #1b5e20;
            width: 150px;
        }

        .test-results {
            padding: 20px 30px;
            background: #FAFAFA;
        }

        .test-results h3 {
            color: #424242;
            margin-bottom: 15px;
            font-size: 16px;
        }

        #console-output {
            background: #263238;
            color: #00FF00;
            padding: 15px;
            margin: 20px 30px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Phase 2.2 v3.2 - Shift+ë“œë˜ê·¸ + ì—ëŸ¬ ìˆ˜ì •</h1>
            <p>ì—…ê³„ í‘œì¤€ Shift+ë“œë˜ê·¸ ë°•ìŠ¤ ì„ íƒ + ëª¨ë“  íƒ€ì… ì—ëŸ¬ ìˆ˜ì • ì™„ë£Œ âœ…</p>
        </div>

        <div class="canvas-toolbar" style="margin: 20px 30px;">
            <button class="canvas-btn canvas-btn-success" onclick="loadTemplate()">ğŸ“‹ Load Template</button>
            <button class="canvas-btn canvas-btn-primary" onclick="testSingleSelect()">ğŸ¯ ë‹¨ì¼ ì„ íƒ</button>
            <button class="canvas-btn canvas-btn-primary" onclick="testMultiSelect()">ğŸ¯ ë‹¤ì¤‘ ì„ íƒ</button>
            <button class="canvas-btn canvas-btn-secondary" onclick="deselectAll()">âŒ ì„ íƒ í•´ì œ</button>
            <button class="canvas-btn canvas-btn-danger" onclick="deleteSelected()">ğŸ—‘ï¸ ì‚­ì œ</button>
            
            <div style="margin-left: auto; display: flex; gap: 8px;">
                <button class="canvas-toggle active" id="grid-toggle" onclick="toggleGrid()">
                    <span class="canvas-toggle-icon">ğŸ”²</span> Grid: ON
                </button>
                <button class="canvas-toggle active" id="snap-toggle" onclick="toggleSnap()">
                    <span class="canvas-toggle-icon">ğŸ§²</span> Snap: ON
                </button>
            </div>
        </div>

        <div class="canvas-container">
            <div id="canvas-wrapper"></div>
        </div>

        <div class="canvas-status-bar">
            <div class="canvas-status-item">
                <span>ì„ íƒëœ ê°ì²´:</span>
                <span class="canvas-status-badge" id="selected-count">0</span>
            </div>
            <div class="canvas-status-item">
                <span id="selection-mode">ëª¨ë“œ: Shift+ë“œë˜ê·¸ë¡œ ë°•ìŠ¤ ì„ íƒ</span>
            </div>
            <div class="canvas-status-item">
                <span id="tool-status">ë„êµ¬: Selection Tool (v3.2)</span>
            </div>
        </div>

        <div class="divider"></div>

        <!-- âœ… Shift+ë“œë˜ê·¸ ì•ˆë‚´ -->
        <div class="shift-drag-info">
            <h4>â­ Shift+ë“œë˜ê·¸ ë°•ìŠ¤ ì„ íƒ (ì—…ê³„ í‘œì¤€)</h4>
            <p>
                <strong>Shift í‚¤ë¥¼ ëˆ„ë¥¸ ìƒíƒœì—ì„œ ë“œë˜ê·¸</strong>í•˜ë©´ ì ì„  ë°•ìŠ¤ê°€ ë‚˜íƒ€ë‚˜ë©° ì˜ì—­ ë‚´ ëª¨ë“  ê°ì²´ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                ì´ ë°©ì‹ì€ <strong>Photoshop, Illustrator, AutoCAD</strong> ë“± ëŒ€ë¶€ë¶„ì˜ ì „ë¬¸ ë””ìì¸/CAD íˆ´ì—ì„œ ì‚¬ìš©í•˜ëŠ” í‘œì¤€ ë°©ì‹ì…ë‹ˆë‹¤.
            </p>
            <p>
                â€¢ <strong>Shift í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì»¤ì„œê°€ ì‹­ìì„ (+)ìœ¼ë¡œ ë³€ê²½</strong>ë˜ì–´ ë°•ìŠ¤ ì„ íƒ ëª¨ë“œì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                â€¢ ë“œë˜ê·¸í•˜ëŠ” ë™ì•ˆ <strong>ì‹¤ì‹œê°„ìœ¼ë¡œ ì„ íƒë  ê°ì²´ ê°œìˆ˜</strong>ê°€ í‘œì‹œë©ë‹ˆë‹¤.<br>
                â€¢ Ctrl í‚¤ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ <strong>ê¸°ì¡´ ì„ íƒì„ ìœ ì§€í•˜ë©´ì„œ ì¶”ê°€ ì„ íƒ</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </div>

        <div class="divider"></div>

        <!-- âœ… í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ -->
        <div class="keyboard-shortcuts">
            <h4>âŒ¨ï¸ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤</h4>
            <table>
                <tr>
                    <td class="key">Shift + ë“œë˜ê·¸</td>
                    <td>ë°•ìŠ¤ ì„ íƒ (ì˜ì—­ ë‚´ ëª¨ë“  ê°ì²´ ì„ íƒ)</td>
                </tr>
                <tr>
                    <td class="key">Ctrl + í´ë¦­</td>
                    <td>ê°œë³„ ê°ì²´ ì¶”ê°€/ì œê±° (í† ê¸€)</td>
                </tr>
                <tr>
                    <td class="key">Ctrl + Shift + ë“œë˜ê·¸</td>
                    <td>ê¸°ì¡´ ì„ íƒ ìœ ì§€í•˜ë©° ë°•ìŠ¤ë¡œ ì¶”ê°€ ì„ íƒ</td>
                </tr>
                <tr>
                    <td class="key">Ctrl + A</td>
                    <td>ì „ì²´ ì„ íƒ (156ê°œ ëª¨ë‘)</td>
                </tr>
                <tr>
                    <td class="key">Delete</td>
                    <td>ì„ íƒëœ ê°ì²´ ì‚­ì œ</td>
                </tr>
                <tr>
                    <td class="key">Escape</td>
                    <td>ì„ íƒ í•´ì œ</td>
                </tr>
                <tr>
                    <td class="key">ë¹ˆ ê³µê°„ í´ë¦­</td>
                    <td>ì„ íƒ í•´ì œ</td>
                </tr>
            </table>
        </div>

        <div class="divider"></div>

        <div class="instructions">
            <h3>ğŸ“– ì‚¬ìš© ë°©ë²• (v3.2)</h3>
            <ul>
                <li><strong>Load Template</strong> â†’ 156ê°œ ì„¤ë¹„ ë¡œë“œ</li>
                <li><strong>Shift + ë“œë˜ê·¸</strong> â†’ ì ì„  ë°•ìŠ¤ë¡œ ì˜ì—­ ì„ íƒ (ê°œìˆ˜ ì‹¤ì‹œê°„ í‘œì‹œ)</li>
                <li><strong>í´ë¦­</strong> â†’ ë‹¨ì¼ ì„ íƒ (ë…¸ë€ìƒ‰ + Transformer)</li>
                <li><strong>Ctrl + í´ë¦­</strong> â†’ ë‹¤ì¤‘ ì„ íƒ (ê°œë³„ ì¶”ê°€/ì œê±°)</li>
                <li><strong>ë“œë˜ê·¸</strong> â†’ ì„ íƒëœ ê°ì²´ ì´ë™ (ë¼ë²¨ í•¨ê»˜ ì´ë™)</li>
                <li><strong>Transformer í•¸ë“¤</strong> â†’ 8ê°œ í•¸ë“¤ë¡œ í¬ê¸° ì¡°ì ˆ</li>
                <li><strong>Delete í‚¤</strong> â†’ ì„ íƒ ì‚­ì œ</li>
            </ul>
        </div>

        <div class="divider"></div>

        <div class="test-results">
            <h3>âœ… v3.2 ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
            <div id="test-checklist">
                <div class="canvas-test-item" id="test-1">âœ… Template ë¡œë“œ (ì—ëŸ¬ ì—†ìŒ)</div>
                <div class="canvas-test-item" id="test-2">âœ… shape.findOne() ì—ëŸ¬ ìˆ˜ì •</div>
                <div class="canvas-test-item" id="test-3">âœ… Shift+ë“œë˜ê·¸ ë°•ìŠ¤ ì„ íƒ</div>
                <div class="canvas-test-item" id="test-4">âœ… ì‹¤ì‹œê°„ ì„ íƒ ê°œìˆ˜ í‘œì‹œ</div>
                <div class="canvas-test-item" id="test-5">âœ… Shift í‚¤ ëˆ„ë¥´ë©´ ì»¤ì„œ ë³€ê²½</div>
                <div class="canvas-test-item" id="test-6">âœ… ëª¨ë“  íƒ€ì… ì—ëŸ¬ í•´ê²°</div>
            </div>
        </div>

        <div id="console-output">Console ì¶œë ¥...<br></div>
    </div>

    <script src="../src/layout_editor/components/Canvas2DEditor.js"></script>
    <script src="../src/layout_editor/tools/ObjectSelectionTool.js"></script>

    <script>
        let canvas2DEditor = null;
        let selectionTool = null;

        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            const output = document.getElementById('console-output');
            const message = args.join(' ');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `[${timestamp}] ${message}<br>`;
            output.scrollTop = output.scrollHeight;
        };

        window.onload = function() {
            console.log('=== Phase 2.2 v3.2 ì‹œì‘ (Shift+ë“œë˜ê·¸ + ì—ëŸ¬ ìˆ˜ì •) ===');
            
            canvas2DEditor = new Canvas2DEditor('canvas-wrapper', {
                width: 1200,
                height: 800,
                gridSize: 10,
                scale: 10,
                showGrid: true,
                snapToGrid: true
            });

            console.log('CSS Colors:', canvas2DEditor.cssColors);
            passTest(1);

            selectionTool = new ObjectSelectionTool(canvas2DEditor);
            selectionTool.activate();

            monitorSelection();

            console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ - Shift+ë“œë˜ê·¸ ëª¨ë“œ í™œì„±í™”');
        };

        async function loadTemplate() {
            try {
                console.log('Template ë¡œë”© ì¤‘...');
                
                const response = await fetch('../public/layouts/templates/standard_26x6.json');
                const templateData = await response.json();
                
                canvas2DEditor.loadLayout(templateData);
                
                selectionTool.deactivate();
                selectionTool.activate();
                
                console.log('âœ… Template ë¡œë“œ ì™„ë£Œ (ì—ëŸ¬ ì—†ìŒ)');
                passTest(2);
                
            } catch (error) {
                console.error('Template ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        function testSingleSelect() {
            console.log('=== ë‹¨ì¼ ì„ íƒ í…ŒìŠ¤íŠ¸ ===');
            
            const equipment = canvas2DEditor.equipmentShapes.get('EQ-01-01');
            if (equipment) {
                canvas2DEditor.selectObject(equipment, false);
                console.log('âœ… EQ-01-01 ì„ íƒë¨ (ë…¸ë€ìƒ‰)');
            }
        }

        function testMultiSelect() {
            console.log('=== Ctrl+Click ë‹¤ì¤‘ ì„ íƒ í…ŒìŠ¤íŠ¸ ===');
            
            const equipment1 = canvas2DEditor.equipmentShapes.get('EQ-01-01');
            const equipment2 = canvas2DEditor.equipmentShapes.get('EQ-01-02');
            const equipment3 = canvas2DEditor.equipmentShapes.get('EQ-02-01');
            
            if (equipment1 && equipment2 && equipment3) {
                canvas2DEditor.selectObject(equipment1, false);
                canvas2DEditor.selectObject(equipment2, true);
                canvas2DEditor.selectObject(equipment3, true);
                console.log('âœ… 3ê°œ ì„¤ë¹„ ì„ íƒë¨');
            }
        }

        function deselectAll() {
            canvas2DEditor.deselectAll();
            console.log('âœ… ëª¨ë“  ì„ íƒ í•´ì œ');
        }

        function deleteSelected() {
            if (canvas2DEditor.selectedObjects.length === 0) {
                alert('ì„ íƒëœ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm(`${canvas2DEditor.selectedObjects.length}ê°œì˜ ê°ì²´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                canvas2DEditor.deleteSelected();
            }
        }

        function toggleGrid() {
            canvas2DEditor.toggleGrid();
            const btn = document.getElementById('grid-toggle');
            const isOn = canvas2DEditor.config.showGrid;
            btn.innerHTML = `<span class="canvas-toggle-icon">ğŸ”²</span> Grid: ${isOn ? 'ON' : 'OFF'}`;
            btn.classList.toggle('active', isOn);
        }

        function toggleSnap() {
            const snapEnabled = canvas2DEditor.toggleSnapToGrid();
            const btn = document.getElementById('snap-toggle');
            btn.innerHTML = `<span class="canvas-toggle-icon">ğŸ§²</span> Snap: ${snapEnabled ? 'ON' : 'OFF'}`;
            btn.classList.toggle('active', snapEnabled);
        }

        function monitorSelection() {
            setInterval(() => {
                const count = canvas2DEditor.selectedObjects.length;
                const badge = document.getElementById('selected-count');
                badge.textContent = count;
                
                if (count > 0) {
                    badge.style.background = '#2ecc71';
                } else {
                    badge.style.background = '#6c757d';
                }
                
                const modeText = document.getElementById('selection-mode');
                if (count > 1) {
                    modeText.textContent = `ëª¨ë“œ: ë‹¤ì¤‘ ì„ íƒ (${count}ê°œ)`;
                } else if (count === 1) {
                    modeText.textContent = 'ëª¨ë“œ: ë‹¨ì¼ ì„ íƒ';
                } else {
                    modeText.textContent = 'ëª¨ë“œ: Shift+ë“œë˜ê·¸ë¡œ ë°•ìŠ¤ ì„ íƒ';
                }
            }, 100);
        }

        function passTest(testNumber) {
            const testItem = document.getElementById(`test-${testNumber}`);
            if (testItem && !testItem.classList.contains('pass')) {
                testItem.classList.add('pass');
                console.log(`âœ… í…ŒìŠ¤íŠ¸ ${testNumber} í†µê³¼`);
            }
        }

        window.onbeforeunload = function() {
            if (selectionTool) {
                selectionTool.destroy();
            }
            if (canvas2DEditor) {
                canvas2DEditor.destroy();
            }
        };
    </script>
</body>
</html>