<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout Editor - SHERLOCK_SKY_3DSIM</title>
    
    <!-- Konva.js CDN -->
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    
    <!-- âœ… Canvas2DEditor ë¨¼ì € ë¡œë“œ (ì „ì—­ ê°ì²´) -->
    <script src="../src/layout_editor/components/Canvas2DEditor.js"></script>
    
    <!-- âœ… ZoomController ë¡œë“œ (ì „ì—­ ê°ì²´) -->
    <script src="../src/layout_editor/controllers/ZoomController.js"></script>
    
    <!-- âœ… ObjectSelectionTool ë¡œë“œ (ì „ì—­ ê°ì²´) -->
    <script src="../src/layout_editor/tools/ObjectSelectionTool.js"></script>
    
    <!-- âœ… AlignmentTool ë¡œë“œ (ì „ì—­ ê°ì²´) -->
    <script src="../src/layout_editor/tools/AlignmentTool.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="../src/styles/layout_editor.css">
    <link rel="stylesheet" href="../src/styles/component-palette.css">
    
    <style>
        :root {
            --toolbar-width: 70px;
            --toolbar-expanded-width: 280px;
            --submenu-width: 210px;
            --property-panel-width: 280px;
            --header-height: 50px;
            --status-height: 32px;
            
            --canvas-equipment-default: #4a90e2;
            --canvas-equipment-selected: #FFD700;
            --canvas-equipment-hover: #3498db;
            --canvas-equipment-stroke: #2c3e50;
            --canvas-transformer-border: #667eea;
            --canvas-transformer-anchor-stroke: #667eea;
            --canvas-transformer-anchor-fill: #ffffff;
            --canvas-bg: #f5f5f5;
            --canvas-grid-minor: #d0d0d0;
            --canvas-grid-major: #a0a0a0;
            --canvas-grid-label: #999999;
            --canvas-selection-stroke: #667eea;
            --canvas-selection-fill: rgba(102, 126, 234, 0.1);
            --canvas-coord-bg: #667eea;
            --canvas-coord-text: #ffffff;
            --canvas-room-stroke: #666666;
            --canvas-wall-default: #888888;
            --canvas-office-fill: #d4e6f1;
            --canvas-office-stroke: #3498db;
            --canvas-partition: #aaaaaa;
            --canvas-text-primary: #212529;
            --canvas-text-secondary: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }
        
        /* í—¤ë” */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 200;
        }
        
        .header h1 {
            font-size: 18px;
            margin: 0;
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
        }
        
        .header-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #27ae60;
            color: white;
        }
        
        .btn-primary:hover {
            background: #229954;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .layout-container {
            display: flex;
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            bottom: var(--status-height);
        }
        
        /* âœ¨ íˆ´ë°” ì»¨í…Œì´ë„ˆ - ì„œë¸Œë©”ë‰´ í¬í•¨ (ìŠ¤í¬ë¡¤ì€ ì—¬ê¸°ì„œ ì²˜ë¦¬) */
        .toolbar-container {
            width: var(--toolbar-width);
            display: flex;
            flex-shrink: 0;
            transition: width 0.3s ease;
            position: relative;
            z-index: 10;
            overflow-y: auto;  /* âœ… ìŠ¤í¬ë¡¤ì€ ì»¨í…Œì´ë„ˆì—ì„œ ì²˜ë¦¬ */
        }
        
        .toolbar-container.expanded {
            width: var(--toolbar-expanded-width);
        }
        
        /* âœ… íˆ´ë°” - overflow: visibleë¡œ ë³€ê²½í•˜ì—¬ íˆ´íŒì´ ë³´ì´ë„ë¡ */
        .toolbar {
            width: var(--toolbar-width);
            min-width: var(--toolbar-width);
            background: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow: visible;  /* âœ… í•µì‹¬ ìˆ˜ì •: íˆ´íŒì´ ì˜ì—­ ë°–ìœ¼ë¡œ ë‚˜ê°ˆ ìˆ˜ ìˆê²Œ */
            position: relative;
        }
        
        /* âœ¨ ì •ë ¬/íšŒì „ íŒì—… ë©”ë‰´ */
        .align-popup {
            display: none;
            position: fixed;
            left: 80px;
            top: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            padding: 10px;
            z-index: 1000;
            min-width: 200px;
        }
        
        .align-popup.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .align-popup-header {
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            padding: 5px 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 8px;
        }
        
        .align-popup-section {
            margin-bottom: 10px;
        }
        
        .align-popup-section-title {
            font-size: 11px;
            color: #999;
            padding: 5px 10px;
            text-transform: uppercase;
        }
        
        .align-popup-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            color: #333;
            transition: all 0.2s;
        }
        
        .align-popup-btn:hover {
            background: #f0f4ff;
            color: #667eea;
        }
        
        .align-popup-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .align-popup-btn .icon {
            font-size: 16px;
            width: 24px;
            text-align: center;
        }
        
        .align-popup-btn .shortcut {
            margin-left: auto;
            font-size: 10px;
            color: #aaa;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        /* íˆ´ë°” ë²„íŠ¼ */
        .toolbar-btn {
            width: 52px;
            height: 52px;
            margin: 4px 0;
            background: #34495e;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .toolbar-btn:hover {
            background: #667eea;
            transform: scale(1.05);
        }
        
        .toolbar-btn.active {
            background: #667eea;
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.6);
        }
        
        .toolbar-btn.zoom {
            background: #27ae60;
            font-size: 20px;
        }
        
        .toolbar-btn.zoom:hover {
            background: #229954;
        }
        
        .toolbar-btn.zoom.reset {
            background: #3498db;
        }
        
        .toolbar-btn.zoom.reset:hover {
            background: #2980b9;
        }
        
        .toolbar-btn.danger {
            background: #c0392b;
        }
        
        .toolbar-btn.danger:hover {
            background: #e74c3c;
        }
        
        /* íˆ´íŒ - ì„œë¸Œë©”ë‰´ê°€ ì—´ë ¸ì„ ë•ŒëŠ” ìˆ¨ê¹€ */
        .toolbar-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        
        .toolbar-btn:hover::after {
            opacity: 1;
        }
        
        /* ì„œë¸Œë©”ë‰´ ì—´ë ¸ì„ ë•Œ íˆ´íŒ ìˆ¨ê¹€ */
        .toolbar-container.expanded .toolbar-btn::after {
            display: none;
        }
        
        .toolbar-divider {
            width: 40px;
            height: 2px;
            background: #4a5c6a;
            margin: 6px 0;
            flex-shrink: 0;
        }
        
        /* âœ¨ Component ì„œë¸Œë©”ë‰´ - íˆ´ë°” ì˜†ì— ë¶™ìŒ */
        .component-submenu {
            width: 0;
            background: white;
            overflow: hidden;
            transition: width 0.3s ease;
            box-shadow: 2px 0 15px rgba(0,0,0,0.15);
        }
        
        .toolbar-container.expanded .component-submenu {
            width: var(--submenu-width);
        }
        
        .submenu-content {
            width: var(--submenu-width);
            min-width: var(--submenu-width);
        }
        
        .submenu-header {
            padding: 14px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .submenu-item {
            padding: 12px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
            white-space: nowrap;
        }
        
        .submenu-item:hover {
            background: #f0f4ff;
        }
        
        .submenu-item:active {
            background: #667eea;
            color: white;
        }
        
        .submenu-item-icon {
            font-size: 20px;
            width: 30px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .submenu-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .submenu-item-name {
            font-weight: 600;
            font-size: 13px;
            color: #2c3e50;
        }
        
        .submenu-item-size {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }
        
        .submenu-item:active .submenu-item-name,
        .submenu-item:active .submenu-item-size {
            color: white;
        }
        
        /* Canvas ì˜ì—­ */
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            position: relative;
            min-width: 0;
        }
        
        #canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        /* Drop ê°€ì´ë“œ */
        .drop-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(52, 152, 219, 0.95);
            color: white;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            display: none;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .drop-guide.visible {
            display: block;
        }
        
        /* PropertyPanel ì˜ì—­ */
        .property-panel {
            width: var(--property-panel-width);
            flex-shrink: 0;
            background: white;
            border-left: 2px solid #e0e0e0;
            overflow-y: auto;
        }
        
        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--status-height);
            background: #34495e;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 13px;
            gap: 20px;
            z-index: 100;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-item.zoom-display {
            background: #27ae60;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 28px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            min-width: 360px;
        }
        
        .modal-content h2 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .form-group {
            margin: 14px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 50px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
            font-size: 13px;
        }
        
        .toast.success { background: #27ae60; }
        .toast.error { background: #e74c3c; }
        .toast.info { background: #3498db; }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” */
        .toolbar::-webkit-scrollbar { width: 4px; }
        .toolbar::-webkit-scrollbar-track { background: #34495e; }
        .toolbar::-webkit-scrollbar-thumb { background: #667eea; border-radius: 2px; }
        
        .property-panel::-webkit-scrollbar,
        .component-submenu::-webkit-scrollbar { width: 6px; }
        .property-panel::-webkit-scrollbar-track,
        .component-submenu::-webkit-scrollbar-track { background: #f0f0f0; }
        .property-panel::-webkit-scrollbar-thumb,
        .component-submenu::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        
        /* Property Panel ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .property-panel-content { padding: 16px; }
        .property-panel-header {
            font-size: 15px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }
        .property-panel-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 150px;
            color: #999;
        }
        .property-panel-empty-icon {
            font-size: 40px;
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ—ï¸ Layout Editor - SHERLOCK_SKY_3DSIM</h1>
        <div class="header-actions">
            <button class="header-btn btn-secondary" onclick="editorApp.undo()">â†¶ Undo</button>
            <button class="header-btn btn-secondary" onclick="editorApp.redo()">â†· Redo</button>
            <button class="header-btn btn-primary" onclick="editorApp.saveLayout()">ğŸ’¾ Save</button>
        </div>
    </div>

    <div class="layout-container">
        <!-- âœ¨ íˆ´ë°” ì»¨í…Œì´ë„ˆ (íˆ´ë°” + ì„œë¸Œë©”ë‰´) -->
        <div class="toolbar-container" id="toolbar-container">
            <!-- íˆ´ë°” -->
            <div class="toolbar">
                <button class="toolbar-btn active" data-tooltip="ì„ íƒ ë„êµ¬ (V)" onclick="editorApp.activateTool('select')">ğŸ‘†</button>
                <button class="toolbar-btn" data-tooltip="Room Size ì„¤ì •" onclick="editorApp.showRoomSizeModal()">ğŸ“</button>
                <button class="toolbar-btn" data-tooltip="ë²½ ê·¸ë¦¬ê¸° (W)" onclick="editorApp.activateTool('wall')">ğŸ§±</button>
                <button class="toolbar-btn" id="component-btn" data-tooltip="ì»´í¬ë„ŒíŠ¸ ì‚½ì… (C)" onclick="editorApp.toggleComponentSubmenu()">ğŸ¨</button>
                
                <div class="toolbar-divider"></div>
                
                <button class="toolbar-btn" data-tooltip="Grid í† ê¸€ (G)" onclick="editorApp.toggleGrid()">ğŸ”²</button>
                <button class="toolbar-btn" data-tooltip="Snap to Grid (S)" onclick="editorApp.toggleSnap()">ğŸ§²</button>
                
                <div class="toolbar-divider"></div>
                
                <button class="toolbar-btn zoom" data-tooltip="Zoom In (+)" onclick="editorApp.zoomIn()">â•</button>
                <button class="toolbar-btn zoom" data-tooltip="Zoom Out (-)" onclick="editorApp.zoomOut()">â–</button>
                <button class="toolbar-btn zoom reset" data-tooltip="Reset Zoom (R)" onclick="editorApp.resetZoom()">ğŸ¯</button>
                
                <div class="toolbar-divider"></div>
                
                <button class="toolbar-btn" data-tooltip="ì „ì²´ ì„ íƒ (Ctrl+A)" onclick="editorApp.selectAll()">âœ…</button>
                <button class="toolbar-btn danger" data-tooltip="ì‚­ì œ (Del)" onclick="editorApp.deleteSelected()">ğŸ—‘ï¸</button>
                <button class="toolbar-btn" data-tooltip="ì„ íƒ í•´ì œ (Esc)" onclick="editorApp.deselectAll()">âŒ</button>
                
                <div class="toolbar-divider"></div>
                
                <!-- âœ¨ ì •ë ¬/íšŒì „ ë²„íŠ¼ ì¶”ê°€ -->
                <button class="toolbar-btn" id="align-btn" data-tooltip="ì •ë ¬/íšŒì „ (A)" onclick="editorApp.toggleAlignPopup()">ğŸ“</button>
                <button class="toolbar-btn" data-tooltip="90Â° íšŒì „ (R)" onclick="editorApp.rotateCW()">ğŸ”„</button>
                
                <button class="toolbar-btn" id="align-btn" data-tooltip="ì •ë ¬/íšŒì „ (A)" onclick="editorApp.toggleAlignPopup()">ğŸ“</button>
                
                <!-- âœ¨ ì •ë ¬/íšŒì „ íŒì—… ë©”ë‰´ (ë²„íŠ¼ ë°”ë¡œ ë‹¤ìŒì— ë°°ì¹˜) -->
                <div class="align-popup" id="align-popup">
                    <div class="align-popup-header">ğŸ“ ì •ë ¬ & íšŒì „</div>
                    
                    <div class="align-popup-section">
                        <div class="align-popup-section-title">ì •ë ¬ (2ê°œ ì´ìƒ ì„ íƒ)</div>
                        <button class="align-popup-btn" onclick="editorApp.alignLeft()">
                            <span class="icon">â¬…ï¸</span> ì¢Œì¸¡ ì •ë ¬
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.alignRight()">
                            <span class="icon">â¡ï¸</span> ìš°ì¸¡ ì •ë ¬
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.alignTop()">
                            <span class="icon">â¬†ï¸</span> ìƒë‹¨ ì •ë ¬
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.alignBottom()">
                            <span class="icon">â¬‡ï¸</span> í•˜ë‹¨ ì •ë ¬
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.alignCenterH()">
                            <span class="icon">â†”ï¸</span> ìˆ˜í‰ ì¤‘ì•™
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.alignCenterV()">
                            <span class="icon">â†•ï¸</span> ìˆ˜ì§ ì¤‘ì•™
                        </button>
                    </div>
                    
                    <div class="align-popup-section">
                        <div class="align-popup-section-title">ê· ë“± ë¶„ë°° (3ê°œ ì´ìƒ ì„ íƒ)</div>
                        <button class="align-popup-btn" onclick="editorApp.distributeH()">
                            <span class="icon">â‡”</span> ìˆ˜í‰ ë¶„ë°°
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.distributeV()">
                            <span class="icon">â‡•</span> ìˆ˜ì§ ë¶„ë°°
                        </button>
                    </div>
                    
                    <div class="align-popup-section">
                        <div class="align-popup-section-title">íšŒì „</div>
                        <button class="align-popup-btn" onclick="editorApp.rotateCW()">
                            <span class="icon">ğŸ”ƒ</span> 90Â° ì‹œê³„ë°©í–¥
                            <span class="shortcut">R</span>
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.rotateCCW()">
                            <span class="icon">ğŸ”„</span> 90Â° ë°˜ì‹œê³„ë°©í–¥
                            <span class="shortcut">Shift+R</span>
                        </button>
                        <button class="align-popup-btn" onclick="editorApp.resetRotation()">
                            <span class="icon">â†©ï¸</span> íšŒì „ ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
                
                <button class="toolbar-btn" data-tooltip="90Â° íšŒì „ (R)" onclick="editorApp.rotateCW()">ğŸ”„</button>


                <div class="toolbar-divider"></div>
                
                <button class="toolbar-btn" data-tooltip="ìƒ˜í”Œ ë ˆì´ì•„ì›ƒ" onclick="editorApp.loadSampleLayout()">ğŸ“</button>
            </div>
            
            <!-- âœ¨ Component ì„œë¸Œë©”ë‰´ -->
            <div class="component-submenu" id="component-submenu">
                <div class="submenu-content">
                    <div class="submenu-header">ğŸ¨ Components</div>
                    <div class="submenu-item" draggable="true" data-component="partition">
                        <span class="submenu-item-icon">ğŸšª</span>
                        <div class="submenu-item-info">
                            <div class="submenu-item-name">Partition</div>
                            <div class="submenu-item-size">3.0 Ã— 2.5m</div>
                        </div>
                    </div>
                    <div class="submenu-item" draggable="true" data-component="desk">
                        <span class="submenu-item-icon">ğŸª‘</span>
                        <div class="submenu-item-info">
                            <div class="submenu-item-name">Desk</div>
                            <div class="submenu-item-size">1.6 Ã— 0.8m</div>
                        </div>
                    </div>
                    <div class="submenu-item" draggable="true" data-component="pillar">
                        <span class="submenu-item-icon">ğŸ›ï¸</span>
                        <div class="submenu-item-info">
                            <div class="submenu-item-name">Pillar</div>
                            <div class="submenu-item-size">0.3 Ã— 0.3m</div>
                        </div>
                    </div>
                    <div class="submenu-item" draggable="true" data-component="office">
                        <span class="submenu-item-icon">ğŸ¢</span>
                        <div class="submenu-item-info">
                            <div class="submenu-item-name">Office</div>
                            <div class="submenu-item-size">12 Ã— 20m</div>
                        </div>
                    </div>
                    <div class="submenu-item" draggable="true" data-component="equipment">
                        <span class="submenu-item-icon">âš™ï¸</span>
                        <div class="submenu-item-info">
                            <div class="submenu-item-name">Equipment</div>
                            <div class="submenu-item-size">1.5 Ã— 3.0m</div>
                        </div>
                    </div>
                </div>
            </div>
            



        </div>

        <!-- Canvas ì˜ì—­ -->
        <div class="canvas-area">
            <div id="canvas-container"></div>
            <div class="drop-guide" id="drop-guide">ğŸ“¦ Drop here to create!</div>
        </div>
        
        <!-- PropertyPanel -->
        <div class="property-panel" id="property-panel">
            <div class="property-panel-content">
                <div class="property-panel-header">ì†ì„±</div>
                <div class="property-panel-empty">
                    <div class="property-panel-empty-icon">ğŸ‘†</div>
                    <div>ê°ì²´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                    <div style="font-size: 11px; margin-top: 5px;">ğŸ’¡ Canvasì—ì„œ ê°ì²´ë¥¼ í´ë¦­</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <span class="status-item">ë„êµ¬: <span id="status-tool">ì„ íƒ</span></span>
        <span class="status-item zoom-display">Zoom: <span id="status-zoom">100%</span></span>
        <span class="status-item">Grid: <span id="status-grid">ON</span></span>
        <span class="status-item">Snap: <span id="status-snap">ON</span></span>
        <span class="status-item">ê°ì²´: <span id="status-objects">0</span></span>
        <span class="status-item">ì„ íƒë¨: <span id="status-selected">0</span></span>
    </div>

    <!-- Room Size Modal -->
    <div class="modal" id="room-size-modal">
        <div class="modal-content">
            <h2>ğŸ“ Room Size ì„¤ì •</h2>
            <div class="form-group">
                <label>Width (m)</label>
                <input type="number" id="room-width" value="130" min="10" step="1">
            </div>
            <div class="form-group">
                <label>Depth (m)</label>
                <input type="number" id="room-depth" value="90" min="10" step="1">
            </div>
            <div class="form-group">
                <label>Wall Height (m)</label>
                <input type="number" id="room-height" value="3" min="2" step="0.1">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="editorApp.closeRoomSizeModal()">ì·¨ì†Œ</button>
                <button class="btn-primary" onclick="editorApp.applyRoomSize()">ì ìš©</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { RoomSizeManager } from '../src/layout_editor/managers/RoomSizeManager.js';
        import { WallDrawTool } from '../src/layout_editor/tools/WallDrawTool.js';
        import { PropertyPanel } from '../src/layout_editor/components/PropertyPanel.js';
        
        const COMPONENTS = {
            partition: { id: 'partition', name: 'Partition', icon: 'ğŸšª', width: 3.0, depth: 2.5, color: '#888888' },
            desk: { id: 'desk', name: 'Desk', icon: 'ğŸª‘', width: 1.6, depth: 0.8, color: '#8B4513' },
            pillar: { id: 'pillar', name: 'Pillar', icon: 'ğŸ›ï¸', width: 0.3, depth: 0.3, color: '#333333' },
            office: { id: 'office', name: 'Office', icon: 'ğŸ¢', width: 12.0, depth: 20.0, color: '#87CEEB' },
            equipment: { id: 'equipment', name: 'Equipment', icon: 'âš™ï¸', width: 1.5, depth: 3.0, color: '#FF8C00' }
        };
        
        // CSS ë³€ìˆ˜ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
        const rootStyles = getComputedStyle(document.documentElement);
        const TOOLBAR_WIDTH = parseInt(rootStyles.getPropertyValue('--toolbar-width')) || 70;
        const TOOLBAR_EXPANDED_WIDTH = parseInt(rootStyles.getPropertyValue('--toolbar-expanded-width')) || 280;
        const PROPERTY_PANEL_WIDTH = parseInt(rootStyles.getPropertyValue('--property-panel-width')) || 280;
        const HEADER_HEIGHT = parseInt(rootStyles.getPropertyValue('--header-height')) || 50;
        const STATUS_HEIGHT = parseInt(rootStyles.getPropertyValue('--status-height')) || 32;
        
        class ZoomControllerExtended extends ZoomController {
            constructor(canvas2DEditor, options = {}) {
                super(canvas2DEditor, options);
            }
            
            updateGrid() {
                this.editor.layers.background.destroyChildren();
                
                const stage = this.editor.stage;
                const stagePos = stage.position();
                const zoom = this.currentZoom;
                
                const padding = 1000;
                const visibleWidth = (this.editor.config.width / zoom) + (padding * 2);
                const visibleHeight = (this.editor.config.height / zoom) + (padding * 2);
                const startX = (-stagePos.x / zoom) - padding;
                const startY = (-stagePos.y / zoom) - padding;
                
                const gridSize = this.getCurrentGridSize();
                const majorInterval = this.gridConfig.majorInterval;
                
                const background = new Konva.Rect({
                    x: startX, y: startY,
                    width: visibleWidth, height: visibleHeight,
                    fill: this.editor.config.backgroundColor
                });
                this.editor.layers.background.add(background);
                
                if (gridSize < 2) {
                    this.editor.layers.background.batchDraw();
                    return;
                }
                
                const gridStartX = Math.floor(startX / gridSize) * gridSize;
                const gridStartY = Math.floor(startY / gridSize) * gridSize;
                const gridEndX = startX + visibleWidth;
                const gridEndY = startY + visibleHeight;
                
                for (let i = gridStartX; i <= gridEndX; i += gridSize) {
                    const gridIndex = Math.round(i / gridSize);
                    const isMajor = (gridIndex % majorInterval) === 0;
                    this.editor.layers.background.add(new Konva.Line({
                        points: [i, gridStartY, i, gridEndY],
                        stroke: isMajor ? this.editor.config.gridMajorColor : this.editor.config.gridColor,
                        strokeWidth: isMajor ? 1 / zoom : 0.5 / zoom
                    }));
                    if (isMajor && i !== 0) {
                        const meters = Math.round((i / this.baseScale) * 10) / 10;
                        this.editor.layers.background.add(new Konva.Text({
                            x: i + 3 / zoom, y: gridStartY + 5 / zoom,
                            text: `${meters}m`, fontSize: 10 / zoom,
                            fill: this.editor.cssColors.gridLabel
                        }));
                    }
                }
                
                for (let i = gridStartY; i <= gridEndY; i += gridSize) {
                    const gridIndex = Math.round(i / gridSize);
                    const isMajor = (gridIndex % majorInterval) === 0;
                    this.editor.layers.background.add(new Konva.Line({
                        points: [gridStartX, i, gridEndX, i],
                        stroke: isMajor ? this.editor.config.gridMajorColor : this.editor.config.gridColor,
                        strokeWidth: isMajor ? 1 / zoom : 0.5 / zoom
                    }));
                    if (isMajor && i !== 0) {
                        const meters = Math.round((i / this.baseScale) * 10) / 10;
                        this.editor.layers.background.add(new Konva.Text({
                            x: gridStartX + 5 / zoom, y: i + 3 / zoom,
                            text: `${meters}m`, fontSize: 10 / zoom,
                            fill: this.editor.cssColors.gridLabel
                        }));
                    }
                }
                
                this.editor.layers.background.batchDraw();
            }
            
            onWheel(e) {
                e.preventDefault();
                const oldZoom = this.currentZoom;
                const delta = -e.deltaY * this.config.wheelSensitivity;
                let newZoom = Math.max(this.config.minZoom, Math.min(this.config.maxZoom, oldZoom + delta));
                if (newZoom === oldZoom) return;
                
                const pointer = this.editor.stage.getPointerPosition();
                const mousePointTo = {
                    x: pointer.x / oldZoom - this.editor.stage.x() / oldZoom,
                    y: pointer.y / oldZoom - this.editor.stage.y() / oldZoom
                };
                this.setZoom(newZoom);
                this.editor.stage.position({
                    x: -(mousePointTo.x - pointer.x / newZoom) * newZoom,
                    y: -(mousePointTo.y - pointer.y / newZoom) * newZoom
                });
                this.updateGrid();
                this.editor.stage.batchDraw();
            }
        }
        
        // =====================================================
        // âœ¨ AlignmentTool - ì •ë ¬ ë° íšŒì „ ê¸°ëŠ¥
        // =====================================================

        
        class WallDrawToolFixed extends WallDrawTool {
            constructor(canvas2DEditor) { super(canvas2DEditor); }
            
            // âœ… Shift í‚¤ê°€ ëˆŒë ¸ì„ ë•Œ ë²½ ê·¸ë¦¬ê¸° ì‹œì‘í•˜ì§€ ì•ŠìŒ (ë°•ìŠ¤ ì„ íƒê³¼ ì¶©ëŒ ë°©ì§€)
            onMouseDown(e) {
                if (!this.isActive) return;
                
                // âœ… Shift í‚¤ê°€ ëˆŒë ¸ìœ¼ë©´ ë²½ ê·¸ë¦¬ê¸° ì‹œì‘í•˜ì§€ ì•ŠìŒ (ë°•ìŠ¤ ì„ íƒê³¼ ì¶©ëŒ ë°©ì§€)
                if (e.evt && e.evt.shiftKey) {
                    console.log('[WallDrawToolFixed] Shift í‚¤ ê°ì§€ - ë²½ ê·¸ë¦¬ê¸° ê±´ë„ˆëœ€ (ë°•ìŠ¤ ì„ íƒ ëª¨ë“œ)');
                    return;
                }
                
                // Stage í´ë¦­ì¸ì§€ í™•ì¸ (ê°ì²´ í´ë¦­ ì œì™¸)
                if (e.target !== this.canvas.stage) {
                    return;
                }
                
                // ì‹œì‘ì  ê¸°ë¡
                const pos = this.getMousePos(e);
                this.startPoint = pos;
                this.isDrawing = true;
                
                console.log('[WallDrawToolFixed] ê·¸ë¦¬ê¸° ì‹œì‘:', pos);
                
                // ì„ì‹œ ë¼ì¸ ìƒì„± (ì ì„ )
                this.tempLine = new Konva.Line({
                    points: [pos.x, pos.y, pos.x, pos.y],
                    stroke: '#667eea',
                    strokeWidth: 3,
                    dash: [10, 5],
                    lineCap: 'round',
                    listening: false
                });
                
                this.canvas.layers.ui.add(this.tempLine);
                this.canvas.layers.ui.batchDraw();
            }
            
            getMousePos(e) {
                const stage = this.canvas.stage;
                const pointer = stage.getPointerPosition();
                if (!pointer) return { x: 0, y: 0 };
                const transform = stage.getAbsoluteTransform().copy();
                transform.invert();
                return transform.point(pointer);
            }
        }
        
        class ObjectSelectionToolExtended extends ObjectSelectionTool {
            constructor(canvas2DEditor) { super(canvas2DEditor); }
            
            attachEventListeners() {
                const layers = [this.editor.layers.equipment, this.editor.layers.room];
                layers.forEach(layer => {
                    if (!layer) return;
                    layer.find('.equipment, .wall, .office, .partition, .desk, .pillar, .component').forEach(shape => {
                        if (shape.draggable()) this.attachShapeEvents(shape);
                    });
                });
            }
            
            onMouseUp(e) {
                if (!this.isSelecting) return;
                this.isSelecting = false;
                const box = this.selectionBox.getClientRect();
                if (!this.ctrlKeyPressed) this.editor.deselectAll();
                
                [this.editor.layers.equipment, this.editor.layers.room].forEach(layer => {
                    if (!layer) return;
                    layer.getChildren().forEach(shape => {
                        const name = shape.name();
                        if (['equipment', 'wall', 'office', 'partition', 'desk', 'pillar', 'component'].some(t => name?.includes(t))) {
                            if (this.haveIntersection(box, shape.getClientRect())) {
                                this.editor.selectObject(shape, true);
                            }
                        }
                    });
                });
                
                if (this.selectionBox) { this.selectionBox.destroy(); this.selectionBox = null; }
                if (this.selectionCountLabel) { this.selectionCountLabel.destroy(); this.selectionCountLabel = null; }
                this.editor.layers.ui.batchDraw();
                this.justFinishedBoxSelect = true;
                setTimeout(() => { this.editor._isBoxSelecting = false; this.justFinishedBoxSelect = false; }, 100);
            }
        }
        
        class LayoutEditorApp {
            constructor() {
                this.componentSubmenuVisible = false;
                
                // ì´ˆê¸° ìº”ë²„ìŠ¤ í¬ê¸° ê³„ì‚°
                const canvasSize = this.calculateCanvasSize();
                
                this.canvas = new Canvas2DEditor('canvas-container', {
                    width: canvasSize.width,
                    height: canvasSize.height,
                    showGrid: true,
                    snapToGrid: true,
                    gridSize: 10
                });
                
                this.zoomController = new ZoomControllerExtended(this.canvas, {
                    minZoom: 0.2, maxZoom: 5.0, zoomStep: 0.1, wheelSensitivity: 0.001
                });
                this.canvas.setZoomController(this.zoomController);
                this.zoomController.activate();
                
                this.selectionTool = new ObjectSelectionToolExtended(this.canvas);
                this.selectionTool.activate();
                
                this.enableDropZone();
                
                this.roomSizeManager = new RoomSizeManager(this.canvas);
                this.wallDrawTool = new WallDrawToolFixed(this.canvas);
                this.propertyPanel = new PropertyPanel('property-panel', this.canvas);
                this.canvas.setPropertyPanel(this.propertyPanel);
                
                // âœ¨ AlignmentTool ì´ˆê¸°í™”
                this.alignmentTool = new AlignmentTool(this.canvas);
                this.alignPopupVisible = false;
                
                this.setupComponentSubmenu();
                this.currentTool = 'select';
                this.setupEventListeners();
                setInterval(() => this.updateStatus(), 500);
                this.showToast('Layout Editor ì¤€ë¹„ ì™„ë£Œ!', 'success');
            }
            
            // âœ¨ ìº”ë²„ìŠ¤ í¬ê¸° ê³„ì‚° (ì„œë¸Œë©”ë‰´ ìƒíƒœ ê³ ë ¤)
            calculateCanvasSize() {
                const toolbarWidth = this.componentSubmenuVisible ? TOOLBAR_EXPANDED_WIDTH : TOOLBAR_WIDTH;
                return {
                    width: window.innerWidth - toolbarWidth - PROPERTY_PANEL_WIDTH,
                    height: window.innerHeight - HEADER_HEIGHT - STATUS_HEIGHT
                };
            }
            
            // âœ¨ ìº”ë²„ìŠ¤ í¬ê¸° ì—…ë°ì´íŠ¸
            updateCanvasSize() {
                const size = this.calculateCanvasSize();
                this.canvas.resize(size.width, size.height);
                this.zoomController?.updateGrid();
            }
            
            enableDropZone() {
                const container = this.canvas.stage.container();
                const dropGuide = document.getElementById('drop-guide');
                container.addEventListener('dragover', e => { e.preventDefault(); dropGuide.classList.add('visible'); });
                container.addEventListener('dragleave', () => dropGuide.classList.remove('visible'));
                container.addEventListener('drop', e => { e.preventDefault(); dropGuide.classList.remove('visible'); this.handleDrop(e); });
            }
            
            handleDrop(event) {
                const componentType = event.dataTransfer.getData('text/plain');
                const component = COMPONENTS[componentType];
                if (!component) return;
                
                const stage = this.canvas.stage;
                const rect = stage.container().getBoundingClientRect();
                const transform = stage.getAbsoluteTransform().copy();
                transform.invert();
                const pos = transform.point({ x: event.clientX - rect.left, y: event.clientY - rect.top });
                
                const shape = this.createComponent(component, pos.x, pos.y);
                if (shape) {
                    this.canvas.selectObject(shape, false);
                    this.selectionTool.attachShapeEvents(shape);
                    this.updateObjectCount();
                    this.showToast(`${component.name} ìƒì„±ë¨`, 'success');
                }
            }
            
            createComponent(component, x, y) {
                const scale = this.canvas.config.scale;
                const width = component.width * scale;
                const height = component.depth * scale;
                
                if (this.canvas.config.snapToGrid) {
                    const gridSize = this.canvas.config.gridSize;
                    x = Math.round(x / gridSize) * gridSize;
                    y = Math.round(y / gridSize) * gridSize;
                }
                
                const id = `${component.id}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                
                // âœ¨ Groupìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ ìƒì„± (Rect + ë°©í–¥ í™”ì‚´í‘œ)
                const group = new Konva.Group({
                    id, x: x, y: y,
                    draggable: true,
                    name: component.id + ' component'
                });
                
                // ë©”ì¸ Rect
                const rect = new Konva.Rect({
                    x: -width / 2, y: -height / 2,
                    width, height, fill: component.color,
                    stroke: '#333', strokeWidth: 2,
                    name: 'componentRect'
                });
                
                // âœ¨ ë°©í–¥ í™”ì‚´í‘œ (ì •ë©´ í‘œì‹œ)
                const arrowLength = Math.min(width, height) * 0.6;
                const arrow = new Konva.Arrow({
                    points: [0, height / 2 - 5, 0, height / 2 - 5 - arrowLength],
                    pointerLength: 8,
                    pointerWidth: 8,
                    fill: '#ff4444',
                    stroke: '#ff4444',
                    strokeWidth: 3,
                    name: 'directionArrow'
                });
                
                // ë°©í–¥ í‘œì‹œ í…ìŠ¤íŠ¸
                const dirLabel = new Konva.Text({
                    x: -15, y: height / 2 - arrowLength - 25,
                    text: 'Front',
                    fontSize: 10,
                    fill: '#ff4444',
                    fontStyle: 'bold',
                    name: 'directionLabel'
                });
                
                group.add(rect);
                group.add(arrow);
                group.add(dirLabel);
                
                group.setAttr('componentType', component.id);
                group.setAttr('componentData', component);
                group.setAttr('currentRotation', 0);
                
                group.on('dragend', () => { 
                    if (this.canvas.config.snapToGrid) {
                        const gridSize = this.canvas.config.gridSize;
                        group.x(Math.round(group.x() / gridSize) * gridSize);
                        group.y(Math.round(group.y() / gridSize) * gridSize);
                        group.getLayer().batchDraw();
                    }
                });
                group.on('click tap', e => { e.cancelBubble = true; this.canvas.selectObject(group, e.evt.ctrlKey || e.evt.metaKey); });
                
                const layer = component.id === 'equipment' ? this.canvas.layers.equipment : this.canvas.layers.room;
                layer.add(group);
                layer.batchDraw();
                this.canvas.componentShapes.set(id, group);
                return group;
            }
            
            setupComponentSubmenu() {
                document.querySelectorAll('.submenu-item').forEach(item => {
                    const componentType = item.dataset.component;
                    item.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', componentType); item.style.opacity = '0.5'; });
                    item.addEventListener('dragend', () => item.style.opacity = '1');
                    item.addEventListener('click', () => {
                        const component = COMPONENTS[componentType];
                        if (component) {
                            const stage = this.canvas.stage;
                            const centerX = (this.canvas.config.width / 2 - stage.x()) / stage.scaleX();
                            const centerY = (this.canvas.config.height / 2 - stage.y()) / stage.scaleY();
                            const shape = this.createComponent(component, centerX, centerY);
                            if (shape) {
                                this.canvas.selectObject(shape, false);
                                this.selectionTool.attachShapeEvents(shape);
                                this.updateObjectCount();
                                this.showToast(`${component.name} ìƒì„±ë¨`, 'success');
                            }
                        }
                    });
                });
            }
            
            // âœ¨ ì„œë¸Œë©”ë‰´ í† ê¸€ (íˆ´ë°” ì»¨í…Œì´ë„ˆ í™•ì¥/ì¶•ì†Œ)
            toggleComponentSubmenu() {
                this.componentSubmenuVisible = !this.componentSubmenuVisible;
                const toolbarContainer = document.getElementById('toolbar-container');
                const btn = document.getElementById('component-btn');
                
                toolbarContainer.classList.toggle('expanded', this.componentSubmenuVisible);
                btn.classList.toggle('active', this.componentSubmenuVisible);
                
                // ìº”ë²„ìŠ¤ í¬ê¸° ì—…ë°ì´íŠ¸ (transition í›„)
                setTimeout(() => this.updateCanvasSize(), 350);
            }
            
            setupEventListeners() {
                document.addEventListener('keydown', e => {
                    if (e.ctrlKey && e.key === 'z') { e.preventDefault(); this.undo(); }
                    else if (e.ctrlKey && e.key === 'y') { e.preventDefault(); this.redo(); }
                    else if (e.ctrlKey && e.key === 'a') { e.preventDefault(); this.selectAll(); }
                    else if ((e.key === 'v' || e.key === 'V') && !e.ctrlKey) this.activateTool('select');
                    else if (e.key === 'w' || e.key === 'W') this.activateTool('wall');
                    else if ((e.key === 'c' || e.key === 'C') && !e.ctrlKey) this.toggleComponentSubmenu();
                    else if (e.key === 'g' || e.key === 'G') this.toggleGrid();
                    else if ((e.key === 's' || e.key === 'S') && !e.ctrlKey) this.toggleSnap();
                    else if (e.key === '+' || e.key === '=') this.zoomIn();
                    else if (e.key === '-' || e.key === '_') this.zoomOut();
                    // âœ¨ Rí‚¤: íšŒì „ (Shift+R ë°˜ì‹œê³„, R ì‹œê³„ë°©í–¥)
                    else if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        if (e.shiftKey) this.rotateCCW();
                        else this.rotateCW();
                    }
                    else if (e.key === 'R' && !e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        if (e.shiftKey) this.rotateCCW();
                        else this.rotateCW();
                    }
                    // âœ¨ 0í‚¤: ì¤Œ ë¦¬ì…‹
                    else if (e.key === '0') this.resetZoom();
                    // âœ¨ Aí‚¤: ì •ë ¬ íŒì—… í† ê¸€
                    else if ((e.key === 'a' || e.key === 'A') && !e.ctrlKey && !e.metaKey) {
                        e.preventDefault();
                        this.toggleAlignPopup();
                    }
                    else if (e.key === 'Delete' || e.key === 'Backspace') this.deleteSelected();
                    else if (e.key === 'Escape') { 
                        this.deselectAll(); 
                        if (this.componentSubmenuVisible) this.toggleComponentSubmenu();
                        if (this.alignPopupVisible) this.toggleAlignPopup();
                    }
                });
                
                window.addEventListener('resize', () => this.updateCanvasSize());
                
                // ì™¸ë¶€ í´ë¦­ ì‹œ ì„œë¸Œë©”ë‰´ ë‹«ê¸°
                document.addEventListener('click', e => {
                    const toolbarContainer = document.getElementById('toolbar-container');
                    const btn = document.getElementById('component-btn');
                    const alignPopup = document.getElementById('align-popup');
                    const alignBtn = document.getElementById('align-btn');
                    
                    // ì»´í¬ë„ŒíŠ¸ ì„œë¸Œë©”ë‰´ ë‹«ê¸°
                    if (this.componentSubmenuVisible && !toolbarContainer.contains(e.target)) {
                        this.toggleComponentSubmenu();
                    }
                    
                    // ì •ë ¬ íŒì—… ë‹«ê¸°
                    if (this.alignPopupVisible && !alignPopup.contains(e.target) && !alignBtn.contains(e.target)) {
                        this.hideAlignPopup();
                    }
                });
            }
            
            activateTool(toolName) {
                this.currentTool = toolName;
                if (toolName === 'select') this.wallDrawTool.deactivate();
                else if (toolName === 'wall') this.wallDrawTool.activate();
                
                document.querySelectorAll('.toolbar-btn').forEach(btn => btn.classList.remove('active'));
                const toolButtons = { 'select': 0, 'wall': 2 };
                if (toolButtons[toolName] !== undefined) {
                    document.querySelectorAll('.toolbar-btn')[toolButtons[toolName]].classList.add('active');
                }
                document.getElementById('status-tool').textContent = toolName === 'select' ? 'ì„ íƒ' : toolName === 'wall' ? 'ë²½ ê·¸ë¦¬ê¸°' : toolName;
                if (toolName === 'wall') this.showToast('ë²½ ê·¸ë¦¬ê¸° ëª¨ë“œ', 'info');
            }
            
            showRoomSizeModal() { document.getElementById('room-size-modal').classList.add('active'); }
            closeRoomSizeModal() { document.getElementById('room-size-modal').classList.remove('active'); }
            applyRoomSize() {
                const width = parseFloat(document.getElementById('room-width').value);
                const depth = parseFloat(document.getElementById('room-depth').value);
                const height = parseFloat(document.getElementById('room-height').value);
                if (width < 10 || depth < 10) { this.showToast('ìµœì†Œ 10m ì´ìƒ', 'error'); return; }
                this.roomSizeManager.updateRoomSize(width, depth, height);
                this.closeRoomSizeModal();
                this.showToast(`Room: ${width}m Ã— ${depth}m`, 'success');
            }
            
            toggleGrid() {
                this.canvas.toggleGrid();
                document.getElementById('status-grid').textContent = this.canvas.config.showGrid ? 'ON' : 'OFF';
            }
            toggleSnap() {
                const isOn = this.canvas.toggleSnapToGrid();
                document.getElementById('status-snap').textContent = isOn ? 'ON' : 'OFF';
            }
            
            zoomIn() { this.zoomController.zoomIn(); this.updateZoomDisplay(); }
            zoomOut() { this.zoomController.zoomOut(); this.updateZoomDisplay(); }
            resetZoom() { this.zoomController.resetZoom(); this.updateZoomDisplay(); }
            updateZoomDisplay() { document.getElementById('status-zoom').textContent = (this.zoomController.getZoom() * 100).toFixed(0) + '%'; }
            
            deleteSelected() {
                if (this.canvas.selectedObjects.length === 0) { this.showToast('ì„ íƒëœ ê°ì²´ ì—†ìŒ', 'info'); return; }
                const count = this.canvas.selectedObjects.length;
                this.canvas.deleteSelected();
                this.updateObjectCount();
                this.showToast(`${count}ê°œ ì‚­ì œë¨`);
            }
            
            deselectAll() { this.canvas.deselectAll(); this.propertyPanel.hide(); this.updateStatus(); }
            selectAll() { this.selectionTool?.selectAll(); this.updateStatus(); this.showToast(`${this.canvas.selectedObjects.length}ê°œ ì„ íƒë¨`, 'success'); }
            updateObjectCount() { setTimeout(() => document.getElementById('status-objects').textContent = this.canvas.getObjectCount().total, 100); }
            updateStatus() {
                document.getElementById('status-objects').textContent = this.canvas.getObjectCount().total;
                document.getElementById('status-selected').textContent = this.canvas.selectedObjects.length;
                this.updateZoomDisplay();
                document.getElementById('status-grid').textContent = this.canvas.config.showGrid ? 'ON' : 'OFF';
                document.getElementById('status-snap').textContent = this.canvas.config.snapToGrid ? 'ON' : 'OFF';
            }
            
            undo() { this.showToast('Undo ì¤€ë¹„ ì¤‘'); }
            redo() { this.showToast('Redo ì¤€ë¹„ ì¤‘'); }
            
            saveLayout() {
                const layout = this.canvas.getCurrentLayout();
                const blob = new Blob([JSON.stringify(layout, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'layout_' + Date.now() + '.json';
                link.click();
                this.showToast('ì €ì¥ ì™„ë£Œ!', 'success');
            }
            
            loadSampleLayout() {
                this.canvas.loadLayout({
                    room: { width: 30, height: 20, walls: [], offices: [] },
                    equipment: [
                        { id: 'eq_1', x: 2, y: 5, width: 2, depth: 1.5, name: 'Equipment 1', rotation: 0 },
                        { id: 'eq_2', x: 5, y: 5, width: 2, depth: 1.5, name: 'Equipment 2', rotation: 0 },
                        { id: 'eq_3', x: 8, y: 5, width: 2, depth: 1.5, name: 'Equipment 3', rotation: 0 },
                        { id: 'eq_4', x: 2, y: 8, width: 2, depth: 1.5, name: 'Equipment 4', rotation: 0 },
                        { id: 'eq_5', x: 5, y: 8, width: 2, depth: 1.5, name: 'Equipment 5', rotation: 0 },
                        { id: 'eq_6', x: 8, y: 8, width: 2, depth: 1.5, name: 'Equipment 6', rotation: 0 }
                    ]
                });
                this.selectionTool?.attachEventListeners();
                this.updateObjectCount();
                this.showToast('ìƒ˜í”Œ ë¡œë“œ ì™„ë£Œ!', 'success');
            }
            
            // =====================================================
            // âœ¨ ì •ë ¬/íšŒì „ ê¸°ëŠ¥ (AlignmentTool ì—°ë™)
            // =====================================================
            
            toggleAlignPopup() {
                this.alignPopupVisible = !this.alignPopupVisible;
                const popup = document.getElementById('align-popup');
                const btn = document.getElementById('align-btn');
                
                if (this.alignPopupVisible) {
                    // ë²„íŠ¼ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ íŒì—… ìœ„ì¹˜ ê³„ì‚°
                    const btnRect = btn.getBoundingClientRect();
                    popup.style.top = `${btnRect.top}px`;
                    popup.style.left = `${btnRect.right + 5}px`; // ë²„íŠ¼ ì˜¤ë¥¸ìª½ 5px
                }
                
                popup.classList.toggle('show', this.alignPopupVisible);
                btn.classList.toggle('active', this.alignPopupVisible);
                
                // ì„œë¸Œë©”ë‰´ê°€ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
                if (this.alignPopupVisible && this.componentSubmenuVisible) {
                    this.toggleComponentSubmenu();
                }
            }
            
            // ì •ë ¬ ë©”ì„œë“œë“¤
            alignLeft() { this.alignmentTool.alignLeft(); this.hideAlignPopup(); }
            alignRight() { this.alignmentTool.alignRight(); this.hideAlignPopup(); }
            alignTop() { this.alignmentTool.alignTop(); this.hideAlignPopup(); }
            alignBottom() { this.alignmentTool.alignBottom(); this.hideAlignPopup(); }
            alignCenterH() { this.alignmentTool.alignCenterHorizontal(); this.hideAlignPopup(); }
            alignCenterV() { this.alignmentTool.alignCenterVertical(); this.hideAlignPopup(); }
            
            // ë¶„ë°° ë©”ì„œë“œë“¤
            distributeH() { this.alignmentTool.distributeHorizontal(); this.hideAlignPopup(); }
            distributeV() { this.alignmentTool.distributeVertical(); this.hideAlignPopup(); }
            
            // íšŒì „ ë©”ì„œë“œë“¤
// íšŒì „ ë©”ì„œë“œë“¤
rotateCW() { 
    console.log('[LayoutEditorApp] rotateCW í˜¸ì¶œë¨');
    console.log('alignmentTool:', this.alignmentTool);
    console.log('selectedObjects:', this.canvas.selectedObjects);
    
    if (!this.alignmentTool) {
        console.error('[LayoutEditorApp] AlignmentToolì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ!');
        this.showToast('AlignmentTool ì´ˆê¸°í™” ì˜¤ë¥˜', 'error');
        return;
    }
    
    this.alignmentTool.rotateCW(); 
}

rotateCCW() { 
    console.log('[LayoutEditorApp] rotateCCW í˜¸ì¶œë¨');
    
    if (!this.alignmentTool) {
        console.error('[LayoutEditorApp] AlignmentToolì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ!');
        this.showToast('AlignmentTool ì´ˆê¸°í™” ì˜¤ë¥˜', 'error');
        return;
    }
    
    this.alignmentTool.rotateCCW(); 
}
            resetRotation() { this.alignmentTool.resetRotation(); this.hideAlignPopup(); }
            
            hideAlignPopup() {
                if (this.alignPopupVisible) {
                    this.alignPopupVisible = false;
                    document.getElementById('align-popup').classList.remove('show');
                    document.getElementById('align-btn').classList.remove('active');
                }
            }
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => { toast.style.animation = 'slideIn 0.3s reverse'; setTimeout(() => toast.remove(), 300); }, 2500);
            }
        }
        
        window.editorApp = new LayoutEditorApp();
    </script>
</body>
</html>