<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test: Cleanroom Sidebar (Standalone) v2.10</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        /* =============================================
           CSS Variables
           [MIGRATE TO] src/styles/variables.css
           ============================================= */
        :root, [data-theme="dark"] {
            --bg-sidebar: #0F172A;
            --bg-main: #1e293b;
            --bg-main-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --bg-panel: #1E293B;
            --bg-panel-header: rgba(0,0,0,0.2);
            --bg-input: rgba(255,255,255,0.05);
            --bg-hover: rgba(255,255,255,0.05);
            --bg-selected: rgba(6, 182, 212, 0.1);
            --border-color: rgba(255,255,255,0.1);
            --border-subtle: rgba(255,255,255,0.05);
            --icon-normal: #E2E8F0;
            --icon-selected: #06B6D4;
            --icon-disabled: #334155;
            --icon-hover: #FFFFFF;
            --text-primary: #E2E8F0;
            --text-secondary: #9CA3AF;
            --text-muted: #6B7280;
            --text-normal: #CBD5E1;
            --text-warning: #FBBF24;
            --text-alarm: #F87171;
            --text-success: #4ADE80;
            --shadow-color: rgba(0,0,0,0.5);
            --glow-color: rgba(6, 182, 212, 0.4);
            --icon-size: 36px;
            --transition-speed: 0.25s;
            --status-bar-height: 36px;
        }
        
        [data-theme="light"] {
            --bg-sidebar: #F8FAFC;
            --bg-main: #FFFFFF;
            --bg-main-gradient: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%);
            --bg-panel: #FFFFFF;
            --bg-panel-header: rgba(0,0,0,0.02);
            --bg-input: rgba(0,0,0,0.03);
            --bg-hover: rgba(0,0,0,0.05);
            --border-color: rgba(0,0,0,0.1);
            --icon-normal: #475569;
            --icon-selected: #0891B2;
            --icon-disabled: #CBD5E1;
            --icon-hover: #0F172A;
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-muted: #94A3B8;
            --text-alarm: #DC2626;
            --text-success: #16A34A;
            --shadow-color: rgba(0,0,0,0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; height: 100vh; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: var(--bg-main); }
        
        /* =============================================
           Sidebar
           [MIGRATE TO] src/ui/sidebar/Sidebar.js
           ============================================= */
        .sidebar { width: 80px; background-color: var(--bg-sidebar); display: flex; flex-direction: column; align-items: center; padding-top: 24px; z-index: 10; box-shadow: 4px 0 15px var(--shadow-color); }
        .icon-btn { width: 54px; height: 54px; margin-bottom: 12px; background: transparent; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative; transition: transform var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1); }
        .icon-btn svg { width: var(--icon-size); height: var(--icon-size); fill: none; stroke: var(--icon-normal); stroke-width: 1px; stroke-linecap: round; stroke-linejoin: round; transition: all var(--transition-speed); }
        .icon-btn:not(.selected):not(.disabled):hover { transform: scale(1.1) translateY(-3px); }
        .icon-btn:not(.selected):not(.disabled):hover svg { stroke: var(--icon-hover); filter: drop-shadow(0 0 3px var(--glow-color)); }
        .icon-btn.selected { transform: scale(1.08) translateY(-2px); }
        .icon-btn.selected svg { stroke: var(--icon-selected); filter: drop-shadow(0 0 6px var(--icon-selected)); }
        .icon-btn.selected::before { content: ''; position: absolute; left: -13px; width: 3px; height: 28px; background-color: var(--icon-selected); border-radius: 0 3px 3px 0; box-shadow: 0 0 6px var(--icon-selected); }
        .icon-btn.disabled { cursor: not-allowed; opacity: 0.4; pointer-events: none; }
        .icon-btn.disabled svg { stroke: var(--icon-disabled); }
        .icon-btn.hidden { display: none !important; }

        /* =============================================
           Submenu System
           [MIGRATE TO] src/ui/sidebar/Submenu.js
           ============================================= */
        .has-submenu { position: relative; }
        .submenu { position: absolute; left: 70px; top: 0; background: var(--bg-sidebar); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px 0; min-width: 200px; opacity: 0; visibility: hidden; transform: translateX(-10px); transition: all 0.2s ease; box-shadow: 4px 4px 20px var(--shadow-color); z-index: 100; }
        #btn-settings-wrapper .submenu, #btn-debug-wrapper .submenu { top: auto; bottom: 0; }
        .has-submenu:not(.disabled):hover .submenu { opacity: 1; visibility: visible; transform: translateX(0); }
        .has-submenu.disabled .submenu { opacity: 0 !important; visibility: hidden !important; pointer-events: none !important; }
        .submenu-item { display: flex; align-items: center; gap: 10px; padding: 10px 16px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.15s; border: none; background: none; width: 100%; text-align: left; }
        .submenu-item:hover { background: var(--bg-hover); color: var(--text-primary); }
        .submenu-item.active { background: var(--bg-selected); color: var(--icon-selected); }
        .submenu-item.disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
        .submenu-item svg { width: 18px; height: 18px; stroke: currentColor; stroke-width: 1.5px; fill: none; }
        .submenu-divider { height: 1px; background: var(--border-color); margin: 6px 12px; }
        .submenu-header { padding: 6px 16px; font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .has-submenu::after { content: ''; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); border: 4px solid transparent; border-left-color: var(--icon-normal); opacity: 0.5; }
        .has-submenu:not(.disabled):hover::after { border-left-color: var(--icon-selected); opacity: 1; }
        
        /* Always Normal State */
        #btn-connection, #btn-settings-wrapper .icon-btn, #btn-debug-wrapper .icon-btn { transform: none !important; }
        #btn-connection::before, #btn-settings-wrapper .icon-btn::before, #btn-debug-wrapper .icon-btn::before { display: none !important; }
        #btn-connection svg, #btn-settings-wrapper .icon-btn svg, #btn-debug-wrapper .icon-btn svg { stroke: var(--icon-normal) !important; filter: none !important; }
        #btn-connection:hover svg, #btn-settings-wrapper .icon-btn:hover svg, #btn-debug-wrapper .icon-btn:hover svg { stroke: var(--icon-hover) !important; filter: drop-shadow(0 0 3px var(--glow-color)) !important; }
        #btn-connection:hover, #btn-settings-wrapper:hover .icon-btn, #btn-debug-wrapper:hover .icon-btn { transform: scale(1.1) translateY(-3px) !important; }

        /* Theme Toggle */
        .theme-toggle-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; color: var(--text-secondary); font-size: 13px; }
        .theme-toggle-label { display: flex; align-items: center; gap: 10px; }
        .theme-toggle-label svg { width: 18px; height: 18px; stroke: currentColor; stroke-width: 1.5px; fill: none; }
        .theme-switch { position: relative; width: 44px; height: 24px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; }
        .theme-switch::before { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: var(--icon-normal); border-radius: 50%; transition: all 0.3s ease; }
        .theme-switch.active { background: var(--icon-selected); border-color: var(--icon-selected); }
        .theme-switch.active::before { left: 22px; background: white; }

        /* =============================================
           Main Content & Views
           [MIGRATE TO] src/styles/layout.css
           
           [v2.10] Cover Screen: Default view on startup
           [v2.10] Three.js: Only when Monitoring ‚Üí 3D View
           ============================================= */
        .main-content { flex-grow: 1; background: var(--bg-main-gradient); display: flex; flex-direction: column; color: var(--text-primary); margin-bottom: var(--status-bar-height); position: relative; overflow: hidden; }
        
        /* [v2.10] Cover Screen - Default startup view */
        #cover-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; background: var(--bg-main-gradient); }
        #cover-screen.hidden { display: none; }
        .cover-logo { font-size: 72px; margin-bottom: 20px; animation: float-logo 3s ease-in-out infinite; }
        @keyframes float-logo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .cover-title { font-size: 32px; font-weight: 700; color: var(--icon-selected); margin-bottom: 8px; letter-spacing: 2px; }
        .cover-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 40px; }
        .cover-status { display: flex; flex-direction: column; align-items: center; gap: 16px; }
        .cover-status-item { display: flex; align-items: center; gap: 12px; padding: 12px 24px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 10px; min-width: 280px; }
        .cover-status-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 2s infinite; }
        .cover-status-dot.connected { background: var(--text-success); box-shadow: 0 0 8px var(--text-success); }
        .cover-status-dot.disconnected { background: var(--text-alarm); }
        .cover-status-text { font-size: 13px; color: var(--text-secondary); flex: 1; }
        .cover-status-value { font-size: 13px; color: var(--text-primary); font-weight: 500; }
        .cover-hint { margin-top: 40px; font-size: 12px; color: var(--text-muted); }
        .cover-hint kbd { padding: 2px 8px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; font-family: 'Consolas', monospace; }

        /* [v2.10] Three.js Container - Hidden by default */
        #threejs-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; display: none; }
        #threejs-container.active { display: block; }
        
        .overlay-ui { position: absolute; top: 20px; left: 20px; z-index: 10; display: flex; flex-direction: column; gap: 10px; }
        .mode-indicator { padding: 12px 20px; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); border: 1px solid var(--border-color); border-radius: 10px; }
        .mode-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .mode-value { font-size: 18px; font-weight: bold; color: var(--icon-selected); }
        .submode-value { font-size: 12px; color: var(--text-secondary); }

        /* Test Controls */
        .test-controls { padding: 16px; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); border: 1px solid var(--border-color); border-radius: 10px; max-width: 280px; }
        .test-controls h4 { font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 12px; letter-spacing: 0.5px; }
        .test-btn { display: block; width: 100%; padding: 10px 14px; margin-bottom: 8px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 12px; cursor: pointer; text-align: left; transition: all 0.2s; }
        .test-btn:hover { background: var(--bg-selected); border-color: var(--icon-selected); }
        .test-btn-icon { margin-right: 8px; }

        /* =============================================
           Equipment Info Panel
           ============================================= */
        #equipmentInfo { position: fixed; top: 80px; right: 20px; width: 320px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 10px 40px var(--shadow-color); z-index: 100; opacity: 0; visibility: hidden; transform: translateX(20px); transition: all 0.3s ease; }
        #equipmentInfo.active { opacity: 1; visibility: visible; transform: translateX(0); }
        .equipment-panel-header { display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid var(--border-subtle); background: var(--bg-panel-header); border-radius: 12px 12px 0 0; }
        .equipment-panel-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .equipment-panel-title.multi-select { color: var(--icon-selected); }
        .header-status { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: var(--bg-input); border-radius: 12px; }
        .status-indicator { width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-indicator.run { background: var(--text-success); box-shadow: 0 0 8px var(--text-success); }
        .status-indicator.idle { background: var(--text-warning); box-shadow: 0 0 8px var(--text-warning); }
        .status-indicator.stop { background: var(--text-alarm); box-shadow: 0 0 8px var(--text-alarm); }
        .status-indicator.disconnected { background: var(--text-muted); }
        .status-text { font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .status-text.run { color: var(--text-success); }
        .status-text.idle { color: var(--text-warning); }
        .status-text.stop { color: var(--text-alarm); }
        .status-text.disconnected { color: var(--text-muted); }
        .close-btn { position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: var(--bg-input); border: none; border-radius: 6px; color: var(--text-muted); cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .close-btn:hover { background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        .equipment-panel-tabs { display: flex; border-bottom: 1px solid var(--border-subtle); padding: 0 16px; }
        .equipment-tab { padding: 10px 16px; background: none; border: none; color: var(--text-muted); font-size: 12px; cursor: pointer; position: relative; }
        .equipment-tab:hover { color: var(--text-primary); }
        .equipment-tab.active { color: var(--icon-selected); }
        .equipment-tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--icon-selected); }
        .equipment-panel-content { padding: 16px; max-height: 400px; overflow-y: auto; }
        .equipment-tab-content { display: none; }
        .equipment-tab-content.active { display: block; }
        .info-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
        .info-label { font-size: 12px; color: var(--text-muted); }
        .info-value { font-size: 12px; color: var(--text-primary); font-family: 'Consolas', monospace; }
        .info-value-small { font-size: 11px; }
        .info-row-divider { height: 1px; background: var(--border-subtle); margin: 8px 0; }
        .multi-select-header { background: var(--bg-selected); padding: 10px 12px; border-radius: 6px; margin-bottom: 12px; }
        .info-icon { margin-right: 8px; }
        .info-text { font-size: 12px; color: var(--text-secondary); }
        .info-badge { font-size: 10px; padding: 2px 8px; background: var(--icon-selected); color: white; border-radius: 10px; margin-left: 8px; }
        .status-counts { display: flex; gap: 8px; flex-wrap: wrap; }
        .status-count-item { display: flex; align-items: center; gap: 4px; padding: 2px 8px; background: var(--bg-input); border-radius: 4px; font-size: 11px; }
        .status-count-item.run { color: var(--text-success); }
        .status-count-item.idle { color: var(--text-warning); }
        .status-count-item.stop { color: var(--text-alarm); }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* PC Info Tab - Gauge System */
        .pcinfo-system-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
        .pcinfo-system-row .info-label { min-width: 45px; font-size: 11px; color: var(--text-muted); }
        .pcinfo-system-row .info-value { font-size: 11px; color: var(--text-primary); text-align: right; flex: 1; }
        .value-separator { color: var(--text-muted); margin: 0 4px; }
        .boot-duration { padding: 2px 8px; border-radius: 4px; font-size: 11px; }
        .boot-duration.boot-green { background: rgba(74, 222, 128, 0.15); color: var(--text-success); }
        .boot-duration.boot-yellow { background: rgba(251, 191, 36, 0.15); color: var(--text-warning); }
        .boot-duration.boot-red { background: rgba(248, 113, 113, 0.15); color: var(--text-alarm); }
        .gauge-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-subtle); }
        .gauge-section-title { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
        .unified-gauge-row { display: flex; align-items: center; padding: 6px 0; gap: 10px; }
        .unified-gauge-label { min-width: 35px; font-size: 11px; color: var(--text-muted); }
        .unified-gauge-container { flex: 1; display: flex; align-items: center; gap: 10px; }
        .unified-gauge-bar { flex: 1; height: 6px; background: var(--bg-input); border-radius: 3px; overflow: hidden; }
        .unified-gauge-fill { height: 100%; border-radius: 3px; transition: width 0.3s ease, background 0.3s ease; }
        .unified-gauge-fill.gauge-green { background: var(--text-success); }
        .unified-gauge-fill.gauge-yellow { background: var(--text-warning); }
        .unified-gauge-fill.gauge-red { background: var(--text-alarm); }
        .unified-gauge-fill.gauge-gray { background: var(--text-muted); }
        .unified-gauge-value { min-width: 75px; text-align: right; font-size: 10px; font-family: 'Consolas', monospace; color: var(--text-secondary); }
        .unified-gauge-na { flex: 1; text-align: right; font-size: 10px; color: var(--text-muted); }

        /* Status Bar */
        .status-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--status-bar-height); background-color: var(--bg-sidebar); border-top: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; font-family: 'Consolas', monospace; font-size: 11px; z-index: 20; }
        .status-group { display: flex; gap: 16px; align-items: center; }
        .status-item { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: var(--bg-input); border-radius: 4px; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .status-dot.connected { background-color: var(--text-success); box-shadow: 0 0 4px var(--text-success); }
        .status-dot.disconnected { background-color: var(--text-alarm); box-shadow: 0 0 4px var(--text-alarm); }
        .status-label { color: var(--text-muted); font-size: 9px; text-transform: uppercase; }
        .status-value { color: var(--text-normal); font-weight: 500; }
        .perf-bar { width: 35px; height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden; }
        .perf-bar-fill { height: 100%; border-radius: 2px; }
        .perf-bar-fill.good { background: var(--text-success); }
        .country-code { font-weight: 700; font-size: 12px; color: var(--icon-selected); letter-spacing: 1px; }

        /* Toast */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { display: flex; align-items: center; gap: 12px; padding: 14px 20px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 10px; box-shadow: 0 8px 24px var(--shadow-color); min-width: 300px; animation: slideIn 0.3s ease; }
        .toast.hiding { animation: slideOut 0.3s ease forwards; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .toast-icon { font-size: 20px; }
        .toast-content { flex: 1; }
        .toast-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .toast-message { font-size: 12px; color: var(--text-secondary); }
        .toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; font-size: 16px; }
        .toast.success { border-left: 4px solid var(--text-success); }
        .toast.error { border-left: 4px solid var(--text-alarm); }
        .toast.warning { border-left: 4px solid var(--text-warning); }
        .toast.info { border-left: 4px solid var(--icon-selected); }

        /* =============================================
           Modal Styles (v2.9 Full Version)
           [MIGRATE TO] src/ui/modals/ConnectionModal.js
           ============================================= */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-container { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 16px; width: 90%; max-width: 700px; max-height: 85vh; overflow: hidden; box-shadow: 0 25px 50px var(--shadow-color); transform: scale(0.9); transition: transform 0.3s ease; }
        .modal-overlay.active .modal-container { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--border-color); background: var(--bg-panel-header); }
        .modal-title { font-size: 18px; font-weight: 600; color: var(--text-primary); }
        .modal-close { width: 32px; height: 32px; border: none; background: var(--bg-input); border-radius: 8px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .modal-close:hover { background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        .modal-body { padding: 24px; overflow-y: auto; max-height: calc(85vh - 140px); }
        .modal-footer { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-top: 1px solid var(--border-color); background: var(--bg-panel-header); }
        .footer-hint { font-size: 11px; color: var(--text-muted); }
        .btn-secondary { padding: 10px 20px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); cursor: pointer; }

        /* Connection Panel Styles (v2.9 Full Version) */
        .connection-panel { background: var(--bg-panel-header); border: 1px solid var(--border-subtle); border-radius: 12px; margin-bottom: 16px; overflow: hidden; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; background: var(--bg-panel-header); border-bottom: 1px solid var(--border-subtle); }
        .panel-header h3 { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .panel-actions { display: flex; gap: 8px; align-items: center; }
        .internet-status { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--bg-input); border-radius: 8px; margin-bottom: 16px; }
        .internet-status .status-dot { width: 10px; height: 10px; }
        .internet-status-text { font-size: 13px; color: var(--text-primary); }
        .internet-status-detail { font-size: 11px; color: var(--text-muted); margin-left: auto; }
        .api-status-content { padding: 16px; }
        .status-indicator-box { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding: 12px; background: var(--bg-input); border-radius: 8px; }
        .status-indicator-box .status-dot { width: 12px; height: 12px; animation: pulse 2s infinite; }
        .status-dot--connected { background: var(--text-success); box-shadow: 0 0 10px var(--text-success); }
        .status-dot--disconnected { background: var(--text-alarm); }
        .status-dot--checking { background: var(--text-muted); }
        .status-details { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .status-detail { display: flex; flex-direction: column; gap: 4px; }
        .detail-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }
        .detail-value { font-size: 13px; color: var(--text-primary); font-family: 'Consolas', monospace; }
        .site-list { display: flex; flex-direction: column; gap: 8px; padding: 16px; }
        .site-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .site-item:hover { background: var(--bg-hover); border-color: var(--border-color); }
        .site-item.site-item--selected { background: var(--bg-selected); border-color: var(--icon-selected); }
        .site-item.site-item--connected { background: rgba(74, 222, 128, 0.1); border-color: var(--text-success); }
        .site-checkbox input { width: 16px; height: 16px; accent-color: var(--icon-selected); }
        .site-info { flex: 1; }
        .site-main { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .site-name { font-size: 14px; font-weight: 500; color: var(--text-primary); }
        .site-region { font-size: 11px; padding: 2px 8px; background: var(--bg-hover); border-radius: 4px; color: var(--text-secondary); }
        .site-meta { font-size: 11px; color: var(--text-muted); margin-top: 4px; display: flex; gap: 12px; }
        .site-status { display: flex; align-items: center; gap: 8px; }
        .btn-disconnect { padding: 4px 10px; font-size: 11px; border: none; border-radius: 4px; cursor: pointer; background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        .panel-footer { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle); background: var(--bg-panel-header); }
        .selection-info { font-size: 12px; color: var(--text-secondary); }
        .btn-connect { padding: 10px 20px; background: linear-gradient(135deg, #06B6D4, #0891B2); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; font-size: 13px; }
        .btn-connect:hover:not(:disabled) { box-shadow: 0 0 20px var(--glow-color); }
        .btn-connect:disabled { opacity: 0.5; cursor: not-allowed; }
        .auto-connect-label { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-secondary); cursor: pointer; }
        .auto-connect-label input { accent-color: var(--icon-selected); }
        .btn-icon { background: none; border: none; cursor: pointer; font-size: 14px; padding: 4px 8px; opacity: 0.7; border-radius: 4px; }
        .btn-icon:hover { opacity: 1; background: var(--bg-hover); }
        .database-item { padding: 16px; }
        .database-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .database-header h4 { font-size: 14px; color: var(--text-primary); }
        .database-stats { display: flex; gap: 16px; }
        .stat-item { display: flex; gap: 4px; font-size: 12px; }
        .stat-label { color: var(--text-muted); }
        .stat-value { color: var(--icon-selected); font-weight: 600; }
        .no-connection { text-align: center; padding: 32px; color: var(--text-muted); }
        .no-connection-icon { font-size: 32px; display: block; margin-bottom: 8px; }

        /* Debug Panel */
        #debug-panel { position: fixed; bottom: 50px; right: 20px; width: 400px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 10px 40px var(--shadow-color); z-index: 100; opacity: 0; visibility: hidden; transform: translateY(20px); transition: all 0.3s ease; }
        #debug-panel.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .debug-panel-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--bg-panel-header); border-radius: 12px 12px 0 0; border-bottom: 1px solid var(--border-subtle); }
        .debug-panel-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .debug-panel-content { font-family: 'Consolas', monospace; font-size: 12px; color: #0f0; background: #1a1a1a; padding: 12px; max-height: 300px; overflow-y: auto; border-radius: 0 0 12px 12px; }
        .debug-section { margin-bottom: 12px; }
        .debug-section-title { color: #0ff; margin-bottom: 8px; font-size: 11px; text-transform: uppercase; }
        .debug-state-item { display: flex; justify-content: space-between; padding: 4px 0; }
        .debug-state-label { color: #888; }
        .debug-state-value { color: #ff0; }
        .debug-state-value.on { color: #0f0; }
        .debug-state-value.off { color: #f00; }

        /* Dev Mode Badge */
        .dev-mode-badge { position: fixed; top: 10px; left: 90px; padding: 4px 12px; background: rgba(251, 191, 36, 0.2); border: 1px solid var(--text-warning); border-radius: 20px; font-size: 11px; color: var(--text-warning); font-weight: 600; z-index: 1000; display: none; }
        .dev-mode-badge.active { display: block; }

        /* Mock Test List */
        .mock-test-list { padding: 8px 16px; }
        .mock-test-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; margin-bottom: 4px; background: var(--bg-input); border-radius: 6px; font-size: 12px; color: var(--text-secondary); cursor: pointer; }
        .mock-test-item:hover { background: var(--bg-hover); color: var(--text-primary); }

        .sidebar-divider { width: 40px; height: 1px; background: var(--border-color); margin: 8px 0; }
        .sidebar-spacer { flex-grow: 1; }
    </style>
</head>
<body>

    <div class="toast-container" id="toast-container"></div>
    <div class="dev-mode-badge" id="dev-mode-badge">‚ö° DEV MODE</div>

    <!-- SIDEBAR v2.10 -->
    <aside class="sidebar" id="sidebar">
        <button class="icon-btn" id="btn-connection" data-mode="connection" data-tooltip="Database Connection (Ctrl+K)">
            <svg viewBox="0 0 24 24"><ellipse cx="7" cy="5" rx="5" ry="2"/><path d="M2 5v4c0 1.1 2.24 2 5 2s5-.9 5-2V5"/><path d="M2 9v4c0 1.1 2.24 2 5 2s5-.9 5-2V9"/><ellipse cx="17" cy="11" rx="5" ry="2"/><path d="M12 11v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/><path d="M12 15v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/></svg>
        </button>

        <div class="has-submenu disabled" id="btn-monitoring-wrapper">
            <button class="icon-btn disabled" id="btn-monitoring" data-mode="monitoring">
                <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="12" rx="2"/><polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/><path d="M12 16v4"/><path d="M8 20h8"/></svg>
            </button>
            <div class="submenu" id="monitoring-submenu">
                <div class="submenu-header">Monitoring Views</div>
                <button class="submenu-item" data-submode="3d-view" onclick="setSubMode('monitoring', '3d-view')">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                    3D View
                </button>
                <button class="submenu-item disabled" data-submode="ranking-view">
                    <svg viewBox="0 0 24 24"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
                    Ranking View (Coming Soon)
                </button>
            </div>
        </div>

        <button class="icon-btn disabled" id="btn-analysis" data-mode="analysis">
            <svg viewBox="0 0 24 24"><path d="M21 21H4.6c-.6 0-1.1-.5-1.1-1.1V3"/><path d="M7 14l4-4 4 4 6-6"/><circle cx="21" cy="8" r="2"/></svg>
        </button>

        <button class="icon-btn disabled" id="btn-simulation" data-mode="simulation">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><path d="M2 12h4"/><path d="M18 12h4"/></svg>
        </button>

        <div class="sidebar-divider"></div>

        <div class="has-submenu disabled hidden" id="btn-layout-wrapper">
            <button class="icon-btn disabled" id="btn-layout" data-mode="layout">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
            </button>
            <div class="submenu" id="layout-submenu">
                <div class="submenu-header">Layout Tools</div>
                <button class="submenu-item" data-submode="layout-editor" onclick="setSubMode('layout', 'layout-editor')">
                    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/></svg>
                    Layout Editor
                </button>
                <button class="submenu-item" data-submode="mapping" onclick="openEquipmentEditModal()">
                    <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Equipment Mapping
                </button>
            </div>
        </div>

        <div class="sidebar-spacer"></div>
        
        <div class="has-submenu disabled" id="btn-debug-wrapper">
            <button class="icon-btn disabled" id="btn-debug" data-mode="debug">
                <svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            </button>
            <div class="submenu" id="debug-submenu">
                <div class="submenu-header">Debug Tools</div>
                <button class="submenu-item" onclick="setDebugView('app-state')">üìä Application State</button>
                <button class="submenu-item" onclick="setDebugView('performance')">‚ö° Performance</button>
                <button class="submenu-item" onclick="setDebugView('event-log')">üìù Event Log</button>
                <button class="submenu-item" onclick="setDebugView('console')">üíª Command Console</button>
                <div class="submenu-divider"></div>
                <button class="submenu-item" onclick="toggleDebugPanel()">üìã Full Debug Panel</button>
            </div>
        </div>
        
        <div class="has-submenu" id="btn-settings-wrapper">
            <button class="icon-btn" id="btn-settings" data-mode="settings">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            </button>
            <div class="submenu" id="settings-submenu">
                <div class="submenu-header">Settings</div>
                <div class="theme-toggle-item">
                    <div class="theme-toggle-label"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/></svg><span>Theme</span></div>
                    <div class="theme-switch" id="theme-switch" onclick="toggleTheme()"></div>
                </div>
                <div class="submenu-divider"></div>
                <button class="submenu-item" id="dev-mode-toggle" onclick="toggleDevMode()">
                    <svg viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                    <span id="dev-mode-label">Dev Mode: OFF</span>
                </button>
                <div id="mock-test-section" style="display: none;">
                    <div class="submenu-divider"></div>
                    <div class="submenu-header">Mock Test Files</div>
                    <div class="mock-test-list">
                        <div class="mock-test-item" onclick="loadMockTest('equipment-status')">üì¶ Equipment Status Test</div>
                        <div class="mock-test-item" onclick="loadMockTest('realtime-update')">üîÑ Realtime Update Test</div>
                        <div class="mock-test-item" onclick="loadMockTest('multi-site')">üåê Multi-Site Test</div>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 50px;"></div>
    </aside>

    <!-- =============================================
         CONNECTION MODAL (Full v2.9 Version)
         [MIGRATE TO] src/ui/modals/ConnectionModal.js
         ============================================= -->
    <div class="modal-overlay" id="connection-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">üîå Database Connection Manager</div>
                <button class="modal-close" onclick="closeConnectionModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Internet Status with Ping -->
                <div class="internet-status" id="internet-status">
                    <span class="status-dot connected" id="internet-dot"></span>
                    <span class="internet-status-text" id="internet-text">Internet Connected</span>
                    <span class="internet-status-detail" id="internet-detail">Ping: 24ms</span>
                </div>
                
                <!-- Backend API Status Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üîå Backend API Status</h3>
                        <button class="btn-connect" onclick="refreshAPIStatus()" style="padding:6px 12px;font-size:12px">üîÑ Check</button>
                    </div>
                    <div class="api-status-content">
                        <div class="status-indicator-box">
                            <span class="status-dot status-dot--checking" id="api-status-dot"></span>
                            <span class="status-text" id="api-status-text">Checking...</span>
                        </div>
                        <div class="status-details">
                            <div class="status-detail">
                                <span class="detail-label">API URL</span>
                                <span class="detail-value">http://localhost:8000</span>
                            </div>
                            <div class="status-detail">
                                <span class="detail-label">Response</span>
                                <span class="detail-value" id="response-time">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Site Connection Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üîç Site Connection</h3>
                        <div class="panel-actions">
                            <label class="auto-connect-label">
                                <input type="checkbox" id="auto-connect-checkbox">
                                <span>Auto</span>
                            </label>
                            <button class="btn-icon" onclick="selectAllSites()" title="Select All">‚òëÔ∏è</button>
                            <button class="btn-icon" onclick="deselectAllSites()" title="Deselect All">‚òê</button>
                        </div>
                    </div>
                    <div class="site-list" id="site-list"></div>
                    <div class="panel-footer">
                        <span class="selection-info" id="selection-count">Selected: 0</span>
                        <button class="btn-connect" id="connect-btn" disabled onclick="connectToSelectedSite()">üîå Connect</button>
                    </div>
                </div>
                
                <!-- Connected Databases Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üìä Connected Databases</h3>
                        <button class="btn-connect" onclick="refreshDatabaseInfo()" style="padding:6px 12px;font-size:12px">üîÑ Refresh</button>
                    </div>
                    <div id="database-list">
                        <div class="no-connection">
                            <span class="no-connection-icon">üìÇ</span>
                            <p>No database connected</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span class="footer-hint">Ctrl+K to toggle | Escape to close</span>
                <button class="btn-secondary" onclick="closeConnectionModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- DEBUG PANEL -->
    <div id="debug-panel">
        <div class="debug-panel-header"><span class="debug-panel-title">üêõ Debug Panel</span><button class="close-btn" onclick="toggleDebugPanel()">√ó</button></div>
        <div class="debug-panel-content">
            <div class="debug-section">
                <div class="debug-section-title">üìä Application State</div>
                <div class="debug-state-item"><span class="debug-state-label">Mode:</span><span class="debug-state-value" id="debug-mode">N/A</span></div>
                <div class="debug-state-item"><span class="debug-state-label">SubMode:</span><span class="debug-state-value" id="debug-submode">N/A</span></div>
                <div class="debug-state-item"><span class="debug-state-label">Connected:</span><span class="debug-state-value off" id="debug-connected">NO</span></div>
                <div class="debug-state-item"><span class="debug-state-label">Dev Mode:</span><span class="debug-state-value off" id="debug-devmode">OFF</span></div>
                <div class="debug-state-item"><span class="debug-state-label">3D Active:</span><span class="debug-state-value off" id="debug-3d">NO</span></div>
            </div>
            <div class="debug-section">
                <div class="debug-section-title">‚ö° Performance</div>
                <div class="debug-state-item"><span class="debug-state-label">Time:</span><span class="debug-state-value" id="debug-time">-</span></div>
                <div class="debug-state-item"><span class="debug-state-label">Memory:</span><span class="debug-state-value" id="debug-memory">-</span></div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="main-content" id="main-content">
        <!-- [v2.10] Cover Screen - Default startup view -->
        <div id="cover-screen">
            <div class="cover-logo">üè≠</div>
            <div class="cover-title">SHERLOCK SKY 3D SIM</div>
            <div class="cover-subtitle">Industrial Equipment Monitoring & Simulation Platform</div>
            
            <div class="cover-status">
                <div class="cover-status-item">
                    <span class="cover-status-dot disconnected" id="cover-api-dot"></span>
                    <span class="cover-status-text">Backend API</span>
                    <span class="cover-status-value" id="cover-api-status">Disconnected</span>
                </div>
                <div class="cover-status-item">
                    <span class="cover-status-dot disconnected" id="cover-db-dot"></span>
                    <span class="cover-status-text">Database</span>
                    <span class="cover-status-value" id="cover-db-status">Not Connected</span>
                </div>
            </div>
            
            <div class="cover-hint">
                Press <kbd>Ctrl+K</kbd> to connect database, or select <kbd>Monitoring ‚Üí 3D View</kbd> after connection
            </div>
        </div>

        <!-- [v2.10] Three.js Container - Hidden by default, shown only in Monitoring/3D View -->
        <div id="threejs-container"></div>
        
        <div class="overlay-ui" id="overlay-ui" style="display: none;">
            <div class="mode-indicator">
                <div class="mode-label">Current Mode</div>
                <div class="mode-value" id="current-mode">‚Äî</div>
                <div class="submode-value" id="current-submode"></div>
            </div>
            <div class="test-controls" id="test-controls" style="display: none;">
                <h4>üß™ Equipment Test Controls</h4>
                <button class="test-btn" onclick="simulateEquipmentClick('EQ-001')"><span class="test-btn-icon">üì¶</span> Click EQ-001 (RUN)</button>
                <button class="test-btn" onclick="simulateEquipmentClick('EQ-002')"><span class="test-btn-icon">üì¶</span> Click EQ-002 (IDLE)</button>
                <button class="test-btn" onclick="simulateEquipmentClick('EQ-003')"><span class="test-btn-icon">üì¶</span> Click EQ-003 (STOP)</button>
                <button class="test-btn" onclick="simulateMultiSelect()"><span class="test-btn-icon">üìä</span> Multi-Select (3)</button>
                <h4 style="margin-top: 16px;">üîî Toast Test</h4>
                <button class="test-btn" onclick="toast.success('Success', 'Done!')"><span class="test-btn-icon">‚úÖ</span> Success</button>
                <button class="test-btn" onclick="toast.error('Error', 'Failed!')"><span class="test-btn-icon">‚ùå</span> Error</button>
            </div>
        </div>
    </main>

    <!-- EQUIPMENT INFO PANEL -->
    <div id="equipmentInfo">
        <button class="close-btn" onclick="hideEquipmentInfo()">√ó</button>
        <div class="equipment-panel-header">
            <h2 id="equipName" class="equipment-panel-title">ÏÑ§ÎπÑ Ï†ïÎ≥¥</h2>
            <div class="header-status" id="headerStatus">
                <span class="status-indicator" id="headerStatusIndicator"></span>
                <span class="status-text" id="headerStatusText">-</span>
            </div>
        </div>
        <div class="equipment-panel-tabs">
            <button class="equipment-tab active" data-tab="general" onclick="switchEquipmentTab('general')">General</button>
            <button class="equipment-tab" data-tab="pcinfo" onclick="switchEquipmentTab('pcinfo')">PC Info.</button>
        </div>
        <div class="equipment-panel-content">
            <div id="tab-general" class="equipment-tab-content active">
                <div id="generalTabContent"><div class="info-row placeholder"><span class="info-label">ÏÑ§ÎπÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span></div></div>
            </div>
            <div id="tab-pcinfo" class="equipment-tab-content">
                <div id="pcinfoTabContent"><div class="info-row placeholder"><span class="info-label">ÏÑ§ÎπÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span></div></div>
            </div>
        </div>
    </div>

    <!-- STATUS BAR -->
    <footer class="status-bar">
        <div class="status-group">
            <div class="status-item"><span class="country-code">KR</span></div>
            <div class="status-item"><span class="status-dot connected"></span><span class="status-label">NET</span><span class="status-value">Online</span></div>
            <div class="status-item"><span class="status-dot disconnected" id="backend-dot"></span><span class="status-label">API</span><span class="status-value" id="backend-value">Disconnected</span></div>
            <div class="status-item"><span class="status-dot disconnected" id="db-dot"></span><span class="status-label">DB</span><span class="status-value" id="db-value">None</span></div>
        </div>
        <div class="status-group">
            <div class="status-item"><span class="status-label">FPS</span><span class="status-value" id="fps-value">60</span><div class="perf-bar"><div class="perf-bar-fill good" style="width: 100%;"></div></div></div>
            <div class="status-item"><span class="status-label">MEM</span><span class="status-value"><span id="memory-value">128</span>MB</span><div class="perf-bar"><div class="perf-bar-fill good" style="width: 30%;"></div></div></div>
        </div>
    </footer>

    <script>
        // =============================================
        // Configuration
        // =============================================
        let currentMode = null, currentSubMode = null, isConnected = false, devModeEnabled = false, selectedSite = null, currentTheme = 'dark';
        let durationTimerInterval = null, currentEquipmentData = null, debugPanelVisible = false;
        let scene, camera, renderer, animationId = null;
        let threejsInitialized = false;
        
        // [v2.9] Extended site profiles with priority
        const siteProfiles = [
            { id: 'kr_b_01', display_name: 'Korea Site B-01', region: 'Asia/Seoul', priority: 10 },
            { id: 'kr_b_02', display_name: 'Korea Site B-02', region: 'Asia/Seoul', priority: 8 },
            { id: 'vn_a_01', display_name: 'Vietnam Site A-01', region: 'Asia/Ho_Chi_Minh', priority: 5 }
        ];
        let siteStatus = {};

        // =============================================
        // Toast System
        // =============================================
        const toast = {
            show(type, title, message, duration = 4000) {
                const container = document.getElementById('toast-container');
                const toastEl = document.createElement('div');
                toastEl.className = `toast ${type}`;
                toastEl.innerHTML = `<span class="toast-icon">${{success:'‚úÖ',error:'‚ùå',warning:'‚ö†Ô∏è',info:'‚ÑπÔ∏è'}[type]}</span><div class="toast-content"><div class="toast-title">${title}</div><div class="toast-message">${message}</div></div><button class="toast-close" onclick="this.parentElement.remove()">‚úï</button>`;
                container.appendChild(toastEl);
                setTimeout(() => { toastEl.classList.add('hiding'); setTimeout(() => toastEl.remove(), 300); }, duration);
            },
            success(t,m) { this.show('success',t,m); },
            error(t,m) { this.show('error',t,m); },
            warning(t,m) { this.show('warning',t,m); },
            info(t,m) { this.show('info',t,m); }
        };

        // =============================================
        // Theme
        // =============================================
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('theme-switch').classList.toggle('active', currentTheme === 'light');
            localStorage.setItem('theme', currentTheme);
            if (scene) scene.background = new THREE.Color(currentTheme === 'dark' ? 0x1e293b : 0xf1f5f9);
        }
        function loadTheme() {
            currentTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('theme-switch').classList.toggle('active', currentTheme === 'light');
        }

        // =============================================
        // [v2.10] View Management
        // =============================================
        function showCoverScreen() {
            document.getElementById('cover-screen').classList.remove('hidden');
            document.getElementById('threejs-container').classList.remove('active');
            document.getElementById('overlay-ui').style.display = 'none';
            stopThreeJS();
        }
        
        function show3DView() {
            document.getElementById('cover-screen').classList.add('hidden');
            document.getElementById('threejs-container').classList.add('active');
            document.getElementById('overlay-ui').style.display = 'flex';
            document.getElementById('test-controls').style.display = 'block';
            if (!threejsInitialized) initThreeJS();
            else startThreeJS();
        }
        
        function hideAllViews() {
            document.getElementById('cover-screen').classList.add('hidden');
            document.getElementById('threejs-container').classList.remove('active');
            document.getElementById('overlay-ui').style.display = 'flex';
            document.getElementById('test-controls').style.display = 'none';
            stopThreeJS();
        }

        // =============================================
        // Three.js 3D View
        // =============================================
        function initThreeJS() {
            const container = document.getElementById('threejs-container');
            scene = new THREE.Scene();
            scene.background = new THREE.Color(currentTheme === 'dark' ? 0x1e293b : 0xf1f5f9);
            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(10, 20, 10);
            scene.add(dirLight);
            
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(30, 30), new THREE.MeshStandardMaterial({ color: 0x334155 }));
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -0.5;
            scene.add(floor);
            scene.add(new THREE.GridHelper(30, 30, 0x06B6D4, 0x475569));
            
            const statusColors = { RUN: 0x4ADE80, IDLE: 0xFBBF24, STOP: 0xF87171 };
            const eqData = [
                { id: 'EQ-001', status: 'RUN', x: -6, z: -6 }, { id: 'EQ-002', status: 'IDLE', x: 0, z: -6 }, { id: 'EQ-003', status: 'STOP', x: 6, z: -6 },
                { id: 'EQ-004', status: 'RUN', x: -6, z: 0 }, { id: 'EQ-005', status: 'RUN', x: 0, z: 0 }, { id: 'EQ-006', status: 'IDLE', x: 6, z: 0 },
                { id: 'EQ-007', status: 'RUN', x: -6, z: 6 }, { id: 'EQ-008', status: 'STOP', x: 0, z: 6 }, { id: 'EQ-009', status: 'RUN', x: 6, z: 6 }
            ];
            eqData.forEach(eq => {
                const mesh = new THREE.Mesh(new THREE.BoxGeometry(3, 2, 3), new THREE.MeshStandardMaterial({ color: 0x64748b }));
                mesh.position.set(eq.x, 0.5, eq.z);
                scene.add(mesh);
                const light = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 0.5, 16), new THREE.MeshStandardMaterial({ color: statusColors[eq.status], emissive: statusColors[eq.status], emissiveIntensity: 0.5 }));
                light.position.set(eq.x, 1.75, eq.z);
                scene.add(light);
            });
            
            threejsInitialized = true;
            startThreeJS();
            window.addEventListener('resize', onWindowResize);
        }
        
        function startThreeJS() { if (!animationId) animate(); }
        function stopThreeJS() { if (animationId) { cancelAnimationFrame(animationId); animationId = null; } }
        function animate() {
            animationId = requestAnimationFrame(animate);
            const time = Date.now() * 0.0001;
            camera.position.x = Math.sin(time) * 20;
            camera.position.z = Math.cos(time) * 20;
            camera.lookAt(0, 0, 0);
            renderer.render(scene, camera);
        }
        function onWindowResize() {
            const container = document.getElementById('threejs-container');
            if (camera && renderer) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        }

        // =============================================
        // GaugeRenderer
        // =============================================
        const GaugeRenderer = {
            getColor(percent) {
                if (percent === null || percent === undefined) return 'gauge-gray';
                if (percent < 50) return 'gauge-green';
                if (percent < 80) return 'gauge-yellow';
                return 'gauge-red';
            },
            render(label, percent, options = {}) {
                const { type = 'percent', used = null, total = null, unit = 'GB' } = options;
                const colorClass = this.getColor(percent);
                const widthPercent = percent ?? 0;
                let valueDisplay = type === 'usage' && used !== null && total !== null 
                    ? `${used.toFixed(1)}/${total.toFixed(0)} ${unit}` 
                    : (percent !== null ? `${percent.toFixed(1)}%` : '-');
                return `<div class="unified-gauge-row"><span class="unified-gauge-label">${label}</span><div class="unified-gauge-container"><div class="unified-gauge-bar"><div class="unified-gauge-fill ${colorClass}" style="width: ${widthPercent}%"></div></div><span class="unified-gauge-value">${valueDisplay}</span></div></div>`;
            },
            renderNA(label, message = 'N/A') { return `<div class="unified-gauge-row"><span class="unified-gauge-label">${label}</span><span class="unified-gauge-na">${message}</span></div>`; },
            renderCPU(percent) { return this.render('CPU', percent, { type: 'percent' }); },
            renderMemory(usedGb, totalGb) {
                const percent = (totalGb && usedGb) ? Math.round((usedGb / totalGb) * 100) : null;
                return this.render('Mem', percent, { type: 'usage', used: usedGb, total: totalGb, unit: 'GB' });
            },
            renderDisk(label, usedGb, totalGb) {
                if (!totalGb || totalGb <= 0) return this.renderNA(label);
                const percent = Math.round((usedGb / totalGb) * 100);
                return this.render(label, percent, { type: 'usage', used: usedGb, total: totalGb, unit: 'GB' });
            }
        };

        // =============================================
        // DataFormatter
        // =============================================
        const DataFormatter = {
            shortenCpuName(name) { return name ? name.replace(/\(R\)|\(TM\)|CPU|@.*$/gi, '').trim().substring(0, 25) : '-'; },
            formatBootDuration(bootTime) {
                if (!bootTime) return '-';
                const diff = Math.floor((Date.now() - new Date(bootTime).getTime()) / 1000);
                const days = Math.floor(diff / 86400), hours = Math.floor((diff % 86400) / 3600);
                if (days > 0) return `${days}d ${hours}h`;
                return `${hours}h ${Math.floor((diff % 3600) / 60)}m`;
            },
            getBootDurationClass(bootTime) {
                if (!bootTime) return '';
                const days = Math.floor((Date.now() - new Date(bootTime).getTime()) / 86400000);
                return days < 7 ? 'boot-green' : days < 30 ? 'boot-yellow' : 'boot-red';
            },
            formatDateTime(dateStr) { return dateStr ? new Date(dateStr).toLocaleString('ko-KR') : '-'; }
        };

        // =============================================
        // Equipment Info Panel
        // =============================================
        function showEquipmentInfo(data) {
            const isMulti = Array.isArray(data) && data.length > 1;
            if (isMulti) showMultiEquipmentInfo(data);
            else showSingleEquipmentInfo(Array.isArray(data) ? data[0] : data);
            document.getElementById('equipmentInfo').classList.add('active');
        }
        
        function showSingleEquipmentInfo(eq) {
            currentEquipmentData = eq;
            document.getElementById('equipName').textContent = eq.equipment_name || eq.id;
            document.getElementById('equipName').classList.remove('multi-select');
            updateHeaderStatus(eq.status);
            
            const generalContent = document.getElementById('generalTabContent');
            const isLotActive = eq.is_lot_active === true;
            if (isLotActive) {
                startDurationTimer(eq.lot_start_time);
                generalContent.innerHTML = `<div class="info-row"><span class="info-label">Line:</span><span class="info-value">${eq.line_name||'-'}</span></div><div class="info-row-divider"></div><div class="info-row"><span class="info-label">Product:</span><span class="info-value">${eq.product_model||'-'}</span></div><div class="info-row"><span class="info-label">Lot No.:</span><span class="info-value">${eq.lot_id||'-'}</span></div><div class="info-row"><span class="info-label">Lot Start:</span><span class="info-value">${DataFormatter.formatDateTime(eq.lot_start_time)}</span></div><div class="info-row"><span class="info-label">Lot Duration:</span><span class="info-value" id="durationDisplay">${formatDuration(eq.lot_start_time)}</span></div><div class="info-row" style="opacity:0.7"><span class="info-label">Updated:</span><span class="info-value" style="font-size:10px">${DataFormatter.formatDateTime(eq.last_updated)}</span></div>`;
            } else {
                if (eq.since_time) startDurationTimer(eq.since_time); else stopDurationTimer();
                generalContent.innerHTML = `<div class="info-row"><span class="info-label">Line:</span><span class="info-value">${eq.line_name||'-'}</span></div><div class="info-row-divider"></div><div class="info-row"><span class="info-label">Product:</span><span class="info-value">-</span></div><div class="info-row"><span class="info-label">Lot No.:</span><span class="info-value">-</span></div><div class="info-row"><span class="info-label">Since:</span><span class="info-value">${eq.since_time?DataFormatter.formatDateTime(eq.since_time):'-'}</span></div><div class="info-row"><span class="info-label">Duration:</span><span class="info-value" id="durationDisplay">${eq.since_time?formatDuration(eq.since_time):'-'}</span></div>`;
            }
            
            const pcinfoContent = document.getElementById('pcinfoTabContent');
            const cpuShortName = DataFormatter.shortenCpuName(eq.cpu_name);
            const bootDuration = DataFormatter.formatBootDuration(eq.last_boot_time);
            const bootClass = DataFormatter.getBootDurationClass(eq.last_boot_time);
            const hasDiskD = eq.disk_d_total_gb && eq.disk_d_total_gb > 0;
            
            pcinfoContent.innerHTML = `<div class="pcinfo-system-row"><span class="info-label">CPU</span><span class="info-value">${cpuShortName}<span class="value-separator">,</span>${eq.cpu_logical_count || '-'} Cores</span></div><div class="pcinfo-system-row"><span class="info-label">GPU</span><span class="info-value info-value-small">${eq.gpu_name || '-'}</span></div><div class="pcinfo-system-row"><span class="info-label">OS</span><span class="info-value">${eq.os_name || '-'}<span class="value-separator">,</span>${eq.os_architecture || '-'}</span></div><div class="pcinfo-system-row"><span class="info-label">Boot</span><span class="info-value"><span class="boot-duration ${bootClass}">${bootDuration}</span></span></div><div class="gauge-section"><div class="gauge-section-title">Resource Usage</div>${GaugeRenderer.renderCPU(eq.cpu_usage_percent)}${GaugeRenderer.renderMemory(eq.memory_used_gb, eq.memory_total_gb)}${GaugeRenderer.renderDisk('C:', eq.disk_c_used_gb, eq.disk_c_total_gb)}${hasDiskD ? GaugeRenderer.renderDisk('D:', eq.disk_d_used_gb, eq.disk_d_total_gb) : GaugeRenderer.renderNA('D:')}</div>${eq.pc_last_update_time ? `<div class="info-row" style="opacity:0.7;margin-top:8px"><span class="info-label">Updated:</span><span class="info-value" style="font-size:10px">${DataFormatter.formatDateTime(eq.pc_last_update_time)}</span></div>` : ''}`;
        }
        
        function showMultiEquipmentInfo(dataArray) {
            stopDurationTimer();
            const count = dataArray.length;
            document.getElementById('equipName').textContent = `${count}Í∞ú ÏÑ§ÎπÑ ÏÑ†ÌÉùÎê®`;
            document.getElementById('equipName').classList.add('multi-select');
            document.getElementById('headerStatus').style.display = 'none';
            
            const statusCounts = { RUN: 0, IDLE: 0, STOP: 0 };
            dataArray.forEach(eq => { if (eq.status) statusCounts[eq.status]++; });
            
            document.getElementById('generalTabContent').innerHTML = `<div class="info-row multi-select-header"><span class="info-icon">üìä</span><span class="info-text">${count}Í∞ú ÏÑ§ÎπÑ ÏßëÍ≥Ñ</span><span class="info-badge">${count}Í∞ú</span></div><div class="info-row"><span class="info-label">Status:</span><div class="status-counts">${statusCounts.RUN>0?`<span class="status-count-item run">üü¢ ${statusCounts.RUN}</span>`:''}${statusCounts.IDLE>0?`<span class="status-count-item idle">üü° ${statusCounts.IDLE}</span>`:''}${statusCounts.STOP>0?`<span class="status-count-item stop">üî¥ ${statusCounts.STOP}</span>`:''}</div></div>`;
            
            const avgCpu = 35 + Math.random() * 30, avgMem = 45 + Math.random() * 25, avgDiskC = 40 + Math.random() * 30;
            document.getElementById('pcinfoTabContent').innerHTML = `<div class="info-row multi-select-header"><span class="info-icon">üíª</span><span class="info-text">${count}Í∞ú ÏÑ§ÎπÑ PC Ï†ïÎ≥¥</span></div><div class="pcinfo-system-row"><span class="info-label">CPU</span><span class="info-value info-value-small">Intel Core i7 Ïô∏ ${count-1}Ï¢Ö</span></div><div class="pcinfo-system-row"><span class="info-label">GPU</span><span class="info-value info-value-small">NVIDIA GeForce Ïô∏ ${count-1}Ï¢Ö</span></div><div class="pcinfo-system-row"><span class="info-label">OS</span><span class="info-value">Windows 10 IoT</span></div><div class="gauge-section"><div class="gauge-section-title">Avg Resource Usage</div>${GaugeRenderer.render('CPU', avgCpu, { type: 'percent' })}${GaugeRenderer.render('Mem', avgMem, { type: 'percent' })}${GaugeRenderer.render('C:', avgDiskC, { type: 'percent' })}${GaugeRenderer.renderNA('D:', 'N/A (ÏùºÎ∂Ä D: ÏóÜÏùå)')}</div>`;
        }
        
        function hideEquipmentInfo() { document.getElementById('equipmentInfo').classList.remove('active'); document.getElementById('headerStatus').style.display = 'flex'; stopDurationTimer(); }
        function switchEquipmentTab(tab) {
            document.querySelectorAll('.equipment-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
            document.querySelectorAll('.equipment-tab-content').forEach(c => c.classList.toggle('active', c.id === `tab-${tab}`));
        }
        function updateHeaderStatus(status) {
            const indicator = document.getElementById('headerStatusIndicator'), text = document.getElementById('headerStatusText');
            document.getElementById('headerStatus').style.display = 'flex';
            const statusClass = (status || 'DISCONNECTED').toLowerCase();
            indicator.className = `status-indicator ${statusClass}`;
            text.className = `status-text ${statusClass}`;
            text.textContent = status || '-';
        }
        function startDurationTimer(baseTime) { stopDurationTimer(); function update() { const el = document.getElementById('durationDisplay'); if (el) el.textContent = formatDuration(baseTime); } update(); durationTimerInterval = setInterval(update, 1000); }
        function stopDurationTimer() { if (durationTimerInterval) { clearInterval(durationTimerInterval); durationTimerInterval = null; } }
        function formatDuration(startTime) { if (!startTime) return '-'; const diff = Math.floor((new Date() - new Date(startTime)) / 1000); return `${String(Math.floor(diff/3600)).padStart(2,'0')}:${String(Math.floor((diff%3600)/60)).padStart(2,'0')}:${String(diff%60).padStart(2,'0')}`; }

        // Test simulations
        function simulateEquipmentClick(eqId) {
            const mockData = {
                'EQ-001': { id: 'EQ-001', equipment_name: 'Etcher A-01', status: 'RUN', line_name: 'Line A', product_model: 'PRODUCT-X100', lot_id: 'LOT-2026-001234', is_lot_active: true, lot_start_time: new Date(Date.now()-3600000).toISOString(), last_updated: new Date().toISOString(), cpu_name: 'Intel(R) Core(TM) i7-10700 CPU @ 2.90GHz', cpu_logical_count: 16, cpu_usage_percent: 45.5, gpu_name: 'NVIDIA GeForce RTX 2060', os_name: 'Windows 10 IoT Enterprise', os_architecture: '64-bit', memory_used_gb: 12.4, memory_total_gb: 32, disk_c_used_gb: 180, disk_c_total_gb: 256, disk_d_used_gb: 450, disk_d_total_gb: 1024, last_boot_time: new Date(Date.now() - 86400000 * 3).toISOString(), pc_last_update_time: new Date().toISOString() },
                'EQ-002': { id: 'EQ-002', equipment_name: 'CVD Unit B-02', status: 'IDLE', line_name: 'Line B', is_lot_active: false, since_time: new Date(Date.now()-1800000).toISOString(), cpu_name: 'Intel(R) Core(TM) i5-9500 CPU @ 3.00GHz', cpu_logical_count: 6, cpu_usage_percent: 12.3, gpu_name: 'Intel UHD Graphics 630', os_name: 'Windows 10 IoT', os_architecture: '64-bit', memory_used_gb: 6.8, memory_total_gb: 16, disk_c_used_gb: 95, disk_c_total_gb: 256, disk_d_total_gb: 0, last_boot_time: new Date(Date.now() - 86400000 * 45).toISOString(), pc_last_update_time: new Date().toISOString() },
                'EQ-003': { id: 'EQ-003', equipment_name: 'Sputter C-03', status: 'STOP', line_name: 'Line C', is_lot_active: false, since_time: new Date(Date.now()-7200000).toISOString(), cpu_name: 'AMD Ryzen 7 5800X', cpu_logical_count: 16, cpu_usage_percent: 85.7, gpu_name: 'AMD Radeon RX 6700 XT', os_name: 'Windows 11 IoT Enterprise', os_architecture: '64-bit', memory_used_gb: 28.5, memory_total_gb: 32, disk_c_used_gb: 220, disk_c_total_gb: 512, disk_d_used_gb: 800, disk_d_total_gb: 2048, last_boot_time: new Date(Date.now() - 86400000 * 120).toISOString(), pc_last_update_time: new Date().toISOString() }
            };
            showEquipmentInfo(mockData[eqId]);
            toast.info('Equipment Selected', `Clicked on ${eqId}`);
        }
        function simulateMultiSelect() { showEquipmentInfo([{ id: 'EQ-001', status: 'RUN' },{ id: 'EQ-002', status: 'IDLE' },{ id: 'EQ-003', status: 'STOP' }]); }
        function openEquipmentEditModal() { toast.info('Equipment Mapping', 'Opening equipment mapping editor...'); }

        // =============================================
        // Connection Modal (v2.9 Full Version)
        // =============================================
        function openConnectionModal() { document.getElementById('connection-modal').classList.add('active'); refreshAPIStatus(); }
        function closeConnectionModal() { document.getElementById('connection-modal').classList.remove('active'); }
        
        function refreshAPIStatus() {
            const dot = document.getElementById('api-status-dot');
            const text = document.getElementById('api-status-text');
            const responseTime = document.getElementById('response-time');
            dot.className = 'status-dot status-dot--checking';
            text.textContent = 'Checking...';
            responseTime.textContent = '-';
            setTimeout(() => {
                dot.className = 'status-dot status-dot--connected';
                text.textContent = 'Connected';
                text.className = 'status-text run';
                responseTime.textContent = `${Math.floor(Math.random() * 50 + 20)}ms`;
            }, 1000);
        }
        
        function renderSiteList() {
            const siteList = document.getElementById('site-list');
            siteList.innerHTML = siteProfiles.map(profile => {
                const isSelected = selectedSite === profile.id;
                const status = siteStatus[profile.id] || {};
                const isConnectedSite = status.status === 'connected';
                return `<div class="site-item ${isSelected ? 'site-item--selected' : ''} ${isConnectedSite ? 'site-item--connected' : ''}" onclick="toggleSiteSelection('${profile.id}')"><div class="site-checkbox"><input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleSiteSelection('${profile.id}')"></div><div class="site-info"><div class="site-main"><span class="site-name">${profile.display_name}</span><span class="site-region">${profile.region}</span></div><div class="site-meta"><span>Priority: ${profile.priority}</span></div></div><div class="site-status">${isConnectedSite ? '<span>‚úÖ</span><button class="btn-disconnect" onclick="event.stopPropagation(); disconnectFromSite(\''+profile.id+'\')">Disconnect</button>' : '<span>‚ö™</span>'}</div></div>`;
            }).join('');
            updateSelectionUI();
        }
        
        function toggleSiteSelection(siteId) { selectedSite = selectedSite === siteId ? null : siteId; renderSiteList(); }
        function selectAllSites() { if (siteProfiles.length > 0) selectedSite = siteProfiles[0].id; renderSiteList(); toast.info('Select All', 'First site selected (single selection mode)'); }
        function deselectAllSites() { selectedSite = null; renderSiteList(); toast.info('Deselect All', 'Selection cleared'); }
        function updateSelectionUI() {
            document.getElementById('selection-count').textContent = `Selected: ${selectedSite ? 1 : 0}`;
            document.getElementById('connect-btn').disabled = !selectedSite;
        }
        
        function connectToSelectedSite() {
            if (!selectedSite) return;
            const btn = document.getElementById('connect-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Connecting...';
            setTimeout(() => {
                siteStatus[selectedSite] = { status: 'connected' };
                isConnected = true;
                renderSiteList();
                enableSidebarIcons();
                updateStatusBar(selectedSite);
                updateCoverStatus(true, selectedSite);
                updateDatabaseList(selectedSite);
                btn.textContent = 'üîå Connect';
                const site = siteProfiles.find(s => s.id === selectedSite);
                toast.success('Connected', `Successfully connected to ${site.display_name}`);
            }, 1500);
        }
        
        function disconnectFromSite(siteId) {
            siteStatus[siteId] = { status: 'disconnected' };
            isConnected = false;
            selectedSite = null;
            renderSiteList();
            disableSidebarIcons();
            updateStatusBar(null);
            updateCoverStatus(false, null);
            updateDatabaseList(null);
            hideEquipmentInfo();
            showCoverScreen();
            currentMode = null;
            currentSubMode = null;
            document.getElementById('current-mode').textContent = '‚Äî';
            document.getElementById('current-submode').textContent = '';
            document.querySelectorAll('.submenu-item').forEach(item => item.classList.remove('active'));
            toast.info('Disconnected', 'Database connection closed');
        }
        
        function updateDatabaseList(siteId) {
            const dbList = document.getElementById('database-list');
            if (siteId) {
                const site = siteProfiles.find(s => s.id === siteId);
                dbList.innerHTML = `<div class="database-item"><div class="database-header"><h4>üìä ${site.display_name}</h4></div><div class="database-stats"><div class="stat-item"><span class="stat-label">Equipment:</span><span class="stat-value">117</span></div><div class="stat-item"><span class="stat-label">Lines:</span><span class="stat-value">6</span></div><div class="stat-item"><span class="stat-label">Active Lots:</span><span class="stat-value">85</span></div></div></div>`;
            } else {
                dbList.innerHTML = `<div class="no-connection"><span class="no-connection-icon">üìÇ</span><p>No database connected</p></div>`;
            }
        }
        
        function refreshDatabaseInfo() { toast.success('Refreshed', 'Database information updated'); }
        
        function updateCoverStatus(connected, siteId) {
            document.getElementById('cover-api-dot').className = `cover-status-dot ${connected ? 'connected' : 'disconnected'}`;
            document.getElementById('cover-api-status').textContent = connected ? 'Connected' : 'Disconnected';
            document.getElementById('cover-db-dot').className = `cover-status-dot ${connected ? 'connected' : 'disconnected'}`;
            document.getElementById('cover-db-status').textContent = siteId ? siteProfiles.find(s=>s.id===siteId)?.display_name : 'Not Connected';
        }
        
        function enableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation'].forEach(id => document.getElementById(id).classList.remove('disabled'));
            document.getElementById('btn-monitoring-wrapper').classList.remove('disabled');
            document.getElementById('btn-debug-wrapper').classList.remove('disabled');
            document.getElementById('btn-debug').classList.remove('disabled');
            if (devModeEnabled) {
                document.getElementById('btn-layout-wrapper').classList.remove('disabled');
                document.getElementById('btn-layout').classList.remove('disabled');
            }
        }
        
        function disableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-layout'].forEach(id => document.getElementById(id).classList.add('disabled'));
            document.getElementById('btn-monitoring-wrapper').classList.add('disabled');
            document.getElementById('btn-layout-wrapper').classList.add('disabled');
            if (!devModeEnabled) {
                document.getElementById('btn-debug-wrapper').classList.add('disabled');
                document.getElementById('btn-debug').classList.add('disabled');
            }
            document.querySelectorAll('.icon-btn').forEach(btn => btn.classList.remove('selected'));
        }
        
        function updateStatusBar(siteId) {
            document.getElementById('backend-dot').className = `status-dot ${siteId ? 'connected' : 'disconnected'}`;
            document.getElementById('backend-value').textContent = siteId ? 'Connected' : 'Disconnected';
            document.getElementById('db-dot').className = `status-dot ${siteId ? 'connected' : 'disconnected'}`;
            document.getElementById('db-value').textContent = siteId ? siteId.replace(/_/g, '-') : 'None';
        }

        // =============================================
        // Mode & Submenu
        // =============================================
        function setMode(mode) {
            currentMode = mode;
            currentSubMode = null;
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('current-submode').textContent = '';
            document.querySelectorAll('.submenu-item').forEach(item => item.classList.remove('active'));
            hideAllViews();
            document.getElementById('overlay-ui').style.display = 'flex';
            updateDebugPanel();
        }
        
        function setSubMode(mode, submode) {
            currentMode = mode;
            currentSubMode = submode;
            document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
            if (mode === 'monitoring') document.getElementById('btn-monitoring').classList.add('selected');
            if (mode === 'layout') document.getElementById('btn-layout').classList.add('selected');
            document.querySelectorAll(`#${mode}-submenu .submenu-item`).forEach(item => item.classList.toggle('active', item.dataset.submode === submode));
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('current-submode').textContent = `‚Üí ${submode === '3d-view' ? '3D View' : submode}`;
            
            if (mode === 'monitoring' && submode === '3d-view') show3DView();
            else { hideAllViews(); document.getElementById('overlay-ui').style.display = 'flex'; }
            
            updateDebugPanel();
            toast.info('Mode Changed', `${mode} ‚Üí ${submode}`);
        }
        
        function toggleDevMode() {
            devModeEnabled = !devModeEnabled;
            const layoutWrapper = document.getElementById('btn-layout-wrapper');
            const debugWrapper = document.getElementById('btn-debug-wrapper');
            if (devModeEnabled) {
                layoutWrapper.classList.remove('hidden');
                if (isConnected) { layoutWrapper.classList.remove('disabled'); document.getElementById('btn-layout').classList.remove('disabled'); }
                debugWrapper.classList.remove('disabled');
                document.getElementById('btn-debug').classList.remove('disabled');
                document.getElementById('dev-mode-label').textContent = 'Dev Mode: ON';
                document.getElementById('mock-test-section').style.display = 'block';
                document.getElementById('dev-mode-badge').classList.add('active');
                toast.warning('Dev Mode ON', 'Mock testing enabled');
            } else {
                layoutWrapper.classList.add('hidden');
                if (!isConnected) { debugWrapper.classList.add('disabled'); document.getElementById('btn-debug').classList.add('disabled'); }
                document.getElementById('dev-mode-label').textContent = 'Dev Mode: OFF';
                document.getElementById('mock-test-section').style.display = 'none';
                document.getElementById('dev-mode-badge').classList.remove('active');
                toast.info('Dev Mode OFF', '');
            }
            updateDebugPanel();
        }
        
        function loadMockTest(testName) {
            toast.info('Mock Test', `Loading: ${testName}`);
            if (testName === 'equipment-status') simulateEquipmentClick('EQ-001');
            else if (testName === 'multi-site') simulateMultiSelect();
        }

        // Debug
        function toggleDebugPanel() { debugPanelVisible = !debugPanelVisible; document.getElementById('debug-panel').classList.toggle('active', debugPanelVisible); if (debugPanelVisible) updateDebugPanel(); }
        function setDebugView(view) { toast.info('Debug View', view); }
        function updateDebugPanel() {
            document.getElementById('debug-mode').textContent = currentMode || 'N/A';
            document.getElementById('debug-submode').textContent = currentSubMode || 'N/A';
            document.getElementById('debug-connected').textContent = isConnected ? 'YES' : 'NO';
            document.getElementById('debug-connected').className = `debug-state-value ${isConnected ? 'on' : 'off'}`;
            document.getElementById('debug-devmode').textContent = devModeEnabled ? 'ON' : 'OFF';
            document.getElementById('debug-devmode').className = `debug-state-value ${devModeEnabled ? 'on' : 'off'}`;
            document.getElementById('debug-3d').textContent = (currentMode === 'monitoring' && currentSubMode === '3d-view') ? 'YES' : 'NO';
            document.getElementById('debug-3d').className = `debug-state-value ${(currentMode === 'monitoring' && currentSubMode === '3d-view') ? 'on' : 'off'}`;
            document.getElementById('debug-time').textContent = new Date().toLocaleTimeString();
            if (performance.memory) document.getElementById('debug-memory').textContent = `${(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)} MB`;
        }

        function setupSidebarEvents() {
            document.querySelectorAll('.icon-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    if (this.id === 'btn-connection') { openConnectionModal(); return; }
                    if (this.id === 'btn-settings' || this.id === 'btn-debug') return;
                    if (this.closest('.has-submenu')) return;
                    document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    setMode(this.dataset.mode);
                });
            });
            document.getElementById('btn-monitoring').addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;
                document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                setMode('monitoring');
            });
        }

        // Init
        function init() {
            loadTheme();
            siteProfiles.forEach(site => { siteStatus[site.id] = { status: 'disconnected' }; });
            renderSiteList();
            setupSidebarEvents();
            showCoverScreen();
            setInterval(() => {
                document.getElementById('fps-value').textContent = 58 + Math.floor(Math.random() * 5);
                document.getElementById('memory-value').textContent = 128 + Math.floor((Math.random() - 0.5) * 20);
                if (debugPanelVisible) updateDebugPanel();
            }, 2000);
        }

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.target.matches('input, textarea')) return;
            const key = e.key.toLowerCase();
            if ((e.ctrlKey || e.metaKey) && key === 'k') { e.preventDefault(); document.getElementById('connection-modal').classList.toggle('active'); return; }
            if (key === 'escape') {
                document.getElementById('connection-modal').classList.remove('active');
                hideEquipmentInfo();
                if (debugPanelVisible) toggleDebugPanel();
                return;
            }
            if (!isConnected && !devModeEnabled) return;
            if (key === 'd') toggleDebugPanel();
        });

        document.addEventListener('DOMContentLoaded', init);
        console.log('üß™ Sidebar Test v2.10 Loaded');
        console.log('Features: Cover Screen, Conditional 3D View, Full PC Info Tab, Full Connection Modal (v2.9)');
    </script>

</body>
</html>
