<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test: Cleanroom Sidebar (Standalone) v2.3</title>
    
    <style>
        /* =============================================
           TEST FRAMEWORK STYLES
           ============================================= */
        .test-framework {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 420px;
            background: #1a1a2e;
            border: 1px solid #16213e;
            border-radius: 12px;
            padding: 16px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            color: #e5e5e5;
            z-index: 9999;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #16213e;
        }
        
        .test-title {
            font-size: 14px;
            font-weight: bold;
            color: #06B6D4;
        }
        
        .test-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }
        
        .test-tab {
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 6px;
            color: #9CA3AF;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }
        
        .test-tab.active {
            background: linear-gradient(135deg, #06B6D4, #0891B2);
            color: white;
        }
        
        .test-tab:hover:not(.active) {
            background: rgba(255,255,255,0.1);
        }
        
        .test-panel {
            display: none;
        }
        
        .test-panel.active {
            display: block;
        }

        /* Icon Style Tester */
        .style-tester {
            margin-bottom: 16px;
        }
        
        .style-section {
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .style-section h4 {
            color: #9CA3AF;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }
        
        .style-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
        
        .style-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .style-option:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .style-option.selected {
            border-color: #06B6D4;
            background: rgba(6, 182, 212, 0.1);
        }
        
        .style-option svg {
            margin-bottom: 4px;
        }
        
        .style-label {
            font-size: 9px;
            color: #6B7280;
        }
        
        /* State Preview */
        .state-preview {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--bg-sidebar);
            border-radius: 8px;
            justify-content: center;
        }
        
        .state-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .state-item .icon-wrapper {
            width: 54px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-radius: 8px;
            transition: all 0.25s;
        }
        
        .state-item .icon-wrapper.normal {
            background: transparent;
        }
        
        .state-item .icon-wrapper.hover {
            background: rgba(255,255,255,0.05);
            transform: scale(1.1) translateY(-3px);
        }
        
        .state-item .icon-wrapper.hover svg {
            stroke: #FFFFFF;
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
        }
        
        .state-item .icon-wrapper.selected {
            background: rgba(6, 182, 212, 0.1);
            transform: scale(1.08) translateY(-2px);
        }
        
        .state-item .icon-wrapper.selected svg {
            stroke: #06B6D4;
            filter: drop-shadow(0 0 6px #06B6D4);
        }
        
        .state-item .icon-wrapper.selected::before {
            content: '';
            position: absolute;
            left: -8px;
            width: 3px;
            height: 28px;
            background: #06B6D4;
            border-radius: 0 3px 3px 0;
            box-shadow: 0 0 6px #06B6D4;
        }
        
        .state-item .icon-wrapper.selected-hover {
            background: rgba(6, 182, 212, 0.15);
            transform: scale(1.12) translateY(-4px);
            animation: float 2s ease-in-out infinite;
        }
        
        .state-item .icon-wrapper.selected-hover svg {
            stroke: #06B6D4;
            filter: drop-shadow(0 0 10px #06B6D4);
        }
        
        .state-item .icon-wrapper.selected-hover::before {
            content: '';
            position: absolute;
            left: -8px;
            width: 3px;
            height: 28px;
            background: #06B6D4;
            border-radius: 0 3px 3px 0;
            box-shadow: 0 0 10px #06B6D4;
        }
        
        .state-item .icon-wrapper.disabled {
            opacity: 0.4;
        }
        
        .state-item .icon-wrapper.disabled svg {
            stroke: #334155;
        }
        
        .state-label {
            font-size: 10px;
            color: #6B7280;
            text-transform: uppercase;
        }
        
        /* Apply Button */
        .apply-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #06B6D4, #0891B2);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.2s;
        }
        
        .apply-btn:hover {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
        }
        
        /* Current Config Display */
        .current-config {
            padding: 12px;
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .config-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 11px;
        }
        
        .config-key { color: #9CA3AF; }
        .config-value { color: #06B6D4; font-weight: 600; }

        /* =============================================
           1. Theme Configuration (Cleanroom Palette)
           v2.3: Modal closable without connection
           ============================================= */
        :root {
            /* Background Colors */
            --bg-sidebar: #0F172A;
            --bg-main: #FFFFFF;
            
            /* Icon Colors */
            --icon-normal: #E2E8F0;
            --icon-selected: #06B6D4;
            --icon-disabled: #334155;
            
            /* Icon Sizing - v2.1 defaults */
            --icon-size: 36px;
            --icon-stroke-normal: 1px;
            --icon-stroke-hover: 1.5px;
            --icon-stroke-selected: 1.5px;
            
            /* Status Text Colors */
            --text-normal: #CBD5E1;
            --text-warning: #FBBF24;
            --text-alarm: #F87171;
            --text-success: #4ADE80;

            /* Interaction Settings */
            --transition-speed: 0.25s;
            
            /* Status Bar */
            --status-bar-height: 36px;
        }

        /* Reset & Layout */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Segoe UI', sans-serif;
            background: #1e293b;
        }
        
        /* =============================================
           2. Sidebar (Left)
           ============================================= */
        .sidebar {
            width: 80px;
            background-color: var(--bg-sidebar);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 24px;
            z-index: 10;
            box-shadow: 4px 0 15px rgba(0,0,0,0.25);
            transition: width 0.3s ease;
        }

        /* Icon Button Container */
        .icon-btn {
            width: 54px;
            height: 54px;
            margin-bottom: 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: transform var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* SVG Style */
        .icon-btn svg {
            width: var(--icon-size);
            height: var(--icon-size);
            fill: none;
            stroke: var(--icon-normal);
            stroke-width: var(--icon-stroke-normal);
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all var(--transition-speed);
        }

        /* =============================================
           3. Interaction Logic (Hover & Selected)
           v2.1: Added floating effect for selected+hover
           ============================================= */
        
        /* Hover Effect (not selected) */
        .icon-btn:not(.selected):not(.disabled):hover {
            transform: scale(1.1) translateY(-3px);
        }
        .icon-btn:not(.selected):not(.disabled):hover svg {
            stroke: #FFFFFF;
            stroke-width: var(--icon-stroke-hover);
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
        }

        /* Selected Effect */
        .icon-btn.selected {
            transform: scale(1.08) translateY(-2px);
        }
        .icon-btn.selected svg {
            stroke: var(--icon-selected);
            stroke-width: var(--icon-stroke-selected);
            filter: drop-shadow(0 0 6px var(--icon-selected));
        }

        /* ‚ú® Selected + Hover = Floating Effect */
        @keyframes float {
            0%, 100% { transform: scale(1.12) translateY(-4px); }
            50% { transform: scale(1.12) translateY(-8px); }
        }
        
        .icon-btn.selected:hover {
            animation: float 2s ease-in-out infinite;
        }
        .icon-btn.selected:hover svg {
            stroke: var(--icon-selected);
            stroke-width: var(--icon-stroke-selected);
            filter: drop-shadow(0 0 12px var(--icon-selected));
        }

        /* Indicator Line for Selected Item */
        .icon-btn.selected::before {
            content: '';
            position: absolute;
            left: -13px;
            width: 3px;
            height: 28px;
            background-color: var(--icon-selected);
            border-radius: 0 3px 3px 0;
            box-shadow: 0 0 6px var(--icon-selected);
        }

        /* Disabled State */
        .icon-btn.disabled {
            cursor: not-allowed;
            opacity: 0.4;
            pointer-events: none;
        }
        .icon-btn.disabled svg {
            stroke: var(--icon-disabled);
        }
        .icon-btn.disabled:hover {
            transform: none;
            animation: none;
        }

        /* Hidden State */
        .icon-btn.hidden {
            display: none !important;
        }

        /* =============================================
           4. Submenu System
           ============================================= */
        .has-submenu {
            position: relative;
        }
        
        .submenu {
            position: absolute;
            left: 70px;
            top: 0;
            background: var(--bg-sidebar);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 160px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-10px);
            transition: all 0.2s ease;
            box-shadow: 4px 4px 20px rgba(0,0,0,0.4);
            z-index: 100;
        }
        
        .has-submenu:hover .submenu,
        .has-submenu.submenu-open .submenu {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }
        
        .submenu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            color: var(--text-normal);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        
        .submenu-item:hover {
            background: rgba(6, 182, 212, 0.1);
            color: #FFFFFF;
        }
        
        .submenu-item.active {
            background: rgba(6, 182, 212, 0.15);
            color: var(--icon-selected);
        }
        
        .submenu-item svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 1.5px;
            fill: none;
        }
        
        .submenu-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 6px 12px;
        }
        
        .submenu-header {
            padding: 6px 16px;
            font-size: 10px;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Submenu indicator arrow */
        .has-submenu::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            border: 4px solid transparent;
            border-left-color: var(--icon-normal);
            opacity: 0.5;
        }
        
        .has-submenu:hover::after {
            border-left-color: var(--icon-selected);
            opacity: 1;
        }
        
        /* =============================================
           4.1 Always Normal State Icons
           Connection and Settings icons never get selected styling
           ============================================= */
        #btn-connection,
        #btn-settings-wrapper .icon-btn {
            transform: none !important;
        }
        #btn-connection::before,
        #btn-settings-wrapper .icon-btn::before {
            display: none !important;
        }
        #btn-connection svg,
        #btn-settings-wrapper .icon-btn svg {
            stroke: var(--icon-normal) !important;
            filter: none !important;
        }
        #btn-connection:hover svg,
        #btn-settings-wrapper .icon-btn:hover svg {
            stroke: #FFFFFF !important;
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3)) !important;
        }
        #btn-connection:hover,
        #btn-settings-wrapper:hover .icon-btn {
            transform: scale(1.1) translateY(-3px) !important;
        }

        /* =============================================
           5. Main Content Area
           ============================================= */
        .main-content {
            flex-grow: 1;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #e5e5e5;
            margin-bottom: var(--status-bar-height);
        }

        .main-content h1 {
            font-size: 32px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #06B6D4, #8B5CF6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-content p {
            color: #9CA3AF;
        }

        /* Current Mode Display */
        .current-mode {
            margin-top: 40px;
            padding: 20px 40px;
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            text-align: center;
        }

        .mode-label {
            font-size: 12px;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .mode-value {
            font-size: 24px;
            font-weight: bold;
            color: #06B6D4;
        }
        
        .submode-value {
            font-size: 14px;
            color: #9CA3AF;
            margin-top: 4px;
        }

        /* =============================================
           6. Status Bar (Bottom) - Compact Height
           v2.1: Reduced height to 36px
           ============================================= */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--status-bar-height);
            background-color: var(--bg-sidebar);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            box-sizing: border-box;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            z-index: 20;
        }

        .status-group { 
            display: flex; 
            gap: 16px;
            align-items: center;
        }
        
        .status-item { 
            display: flex; 
            align-items: center; 
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 4px;
        }
        
        .status-normal { color: var(--text-normal); }
        .status-success { color: var(--text-success); }
        .status-warning { color: var(--text-warning); font-weight: 600; }
        .status-alarm { 
            color: var(--text-alarm); 
            font-weight: 700; 
            animation: pulse-alarm 1.5s infinite; 
        }

        .status-dot { 
            width: 6px; 
            height: 6px; 
            border-radius: 50%; 
            background-color: currentColor;
            flex-shrink: 0;
        }
        
        .status-dot.connected {
            background-color: var(--text-success);
            box-shadow: 0 0 4px var(--text-success);
        }
        
        .status-dot.disconnected {
            background-color: var(--text-alarm);
            box-shadow: 0 0 4px var(--text-alarm);
        }
        
        .status-dot.warning {
            background-color: var(--text-warning);
            box-shadow: 0 0 4px var(--text-warning);
        }

        .status-label {
            color: #6B7280;
            font-size: 9px;
            text-transform: uppercase;
        }
        
        .status-value {
            color: var(--text-normal);
            font-weight: 500;
            font-size: 11px;
        }
        
        /* Performance Bar - Compact */
        .perf-bar {
            width: 50px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .perf-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s, background 0.3s;
        }
        
        .perf-bar-fill.good { background: var(--text-success); }
        .perf-bar-fill.medium { background: var(--text-warning); }
        .perf-bar-fill.bad { background: var(--text-alarm); }

        @keyframes pulse-alarm {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Tooltip */
        .icon-btn[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 70px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            transform: translateX(-10px);
            z-index: 50;
        }

        .icon-btn:not(.has-submenu):hover[data-tooltip]::after {
            opacity: 1;
            transform: translateX(0);
        }

        /* Divider */
        .sidebar-divider {
            width: 40px;
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 8px 0;
        }

        /* Spacer */
        .sidebar-spacer {
            flex-grow: 1;
        }
        
        /* =============================================
           7. Connection Modal Styles
           ============================================= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-container {
            background: #1E293B;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-container {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #E2E8F0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            color: #9CA3AF;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(248, 113, 113, 0.2);
            color: #F87171;
        }
        
        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(85vh - 140px);
        }
        
        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
        }
        
        .footer-hint {
            font-size: 11px;
            color: #6B7280;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #E2E8F0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Connection Panel Styles */
        .connection-panel {
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .panel-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: #E2E8F0;
        }
        
        .panel-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .panel-content {
            padding: 16px;
        }
        
        /* API Status Panel */
        .api-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
        }
        
        .api-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .api-status-indicator.healthy {
            background: #4ADE80;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }
        
        .api-status-indicator.unhealthy {
            background: #F87171;
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .api-status-info {
            flex: 1;
        }
        
        .api-status-url {
            font-size: 13px;
            color: #E2E8F0;
            font-family: 'Consolas', monospace;
        }
        
        .api-status-meta {
            font-size: 11px;
            color: #6B7280;
            margin-top: 2px;
        }
        
        /* Site List */
        .site-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
        }
        
        .site-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .site-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
        }
        
        .site-item.site-item--selected {
            background: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.3);
        }
        
        .site-item.site-item--connected {
            background: rgba(74, 222, 128, 0.1);
            border-color: rgba(74, 222, 128, 0.3);
        }
        
        .site-checkbox input {
            width: 16px;
            height: 16px;
            accent-color: #06B6D4;
        }
        
        .site-info {
            flex: 1;
        }
        
        .site-main {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .site-name {
            font-size: 14px;
            font-weight: 500;
            color: #E2E8F0;
        }
        
        .site-region {
            font-size: 11px;
            padding: 2px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            color: #9CA3AF;
        }
        
        .site-meta {
            font-size: 11px;
            color: #6B7280;
            margin-top: 4px;
        }
        
        .site-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-icon {
            font-size: 16px;
        }
        
        .btn-disconnect, .btn-retry {
            padding: 4px 10px;
            font-size: 11px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-disconnect {
            background: rgba(248, 113, 113, 0.2);
            color: #F87171;
        }
        
        .btn-disconnect:hover {
            background: rgba(248, 113, 113, 0.3);
        }
        
        .btn-retry {
            background: rgba(251, 191, 36, 0.2);
            color: #FBBF24;
        }
        
        .btn-retry:hover {
            background: rgba(251, 191, 36, 0.3);
        }
        
        .panel-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-top: 1px solid rgba(255,255,255,0.05);
            background: rgba(0,0,0,0.1);
        }
        
        .selection-info {
            font-size: 12px;
            color: #9CA3AF;
        }
        
        .btn-connect {
            padding: 10px 20px;
            background: linear-gradient(135deg, #06B6D4, #0891B2);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-connect:hover:not(:disabled) {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
        }
        
        .btn-connect:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Auto-connect label */
        .auto-connect-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #9CA3AF;
            cursor: pointer;
        }
        
        .auto-connect-label input {
            accent-color: #06B6D4;
        }
        
        /* Button icons in panels */
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .btn-icon:hover {
            opacity: 1;
        }
        
        /* Database Info */
        .database-item {
            padding: 16px;
        }
        
        .database-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .database-header h4 {
            font-size: 14px;
            color: #E2E8F0;
        }
        
        .database-stats {
            display: flex;
            gap: 16px;
        }
        
        .stat-item {
            display: flex;
            gap: 4px;
            font-size: 12px;
        }
        
        .stat-label {
            color: #6B7280;
        }
        
        .stat-value {
            color: #06B6D4;
            font-weight: 600;
        }
        
        .no-connection {
            text-align: center;
            padding: 32px;
            color: #6B7280;
        }
        
        .no-connection-icon {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }
        
        /* Loading spinner */
        .loading-spinner-small {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: #06B6D4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* =============================================
           8. Test Controls Additional Styles
           ============================================= */
        .slider-container {
            margin: 8px 0;
        }
        
        .slider-container label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 11px;
            color: #9CA3AF;
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #06B6D4;
            cursor: pointer;
        }
        
        .test-log {
            margin-top: 12px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            font-size: 10px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 2px 0;
            color: #6B7280;
        }
        
        .log-entry.success { color: #4ADE80; }
        .log-entry.error { color: #F87171; }
        .log-entry.info { color: #06B6D4; }
    </style>
</head>
<body>

    <!-- =============================================
         SIDEBAR COMPONENT
         Icon Order: Connection ‚Üí Monitoring ‚Üí Analysis ‚Üí Simulation
         Settings at bottom, Layout hidden by default (Dev mode)
         v2.3: Connection and Settings always normal state
         ============================================= -->
    <aside class="sidebar" id="sidebar">
        
        <!-- 1. Multi-Site Database Connection Button (always normal state) -->
        <button class="icon-btn" id="btn-connection" data-mode="connection" data-tooltip="Database Connection (Ctrl+K)">
            <svg viewBox="0 0 24 24">
                <!-- Multi-site database icon -->
                <ellipse cx="7" cy="5" rx="5" ry="2"/>
                <path d="M2 5v4c0 1.1 2.24 2 5 2s5-.9 5-2V5"/>
                <path d="M2 9v4c0 1.1 2.24 2 5 2s5-.9 5-2V9"/>
                <ellipse cx="17" cy="11" rx="5" ry="2"/>
                <path d="M12 11v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/>
                <path d="M12 15v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/>
                <path d="M7 13v2" stroke-dasharray="2 2"/>
                <circle cx="12" cy="17" r="1.5" fill="currentColor" stroke="none"/>
            </svg>
        </button>

        <!-- 2. Monitoring Button with Submenu -->
        <div class="has-submenu" id="btn-monitoring-wrapper">
            <button class="icon-btn disabled" id="btn-monitoring" data-mode="monitoring" data-tooltip="System Monitoring (M)">
                <svg viewBox="0 0 24 24">
                    <rect x="3" y="4" width="18" height="12" rx="2" />
                    <polyline points="6 10 9 10 11 7 13 13 15 10 18 10" />
                    <path d="M12 16v4" />
                    <path d="M8 20h8" />
                </svg>
            </button>
            
            <!-- Submenu -->
            <div class="submenu" id="monitoring-submenu">
                <div class="submenu-header">Monitoring Views</div>
                <button class="submenu-item active" data-submode="3d-view" onclick="setSubMode('monitoring', '3d-view')">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    3D View
                </button>
                <button class="submenu-item" data-submode="ranking-view" onclick="setSubMode('monitoring', 'ranking-view')">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 20V10"/>
                        <path d="M12 20V4"/>
                        <path d="M6 20v-6"/>
                    </svg>
                    Ranking View
                </button>
            </div>
        </div>

        <!-- 3. Analysis Button -->
        <button class="icon-btn disabled" id="btn-analysis" data-mode="analysis" data-tooltip="Data Analysis (A)">
            <svg viewBox="0 0 24 24">
                <path d="M21 21H4.6c-.6 0-1.1-.5-1.1-1.1V3"/>
                <path d="M7 14l4-4 4 4 6-6"/>
                <circle cx="21" cy="8" r="2"/>
            </svg>
        </button>

        <!-- 4. Simulation Button -->
        <button class="icon-btn disabled" id="btn-simulation" data-mode="simulation" data-tooltip="Simulation (S)">
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 2v4"/>
                <path d="M12 18v4"/>
                <path d="M4.93 4.93l2.83 2.83"/>
                <path d="M16.24 16.24l2.83 2.83"/>
                <path d="M2 12h4"/>
                <path d="M18 12h4"/>
                <path d="M4.93 19.07l2.83-2.83"/>
                <path d="M16.24 7.76l2.83-2.83"/>
            </svg>
        </button>

        <div class="sidebar-divider"></div>

        <!-- Layout Button (Hidden by default, shown in Dev mode) -->
        <button class="icon-btn disabled hidden" id="btn-layout" data-mode="layout" data-tooltip="Layout Editor">
            <svg viewBox="0 0 24 24">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
            </svg>
        </button>

        <!-- Debug Button -->
        <button class="icon-btn disabled" id="btn-debug" data-mode="debug" data-tooltip="Debug Panel (D)">
            <svg viewBox="0 0 24 24">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
        </button>

        <div class="sidebar-spacer"></div>
        
        <!-- Settings Button with Submenu (moved to bottom, always normal state) -->
        <div class="has-submenu" id="btn-settings-wrapper">
            <button class="icon-btn" id="btn-settings" data-mode="settings" data-tooltip="Settings">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>
            
            <!-- Settings Submenu -->
            <div class="submenu" id="settings-submenu">
                <div class="submenu-header">Settings</div>
                <button class="submenu-item" data-submode="general" onclick="setSubMode('settings', 'general')">
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 2v2"/>
                        <path d="M12 20v2"/>
                        <path d="M4.93 4.93l1.41 1.41"/>
                        <path d="M17.66 17.66l1.41 1.41"/>
                        <path d="M2 12h2"/>
                        <path d="M20 12h2"/>
                    </svg>
                    General
                </button>
                <div class="submenu-divider"></div>
                <button class="submenu-item" id="dev-mode-toggle" data-submode="dev-mode" onclick="toggleDevMode()">
                    <svg viewBox="0 0 24 24">
                        <polyline points="16 18 22 12 16 6"/>
                        <polyline points="8 6 2 12 8 18"/>
                    </svg>
                    <span id="dev-mode-label">Dev Mode: OFF</span>
                </button>
            </div>
        </div>

        <div style="height: 50px;"></div>
    </aside>

    <!-- =============================================
         DATABASE CONNECTION MODAL
         ============================================= -->
    <div class="modal-overlay" id="connection-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">
                    üîå Database Connection Manager
                </div>
                <button class="modal-close" onclick="closeConnectionModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <!-- API Status Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üì° API Status</h3>
                        <div class="panel-actions">
                            <button class="btn-icon" onclick="refreshAPIStatus()" title="Refresh">üîÑ</button>
                        </div>
                    </div>
                    <div class="api-status">
                        <div class="api-status-indicator" id="api-indicator"></div>
                        <div class="api-status-info">
                            <div class="api-status-url" id="api-url">http://localhost:8000</div>
                            <div class="api-status-meta">
                                <span id="api-status-text">Checking...</span>
                                <span id="api-response-time"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Site Selection Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üîç Site Connection</h3>
                        <div class="panel-actions">
                            <label class="auto-connect-label">
                                <input type="checkbox" id="auto-connect-checkbox">
                                <span>Auto Connect</span>
                            </label>
                        </div>
                    </div>
                    <div class="site-list" id="site-list">
                        <!-- Sites will be rendered here -->
                    </div>
                    <div class="panel-footer">
                        <div class="selection-info">
                            <span id="selection-count">Selected: 0</span>
                        </div>
                        <button class="btn-connect" id="connect-btn" disabled onclick="connectToSelectedSite()">
                            üîå Connect
                        </button>
                    </div>
                </div>
                
                <!-- Database List Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üìä Connected Databases</h3>
                        <div class="panel-actions">
                            <button class="btn-icon" onclick="refreshDatabaseInfo()" title="Refresh">üîÑ</button>
                        </div>
                    </div>
                    <div id="database-list">
                        <div class="no-connection">
                            <span class="no-connection-icon">üìÇ</span>
                            <p>No database connected</p>
                            <small>Connect to a site to view tables</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <span class="footer-hint">Ctrl+K to toggle | Escape to close</span>
                <button class="btn-secondary" onclick="closeConnectionModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- =============================================
         MAIN CONTENT AREA
         ============================================= -->
    <main class="main-content">
        <h1>üß™ Sidebar Test v2.3</h1>
        <p>ÏïÑÏù¥ÏΩò ÏàúÏÑú: Connection ‚Üí Monitoring ‚Üí Analysis ‚Üí Simulation | Settings at bottom</p>
        
        <div class="current-mode">
            <div class="mode-label">Current Mode</div>
            <div class="mode-value" id="current-mode">‚Äî</div>
            <div class="submode-value" id="current-submode"></div>
        </div>
    </main>

    <!-- =============================================
         STATUS BAR - Compact (36px height)
         ============================================= -->
    <footer class="status-bar">
        <!-- Left Group: Connections -->
        <div class="status-group">
            <!-- Backend Connection -->
            <div class="status-item" id="status-backend">
                <span class="status-dot disconnected" id="backend-dot"></span>
                <span class="status-label">Backend</span>
                <span class="status-value" id="backend-value">Disconnected</span>
            </div>
            
            <!-- DB Connection -->
            <div class="status-item" id="status-db">
                <span class="status-dot disconnected" id="db-dot"></span>
                <span class="status-label">DB</span>
                <span class="status-value" id="db-value">None</span>
            </div>
        </div>

        <!-- Center Group: Performance -->
        <div class="status-group">
            <!-- Render Performance -->
            <div class="status-item" id="status-render">
                <span class="status-label">FPS</span>
                <span class="status-value" id="fps-value">60</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="fps-bar" style="width: 100%;"></div>
                </div>
            </div>
            
            <!-- Memory Usage -->
            <div class="status-item" id="status-memory">
                <span class="status-label">MEM</span>
                <span class="status-value"><span id="memory-value">128</span>MB</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="memory-bar" style="width: 30%;"></div>
                </div>
            </div>
        </div>

        <!-- Right Group: User Info -->
        <div class="status-group">
            <div class="status-item">
                <span class="status-label">User</span>
                <span class="status-value">Admin</span>
            </div>
        </div>
    </footer>

    <!-- =============================================
         TEST FRAMEWORK PANEL
         ============================================= -->
    <div class="test-framework" id="test-panel">
        <div class="test-header">
            <div class="test-title">üß™ Icon Style Tester v2.3</div>
        </div>
        
        <!-- Tabs -->
        <div class="test-tabs">
            <button class="test-tab active" onclick="showPanel('style')">Icon Styles</button>
            <button class="test-tab" onclick="showPanel('status')">Status Bar</button>
            <button class="test-tab" onclick="showPanel('tests')">Tests</button>
        </div>
        
        <!-- Panel 1: Icon Styles -->
        <div class="test-panel active" id="panel-style">
            <div class="style-tester">
                <!-- Stroke Width Selection -->
                <div class="style-section">
                    <h4>Stroke Width (ÏÑ† ÍµµÍ∏∞)</h4>
                    <div class="style-row" id="stroke-options">
                        <!-- Generated by JS -->
                    </div>
                </div>
                
                <!-- Icon Size Selection -->
                <div class="style-section">
                    <h4>Icon Size (ÏïÑÏù¥ÏΩò ÌÅ¨Í∏∞)</h4>
                    <div class="style-row" id="size-options">
                        <!-- Generated by JS -->
                    </div>
                </div>
                
                <!-- State Preview -->
                <div class="style-section">
                    <h4>State Preview (ÏÉÅÌÉú ÎØ∏Î¶¨Î≥¥Í∏∞)</h4>
                    <div class="state-preview" id="state-preview">
                        <!-- Generated by JS -->
                    </div>
                </div>
                
                <!-- Current Config -->
                <div class="current-config">
                    <div class="config-row">
                        <span class="config-key">Icon Size:</span>
                        <span class="config-value" id="config-size">36px</span>
                    </div>
                    <div class="config-row">
                        <span class="config-key">Stroke Normal:</span>
                        <span class="config-value" id="config-stroke-normal">1px</span>
                    </div>
                    <div class="config-row">
                        <span class="config-key">Stroke Hover:</span>
                        <span class="config-value" id="config-stroke-hover">1.5px</span>
                    </div>
                    <div class="config-row">
                        <span class="config-key">Stroke Selected:</span>
                        <span class="config-value" id="config-stroke-selected">1.5px</span>
                    </div>
                </div>
                
                <button class="apply-btn" onclick="applyStyles()">‚úì Apply to Sidebar</button>
            </div>
        </div>
        
        <!-- Panel 2: Status Bar Controls -->
        <div class="test-panel" id="panel-status">
            <div class="style-section">
                <h4>Backend Connection</h4>
                <div class="style-row">
                    <button class="style-option" onclick="setBackendStatus('connected')">‚úì Connected</button>
                    <button class="style-option" onclick="setBackendStatus('disconnected')">‚úó Disconnected</button>
                    <button class="style-option" onclick="setBackendStatus('connecting')">‚ü≥ Connecting</button>
                </div>
            </div>
            
            <div class="style-section">
                <h4>Database Connection</h4>
                <div class="style-row">
                    <button class="style-option" onclick="setDBStatus('connected', 'kr-b-01')">kr-b-01</button>
                    <button class="style-option" onclick="setDBStatus('connected', 'vn-a-02')">vn-a-02</button>
                    <button class="style-option" onclick="setDBStatus('disconnected', 'None')">Disconnected</button>
                </div>
            </div>
            
            <div class="style-section">
                <h4>Render Performance</h4>
                <div class="slider-container">
                    <label>
                        <span>FPS</span>
                        <span id="fps-display">60</span>
                    </label>
                    <input type="range" min="1" max="120" value="60" oninput="setFPS(this.value)">
                </div>
                <div class="slider-container">
                    <label>
                        <span>Memory (MB)</span>
                        <span id="memory-display">128</span>
                    </label>
                    <input type="range" min="50" max="2000" value="128" oninput="setMemory(this.value)">
                </div>
            </div>
        </div>
        
        <!-- Panel 3: Automated Tests -->
        <div class="test-panel" id="panel-tests">
            <div class="style-section">
                <h4>Visual Tests</h4>
                <div id="test-results">
                    <!-- Generated by test runner -->
                </div>
                <button class="apply-btn" onclick="runAllTests()" style="margin-top: 12px;">‚ñ∂ Run All Tests</button>
            </div>
            
            <div class="test-log" id="test-log">
                <div class="log-entry info">Ready to run tests...</div>
            </div>
        </div>
    </div>

    <!-- =============================================
         SCRIPTS
         ============================================= -->
    <script>
        // =============================================
        // Configuration - v2.3 defaults
        // =============================================
        const CONFIG = {
            strokeWidths: [1, 1.5, 2, 2.5, 3],
            iconSizes: [24, 28, 32, 36, 40],
            currentStroke: 1,
            currentSize: 36,
            strokeHover: 1.5,
            strokeSelected: 1.5
        };
        
        let currentMode = null;
        let currentSubMode = null;
        let isConnected = false;
        let devModeEnabled = false;
        let selectedSite = null;
        
        // Simulated site profiles (matching Sherlock_Sky_3DSim structure)
        const siteProfiles = [
            { id: 'kr_b_01', display_name: 'Korea Site B-01', region: 'Asia/Seoul', priority: 10 },
            { id: 'kr_b_02', display_name: 'Korea Site B-02', region: 'Asia/Seoul', priority: 8 },
            { id: 'vn_a_01', display_name: 'Vietnam Site A-01', region: 'Asia/Ho_Chi_Minh', priority: 5 },
            { id: 'us_w_01', display_name: 'USA West Site W-01', region: 'America/Los_Angeles', priority: 3 }
        ];
        
        let siteStatus = {};

        // =============================================
        // Initialize
        // =============================================
        function init() {
            generateStrokeOptions();
            generateSizeOptions();
            generateStatePreview();
            setupSidebarEvents();
            startPerformanceSimulation();
            updateConfigDisplay();
            applyStyles();
            
            // Initialize site status
            siteProfiles.forEach(site => {
                siteStatus[site.id] = { status: 'disconnected' };
            });
            
            // Render site list
            renderSiteList();
            
            // Show connection modal on start
            setTimeout(() => {
                openConnectionModal();
            }, 500);
            
            // Start API status check simulation
            simulateAPIStatus();
        }

        // =============================================
        // Connection Modal Functions
        // v2.3: Modal can be closed without connection
        // =============================================
        function openConnectionModal() {
            document.getElementById('connection-modal').classList.add('active');
            log('Connection modal opened', 'info');
        }
        
        function closeConnectionModal() {
            // v2.3: Allow closing modal even without connection
            document.getElementById('connection-modal').classList.remove('active');
            log('Connection modal closed', 'info');
        }
        
        function toggleConnectionModal() {
            const modal = document.getElementById('connection-modal');
            if (modal.classList.contains('active')) {
                closeConnectionModal();
            } else {
                openConnectionModal();
            }
        }
        
        function simulateAPIStatus() {
            const indicator = document.getElementById('api-indicator');
            const statusText = document.getElementById('api-status-text');
            const responseTime = document.getElementById('api-response-time');
            
            // Simulate healthy API
            indicator.className = 'api-status-indicator healthy';
            statusText.textContent = 'Healthy';
            responseTime.textContent = '‚Ä¢ 45ms';
        }
        
        function refreshAPIStatus() {
            const indicator = document.getElementById('api-indicator');
            const statusText = document.getElementById('api-status-text');
            
            indicator.className = 'api-status-indicator';
            statusText.textContent = 'Checking...';
            
            setTimeout(() => {
                simulateAPIStatus();
                log('API status refreshed', 'success');
            }, 500);
        }
        
        function renderSiteList() {
            const siteList = document.getElementById('site-list');
            
            siteList.innerHTML = siteProfiles.map(profile => {
                const status = siteStatus[profile.id] || {};
                const isSelected = selectedSite === profile.id;
                const isConnectedSite = status.status === 'connected';
                
                let itemClasses = ['site-item'];
                if (isSelected) itemClasses.push('site-item--selected');
                if (isConnectedSite) itemClasses.push('site-item--connected');
                
                return `
                    <div class="${itemClasses.join(' ')}" data-site-id="${profile.id}" onclick="toggleSiteSelection('${profile.id}')">
                        <div class="site-checkbox">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleSiteSelection('${profile.id}')">
                        </div>
                        <div class="site-info">
                            <div class="site-main">
                                <span class="site-name">${profile.display_name}</span>
                                <span class="site-region">${profile.region}</span>
                            </div>
                            <div class="site-meta">
                                Priority: ${profile.priority}
                            </div>
                        </div>
                        <div class="site-status">
                            ${isConnectedSite ? `
                                <span class="status-icon">‚úÖ</span>
                                <button class="btn-disconnect" onclick="event.stopPropagation(); disconnectFromSite('${profile.id}')">Disconnect</button>
                            ` : `
                                <span class="status-icon">‚ö™</span>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateSelectionUI();
        }
        
        function toggleSiteSelection(siteId) {
            if (selectedSite === siteId) {
                selectedSite = null;
            } else {
                selectedSite = siteId;
            }
            renderSiteList();
        }
        
        function updateSelectionUI() {
            const countEl = document.getElementById('selection-count');
            const connectBtn = document.getElementById('connect-btn');
            
            countEl.textContent = `Selected: ${selectedSite ? 1 : 0}`;
            connectBtn.disabled = !selectedSite;
        }
        
        function connectToSelectedSite() {
            if (!selectedSite) return;
            
            const connectBtn = document.getElementById('connect-btn');
            connectBtn.disabled = true;
            connectBtn.textContent = '‚è≥ Connecting...';
            
            // Simulate connection
            setTimeout(() => {
                siteStatus[selectedSite] = { status: 'connected' };
                isConnected = true;
                
                // Update UI
                renderSiteList();
                renderDatabaseInfo(selectedSite);
                enableSidebarIcons();
                updateStatusBar(selectedSite);
                
                connectBtn.textContent = 'üîå Connect';
                connectBtn.disabled = true;
                
                log(`Connected to ${selectedSite}`, 'success');
            }, 1500);
        }
        
        function disconnectFromSite(siteId) {
            siteStatus[siteId] = { status: 'disconnected' };
            isConnected = false;
            selectedSite = null;
            
            renderSiteList();
            clearDatabaseInfo();
            disableSidebarIcons();
            updateStatusBar(null);
            
            // Reset current mode
            currentMode = null;
            document.getElementById('current-mode').textContent = '‚Äî';
            document.getElementById('current-submode').textContent = '';
            
            log(`Disconnected from ${siteId}`, 'info');
        }
        
        function renderDatabaseInfo(siteId) {
            const dbList = document.getElementById('database-list');
            const site = siteProfiles.find(s => s.id === siteId);
            
            dbList.innerHTML = `
                <div class="database-item">
                    <div class="database-header">
                        <h4>üóÑÔ∏è ${site.display_name} - EquipmentDB</h4>
                        <div class="database-stats">
                            <span class="stat-item">
                                <span class="stat-label">Tables:</span>
                                <span class="stat-value">12</span>
                            </span>
                            <span class="stat-item">
                                <span class="stat-label">Type:</span>
                                <span class="stat-value">MSSQL</span>
                            </span>
                        </div>
                    </div>
                    <div style="padding: 8px 0; font-size: 12px; color: #6B7280;">
                        Site ID: ${siteId}
                    </div>
                </div>
            `;
        }
        
        function clearDatabaseInfo() {
            const dbList = document.getElementById('database-list');
            dbList.innerHTML = `
                <div class="no-connection">
                    <span class="no-connection-icon">üìÇ</span>
                    <p>No database connected</p>
                    <small>Connect to a site to view tables</small>
                </div>
            `;
        }
        
        function refreshDatabaseInfo() {
            if (isConnected && selectedSite) {
                log('Refreshing database info...', 'info');
                setTimeout(() => {
                    renderDatabaseInfo(selectedSite);
                    log('Database info refreshed', 'success');
                }, 500);
            }
        }
        
        function enableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-debug'].forEach(id => {
                document.getElementById(id).classList.remove('disabled');
            });
            
            if (devModeEnabled) {
                document.getElementById('btn-layout').classList.remove('disabled');
            }
        }
        
        function disableSidebarIcons() {
            // v2.3: Only disable feature icons, keep Connection and Settings normal
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-debug', 'btn-layout'].forEach(id => {
                document.getElementById(id).classList.add('disabled');
            });
            
            // Clear selected state from all buttons
            document.querySelectorAll('.icon-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }
        
        function updateStatusBar(siteId) {
            const backendDot = document.getElementById('backend-dot');
            const backendValue = document.getElementById('backend-value');
            const dbDot = document.getElementById('db-dot');
            const dbValue = document.getElementById('db-value');
            
            if (siteId) {
                backendDot.className = 'status-dot connected';
                backendValue.textContent = 'Connected';
                dbDot.className = 'status-dot connected';
                dbValue.textContent = siteId.replace(/_/g, '-');
            } else {
                backendDot.className = 'status-dot disconnected';
                backendValue.textContent = 'Disconnected';
                dbDot.className = 'status-dot disconnected';
                dbValue.textContent = 'None';
            }
        }

        // =============================================
        // Dev Mode Toggle
        // =============================================
        function toggleDevMode() {
            devModeEnabled = !devModeEnabled;
            
            const layoutBtn = document.getElementById('btn-layout');
            const devModeLabel = document.getElementById('dev-mode-label');
            
            if (devModeEnabled) {
                layoutBtn.classList.remove('hidden');
                if (isConnected) {
                    layoutBtn.classList.remove('disabled');
                }
                devModeLabel.textContent = 'Dev Mode: ON';
                log('Dev Mode enabled - Layout Editor visible', 'success');
            } else {
                layoutBtn.classList.add('hidden');
                devModeLabel.textContent = 'Dev Mode: OFF';
                log('Dev Mode disabled - Layout Editor hidden', 'info');
            }
        }

        // =============================================
        // Panel Management
        // =============================================
        function showPanel(panelName) {
            document.querySelectorAll('.test-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.test-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(`panel-${panelName}`).classList.add('active');
            event.target.classList.add('active');
        }

        // =============================================
        // Stroke Width Options
        // =============================================
        function generateStrokeOptions() {
            const container = document.getElementById('stroke-options');
            container.innerHTML = '';
            
            CONFIG.strokeWidths.forEach(width => {
                const option = document.createElement('div');
                option.className = `style-option${width === CONFIG.currentStroke ? ' selected' : ''}`;
                option.onclick = () => selectStroke(width);
                
                option.innerHTML = `
                    <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="#E2E8F0" stroke-width="${width}">
                        <rect x="3" y="4" width="18" height="12" rx="2"/>
                        <polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/>
                    </svg>
                    <span class="style-label">${width}px</span>
                `;
                
                container.appendChild(option);
            });
        }

        function selectStroke(width) {
            CONFIG.currentStroke = width;
            CONFIG.strokeHover = Math.min(width + 0.5, 3);
            CONFIG.strokeSelected = Math.min(width + 0.5, 3);
            
            generateStrokeOptions();
            generateStatePreview();
            updateConfigDisplay();
        }

        // =============================================
        // Icon Size Options
        // =============================================
        function generateSizeOptions() {
            const container = document.getElementById('size-options');
            container.innerHTML = '';
            
            CONFIG.iconSizes.forEach(size => {
                const option = document.createElement('div');
                option.className = `style-option${size === CONFIG.currentSize ? ' selected' : ''}`;
                option.onclick = () => selectSize(size);
                
                option.innerHTML = `
                    <svg viewBox="0 0 24 24" width="${size}" height="${size}" fill="none" stroke="#E2E8F0" stroke-width="${CONFIG.currentStroke}">
                        <rect x="3" y="4" width="18" height="12" rx="2"/>
                        <polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/>
                    </svg>
                    <span class="style-label">${size}px</span>
                `;
                
                container.appendChild(option);
            });
        }

        function selectSize(size) {
            CONFIG.currentSize = size;
            generateSizeOptions();
            generateStatePreview();
            updateConfigDisplay();
        }

        // =============================================
        // State Preview
        // =============================================
        function generateStatePreview() {
            const container = document.getElementById('state-preview');
            const states = ['normal', 'hover', 'selected', 'selected-hover', 'disabled'];
            
            container.innerHTML = states.map(state => {
                const strokeWidth = (state === 'hover' || state === 'selected-hover') ? CONFIG.strokeHover : 
                                   state === 'selected' ? CONFIG.strokeSelected : 
                                   CONFIG.currentStroke;
                const color = state === 'disabled' ? '#334155' :
                             (state === 'selected' || state === 'selected-hover') ? '#06B6D4' :
                             state === 'hover' ? '#FFFFFF' : '#E2E8F0';
                
                const label = state === 'selected-hover' ? 'sel+hover' : state;
                
                return `
                    <div class="state-item">
                        <div class="icon-wrapper ${state}">
                            <svg viewBox="0 0 24 24" width="${CONFIG.currentSize}" height="${CONFIG.currentSize}" 
                                 fill="none" stroke="${color}" stroke-width="${strokeWidth}"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="12" rx="2"/>
                                <polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/>
                                <path d="M12 16v4"/>
                                <path d="M8 20h8"/>
                            </svg>
                        </div>
                        <span class="state-label">${label}</span>
                    </div>
                `;
            }).join('');
        }

        // =============================================
        // Apply Styles to Sidebar
        // =============================================
        function applyStyles() {
            document.documentElement.style.setProperty('--icon-size', `${CONFIG.currentSize}px`);
            document.documentElement.style.setProperty('--icon-stroke-normal', `${CONFIG.currentStroke}px`);
            document.documentElement.style.setProperty('--icon-stroke-hover', `${CONFIG.strokeHover}px`);
            document.documentElement.style.setProperty('--icon-stroke-selected', `${CONFIG.strokeSelected}px`);
            
            log(`Applied: Size=${CONFIG.currentSize}px, Stroke=${CONFIG.currentStroke}px`, 'success');
        }

        function updateConfigDisplay() {
            document.getElementById('config-size').textContent = `${CONFIG.currentSize}px`;
            document.getElementById('config-stroke-normal').textContent = `${CONFIG.currentStroke}px`;
            document.getElementById('config-stroke-hover').textContent = `${CONFIG.strokeHover}px`;
            document.getElementById('config-stroke-selected').textContent = `${CONFIG.strokeSelected}px`;
        }

        // =============================================
        // Sidebar Events
        // =============================================
        function setupSidebarEvents() {
            const buttons = document.querySelectorAll('.icon-btn');
            
            buttons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (this.classList.contains('disabled')) return;
                    if (this.closest('.has-submenu') && this.id !== 'btn-connection') return;
                    
                    // Special handling for connection button
                    if (this.id === 'btn-connection') {
                        openConnectionModal();
                        return;
                    }
                    
                    // Don't select Connection or Settings buttons
                    if (this.id === 'btn-connection' || this.id === 'btn-settings') {
                        return;
                    }
                    
                    buttons.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const mode = this.dataset.mode;
                    setMode(mode);
                });
            });
            
            // Monitoring button special handling
            const monitoringBtn = document.getElementById('btn-monitoring');
            monitoringBtn.addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;
                const buttons = document.querySelectorAll('.icon-btn');
                buttons.forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                setMode('monitoring');
            });
        }

        function setMode(mode) {
            currentMode = mode;
            currentSubMode = null;
            document.getElementById('current-mode').textContent = 
                mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('current-submode').textContent = '';
            
            // Disable Debug button when Monitoring is selected
            const debugBtn = document.getElementById('btn-debug');
            if (mode === 'monitoring') {
                debugBtn.classList.add('disabled');
                log('Debug Panel disabled (Monitoring mode)', 'info');
            } else if (isConnected) {
                debugBtn.classList.remove('disabled');
            }
            
            log(`Mode: ${mode}`, 'info');
        }

        function setSubMode(mode, submode) {
            currentMode = mode;
            currentSubMode = submode;
            
            // Update main button
            const buttons = document.querySelectorAll('.icon-btn');
            buttons.forEach(b => b.classList.remove('selected'));
            
            if (mode === 'monitoring') {
                document.getElementById('btn-monitoring').classList.add('selected');
            }
            
            // Update submenu items
            document.querySelectorAll('.submenu-item').forEach(item => {
                item.classList.toggle('active', item.dataset.submode === submode);
            });
            
            // Update display
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            const submodeLabels = {
                '3d-view': '3D View',
                'ranking-view': 'Ranking View',
                'general': 'General Settings',
                'dev-mode': 'Developer Mode'
            };
            document.getElementById('current-submode').textContent = `‚Üí ${submodeLabels[submode] || submode}`;
            
            log(`Mode: ${mode} ‚Üí ${submode}`, 'info');
        }

        // =============================================
        // Status Bar Controls
        // =============================================
        function setBackendStatus(status) {
            const dot = document.getElementById('backend-dot');
            const value = document.getElementById('backend-value');
            
            dot.className = 'status-dot';
            
            switch(status) {
                case 'connected':
                    dot.classList.add('connected');
                    value.textContent = 'Connected';
                    break;
                case 'disconnected':
                    dot.classList.add('disconnected');
                    value.textContent = 'Disconnected';
                    break;
                case 'connecting':
                    dot.classList.add('warning');
                    value.textContent = 'Connecting...';
                    break;
            }
            
            log(`Backend: ${status}`, status === 'connected' ? 'success' : 'error');
        }

        function setDBStatus(status, name) {
            const dot = document.getElementById('db-dot');
            const value = document.getElementById('db-value');
            
            dot.className = 'status-dot';
            dot.classList.add(status === 'connected' ? 'connected' : 'disconnected');
            value.textContent = name;
            
            log(`Database: ${name} (${status})`, status === 'connected' ? 'success' : 'error');
        }

        function setFPS(fps) {
            fps = parseInt(fps);
            document.getElementById('fps-value').textContent = fps;
            document.getElementById('fps-display').textContent = fps;
            
            const bar = document.getElementById('fps-bar');
            const percent = Math.min(100, (fps / 60) * 100);
            bar.style.width = `${percent}%`;
            
            bar.className = 'perf-bar-fill';
            if (fps >= 50) bar.classList.add('good');
            else if (fps >= 30) bar.classList.add('medium');
            else bar.classList.add('bad');
        }

        function setMemory(mb) {
            mb = parseInt(mb);
            document.getElementById('memory-value').textContent = mb;
            document.getElementById('memory-display').textContent = mb;
            
            const bar = document.getElementById('memory-bar');
            const percent = Math.min(100, (mb / 1000) * 100);
            bar.style.width = `${percent}%`;
            
            bar.className = 'perf-bar-fill';
            if (mb < 500) bar.classList.add('good');
            else if (mb < 1000) bar.classList.add('medium');
            else bar.classList.add('bad');
        }

        // =============================================
        // Performance Simulation
        // =============================================
        function startPerformanceSimulation() {
            setInterval(() => {
                const baseFPS = 58;
                const fps = baseFPS + Math.floor(Math.random() * 5);
                setFPS(fps);
                
                const currentMem = parseInt(document.getElementById('memory-value').textContent);
                const newMem = Math.max(100, Math.min(300, currentMem + (Math.random() - 0.5) * 20));
                setMemory(Math.floor(newMem));
            }, 2000);
        }

        // =============================================
        // Test Runner
        // =============================================
        const tests = [
            { name: 'Sidebar renders', fn: () => document.getElementById('sidebar').offsetWidth > 0 },
            { name: 'Icon order correct (4 main)', fn: () => {
                const ids = ['btn-connection', 'btn-monitoring', 'btn-analysis', 'btn-simulation'];
                return ids.every(id => document.getElementById(id) !== null);
            }},
            { name: 'Settings at bottom', fn: () => {
                const sidebar = document.getElementById('sidebar');
                const settingsWrapper = document.getElementById('btn-settings-wrapper');
                const spacer = sidebar.querySelector('.sidebar-spacer');
                return spacer && settingsWrapper && spacer.compareDocumentPosition(settingsWrapper) & Node.DOCUMENT_POSITION_FOLLOWING;
            }},
            { name: 'Layout hidden by default', fn: () => {
                return document.getElementById('btn-layout').classList.contains('hidden');
            }},
            { name: 'Connection modal shows on start', fn: () => {
                return document.getElementById('connection-modal').classList.contains('active');
            }},
            { name: 'Icons disabled before connection', fn: () => {
                return document.getElementById('btn-monitoring').classList.contains('disabled');
            }},
            { name: 'Default stroke = 1px', fn: () => CONFIG.currentStroke === 1 },
            { name: 'Default size = 36px', fn: () => CONFIG.currentSize === 36 },
            { name: 'Connection btn normal state', fn: () => {
                const connBtn = document.getElementById('btn-connection');
                return !connBtn.classList.contains('selected');
            }},
            { name: 'Settings always normal state', fn: () => {
                const settingsBtn = document.getElementById('btn-settings');
                return !settingsBtn.classList.contains('selected');
            }},
        ];

        function runAllTests() {
            const container = document.getElementById('test-results');
            container.innerHTML = '';
            
            let passed = 0;
            let failed = 0;
            
            tests.forEach(test => {
                try {
                    const result = test.fn();
                    result ? passed++ : failed++;
                    
                    container.innerHTML += `
                        <div style="padding: 6px 0; display: flex; gap: 8px; align-items: center;">
                            <span style="color: ${result ? '#4ADE80' : '#F87171'};">${result ? '‚úì' : '‚úó'}</span>
                            <span style="color: ${result ? '#E5E5E5' : '#9CA3AF'};">${test.name}</span>
                        </div>
                    `;
                } catch(e) {
                    failed++;
                    container.innerHTML += `
                        <div style="padding: 6px 0; display: flex; gap: 8px; align-items: center;">
                            <span style="color: #F87171;">‚úó</span>
                            <span style="color: #9CA3AF;">${test.name}: ${e.message}</span>
                        </div>
                    `;
                }
            });
            
            log(`Tests: ${passed} passed, ${failed} failed`, failed === 0 ? 'success' : 'error');
        }

        // =============================================
        // Logging
        // =============================================
        function log(message, type = 'info') {
            const logEl = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
            
            while (logEl.children.length > 20) {
                logEl.removeChild(logEl.firstChild);
            }
        }

        // =============================================
        // Keyboard Shortcuts
        // v2.3: Escape always closes modal
        // =============================================
        document.addEventListener('keydown', (e) => {
            if (e.target.matches('input, textarea')) return;
            
            const key = e.key.toLowerCase();
            
            // Ctrl+K: Toggle connection modal
            if ((e.ctrlKey || e.metaKey) && key === 'k') {
                e.preventDefault();
                toggleConnectionModal();
                return;
            }
            
            // Escape: Close modal (always allowed now)
            if (key === 'escape') {
                if (document.getElementById('connection-modal').classList.contains('active')) {
                    closeConnectionModal();
                }
                return;
            }
            
            // Other shortcuts only work when connected
            if (!isConnected) return;
            
            switch(key) {
                case 'm':
                    if (!document.getElementById('btn-monitoring').classList.contains('disabled')) {
                        document.getElementById('btn-monitoring').click();
                    }
                    break;
                case 'a':
                    if (!document.getElementById('btn-analysis').classList.contains('disabled')) {
                        document.getElementById('btn-analysis').click();
                    }
                    break;
                case 's':
                    if (!e.ctrlKey && !document.getElementById('btn-simulation').classList.contains('disabled')) {
                        document.getElementById('btn-simulation').click();
                    }
                    break;
                case 'd':
                    const debugBtn = document.getElementById('btn-debug');
                    if (!debugBtn.classList.contains('disabled')) {
                        debugBtn.click();
                    }
                    break;
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
        
        // Console exports
        window.applyStyles = applyStyles;
        window.setMode = setMode;
        window.setSubMode = setSubMode;
        window.setBackendStatus = setBackendStatus;
        window.setDBStatus = setDBStatus;
        window.setFPS = setFPS;
        window.setMemory = setMemory;
        window.toggleDevMode = toggleDevMode;
        window.openConnectionModal = openConnectionModal;
        window.closeConnectionModal = closeConnectionModal;
        
        console.log('üß™ Sidebar Test v2.3 Loaded');
        console.log('Changes: Modal closable without connection, Connection+Settings always normal state');
    </script>

</body>
</html>
