<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test: Cleanroom Sidebar (Standalone) v2.4</title>
    
    <style>
        /* =============================================
           1. Theme Configuration (Cleanroom Palette)
           v2.4: Icon customization modal, disabled submenu fix
           ============================================= */
        :root {
            /* Background Colors */
            --bg-sidebar: #0F172A;
            --bg-main: #FFFFFF;
            
            /* Icon Colors */
            --icon-normal: #E2E8F0;
            --icon-selected: #06B6D4;
            --icon-disabled: #334155;
            
            /* Icon Sizing */
            --icon-size: 36px;
            --icon-stroke-normal: 1px;
            --icon-stroke-hover: 1.5px;
            --icon-stroke-selected: 1.5px;
            
            /* Status Text Colors */
            --text-normal: #CBD5E1;
            --text-warning: #FBBF24;
            --text-alarm: #F87171;
            --text-success: #4ADE80;

            /* Interaction Settings */
            --transition-speed: 0.25s;
            
            /* Status Bar */
            --status-bar-height: 36px;
        }

        /* Reset & Layout */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Segoe UI', sans-serif;
            background: #1e293b;
        }
        
        /* =============================================
           2. Sidebar (Left)
           ============================================= */
        .sidebar {
            width: 80px;
            background-color: var(--bg-sidebar);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 24px;
            z-index: 10;
            box-shadow: 4px 0 15px rgba(0,0,0,0.25);
            transition: width 0.3s ease;
        }

        /* Icon Button Container */
        .icon-btn {
            width: 54px;
            height: 54px;
            margin-bottom: 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: transform var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* SVG Style */
        .icon-btn svg {
            width: var(--icon-size);
            height: var(--icon-size);
            fill: none;
            stroke: var(--icon-normal);
            stroke-width: var(--icon-stroke-normal);
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all var(--transition-speed);
        }

        /* =============================================
           3. Interaction Logic (Hover & Selected)
           ============================================= */
        
        /* Hover Effect (not selected) */
        .icon-btn:not(.selected):not(.disabled):hover {
            transform: scale(1.1) translateY(-3px);
        }
        .icon-btn:not(.selected):not(.disabled):hover svg {
            stroke: #FFFFFF;
            stroke-width: var(--icon-stroke-hover);
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
        }

        /* Selected Effect */
        .icon-btn.selected {
            transform: scale(1.08) translateY(-2px);
        }
        .icon-btn.selected svg {
            stroke: var(--icon-selected);
            stroke-width: var(--icon-stroke-selected);
            filter: drop-shadow(0 0 6px var(--icon-selected));
        }

        /* Selected + Hover = Floating Effect */
        @keyframes float {
            0%, 100% { transform: scale(1.12) translateY(-4px); }
            50% { transform: scale(1.12) translateY(-8px); }
        }
        
        .icon-btn.selected:hover {
            animation: float 2s ease-in-out infinite;
        }
        .icon-btn.selected:hover svg {
            stroke: var(--icon-selected);
            stroke-width: var(--icon-stroke-selected);
            filter: drop-shadow(0 0 12px var(--icon-selected));
        }

        /* Indicator Line for Selected Item */
        .icon-btn.selected::before {
            content: '';
            position: absolute;
            left: -13px;
            width: 3px;
            height: 28px;
            background-color: var(--icon-selected);
            border-radius: 0 3px 3px 0;
            box-shadow: 0 0 6px var(--icon-selected);
        }

        /* Disabled State */
        .icon-btn.disabled {
            cursor: not-allowed;
            opacity: 0.4;
            pointer-events: none;
        }
        .icon-btn.disabled svg {
            stroke: var(--icon-disabled);
        }
        .icon-btn.disabled:hover {
            transform: none;
            animation: none;
        }

        /* Hidden State */
        .icon-btn.hidden {
            display: none !important;
        }

        /* =============================================
           4. Submenu System
           ============================================= */
        .has-submenu {
            position: relative;
        }
        
        .submenu {
            position: absolute;
            left: 70px;
            top: 0;
            background: var(--bg-sidebar);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 160px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-10px);
            transition: all 0.2s ease;
            box-shadow: 4px 4px 20px rgba(0,0,0,0.4);
            z-index: 100;
        }
        
        /* v2.4: Submenu only shows when NOT disabled */
        .has-submenu:not(.disabled):hover .submenu,
        .has-submenu:not(.disabled).submenu-open .submenu {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }
        
        /* Disabled wrapper blocks submenu */
        .has-submenu.disabled .submenu {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }
        
        .submenu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            color: var(--text-normal);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        
        .submenu-item:hover {
            background: rgba(6, 182, 212, 0.1);
            color: #FFFFFF;
        }
        
        .submenu-item.active {
            background: rgba(6, 182, 212, 0.15);
            color: var(--icon-selected);
        }
        
        .submenu-item svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 1.5px;
            fill: none;
        }
        
        .submenu-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 6px 12px;
        }
        
        .submenu-header {
            padding: 6px 16px;
            font-size: 10px;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Submenu indicator arrow */
        .has-submenu::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            border: 4px solid transparent;
            border-left-color: var(--icon-normal);
            opacity: 0.5;
        }
        
        .has-submenu:not(.disabled):hover::after {
            border-left-color: var(--icon-selected);
            opacity: 1;
        }
        
        /* Disabled submenu arrow */
        .has-submenu.disabled::after {
            border-left-color: var(--icon-disabled);
            opacity: 0.3;
        }
        
        /* =============================================
           4.1 Always Normal State Icons
           Connection and Settings icons never get selected styling
           ============================================= */
        #btn-connection,
        #btn-settings-wrapper .icon-btn {
            transform: none !important;
        }
        #btn-connection::before,
        #btn-settings-wrapper .icon-btn::before {
            display: none !important;
        }
        #btn-connection svg,
        #btn-settings-wrapper .icon-btn svg {
            stroke: var(--icon-normal) !important;
            filter: none !important;
        }
        #btn-connection:hover svg,
        #btn-settings-wrapper .icon-btn:hover svg {
            stroke: #FFFFFF !important;
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3)) !important;
        }
        #btn-connection:hover,
        #btn-settings-wrapper:hover .icon-btn {
            transform: scale(1.1) translateY(-3px) !important;
        }

        /* =============================================
           5. Main Content Area
           ============================================= */
        .main-content {
            flex-grow: 1;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #e5e5e5;
            margin-bottom: var(--status-bar-height);
        }

        .main-content h1 {
            font-size: 32px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #06B6D4, #8B5CF6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-content p {
            color: #9CA3AF;
        }

        /* Current Mode Display */
        .current-mode {
            margin-top: 40px;
            padding: 20px 40px;
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            text-align: center;
        }

        .mode-label {
            font-size: 12px;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .mode-value {
            font-size: 24px;
            font-weight: bold;
            color: #06B6D4;
        }
        
        .submode-value {
            font-size: 14px;
            color: #9CA3AF;
            margin-top: 4px;
        }

        /* =============================================
           6. Status Bar (Bottom)
           ============================================= */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--status-bar-height);
            background-color: var(--bg-sidebar);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            box-sizing: border-box;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            z-index: 20;
        }

        .status-group { 
            display: flex; 
            gap: 16px;
            align-items: center;
        }
        
        .status-item { 
            display: flex; 
            align-items: center; 
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 4px;
        }

        .status-dot { 
            width: 6px; 
            height: 6px; 
            border-radius: 50%; 
            background-color: currentColor;
            flex-shrink: 0;
        }
        
        .status-dot.connected {
            background-color: var(--text-success);
            box-shadow: 0 0 4px var(--text-success);
        }
        
        .status-dot.disconnected {
            background-color: var(--text-alarm);
            box-shadow: 0 0 4px var(--text-alarm);
        }

        .status-label {
            color: #6B7280;
            font-size: 9px;
            text-transform: uppercase;
        }
        
        .status-value {
            color: var(--text-normal);
            font-weight: 500;
            font-size: 11px;
        }
        
        .perf-bar {
            width: 50px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .perf-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s, background 0.3s;
        }
        
        .perf-bar-fill.good { background: var(--text-success); }
        .perf-bar-fill.medium { background: var(--text-warning); }
        .perf-bar-fill.bad { background: var(--text-alarm); }

        /* Tooltip */
        .icon-btn[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 70px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            transform: translateX(-10px);
            z-index: 50;
        }

        .icon-btn:not(.has-submenu):hover[data-tooltip]::after {
            opacity: 1;
            transform: translateX(0);
        }

        /* Divider & Spacer */
        .sidebar-divider {
            width: 40px;
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 8px 0;
        }

        .sidebar-spacer {
            flex-grow: 1;
        }
        
        /* =============================================
           7. Modal Styles (Shared)
           ============================================= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-container {
            background: #1E293B;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-container {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #E2E8F0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            color: #9CA3AF;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(248, 113, 113, 0.2);
            color: #F87171;
        }
        
        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(85vh - 140px);
        }
        
        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
        }
        
        .footer-hint {
            font-size: 11px;
            color: #6B7280;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #E2E8F0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .btn-primary {
            padding: 10px 20px;
            background: linear-gradient(135deg, #06B6D4, #0891B2);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Connection Panel Styles */
        .connection-panel {
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .panel-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: #E2E8F0;
        }
        
        .panel-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        /* API Status Panel */
        .api-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
        }
        
        .api-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .api-status-indicator.healthy {
            background: #4ADE80;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .api-status-info {
            flex: 1;
        }
        
        .api-status-url {
            font-size: 13px;
            color: #E2E8F0;
            font-family: 'Consolas', monospace;
        }
        
        .api-status-meta {
            font-size: 11px;
            color: #6B7280;
            margin-top: 2px;
        }
        
        /* Site List */
        .site-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
        }
        
        .site-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .site-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
        }
        
        .site-item.site-item--selected {
            background: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.3);
        }
        
        .site-item.site-item--connected {
            background: rgba(74, 222, 128, 0.1);
            border-color: rgba(74, 222, 128, 0.3);
        }
        
        .site-checkbox input {
            width: 16px;
            height: 16px;
            accent-color: #06B6D4;
        }
        
        .site-info {
            flex: 1;
        }
        
        .site-main {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .site-name {
            font-size: 14px;
            font-weight: 500;
            color: #E2E8F0;
        }
        
        .site-region {
            font-size: 11px;
            padding: 2px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            color: #9CA3AF;
        }
        
        .site-meta {
            font-size: 11px;
            color: #6B7280;
            margin-top: 4px;
        }
        
        .site-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-icon {
            font-size: 16px;
        }
        
        .btn-disconnect {
            padding: 4px 10px;
            font-size: 11px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(248, 113, 113, 0.2);
            color: #F87171;
        }
        
        .btn-disconnect:hover {
            background: rgba(248, 113, 113, 0.3);
        }
        
        .panel-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-top: 1px solid rgba(255,255,255,0.05);
            background: rgba(0,0,0,0.1);
        }
        
        .selection-info {
            font-size: 12px;
            color: #9CA3AF;
        }
        
        .btn-connect {
            padding: 10px 20px;
            background: linear-gradient(135deg, #06B6D4, #0891B2);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-connect:hover:not(:disabled) {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
        }
        
        .btn-connect:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .auto-connect-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #9CA3AF;
            cursor: pointer;
        }
        
        .auto-connect-label input {
            accent-color: #06B6D4;
        }
        
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .btn-icon:hover {
            opacity: 1;
        }
        
        /* Database Info */
        .database-item {
            padding: 16px;
        }
        
        .database-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .database-header h4 {
            font-size: 14px;
            color: #E2E8F0;
        }
        
        .database-stats {
            display: flex;
            gap: 16px;
        }
        
        .stat-item {
            display: flex;
            gap: 4px;
            font-size: 12px;
        }
        
        .stat-label {
            color: #6B7280;
        }
        
        .stat-value {
            color: #06B6D4;
            font-weight: 600;
        }
        
        .no-connection {
            text-align: center;
            padding: 32px;
            color: #6B7280;
        }
        
        .no-connection-icon {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }
        
        /* =============================================
           8. Icon Customization Modal
           ============================================= */
        #icon-modal .modal-container {
            max-width: 800px;
        }
        
        .icon-menu-section {
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .icon-menu-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .icon-menu-header .current-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(6, 182, 212, 0.1);
            border-radius: 8px;
        }
        
        .icon-menu-header .current-icon svg {
            width: 20px;
            height: 20px;
            stroke: var(--icon-selected);
            stroke-width: 1.5px;
            fill: none;
        }
        
        .icon-menu-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: #E2E8F0;
            flex: 1;
        }
        
        .icon-options {
            display: flex;
            gap: 12px;
            padding: 16px;
            flex-wrap: wrap;
        }
        
        .icon-option {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.03);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .icon-option:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.1);
        }
        
        .icon-option.selected {
            background: rgba(6, 182, 212, 0.15);
            border-color: var(--icon-selected);
        }
        
        .icon-option svg {
            width: 28px;
            height: 28px;
            stroke: var(--icon-normal);
            stroke-width: 1.5px;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .icon-option.selected svg {
            stroke: var(--icon-selected);
        }
        
        .icon-option:hover svg {
            stroke: #FFFFFF;
        }
    </style>
</head>
<body>

    <!-- =============================================
         SIDEBAR COMPONENT v2.4
         ============================================= -->
    <aside class="sidebar" id="sidebar">
        
        <!-- 1. Database Connection Button -->
        <button class="icon-btn" id="btn-connection" data-mode="connection" data-tooltip="Database Connection (Ctrl+K)">
            <svg viewBox="0 0 24 24" id="icon-connection">
                <ellipse cx="7" cy="5" rx="5" ry="2"/>
                <path d="M2 5v4c0 1.1 2.24 2 5 2s5-.9 5-2V5"/>
                <path d="M2 9v4c0 1.1 2.24 2 5 2s5-.9 5-2V9"/>
                <ellipse cx="17" cy="11" rx="5" ry="2"/>
                <path d="M12 11v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/>
                <path d="M12 15v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/>
                <path d="M7 13v2" stroke-dasharray="2 2"/>
                <circle cx="12" cy="17" r="1.5" fill="currentColor" stroke="none"/>
            </svg>
        </button>

        <!-- 2. Monitoring Button with Submenu -->
        <div class="has-submenu disabled" id="btn-monitoring-wrapper">
            <button class="icon-btn disabled" id="btn-monitoring" data-mode="monitoring" data-tooltip="System Monitoring (M)">
                <svg viewBox="0 0 24 24" id="icon-monitoring">
                    <rect x="3" y="4" width="18" height="12" rx="2" />
                    <polyline points="6 10 9 10 11 7 13 13 15 10 18 10" />
                    <path d="M12 16v4" />
                    <path d="M8 20h8" />
                </svg>
            </button>
            
            <div class="submenu" id="monitoring-submenu">
                <div class="submenu-header">Monitoring Views</div>
                <button class="submenu-item active" data-submode="3d-view" onclick="setSubMode('monitoring', '3d-view')">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    3D View
                </button>
                <button class="submenu-item" data-submode="ranking-view" onclick="setSubMode('monitoring', 'ranking-view')">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 20V10"/>
                        <path d="M12 20V4"/>
                        <path d="M6 20v-6"/>
                    </svg>
                    Ranking View
                </button>
            </div>
        </div>

        <!-- 3. Analysis Button -->
        <button class="icon-btn disabled" id="btn-analysis" data-mode="analysis" data-tooltip="Data Analysis (A)">
            <svg viewBox="0 0 24 24" id="icon-analysis">
                <path d="M21 21H4.6c-.6 0-1.1-.5-1.1-1.1V3"/>
                <path d="M7 14l4-4 4 4 6-6"/>
                <circle cx="21" cy="8" r="2"/>
            </svg>
        </button>

        <!-- 4. Simulation Button -->
        <button class="icon-btn disabled" id="btn-simulation" data-mode="simulation" data-tooltip="Simulation (S)">
            <svg viewBox="0 0 24 24" id="icon-simulation">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 2v4"/>
                <path d="M12 18v4"/>
                <path d="M4.93 4.93l2.83 2.83"/>
                <path d="M16.24 16.24l2.83 2.83"/>
                <path d="M2 12h4"/>
                <path d="M18 12h4"/>
                <path d="M4.93 19.07l2.83-2.83"/>
                <path d="M16.24 7.76l2.83-2.83"/>
            </svg>
        </button>

        <div class="sidebar-divider"></div>

        <!-- Layout Button (Hidden by default) -->
        <button class="icon-btn disabled hidden" id="btn-layout" data-mode="layout" data-tooltip="Layout Editor">
            <svg viewBox="0 0 24 24" id="icon-layout">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
            </svg>
        </button>

        <!-- Debug Button -->
        <button class="icon-btn disabled" id="btn-debug" data-mode="debug" data-tooltip="Debug Panel (D)">
            <svg viewBox="0 0 24 24" id="icon-debug">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
        </button>

        <div class="sidebar-spacer"></div>
        
        <!-- Settings Button with Submenu -->
        <div class="has-submenu" id="btn-settings-wrapper">
            <button class="icon-btn" id="btn-settings" data-mode="settings" data-tooltip="Settings">
                <svg viewBox="0 0 24 24" id="icon-settings">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>
            
            <div class="submenu" id="settings-submenu">
                <div class="submenu-header">Settings</div>
                <button class="submenu-item" data-submode="general" onclick="setSubMode('settings', 'general')">
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 2v2"/>
                        <path d="M12 20v2"/>
                        <path d="M4.93 4.93l1.41 1.41"/>
                        <path d="M17.66 17.66l1.41 1.41"/>
                        <path d="M2 12h2"/>
                        <path d="M20 12h2"/>
                    </svg>
                    General
                </button>
                <button class="submenu-item" data-submode="icon" onclick="openIconModal()">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="M21 15l-5-5L5 21"/>
                    </svg>
                    Icon
                </button>
                <div class="submenu-divider"></div>
                <button class="submenu-item" id="dev-mode-toggle" data-submode="dev-mode" onclick="toggleDevMode()">
                    <svg viewBox="0 0 24 24">
                        <polyline points="16 18 22 12 16 6"/>
                        <polyline points="8 6 2 12 8 18"/>
                    </svg>
                    <span id="dev-mode-label">Dev Mode: OFF</span>
                </button>
            </div>
        </div>

        <div style="height: 50px;"></div>
    </aside>

    <!-- =============================================
         DATABASE CONNECTION MODAL
         ============================================= -->
    <div class="modal-overlay" id="connection-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">üîå Database Connection Manager</div>
                <button class="modal-close" onclick="closeConnectionModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <!-- API Status Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üì° API Status</h3>
                        <div class="panel-actions">
                            <button class="btn-icon" onclick="refreshAPIStatus()" title="Refresh">üîÑ</button>
                        </div>
                    </div>
                    <div class="api-status">
                        <div class="api-status-indicator healthy" id="api-indicator"></div>
                        <div class="api-status-info">
                            <div class="api-status-url" id="api-url">http://localhost:8000</div>
                            <div class="api-status-meta">
                                <span id="api-status-text">Healthy</span>
                                <span id="api-response-time">‚Ä¢ 45ms</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Site Selection Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üîç Site Connection</h3>
                        <div class="panel-actions">
                            <label class="auto-connect-label">
                                <input type="checkbox" id="auto-connect-checkbox">
                                <span>Auto Connect</span>
                            </label>
                        </div>
                    </div>
                    <div class="site-list" id="site-list"></div>
                    <div class="panel-footer">
                        <div class="selection-info">
                            <span id="selection-count">Selected: 0</span>
                        </div>
                        <button class="btn-connect" id="connect-btn" disabled onclick="connectToSelectedSite()">
                            üîå Connect
                        </button>
                    </div>
                </div>
                
                <!-- Database List Panel -->
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üìä Connected Databases</h3>
                        <div class="panel-actions">
                            <button class="btn-icon" onclick="refreshDatabaseInfo()" title="Refresh">üîÑ</button>
                        </div>
                    </div>
                    <div id="database-list">
                        <div class="no-connection">
                            <span class="no-connection-icon">üìÇ</span>
                            <p>No database connected</p>
                            <small>Connect to a site to view tables</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <span class="footer-hint">Ctrl+K to toggle | Escape to close</span>
                <button class="btn-secondary" onclick="closeConnectionModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- =============================================
         ICON CUSTOMIZATION MODAL
         ============================================= -->
    <div class="modal-overlay" id="icon-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">üé® Icon Customization</div>
                <button class="modal-close" onclick="closeIconModal()">‚úï</button>
            </div>
            
            <div class="modal-body" id="icon-modal-body">
                <!-- Icon sections will be generated here -->
            </div>
            
            <div class="modal-footer">
                <span class="footer-hint">Select icons for each menu</span>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-secondary" onclick="closeIconModal()">Cancel</button>
                    <button class="btn-primary" onclick="applyIconChanges()">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- =============================================
         MAIN CONTENT AREA
         ============================================= -->
    <main class="main-content">
        <h1>üß™ Sidebar Test v2.4</h1>
        <p>Connection ‚Üí Monitoring ‚Üí Analysis ‚Üí Simulation | Settings at bottom</p>
        
        <div class="current-mode">
            <div class="mode-label">Current Mode</div>
            <div class="mode-value" id="current-mode">‚Äî</div>
            <div class="submode-value" id="current-submode"></div>
        </div>
    </main>

    <!-- =============================================
         STATUS BAR
         ============================================= -->
    <footer class="status-bar">
        <div class="status-group">
            <div class="status-item" id="status-backend">
                <span class="status-dot disconnected" id="backend-dot"></span>
                <span class="status-label">Backend</span>
                <span class="status-value" id="backend-value">Disconnected</span>
            </div>
            <div class="status-item" id="status-db">
                <span class="status-dot disconnected" id="db-dot"></span>
                <span class="status-label">DB</span>
                <span class="status-value" id="db-value">None</span>
            </div>
        </div>

        <div class="status-group">
            <div class="status-item" id="status-render">
                <span class="status-label">FPS</span>
                <span class="status-value" id="fps-value">60</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="fps-bar" style="width: 100%;"></div>
                </div>
            </div>
            <div class="status-item" id="status-memory">
                <span class="status-label">MEM</span>
                <span class="status-value"><span id="memory-value">128</span>MB</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="memory-bar" style="width: 30%;"></div>
                </div>
            </div>
        </div>

        <div class="status-group">
            <div class="status-item">
                <span class="status-label">User</span>
                <span class="status-value">Admin</span>
            </div>
        </div>
    </footer>

    <script>
        // =============================================
        // Configuration
        // =============================================
        let currentMode = null;
        let currentSubMode = null;
        let isConnected = false;
        let devModeEnabled = false;
        let selectedSite = null;
        
        // Icon selections (stores selected icon index for each menu)
        let iconSelections = {
            connection: 0,
            monitoring: 0,
            analysis: 0,
            simulation: 0,
            layout: 0,
            debug: 0,
            settings: 0
        };
        
        // Pending icon selections (before apply)
        let pendingIconSelections = {};
        
        // Icon options for each menu
        const iconOptions = {
            connection: [
                // 0: Multi-site database (current)
                `<ellipse cx="7" cy="5" rx="5" ry="2"/><path d="M2 5v4c0 1.1 2.24 2 5 2s5-.9 5-2V5"/><path d="M2 9v4c0 1.1 2.24 2 5 2s5-.9 5-2V9"/><ellipse cx="17" cy="11" rx="5" ry="2"/><path d="M12 11v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/><path d="M12 15v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/><path d="M7 13v2" stroke-dasharray="2 2"/><circle cx="12" cy="17" r="1.5" fill="currentColor" stroke="none"/>`,
                // 1: Single database
                `<ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"/><path d="M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"/>`,
                // 2: Server
                `<rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/>`,
                // 3: Cloud database
                `<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/><line x1="12" y1="13" x2="12" y2="17"/><line x1="10" y1="15" x2="14" y2="15"/>`,
                // 4: Link
                `<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>`
            ],
            monitoring: [
                // 0: Monitor with heartbeat (current)
                `<rect x="3" y="4" width="18" height="12" rx="2"/><polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/><path d="M12 16v4"/><path d="M8 20h8"/>`,
                // 1: Activity
                `<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>`,
                // 2: Eye
                `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>`,
                // 3: Radio
                `<circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49"/><path d="M7.76 16.24a6 6 0 0 1 0-8.49"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M4.93 19.07a10 10 0 0 1 0-14.14"/>`,
                // 4: CPU
                `<rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/>`
            ],
            analysis: [
                // 0: Trend chart (current)
                `<path d="M21 21H4.6c-.6 0-1.1-.5-1.1-1.1V3"/><path d="M7 14l4-4 4 4 6-6"/><circle cx="21" cy="8" r="2"/>`,
                // 1: Bar chart
                `<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>`,
                // 2: Pie chart
                `<path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/>`,
                // 3: Statistics
                `<path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>`,
                // 4: Table
                `<rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/>`
            ],
            simulation: [
                // 0: Sun/Gear (current)
                `<circle cx="12" cy="12" r="3"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><path d="M2 12h4"/><path d="M18 12h4"/><path d="M4.93 19.07l2.83-2.83"/><path d="M16.24 7.76l2.83-2.83"/>`,
                // 1: Play circle
                `<circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/>`,
                // 2: Refresh
                `<polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>`,
                // 3: Zap
                `<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>`,
                // 4: Cog
                `<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>`
            ],
            layout: [
                // 0: Grid (current)
                `<rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>`,
                // 1: Layout
                `<rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/>`,
                // 2: Sidebar
                `<rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/>`,
                // 3: Columns
                `<path d="M12 3h7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-7"/><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7"/>`,
                // 4: Move
                `<polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 9 22 12 19 15"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/>`
            ],
            debug: [
                // 0: Wrench (current)
                `<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>`,
                // 1: Bug
                `<rect x="8" y="6" width="8" height="14" rx="4"/><path d="M8 6V4a4 4 0 0 1 8 0v2"/><line x1="12" y1="6" x2="12" y2="20"/><path d="M4 13h4"/><path d="M16 13h4"/><path d="M4 9h4"/><path d="M16 9h4"/><path d="M4 17h4"/><path d="M16 17h4"/>`,
                // 2: Terminal
                `<polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/>`,
                // 3: Code
                `<polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>`,
                // 4: Tool
                `<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>`
            ],
            settings: [
                // 0: Gear (current)
                `<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>`,
                // 1: Sliders
                `<line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/>`,
                // 2: Toggle
                `<rect x="1" y="5" width="22" height="14" rx="7"/><circle cx="8" cy="12" r="3"/>`,
                // 3: Settings 2
                `<circle cx="12" cy="12" r="3"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/>`,
                // 4: Menu
                `<line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>`
            ]
        };
        
        const menuLabels = {
            connection: 'Database Connection',
            monitoring: 'System Monitoring',
            analysis: 'Data Analysis',
            simulation: 'Simulation',
            layout: 'Layout Editor',
            debug: 'Debug Panel',
            settings: 'Settings'
        };
        
        const siteProfiles = [
            { id: 'kr_b_01', display_name: 'Korea Site B-01', region: 'Asia/Seoul', priority: 10 },
            { id: 'kr_b_02', display_name: 'Korea Site B-02', region: 'Asia/Seoul', priority: 8 },
            { id: 'vn_a_01', display_name: 'Vietnam Site A-01', region: 'Asia/Ho_Chi_Minh', priority: 5 },
            { id: 'us_w_01', display_name: 'USA West Site W-01', region: 'America/Los_Angeles', priority: 3 }
        ];
        
        let siteStatus = {};

        // =============================================
        // Initialize
        // =============================================
        function init() {
            siteProfiles.forEach(site => {
                siteStatus[site.id] = { status: 'disconnected' };
            });
            
            renderSiteList();
            setupSidebarEvents();
            startPerformanceSimulation();
            
            setTimeout(() => {
                openConnectionModal();
            }, 500);
        }

        // =============================================
        // Connection Modal Functions
        // =============================================
        function openConnectionModal() {
            document.getElementById('connection-modal').classList.add('active');
        }
        
        function closeConnectionModal() {
            document.getElementById('connection-modal').classList.remove('active');
        }
        
        function toggleConnectionModal() {
            const modal = document.getElementById('connection-modal');
            if (modal.classList.contains('active')) {
                closeConnectionModal();
            } else {
                openConnectionModal();
            }
        }
        
        function refreshAPIStatus() {
            const indicator = document.getElementById('api-indicator');
            const statusText = document.getElementById('api-status-text');
            
            indicator.className = 'api-status-indicator';
            statusText.textContent = 'Checking...';
            
            setTimeout(() => {
                indicator.className = 'api-status-indicator healthy';
                statusText.textContent = 'Healthy';
            }, 500);
        }
        
        function renderSiteList() {
            const siteList = document.getElementById('site-list');
            
            siteList.innerHTML = siteProfiles.map(profile => {
                const status = siteStatus[profile.id] || {};
                const isSelected = selectedSite === profile.id;
                const isConnectedSite = status.status === 'connected';
                
                let itemClasses = ['site-item'];
                if (isSelected) itemClasses.push('site-item--selected');
                if (isConnectedSite) itemClasses.push('site-item--connected');
                
                return `
                    <div class="${itemClasses.join(' ')}" onclick="toggleSiteSelection('${profile.id}')">
                        <div class="site-checkbox">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleSiteSelection('${profile.id}')">
                        </div>
                        <div class="site-info">
                            <div class="site-main">
                                <span class="site-name">${profile.display_name}</span>
                                <span class="site-region">${profile.region}</span>
                            </div>
                            <div class="site-meta">Priority: ${profile.priority}</div>
                        </div>
                        <div class="site-status">
                            ${isConnectedSite ? `
                                <span class="status-icon">‚úÖ</span>
                                <button class="btn-disconnect" onclick="event.stopPropagation(); disconnectFromSite('${profile.id}')">Disconnect</button>
                            ` : `<span class="status-icon">‚ö™</span>`}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateSelectionUI();
        }
        
        function toggleSiteSelection(siteId) {
            selectedSite = selectedSite === siteId ? null : siteId;
            renderSiteList();
        }
        
        function updateSelectionUI() {
            document.getElementById('selection-count').textContent = `Selected: ${selectedSite ? 1 : 0}`;
            document.getElementById('connect-btn').disabled = !selectedSite;
        }
        
        function connectToSelectedSite() {
            if (!selectedSite) return;
            
            const connectBtn = document.getElementById('connect-btn');
            connectBtn.disabled = true;
            connectBtn.textContent = '‚è≥ Connecting...';
            
            setTimeout(() => {
                siteStatus[selectedSite] = { status: 'connected' };
                isConnected = true;
                
                renderSiteList();
                renderDatabaseInfo(selectedSite);
                enableSidebarIcons();
                updateStatusBar(selectedSite);
                
                connectBtn.textContent = 'üîå Connect';
                connectBtn.disabled = true;
            }, 1500);
        }
        
        function disconnectFromSite(siteId) {
            siteStatus[siteId] = { status: 'disconnected' };
            isConnected = false;
            selectedSite = null;
            
            renderSiteList();
            clearDatabaseInfo();
            disableSidebarIcons();
            updateStatusBar(null);
            
            currentMode = null;
            document.getElementById('current-mode').textContent = '‚Äî';
            document.getElementById('current-submode').textContent = '';
        }
        
        function renderDatabaseInfo(siteId) {
            const site = siteProfiles.find(s => s.id === siteId);
            document.getElementById('database-list').innerHTML = `
                <div class="database-item">
                    <div class="database-header">
                        <h4>üóÑÔ∏è ${site.display_name} - EquipmentDB</h4>
                        <div class="database-stats">
                            <span class="stat-item"><span class="stat-label">Tables:</span><span class="stat-value">12</span></span>
                            <span class="stat-item"><span class="stat-label">Type:</span><span class="stat-value">MSSQL</span></span>
                        </div>
                    </div>
                    <div style="padding: 8px 0; font-size: 12px; color: #6B7280;">Site ID: ${siteId}</div>
                </div>
            `;
        }
        
        function clearDatabaseInfo() {
            document.getElementById('database-list').innerHTML = `
                <div class="no-connection">
                    <span class="no-connection-icon">üìÇ</span>
                    <p>No database connected</p>
                    <small>Connect to a site to view tables</small>
                </div>
            `;
        }
        
        function refreshDatabaseInfo() {
            if (isConnected && selectedSite) {
                renderDatabaseInfo(selectedSite);
            }
        }
        
        function enableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-debug'].forEach(id => {
                document.getElementById(id).classList.remove('disabled');
            });
            
            // Enable wrapper for submenu
            document.getElementById('btn-monitoring-wrapper').classList.remove('disabled');
            
            if (devModeEnabled) {
                document.getElementById('btn-layout').classList.remove('disabled');
            }
        }
        
        function disableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-debug', 'btn-layout'].forEach(id => {
                document.getElementById(id).classList.add('disabled');
            });
            
            // Disable wrapper for submenu
            document.getElementById('btn-monitoring-wrapper').classList.add('disabled');
            
            document.querySelectorAll('.icon-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }
        
        function updateStatusBar(siteId) {
            const backendDot = document.getElementById('backend-dot');
            const backendValue = document.getElementById('backend-value');
            const dbDot = document.getElementById('db-dot');
            const dbValue = document.getElementById('db-value');
            
            if (siteId) {
                backendDot.className = 'status-dot connected';
                backendValue.textContent = 'Connected';
                dbDot.className = 'status-dot connected';
                dbValue.textContent = siteId.replace(/_/g, '-');
            } else {
                backendDot.className = 'status-dot disconnected';
                backendValue.textContent = 'Disconnected';
                dbDot.className = 'status-dot disconnected';
                dbValue.textContent = 'None';
            }
        }

        // =============================================
        // Icon Modal Functions
        // =============================================
        function openIconModal() {
            // Copy current selections to pending
            pendingIconSelections = { ...iconSelections };
            
            // Render icon options
            const body = document.getElementById('icon-modal-body');
            body.innerHTML = Object.keys(iconOptions).map(menuKey => {
                const icons = iconOptions[menuKey];
                const currentIdx = iconSelections[menuKey];
                
                return `
                    <div class="icon-menu-section">
                        <div class="icon-menu-header">
                            <div class="current-icon">
                                <svg viewBox="0 0 24 24">${icons[currentIdx]}</svg>
                            </div>
                            <h4>${menuLabels[menuKey]}</h4>
                        </div>
                        <div class="icon-options">
                            ${icons.map((icon, idx) => `
                                <div class="icon-option ${idx === currentIdx ? 'selected' : ''}" 
                                     data-menu="${menuKey}" data-index="${idx}"
                                     onclick="selectIcon('${menuKey}', ${idx})">
                                    <svg viewBox="0 0 24 24">${icon}</svg>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('icon-modal').classList.add('active');
        }
        
        function closeIconModal() {
            document.getElementById('icon-modal').classList.remove('active');
        }
        
        function selectIcon(menuKey, idx) {
            pendingIconSelections[menuKey] = idx;
            
            // Update UI
            const section = document.querySelector(`.icon-menu-section .icon-menu-header h4`);
            document.querySelectorAll(`.icon-option[data-menu="${menuKey}"]`).forEach((opt, i) => {
                opt.classList.toggle('selected', i === idx);
            });
            
            // Update current icon preview
            const icons = iconOptions[menuKey];
            const sections = document.querySelectorAll('.icon-menu-section');
            const menuIndex = Object.keys(iconOptions).indexOf(menuKey);
            if (sections[menuIndex]) {
                sections[menuIndex].querySelector('.current-icon svg').innerHTML = icons[idx];
            }
        }
        
        function applyIconChanges() {
            // Apply pending selections
            iconSelections = { ...pendingIconSelections };
            
            // Update sidebar icons
            Object.keys(iconSelections).forEach(menuKey => {
                const idx = iconSelections[menuKey];
                const iconEl = document.getElementById(`icon-${menuKey}`);
                if (iconEl) {
                    iconEl.innerHTML = iconOptions[menuKey][idx];
                }
            });
            
            closeIconModal();
        }

        // =============================================
        // Dev Mode Toggle
        // =============================================
        function toggleDevMode() {
            devModeEnabled = !devModeEnabled;
            
            const layoutBtn = document.getElementById('btn-layout');
            const devModeLabel = document.getElementById('dev-mode-label');
            
            if (devModeEnabled) {
                layoutBtn.classList.remove('hidden');
                if (isConnected) {
                    layoutBtn.classList.remove('disabled');
                }
                devModeLabel.textContent = 'Dev Mode: ON';
            } else {
                layoutBtn.classList.add('hidden');
                devModeLabel.textContent = 'Dev Mode: OFF';
            }
        }

        // =============================================
        // Sidebar Events
        // =============================================
        function setupSidebarEvents() {
            const buttons = document.querySelectorAll('.icon-btn');
            
            buttons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (this.classList.contains('disabled')) return;
                    if (this.closest('.has-submenu') && this.id !== 'btn-connection') return;
                    
                    if (this.id === 'btn-connection') {
                        openConnectionModal();
                        return;
                    }
                    
                    if (this.id === 'btn-connection' || this.id === 'btn-settings') return;
                    
                    buttons.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    setMode(this.dataset.mode);
                });
            });
            
            const monitoringBtn = document.getElementById('btn-monitoring');
            monitoringBtn.addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;
                document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                setMode('monitoring');
            });
        }

        function setMode(mode) {
            currentMode = mode;
            currentSubMode = null;
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('current-submode').textContent = '';
            
            const debugBtn = document.getElementById('btn-debug');
            if (mode === 'monitoring') {
                debugBtn.classList.add('disabled');
            } else if (isConnected) {
                debugBtn.classList.remove('disabled');
            }
        }

        function setSubMode(mode, submode) {
            currentMode = mode;
            currentSubMode = submode;
            
            document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
            
            if (mode === 'monitoring') {
                document.getElementById('btn-monitoring').classList.add('selected');
            }
            
            document.querySelectorAll('.submenu-item').forEach(item => {
                item.classList.toggle('active', item.dataset.submode === submode);
            });
            
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            const submodeLabels = {
                '3d-view': '3D View',
                'ranking-view': 'Ranking View',
                'general': 'General Settings',
                'icon': 'Icon Customization',
                'dev-mode': 'Developer Mode'
            };
            document.getElementById('current-submode').textContent = `‚Üí ${submodeLabels[submode] || submode}`;
        }

        // =============================================
        // Performance Simulation
        // =============================================
        function startPerformanceSimulation() {
            setInterval(() => {
                const fps = 58 + Math.floor(Math.random() * 5);
                document.getElementById('fps-value').textContent = fps;
                
                const bar = document.getElementById('fps-bar');
                bar.style.width = `${Math.min(100, (fps / 60) * 100)}%`;
                bar.className = 'perf-bar-fill ' + (fps >= 50 ? 'good' : fps >= 30 ? 'medium' : 'bad');
                
                const mem = 128 + Math.floor((Math.random() - 0.5) * 20);
                document.getElementById('memory-value').textContent = mem;
                document.getElementById('memory-bar').style.width = `${Math.min(100, (mem / 500) * 100)}%`;
            }, 2000);
        }

        // =============================================
        // Keyboard Shortcuts
        // =============================================
        document.addEventListener('keydown', (e) => {
            if (e.target.matches('input, textarea')) return;
            
            const key = e.key.toLowerCase();
            
            if ((e.ctrlKey || e.metaKey) && key === 'k') {
                e.preventDefault();
                toggleConnectionModal();
                return;
            }
            
            if (key === 'escape') {
                if (document.getElementById('icon-modal').classList.contains('active')) {
                    closeIconModal();
                } else if (document.getElementById('connection-modal').classList.contains('active')) {
                    closeConnectionModal();
                }
                return;
            }
            
            if (!isConnected) return;
            
            switch(key) {
                case 'm':
                    if (!document.getElementById('btn-monitoring').classList.contains('disabled')) {
                        document.getElementById('btn-monitoring').click();
                    }
                    break;
                case 'a':
                    if (!document.getElementById('btn-analysis').classList.contains('disabled')) {
                        document.getElementById('btn-analysis').click();
                    }
                    break;
                case 's':
                    if (!e.ctrlKey && !document.getElementById('btn-simulation').classList.contains('disabled')) {
                        document.getElementById('btn-simulation').click();
                    }
                    break;
                case 'd':
                    const debugBtn = document.getElementById('btn-debug');
                    if (!debugBtn.classList.contains('disabled')) {
                        debugBtn.click();
                    }
                    break;
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', init);
        
        console.log('üß™ Sidebar Test v2.4 Loaded');
        console.log('Changes: Disabled submenu fix, Icon customization modal');
    </script>

</body>
</html>
