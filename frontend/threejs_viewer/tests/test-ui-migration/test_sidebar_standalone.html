<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test: Cleanroom Sidebar (Standalone) v2.8</title>
    
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        /* =============================================
           MIGRATION GUIDE - CSS Variables
           ===========================================
           [MIGRATE TO] src/styles/variables.css
           ============================================= */
        
        /* Dark Theme (Default) */
        :root, [data-theme="dark"] {
            --bg-sidebar: #0F172A;
            --bg-main: #1e293b;
            --bg-main-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --bg-panel: #1E293B;
            --bg-panel-header: rgba(0,0,0,0.2);
            --bg-input: rgba(255,255,255,0.05);
            --bg-hover: rgba(255,255,255,0.05);
            --bg-selected: rgba(6, 182, 212, 0.1);
            
            --border-color: rgba(255,255,255,0.1);
            --border-subtle: rgba(255,255,255,0.05);
            
            --icon-normal: #E2E8F0;
            --icon-selected: #06B6D4;
            --icon-disabled: #334155;
            --icon-hover: #FFFFFF;
            
            --text-primary: #E2E8F0;
            --text-secondary: #9CA3AF;
            --text-muted: #6B7280;
            --text-normal: #CBD5E1;
            --text-warning: #FBBF24;
            --text-alarm: #F87171;
            --text-success: #4ADE80;
            
            --shadow-color: rgba(0,0,0,0.5);
            --glow-color: rgba(6, 182, 212, 0.4);
            
            --icon-size: 36px;
            --icon-stroke-normal: 1px;
            --icon-stroke-hover: 1.5px;
            --icon-stroke-selected: 1.5px;
            --transition-speed: 0.25s;
            --status-bar-height: 36px;
        }
        
        /* Light Theme */
        [data-theme="light"] {
            --bg-sidebar: #F8FAFC;
            --bg-main: #FFFFFF;
            --bg-main-gradient: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%);
            --bg-panel: #FFFFFF;
            --bg-panel-header: rgba(0,0,0,0.02);
            --bg-input: rgba(0,0,0,0.03);
            --bg-hover: rgba(0,0,0,0.05);
            --bg-selected: rgba(6, 182, 212, 0.1);
            
            --border-color: rgba(0,0,0,0.1);
            --border-subtle: rgba(0,0,0,0.05);
            
            --icon-normal: #475569;
            --icon-selected: #0891B2;
            --icon-disabled: #CBD5E1;
            --icon-hover: #0F172A;
            
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-muted: #94A3B8;
            --text-normal: #334155;
            --text-warning: #D97706;
            --text-alarm: #DC2626;
            --text-success: #16A34A;
            
            --shadow-color: rgba(0,0,0,0.15);
            --glow-color: rgba(6, 182, 212, 0.3);
        }

        /* Reset & Layout */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-main);
            transition: background 0.3s ease;
        }
        
        /* =============================================
           MIGRATION GUIDE - Sidebar Component
           [MIGRATE TO] src/ui/sidebar/Sidebar.js
           ============================================= */
        .sidebar {
            width: 80px;
            background-color: var(--bg-sidebar);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 24px;
            z-index: 10;
            box-shadow: 4px 0 15px var(--shadow-color);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .icon-btn {
            width: 54px;
            height: 54px;
            margin-bottom: 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: transform var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .icon-btn svg {
            width: var(--icon-size);
            height: var(--icon-size);
            fill: none;
            stroke: var(--icon-normal);
            stroke-width: var(--icon-stroke-normal);
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: all var(--transition-speed);
        }

        /* Icon Interaction States */
        .icon-btn:not(.selected):not(.disabled):hover {
            transform: scale(1.1) translateY(-3px);
        }
        .icon-btn:not(.selected):not(.disabled):hover svg {
            stroke: var(--icon-hover);
            stroke-width: var(--icon-stroke-hover);
            filter: drop-shadow(0 0 3px var(--glow-color));
        }

        .icon-btn.selected {
            transform: scale(1.08) translateY(-2px);
        }
        .icon-btn.selected svg {
            stroke: var(--icon-selected);
            stroke-width: var(--icon-stroke-selected);
            filter: drop-shadow(0 0 6px var(--icon-selected));
        }

        @keyframes float {
            0%, 100% { transform: scale(1.12) translateY(-4px); }
            50% { transform: scale(1.12) translateY(-8px); }
        }
        
        .icon-btn.selected:hover {
            animation: float 2s ease-in-out infinite;
        }
        .icon-btn.selected:hover svg {
            filter: drop-shadow(0 0 12px var(--icon-selected));
        }

        .icon-btn.selected::before {
            content: '';
            position: absolute;
            left: -13px;
            width: 3px;
            height: 28px;
            background-color: var(--icon-selected);
            border-radius: 0 3px 3px 0;
            box-shadow: 0 0 6px var(--icon-selected);
        }

        .icon-btn.disabled {
            cursor: not-allowed;
            opacity: 0.4;
            pointer-events: none;
        }
        .icon-btn.disabled svg {
            stroke: var(--icon-disabled);
        }

        .icon-btn.hidden { display: none !important; }

        /* =============================================
           MIGRATION GUIDE - Submenu System
           [MIGRATE TO] src/ui/sidebar/Submenu.js
           
           [v2.8 FIX] Submenu items: Normal by default, 
           Active color only when .active class is present
           ============================================= */
        .has-submenu { position: relative; }
        
        .submenu {
            position: absolute;
            left: 70px;
            top: 0;
            background: var(--bg-sidebar);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 180px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-10px);
            transition: all 0.2s ease;
            box-shadow: 4px 4px 20px var(--shadow-color);
            z-index: 100;
        }
        
        #btn-settings-wrapper .submenu { top: auto; bottom: 0; }
        
        .has-submenu:not(.disabled):hover .submenu,
        .has-submenu:not(.disabled).submenu-open .submenu {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }
        
        .has-submenu.disabled .submenu {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }
        
        /* [v2.8] Submenu item - NORMAL state by default */
        .submenu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            color: var(--text-secondary);  /* Normal: secondary color */
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        
        .submenu-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        /* [v2.8] Submenu item - ACTIVE state only with .active class */
        .submenu-item.active {
            background: var(--bg-selected);
            color: var(--icon-selected);
        }
        
        .submenu-item svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 1.5px;
            fill: none;
        }
        
        /* [v2.8] Disabled submenu item */
        .submenu-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .submenu-divider { height: 1px; background: var(--border-color); margin: 6px 12px; }
        .submenu-header { padding: 6px 16px; font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        
        .has-submenu::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            border: 4px solid transparent;
            border-left-color: var(--icon-normal);
            opacity: 0.5;
        }
        
        .has-submenu:not(.disabled):hover::after { border-left-color: var(--icon-selected); opacity: 1; }
        .has-submenu.disabled::after { border-left-color: var(--icon-disabled); opacity: 0.3; }
        
        /* Always Normal State Icons */
        #btn-connection, #btn-settings-wrapper .icon-btn { transform: none !important; }
        #btn-connection::before, #btn-settings-wrapper .icon-btn::before { display: none !important; }
        #btn-connection svg, #btn-settings-wrapper .icon-btn svg { stroke: var(--icon-normal) !important; filter: none !important; }
        #btn-connection:hover svg, #btn-settings-wrapper .icon-btn:hover svg { stroke: var(--icon-hover) !important; filter: drop-shadow(0 0 3px var(--glow-color)) !important; }
        #btn-connection:hover, #btn-settings-wrapper:hover .icon-btn { transform: scale(1.1) translateY(-3px) !important; }

        /* Theme Toggle */
        .theme-toggle-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; color: var(--text-secondary); font-size: 13px; }
        .theme-toggle-label { display: flex; align-items: center; gap: 10px; }
        .theme-toggle-label svg { width: 18px; height: 18px; stroke: currentColor; stroke-width: 1.5px; fill: none; }
        .theme-switch { position: relative; width: 44px; height: 24px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; }
        .theme-switch::before { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: var(--icon-normal); border-radius: 50%; transition: all 0.3s ease; }
        .theme-switch.active { background: var(--icon-selected); border-color: var(--icon-selected); }
        .theme-switch.active::before { left: 22px; background: white; }
        .theme-icons { display: flex; align-items: center; gap: 6px; margin-left: 8px; }
        .theme-icons svg { width: 14px; height: 14px; stroke: var(--text-muted); transition: all 0.3s ease; }
        .theme-icons .icon-sun { stroke: var(--text-warning); opacity: 0.5; }
        .theme-icons .icon-moon { stroke: var(--icon-selected); }
        [data-theme="light"] .theme-icons .icon-sun { opacity: 1; }
        [data-theme="light"] .theme-icons .icon-moon { opacity: 0.5; }

        /* =============================================
           MIGRATION GUIDE - Main Content Area
           [MIGRATE TO] src/styles/layout.css
           
           [v2.8] Three.js canvas container for 3D View
           ============================================= */
        .main-content {
            flex-grow: 1;
            background: var(--bg-main-gradient);
            display: flex;
            flex-direction: column;
            color: var(--text-primary);
            margin-bottom: var(--status-bar-height);
            transition: background 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        /* [v2.8] Three.js Canvas Container */
        #threejs-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* [v2.8] Overlay UI on top of Three.js */
        .overlay-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mode-indicator {
            padding: 12px 20px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 10px;
        }

        .mode-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .mode-value { font-size: 18px; font-weight: bold; color: var(--icon-selected); }
        .submode-value { font-size: 12px; color: var(--text-secondary); }

        /* [v2.8] Test Controls Panel */
        .test-controls {
            padding: 16px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            max-width: 280px;
        }

        .test-controls h4 {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .test-btn {
            display: block;
            width: 100%;
            padding: 10px 14px;
            margin-bottom: 8px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }

        .test-btn:hover {
            background: var(--bg-selected);
            border-color: var(--icon-selected);
        }

        .test-btn-icon { margin-right: 8px; }

        /* =============================================
           MIGRATION GUIDE - Equipment Info Panel
           [MIGRATE TO] src/ui/EquipmentInfoPanel.js
           [MIGRATE TO] src/styles/components/equipment-info.css
           
           [v2.8] Full implementation based on main branch
           ============================================= */
        #equipmentInfo {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 320px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 10px 40px var(--shadow-color);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateX(20px);
            transition: all 0.3s ease;
        }

        #equipmentInfo.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        .equipment-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border-subtle);
            background: var(--bg-panel-header);
            border-radius: 12px 12px 0 0;
        }

        .equipment-panel-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .equipment-panel-title.multi-select {
            color: var(--icon-selected);
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--bg-input);
            border-radius: 12px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.run { background: var(--text-success); box-shadow: 0 0 8px var(--text-success); }
        .status-indicator.idle { background: var(--text-warning); box-shadow: 0 0 8px var(--text-warning); }
        .status-indicator.stop { background: var(--text-alarm); box-shadow: 0 0 8px var(--text-alarm); }
        .status-indicator.disconnected { background: var(--text-muted); }

        .status-text {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-text.run { color: var(--text-success); }
        .status-text.idle { color: var(--text-warning); }
        .status-text.stop { color: var(--text-alarm); }
        .status-text.disconnected { color: var(--text-muted); }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: var(--bg-input);
            border: none;
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(248, 113, 113, 0.2);
            color: var(--text-alarm);
        }

        /* Equipment Panel Tabs */
        .equipment-panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-subtle);
            padding: 0 16px;
        }

        .equipment-tab {
            padding: 10px 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
        }

        .equipment-tab:hover { color: var(--text-primary); }

        .equipment-tab.active {
            color: var(--icon-selected);
        }

        .equipment-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--icon-selected);
        }

        /* Equipment Panel Content */
        .equipment-panel-content {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .equipment-tab-content {
            display: none;
        }

        .equipment-tab-content.active {
            display: block;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .info-value {
            font-size: 12px;
            color: var(--text-primary);
            font-family: 'Consolas', monospace;
        }

        .info-row-divider {
            height: 1px;
            background: var(--border-subtle);
            margin: 8px 0;
        }

        .info-row-meta { opacity: 0.7; }
        .info-value-meta { font-size: 10px; }

        .info-row.unmapped-notice,
        .info-row.error-notice {
            background: rgba(248, 113, 113, 0.1);
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .info-icon { margin-right: 8px; }
        .info-text { font-size: 12px; color: var(--text-secondary); }

        .multi-select-header {
            background: var(--bg-selected);
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .info-badge {
            font-size: 10px;
            padding: 2px 8px;
            background: var(--icon-selected);
            color: white;
            border-radius: 10px;
            margin-left: 8px;
        }

        .status-counts {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .status-count-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: var(--bg-input);
            border-radius: 4px;
            font-size: 11px;
        }

        .status-count-item.run { color: var(--text-success); }
        .status-count-item.idle { color: var(--text-warning); }
        .status-count-item.stop { color: var(--text-alarm); }

        .loading-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 40px;
        }

        .loading-spinner-small {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--icon-selected);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading-text {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* =============================================
           MIGRATION GUIDE - Status Bar
           [MIGRATE TO] src/ui/StatusBar.js
           ============================================= */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--status-bar-height);
            background-color: var(--bg-sidebar);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            font-family: 'Consolas', monospace;
            font-size: 11px;
            z-index: 20;
            transition: background-color 0.3s ease;
        }

        .status-group { display: flex; gap: 16px; align-items: center; }
        .status-item { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: var(--bg-input); border-radius: 4px; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
        .status-dot.connected { background-color: var(--text-success); box-shadow: 0 0 4px var(--text-success); }
        .status-dot.disconnected { background-color: var(--text-alarm); box-shadow: 0 0 4px var(--text-alarm); }
        .status-label { color: var(--text-muted); font-size: 9px; text-transform: uppercase; }
        .status-value { color: var(--text-normal); font-weight: 500; font-size: 11px; }
        .perf-bar { width: 35px; height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden; }
        .perf-bar-fill { height: 100%; border-radius: 2px; transition: width 0.3s, background 0.3s; }
        .perf-bar-fill.good { background: var(--text-success); }
        .perf-bar-fill.medium { background: var(--text-warning); }
        .perf-bar-fill.bad { background: var(--text-alarm); }
        .country-code { font-weight: 700; font-size: 12px; color: var(--icon-selected); letter-spacing: 1px; }

        /* Tooltip */
        .icon-btn[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 70px;
            background: var(--bg-panel);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            transform: translateX(-10px);
            z-index: 50;
            border: 1px solid var(--border-color);
        }

        .icon-btn:not(.has-submenu):hover[data-tooltip]::after { opacity: 1; transform: translateX(0); }

        .sidebar-divider { width: 40px; height: 1px; background: var(--border-color); margin: 8px 0; }
        .sidebar-spacer { flex-grow: 1; }
        
        /* =============================================
           MIGRATION GUIDE - Toast Notification
           [MIGRATE TO] src/ui/common/Toast.js
           ============================================= */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-shadow: 0 8px 24px var(--shadow-color);
            min-width: 300px;
            max-width: 450px;
            animation: slideIn 0.3s ease;
        }
        
        .toast.hiding { animation: slideOut 0.3s ease forwards; }
        
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        
        .toast-icon { font-size: 20px; flex-shrink: 0; }
        .toast-content { flex: 1; }
        .toast-title { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
        .toast-message { font-size: 12px; color: var(--text-secondary); }
        .toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; font-size: 16px; transition: color 0.2s; }
        .toast-close:hover { color: var(--text-primary); }
        
        .toast.success { border-left: 4px solid var(--text-success); }
        .toast.error { border-left: 4px solid var(--text-alarm); }
        .toast.warning { border-left: 4px solid var(--text-warning); }
        .toast.info { border-left: 4px solid var(--icon-selected); }

        /* Modal Styles - Compact version */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-container {
            background: var(--bg-panel); border: 1px solid var(--border-color);
            border-radius: 16px; width: 90%; max-width: 700px; max-height: 85vh;
            overflow: hidden; box-shadow: 0 25px 50px var(--shadow-color);
            transform: scale(0.9) translateY(20px); transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-container { transform: scale(1) translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--border-color); background: var(--bg-panel-header); }
        .modal-title { font-size: 18px; font-weight: 600; color: var(--text-primary); }
        .modal-close { width: 32px; height: 32px; border: none; background: var(--bg-input); border-radius: 8px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .modal-close:hover { background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        .modal-body { padding: 24px; overflow-y: auto; max-height: calc(85vh - 140px); }
        .modal-footer { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-top: 1px solid var(--border-color); background: var(--bg-panel-header); }
        .footer-hint { font-size: 11px; color: var(--text-muted); }
        .btn-secondary { padding: 10px 20px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); cursor: pointer; }
        .btn-secondary:hover { background: var(--bg-hover); }

        /* Connection Panel Styles - Compact */
        .connection-panel { background: var(--bg-panel-header); border: 1px solid var(--border-subtle); border-radius: 12px; margin-bottom: 16px; overflow: hidden; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; background: var(--bg-panel-header); border-bottom: 1px solid var(--border-subtle); }
        .panel-header h3 { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .panel-actions { display: flex; gap: 8px; align-items: center; }
        .internet-status { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: var(--bg-input); border-radius: 8px; margin-bottom: 16px; }
        .internet-status .status-dot { width: 10px; height: 10px; }
        .internet-status-text { font-size: 13px; color: var(--text-primary); }
        .internet-status-detail { font-size: 11px; color: var(--text-muted); margin-left: auto; }
        .api-status-content { padding: 16px; }
        .status-indicator-box { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding: 12px; background: var(--bg-input); border-radius: 8px; }
        .status-indicator-box .status-dot { width: 12px; height: 12px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-dot--connected { background: var(--text-success); box-shadow: 0 0 10px var(--text-success); }
        .status-dot--disconnected { background: var(--text-alarm); box-shadow: 0 0 10px var(--text-alarm); }
        .status-dot--checking { background: var(--text-muted); }
        .status-details { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .status-detail { display: flex; flex-direction: column; gap: 4px; }
        .detail-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }
        .detail-value { font-size: 13px; color: var(--text-primary); font-family: 'Consolas', monospace; }
        .site-list { display: flex; flex-direction: column; gap: 8px; padding: 16px; }
        .site-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .site-item:hover { background: var(--bg-hover); border-color: var(--border-color); }
        .site-item.site-item--selected { background: var(--bg-selected); border-color: var(--icon-selected); }
        .site-item.site-item--connected { background: rgba(74, 222, 128, 0.1); border-color: var(--text-success); }
        .site-checkbox input { width: 16px; height: 16px; accent-color: var(--icon-selected); }
        .site-info { flex: 1; }
        .site-main { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .site-name { font-size: 14px; font-weight: 500; color: var(--text-primary); }
        .site-region { font-size: 11px; padding: 2px 8px; background: var(--bg-hover); border-radius: 4px; color: var(--text-secondary); }
        .site-meta { font-size: 11px; color: var(--text-muted); margin-top: 4px; display: flex; gap: 12px; }
        .site-status { display: flex; align-items: center; gap: 8px; }
        .btn-disconnect, .btn-retry { padding: 4px 10px; font-size: 11px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-disconnect { background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        .btn-retry { background: rgba(251, 191, 36, 0.2); color: var(--text-warning); }
        .panel-footer { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle); background: var(--bg-panel-header); }
        .selection-info { font-size: 12px; color: var(--text-secondary); }
        .btn-connect, .btn-refresh-styled { padding: 10px 20px; background: linear-gradient(135deg, #06B6D4, #0891B2); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; font-size: 13px; }
        .btn-connect:hover:not(:disabled), .btn-refresh-styled:hover:not(:disabled) { box-shadow: 0 0 20px var(--glow-color); }
        .btn-connect:disabled, .btn-refresh-styled:disabled { opacity: 0.5; cursor: not-allowed; }
        .auto-connect-label { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-secondary); cursor: pointer; }
        .auto-connect-label input { accent-color: var(--icon-selected); }
        .btn-icon { background: none; border: none; cursor: pointer; font-size: 14px; padding: 4px 8px; opacity: 0.7; border-radius: 4px; }
        .btn-icon:hover { opacity: 1; background: var(--bg-hover); }
        .database-item { padding: 16px; }
        .database-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .database-header h4 { font-size: 14px; color: var(--text-primary); }
        .database-stats { display: flex; gap: 16px; }
        .stat-item { display: flex; gap: 4px; font-size: 12px; }
        .stat-label { color: var(--text-muted); }
        .stat-value { color: var(--icon-selected); font-weight: 600; }
        .no-connection { text-align: center; padding: 32px; color: var(--text-muted); }
        .no-connection-icon { font-size: 32px; display: block; margin-bottom: 8px; }
    </style>
</head>
<body>

    <div class="toast-container" id="toast-container"></div>

    <!-- =============================================
         SIDEBAR v2.8
         [v2.8] Ranking View is disabled
         ============================================= -->
    <aside class="sidebar" id="sidebar">
        <button class="icon-btn" id="btn-connection" data-mode="connection" data-tooltip="Database Connection (Ctrl+K)">
            <svg viewBox="0 0 24 24" id="icon-connection">
                <ellipse cx="7" cy="5" rx="5" ry="2"/><path d="M2 5v4c0 1.1 2.24 2 5 2s5-.9 5-2V5"/><path d="M2 9v4c0 1.1 2.24 2 5 2s5-.9 5-2V9"/><ellipse cx="17" cy="11" rx="5" ry="2"/><path d="M12 11v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/><path d="M12 15v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/>
            </svg>
        </button>

        <!-- [v2.8] Monitoring with submenu - 3D View active only when clicked -->
        <div class="has-submenu disabled" id="btn-monitoring-wrapper">
            <button class="icon-btn disabled" id="btn-monitoring" data-mode="monitoring" data-tooltip="System Monitoring (M)">
                <svg viewBox="0 0 24 24" id="icon-monitoring">
                    <rect x="3" y="4" width="18" height="12" rx="2"/><polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/><path d="M12 16v4"/><path d="M8 20h8"/>
                </svg>
            </button>
            <div class="submenu" id="monitoring-submenu">
                <div class="submenu-header">Monitoring Views</div>
                <!-- [v2.8] NO .active class by default - only added when clicked -->
                <button class="submenu-item" id="submenu-3d-view" data-submode="3d-view" onclick="setSubMode('monitoring', '3d-view')">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                    3D View
                </button>
                <!-- [v2.8] Ranking View is DISABLED -->
                <button class="submenu-item disabled" data-submode="ranking-view">
                    <svg viewBox="0 0 24 24"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
                    Ranking View (Coming Soon)
                </button>
            </div>
        </div>

        <button class="icon-btn disabled" id="btn-analysis" data-mode="analysis" data-tooltip="Data Analysis (A)">
            <svg viewBox="0 0 24 24" id="icon-analysis">
                <path d="M21 21H4.6c-.6 0-1.1-.5-1.1-1.1V3"/><path d="M7 14l4-4 4 4 6-6"/><circle cx="21" cy="8" r="2"/>
            </svg>
        </button>

        <button class="icon-btn disabled" id="btn-simulation" data-mode="simulation" data-tooltip="Simulation (S)">
            <svg viewBox="0 0 24 24" id="icon-simulation">
                <circle cx="12" cy="12" r="3"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><path d="M2 12h4"/><path d="M18 12h4"/>
            </svg>
        </button>

        <div class="sidebar-divider"></div>

        <button class="icon-btn disabled hidden" id="btn-layout" data-mode="layout" data-tooltip="Layout Editor">
            <svg viewBox="0 0 24 24" id="icon-layout">
                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
            </svg>
        </button>

        <div class="sidebar-spacer"></div>
        
        <button class="icon-btn disabled" id="btn-debug" data-mode="debug" data-tooltip="Debug Panel (D)">
            <svg viewBox="0 0 24 24" id="icon-debug">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
        </button>
        
        <div class="has-submenu" id="btn-settings-wrapper">
            <button class="icon-btn" id="btn-settings" data-mode="settings" data-tooltip="Settings">
                <svg viewBox="0 0 24 24" id="icon-settings">
                    <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>
            <div class="submenu" id="settings-submenu">
                <div class="submenu-header">Settings</div>
                <div class="theme-toggle-item">
                    <div class="theme-toggle-label">
                        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/></svg>
                        <span>Theme</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div class="theme-switch" id="theme-switch" onclick="toggleTheme()"></div>
                        <div class="theme-icons">
                            <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/></svg>
                            <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                        </div>
                    </div>
                </div>
                <div class="submenu-divider"></div>
                <button class="submenu-item" id="dev-mode-toggle" onclick="toggleDevMode()">
                    <svg viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                    <span id="dev-mode-label">Dev Mode: OFF</span>
                </button>
            </div>
        </div>
        <div style="height: 50px;"></div>
    </aside>

    <!-- CONNECTION MODAL (Compact) -->
    <div class="modal-overlay" id="connection-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">üîå Database Connection Manager</div>
                <button class="modal-close" onclick="closeConnectionModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="internet-status" id="internet-status">
                    <span class="status-dot connected" id="internet-dot"></span>
                    <span class="internet-status-text" id="internet-text">Internet Connected</span>
                    <span class="internet-status-detail" id="internet-detail">Ping: 24ms</span>
                </div>
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üîå Backend API Status</h3>
                        <button class="btn-refresh-styled" onclick="refreshAPIStatus()">üîÑ Check</button>
                    </div>
                    <div class="api-status-content">
                        <div class="status-indicator-box">
                            <span class="status-dot status-dot--checking" id="api-status-dot"></span>
                            <span class="status-text" id="api-status-text">Checking...</span>
                        </div>
                        <div class="status-details">
                            <div class="status-detail"><span class="detail-label">API URL</span><span class="detail-value">http://localhost:8000</span></div>
                            <div class="status-detail"><span class="detail-label">Response</span><span class="detail-value" id="response-time">-</span></div>
                        </div>
                    </div>
                </div>
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üîç Site Connection</h3>
                        <div class="panel-actions">
                            <label class="auto-connect-label"><input type="checkbox"><span>Auto</span></label>
                            <button class="btn-icon" onclick="selectAllSites()">‚òëÔ∏è</button>
                            <button class="btn-icon" onclick="deselectAllSites()">‚òê</button>
                        </div>
                    </div>
                    <div class="site-list" id="site-list"></div>
                    <div class="panel-footer">
                        <span id="selection-count">Selected: 0</span>
                        <button class="btn-connect" id="connect-btn" disabled onclick="connectToSelectedSite()">üîå Connect</button>
                    </div>
                </div>
                <div class="connection-panel">
                    <div class="panel-header">
                        <h3>üìä Connected Databases</h3>
                        <button class="btn-refresh-styled" onclick="refreshDatabaseInfo()">üîÑ Refresh</button>
                    </div>
                    <div id="database-list">
                        <div class="no-connection"><span class="no-connection-icon">üìÇ</span><p>No database connected</p></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span class="footer-hint">Ctrl+K to toggle | Escape to close</span>
                <button class="btn-secondary" onclick="closeConnectionModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- =============================================
         MAIN CONTENT with Three.js
         [v2.8] 3D View implementation
         ============================================= -->
    <main class="main-content" id="main-content">
        <!-- Three.js Canvas Container -->
        <div id="threejs-container"></div>
        
        <!-- Overlay UI -->
        <div class="overlay-ui" id="overlay-ui">
            <div class="mode-indicator">
                <div class="mode-label">Current Mode</div>
                <div class="mode-value" id="current-mode">‚Äî</div>
                <div class="submode-value" id="current-submode"></div>
            </div>
            
            <!-- [v2.8] Test Controls Panel - Only visible in Monitoring Mode -->
            <div class="test-controls" id="test-controls" style="display: none;">
                <h4>üß™ Equipment Test Controls</h4>
                
                <button class="test-btn" onclick="simulateEquipmentClick('EQ-001')">
                    <span class="test-btn-icon">üì¶</span> Click Equipment EQ-001 (RUN)
                </button>
                <button class="test-btn" onclick="simulateEquipmentClick('EQ-002')">
                    <span class="test-btn-icon">üì¶</span> Click Equipment EQ-002 (IDLE)
                </button>
                <button class="test-btn" onclick="simulateEquipmentClick('EQ-003')">
                    <span class="test-btn-icon">üì¶</span> Click Equipment EQ-003 (STOP)
                </button>
                <button class="test-btn" onclick="simulateMultiSelect()">
                    <span class="test-btn-icon">üìä</span> Multi-Select (3 Equipment)
                </button>
                <button class="test-btn" onclick="simulateUnmapped()">
                    <span class="test-btn-icon">‚ö†Ô∏è</span> Click Unmapped Equipment
                </button>
                
                <h4 style="margin-top: 16px;">üîî Toast Test</h4>
                <button class="test-btn" onclick="toast.success('Success', 'Operation completed successfully')">
                    <span class="test-btn-icon">‚úÖ</span> Success Toast
                </button>
                <button class="test-btn" onclick="toast.error('Error', 'Something went wrong')">
                    <span class="test-btn-icon">‚ùå</span> Error Toast
                </button>
                <button class="test-btn" onclick="toast.warning('Warning', 'Please check your input')">
                    <span class="test-btn-icon">‚ö†Ô∏è</span> Warning Toast
                </button>
                <button class="test-btn" onclick="toast.info('Info', 'New update available')">
                    <span class="test-btn-icon">‚ÑπÔ∏è</span> Info Toast
                </button>
                
                <h4 style="margin-top: 16px;">‚ö° Realtime Update Test</h4>
                <button class="test-btn" onclick="simulateRealtimeUpdate()">
                    <span class="test-btn-icon">üîÑ</span> Trigger Realtime Update
                </button>
            </div>
        </div>
    </main>

    <!-- =============================================
         EQUIPMENT INFO PANEL
         [MIGRATE TO] src/ui/EquipmentInfoPanel.js
         
         [v2.8] Full implementation based on main branch
         - Header: Equipment Name + Status
         - Tabs: General / PC Info
         - General Tab: Line, Product, Lot, Duration
         - Real-time duration timer
         ============================================= -->
    <div id="equipmentInfo">
        <button class="close-btn" onclick="hideEquipmentInfo()">√ó</button>
        
        <div class="equipment-panel-header">
            <h2 id="equipName" class="equipment-panel-title">ÏÑ§ÎπÑ Ï†ïÎ≥¥</h2>
            <div class="header-status" id="headerStatus">
                <span class="status-indicator" id="headerStatusIndicator"></span>
                <span class="status-text" id="headerStatusText">-</span>
            </div>
        </div>
        
        <div class="equipment-panel-tabs">
            <button class="equipment-tab active" data-tab="general" onclick="switchEquipmentTab('general')">General</button>
            <button class="equipment-tab" data-tab="pcinfo" onclick="switchEquipmentTab('pcinfo')">PC Info.</button>
        </div>
        
        <div class="equipment-panel-content">
            <div id="tab-general" class="equipment-tab-content active">
                <div id="generalTabContent">
                    <div class="info-row placeholder">
                        <span class="info-label">ÏÑ§ÎπÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span>
                    </div>
                </div>
            </div>
            <div id="tab-pcinfo" class="equipment-tab-content">
                <div id="pcinfoTabContent">
                    <div class="info-row placeholder">
                        <span class="info-label">ÏÑ§ÎπÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STATUS BAR -->
    <footer class="status-bar">
        <div class="status-group">
            <div class="status-item"><span class="country-code">KR</span></div>
            <div class="status-item">
                <span class="status-dot connected" id="statusbar-internet-dot"></span>
                <span class="status-label">NET</span>
                <span class="status-value">Online</span>
            </div>
            <div class="status-item">
                <span class="status-dot disconnected" id="backend-dot"></span>
                <span class="status-label">API</span>
                <span class="status-value" id="backend-value">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-dot disconnected" id="db-dot"></span>
                <span class="status-label">DB</span>
                <span class="status-value" id="db-value">None</span>
            </div>
        </div>
        <div class="status-group">
            <div class="status-item">
                <span class="status-label">FPS</span>
                <span class="status-value" id="fps-value">60</span>
                <div class="perf-bar"><div class="perf-bar-fill good" id="fps-bar" style="width: 100%;"></div></div>
            </div>
            <div class="status-item">
                <span class="status-label">MEM</span>
                <span class="status-value"><span id="memory-value">128</span>MB</span>
                <div class="perf-bar"><div class="perf-bar-fill good" id="memory-bar" style="width: 30%;"></div></div>
            </div>
        </div>
    </footer>

    <script>
        // =============================================
        // Configuration
        // =============================================
        let currentMode = null;
        let currentSubMode = null;
        let isConnected = false;
        let devModeEnabled = false;
        let selectedSite = null;
        let currentTheme = 'dark';
        let durationTimerInterval = null;
        let currentEquipmentData = null;
        
        // Three.js variables
        let scene, camera, renderer, equipmentMeshes = [];
        
        // Mock data
        const siteProfiles = [
            { id: 'kr_b_01', display_name: 'Korea Site B-01', region: 'Asia/Seoul', priority: 10 },
            { id: 'kr_b_02', display_name: 'Korea Site B-02', region: 'Asia/Seoul', priority: 8 },
            { id: 'vn_a_01', display_name: 'Vietnam Site A-01', region: 'Asia/Ho_Chi_Minh', priority: 5 }
        ];
        
        let siteStatus = {};

        // =============================================
        // Toast System
        // =============================================
        const toast = {
            show(type, title, message, duration = 4000) {
                const container = document.getElementById('toast-container');
                const toastEl = document.createElement('div');
                toastEl.className = `toast ${type}`;
                const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
                toastEl.innerHTML = `
                    <span class="toast-icon">${icons[type]}</span>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close" onclick="this.parentElement.remove()">‚úï</button>
                `;
                container.appendChild(toastEl);
                setTimeout(() => {
                    toastEl.classList.add('hiding');
                    setTimeout(() => toastEl.remove(), 300);
                }, duration);
            },
            success(title, message) { this.show('success', title, message); },
            error(title, message) { this.show('error', title, message); },
            warning(title, message) { this.show('warning', title, message); },
            info(title, message) { this.show('info', title, message); }
        };

        // =============================================
        // Theme Functions
        // =============================================
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('theme-switch').classList.toggle('active', currentTheme === 'light');
            localStorage.setItem('theme', currentTheme);
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('theme-switch').classList.toggle('active', currentTheme === 'light');
        }

        // =============================================
        // Three.js 3D View
        // [v2.8] Simple cleanroom equipment visualization
        // =============================================
        function initThreeJS() {
            const container = document.getElementById('threejs-container');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(currentTheme === 'dark' ? 0x1e293b : 0xf1f5f9);
            
            // Camera
            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            scene.add(directionalLight);
            
            // Floor (Cleanroom)
            const floorGeometry = new THREE.PlaneGeometry(30, 30);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: currentTheme === 'dark' ? 0x334155 : 0xe2e8f0,
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -0.5;
            scene.add(floor);
            
            // Grid
            const gridHelper = new THREE.GridHelper(30, 30, 0x06B6D4, 0x475569);
            gridHelper.position.y = -0.49;
            scene.add(gridHelper);
            
            // Create Equipment (3x3 grid)
            const statusColors = {
                RUN: 0x4ADE80,
                IDLE: 0xFBBF24,
                STOP: 0xF87171
            };
            
            const equipmentData = [
                { id: 'EQ-001', status: 'RUN', x: -6, z: -6 },
                { id: 'EQ-002', status: 'IDLE', x: 0, z: -6 },
                { id: 'EQ-003', status: 'STOP', x: 6, z: -6 },
                { id: 'EQ-004', status: 'RUN', x: -6, z: 0 },
                { id: 'EQ-005', status: 'RUN', x: 0, z: 0 },
                { id: 'EQ-006', status: 'IDLE', x: 6, z: 0 },
                { id: 'EQ-007', status: 'RUN', x: -6, z: 6 },
                { id: 'EQ-008', status: 'STOP', x: 0, z: 6 },
                { id: 'EQ-009', status: 'RUN', x: 6, z: 6 }
            ];
            
            equipmentData.forEach(eq => {
                // Equipment body
                const geometry = new THREE.BoxGeometry(3, 2, 3);
                const material = new THREE.MeshStandardMaterial({ 
                    color: 0x64748b,
                    roughness: 0.5,
                    metalness: 0.3
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(eq.x, 0.5, eq.z);
                mesh.userData = eq;
                scene.add(mesh);
                equipmentMeshes.push(mesh);
                
                // Status light (signal tower)
                const lightGeometry = new THREE.CylinderGeometry(0.2, 0.2, 0.5, 16);
                const lightMaterial = new THREE.MeshStandardMaterial({ 
                    color: statusColors[eq.status],
                    emissive: statusColors[eq.status],
                    emissiveIntensity: 0.5
                });
                const light = new THREE.Mesh(lightGeometry, lightMaterial);
                light.position.set(eq.x, 1.75, eq.z);
                scene.add(light);
            });
            
            // Animation
            function animate() {
                requestAnimationFrame(animate);
                
                // Rotate camera slowly
                const time = Date.now() * 0.0001;
                camera.position.x = Math.sin(time) * 20;
                camera.position.z = Math.cos(time) * 20;
                camera.lookAt(0, 0, 0);
                
                renderer.render(scene, camera);
            }
            animate();
            
            // Handle resize
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }

        // =============================================
        // Equipment Info Panel Functions
        // [MIGRATE TO] src/ui/EquipmentInfoPanel.js
        // =============================================
        function showEquipmentInfo(data) {
            const panel = document.getElementById('equipmentInfo');
            const isMulti = Array.isArray(data) && data.length > 1;
            
            if (isMulti) {
                showMultiEquipmentInfo(data);
            } else {
                const eq = Array.isArray(data) ? data[0] : data;
                showSingleEquipmentInfo(eq);
            }
            
            panel.classList.add('active');
        }
        
        function showSingleEquipmentInfo(eq) {
            currentEquipmentData = eq;
            
            // Update header
            document.getElementById('equipName').textContent = eq.equipment_name || eq.id;
            document.getElementById('equipName').classList.remove('multi-select');
            
            // Update status
            updateHeaderStatus(eq.status);
            
            // Update General tab
            const generalContent = document.getElementById('generalTabContent');
            const isLotActive = eq.is_lot_active === true;
            
            if (isLotActive) {
                startDurationTimer(eq.lot_start_time);
                generalContent.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Line:</span>
                        <span class="info-value">${eq.line_name || '-'}</span>
                    </div>
                    <div class="info-row-divider"></div>
                    <div class="info-row">
                        <span class="info-label">Product:</span>
                        <span class="info-value">${eq.product_model || '-'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lot No.:</span>
                        <span class="info-value">${eq.lot_id || '-'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lot Start:</span>
                        <span class="info-value">${formatDateTime(eq.lot_start_time) || '-'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lot Duration:</span>
                        <span class="info-value" id="durationDisplay">${formatDuration(eq.lot_start_time)}</span>
                    </div>
                    <div class="info-row info-row-meta">
                        <span class="info-label">Updated:</span>
                        <span class="info-value info-value-meta">${formatDateTime(eq.last_updated)}</span>
                    </div>
                `;
            } else {
                if (eq.since_time) {
                    startDurationTimer(eq.since_time);
                } else {
                    stopDurationTimer();
                }
                generalContent.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Line:</span>
                        <span class="info-value">${eq.line_name || '-'}</span>
                    </div>
                    <div class="info-row-divider"></div>
                    <div class="info-row">
                        <span class="info-label">Product:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lot No.:</span>
                        <span class="info-value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Since:</span>
                        <span class="info-value">${eq.since_time ? formatDateTime(eq.since_time) : '-'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Duration:</span>
                        <span class="info-value" id="durationDisplay">${eq.since_time ? formatDuration(eq.since_time) : '-'}</span>
                    </div>
                `;
            }
            
            // Update PC Info tab
            const pcinfoContent = document.getElementById('pcinfoTabContent');
            pcinfoContent.innerHTML = `
                <div class="info-row">
                    <span class="info-label">PC Name:</span>
                    <span class="info-value">${eq.pc_name || '-'}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">IP Address:</span>
                    <span class="info-value">${eq.ip_address || '-'}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">MAC Address:</span>
                    <span class="info-value">${eq.mac_address || '-'}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">OS Version:</span>
                    <span class="info-value">${eq.os_version || '-'}</span>
                </div>
            `;
        }
        
        function showMultiEquipmentInfo(dataArray) {
            stopDurationTimer();
            
            const count = dataArray.length;
            
            // Update header
            document.getElementById('equipName').textContent = `${count}Í∞ú ÏÑ§ÎπÑ ÏÑ†ÌÉùÎê®`;
            document.getElementById('equipName').classList.add('multi-select');
            
            // Hide status
            document.getElementById('headerStatus').style.display = 'none';
            
            // Count statuses
            const statusCounts = { RUN: 0, IDLE: 0, STOP: 0 };
            const lines = new Set();
            const products = new Set();
            
            dataArray.forEach(eq => {
                if (eq.status) statusCounts[eq.status]++;
                if (eq.line_name) lines.add(eq.line_name);
                if (eq.product_model) products.add(eq.product_model);
            });
            
            // Update General tab
            const generalContent = document.getElementById('generalTabContent');
            generalContent.innerHTML = `
                <div class="info-row multi-select-header">
                    <span class="info-icon">üìä</span>
                    <span class="info-text">${count}Í∞ú ÏÑ§ÎπÑ ÏßëÍ≥Ñ Ï†ïÎ≥¥</span>
                    <span class="info-badge">${count}Í∞ú Ï°∞ÌöåÎê®</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Line:</span>
                    <span class="info-value">${[...lines].join(', ') || '-'}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Status:</span>
                    <div class="status-counts">
                        ${statusCounts.RUN > 0 ? `<span class="status-count-item run">üü¢ ${statusCounts.RUN}</span>` : ''}
                        ${statusCounts.IDLE > 0 ? `<span class="status-count-item idle">üü° ${statusCounts.IDLE}</span>` : ''}
                        ${statusCounts.STOP > 0 ? `<span class="status-count-item stop">üî¥ ${statusCounts.STOP}</span>` : ''}
                    </div>
                </div>
                <div class="info-row">
                    <span class="info-label">Product:</span>
                    <span class="info-value">${[...products].join(', ') || '-'}</span>
                </div>
            `;
            
            // Update PC Info tab
            const pcinfoContent = document.getElementById('pcinfoTabContent');
            pcinfoContent.innerHTML = `
                <div class="info-row multi-select-header">
                    <span class="info-icon">üíª</span>
                    <span class="info-text">${count}Í∞ú ÏÑ§ÎπÑ PC Ï†ïÎ≥¥</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ÏÑ†ÌÉùÎêú ÏÑ§ÎπÑ:</span>
                    <span class="info-value">${dataArray.map(e => e.id).join(', ')}</span>
                </div>
            `;
        }
        
        function showUnmappedEquipment(frontendId) {
            stopDurationTimer();
            
            document.getElementById('equipName').textContent = frontendId;
            updateHeaderStatus('DISCONNECTED');
            
            const generalContent = document.getElementById('generalTabContent');
            generalContent.innerHTML = `
                <div class="info-row unmapped-notice">
                    <span class="info-icon">‚ö†Ô∏è</span>
                    <span class="info-text">DBÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùÄ ÏÑ§ÎπÑÏûÖÎãàÎã§</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Frontend ID:</span>
                    <span class="info-value">${frontendId}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Position:</span>
                    <span class="info-value">Row 1, Col 1</span>
                </div>
                <div class="info-row">
                    <span class="info-text">Edit Mode (EÌÇ§)ÏóêÏÑú Îß§ÌïëÌï¥Ï£ºÏÑ∏Ïöî</span>
                </div>
            `;
            
            document.getElementById('equipmentInfo').classList.add('active');
        }
        
        function hideEquipmentInfo() {
            document.getElementById('equipmentInfo').classList.remove('active');
            document.getElementById('headerStatus').style.display = 'flex';
            stopDurationTimer();
        }
        
        function switchEquipmentTab(tab) {
            document.querySelectorAll('.equipment-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
            document.querySelectorAll('.equipment-tab-content').forEach(c => c.classList.toggle('active', c.id === `tab-${tab}`));
        }
        
        function updateHeaderStatus(status) {
            const indicator = document.getElementById('headerStatusIndicator');
            const text = document.getElementById('headerStatusText');
            const statusEl = document.getElementById('headerStatus');
            
            statusEl.style.display = 'flex';
            
            const statusClass = (status || 'DISCONNECTED').toLowerCase();
            indicator.className = `status-indicator ${statusClass}`;
            text.className = `status-text ${statusClass}`;
            text.textContent = status || '-';
        }
        
        // Duration Timer
        function startDurationTimer(baseTime) {
            stopDurationTimer();
            
            function update() {
                const el = document.getElementById('durationDisplay');
                if (el) {
                    el.textContent = formatDuration(baseTime);
                }
            }
            
            update();
            durationTimerInterval = setInterval(update, 1000);
        }
        
        function stopDurationTimer() {
            if (durationTimerInterval) {
                clearInterval(durationTimerInterval);
                durationTimerInterval = null;
            }
        }
        
        function formatDuration(startTime) {
            if (!startTime) return '-';
            const start = new Date(startTime);
            const now = new Date();
            const diff = Math.floor((now - start) / 1000);
            
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const d = new Date(dateStr);
            return d.toLocaleString('ko-KR');
        }

        // =============================================
        // Test Simulation Functions
        // =============================================
        function simulateEquipmentClick(eqId) {
            const mockData = {
                'EQ-001': {
                    id: 'EQ-001',
                    equipment_name: 'Etcher A-01',
                    status: 'RUN',
                    line_name: 'Line A',
                    product_model: 'PRODUCT-X100',
                    lot_id: 'LOT-2026-001234',
                    is_lot_active: true,
                    lot_start_time: new Date(Date.now() - 3600000).toISOString(),
                    last_updated: new Date().toISOString(),
                    pc_name: 'ETCHER-A01-PC',
                    ip_address: '192.168.1.101',
                    mac_address: 'AA:BB:CC:DD:EE:01',
                    os_version: 'Windows 10 IoT'
                },
                'EQ-002': {
                    id: 'EQ-002',
                    equipment_name: 'CVD Unit B-02',
                    status: 'IDLE',
                    line_name: 'Line B',
                    is_lot_active: false,
                    since_time: new Date(Date.now() - 1800000).toISOString(),
                    pc_name: 'CVD-B02-PC',
                    ip_address: '192.168.1.102',
                    mac_address: 'AA:BB:CC:DD:EE:02',
                    os_version: 'Windows 10 IoT'
                },
                'EQ-003': {
                    id: 'EQ-003',
                    equipment_name: 'Sputter C-03',
                    status: 'STOP',
                    line_name: 'Line C',
                    is_lot_active: false,
                    since_time: new Date(Date.now() - 7200000).toISOString(),
                    pc_name: 'SPUTTER-C03-PC',
                    ip_address: '192.168.1.103',
                    mac_address: 'AA:BB:CC:DD:EE:03',
                    os_version: 'Windows 10 IoT'
                }
            };
            
            showEquipmentInfo(mockData[eqId]);
            toast.info('Equipment Selected', `Clicked on ${eqId}`);
        }
        
        function simulateMultiSelect() {
            const mockData = [
                { id: 'EQ-001', status: 'RUN', line_name: 'Line A', product_model: 'PRODUCT-X100' },
                { id: 'EQ-002', status: 'IDLE', line_name: 'Line B', product_model: 'PRODUCT-Y200' },
                { id: 'EQ-003', status: 'STOP', line_name: 'Line A', product_model: 'PRODUCT-X100' }
            ];
            
            showEquipmentInfo(mockData);
            toast.info('Multi-Select', '3 equipment selected');
        }
        
        function simulateUnmapped() {
            showUnmappedEquipment('UNMAPPED-EQ-099');
            toast.warning('Unmapped Equipment', 'This equipment is not mapped to DB');
        }
        
        function simulateRealtimeUpdate() {
            if (!currentEquipmentData) {
                toast.warning('No Equipment', 'Please select an equipment first');
                return;
            }
            
            // Simulate status change
            const newStatuses = ['RUN', 'IDLE', 'STOP'];
            const currentIdx = newStatuses.indexOf(currentEquipmentData.status);
            const newStatus = newStatuses[(currentIdx + 1) % 3];
            
            currentEquipmentData.status = newStatus;
            currentEquipmentData.last_updated = new Date().toISOString();
            
            updateHeaderStatus(newStatus);
            toast.success('Realtime Update', `Status changed to ${newStatus}`);
        }

        // =============================================
        // Connection Modal & Site Functions
        // =============================================
        function openConnectionModal() {
            document.getElementById('connection-modal').classList.add('active');
            refreshAPIStatus();
        }
        
        function closeConnectionModal() {
            document.getElementById('connection-modal').classList.remove('active');
        }
        
        function refreshAPIStatus() {
            const dot = document.getElementById('api-status-dot');
            const text = document.getElementById('api-status-text');
            
            dot.className = 'status-dot status-dot--checking';
            text.textContent = 'Checking...';
            
            setTimeout(() => {
                dot.className = 'status-dot status-dot--connected';
                text.textContent = 'Connected';
                text.className = 'status-text run';
                document.getElementById('response-time').textContent = `${Math.floor(Math.random() * 50 + 20)}ms`;
            }, 1000);
        }
        
        function renderSiteList() {
            const siteList = document.getElementById('site-list');
            siteList.innerHTML = siteProfiles.map(profile => {
                const isSelected = selectedSite === profile.id;
                const status = siteStatus[profile.id] || {};
                const isConnectedSite = status.status === 'connected';
                
                return `
                    <div class="site-item ${isSelected ? 'site-item--selected' : ''} ${isConnectedSite ? 'site-item--connected' : ''}" onclick="toggleSiteSelection('${profile.id}')">
                        <div class="site-checkbox"><input type="checkbox" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleSiteSelection('${profile.id}')"></div>
                        <div class="site-info">
                            <div class="site-main">
                                <span class="site-name">${profile.display_name}</span>
                                <span class="site-region">${profile.region}</span>
                            </div>
                        </div>
                        <div class="site-status">
                            ${isConnectedSite ? '<span>‚úÖ</span><button class="btn-disconnect" onclick="event.stopPropagation(); disconnectFromSite(\''+profile.id+'\')">Disconnect</button>' : '<span>‚ö™</span>'}
                        </div>
                    </div>
                `;
            }).join('');
            updateSelectionUI();
        }
        
        function toggleSiteSelection(siteId) {
            selectedSite = selectedSite === siteId ? null : siteId;
            renderSiteList();
        }
        
        function selectAllSites() {
            if (siteProfiles.length > 0) selectedSite = siteProfiles[0].id;
            renderSiteList();
        }
        
        function deselectAllSites() {
            selectedSite = null;
            renderSiteList();
        }
        
        function updateSelectionUI() {
            document.getElementById('selection-count').textContent = `Selected: ${selectedSite ? 1 : 0}`;
            document.getElementById('connect-btn').disabled = !selectedSite;
        }
        
        function connectToSelectedSite() {
            if (!selectedSite) return;
            const btn = document.getElementById('connect-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Connecting...';
            
            setTimeout(() => {
                siteStatus[selectedSite] = { status: 'connected' };
                isConnected = true;
                renderSiteList();
                enableSidebarIcons();
                updateStatusBar(selectedSite);
                btn.textContent = 'üîå Connect';
                
                const site = siteProfiles.find(s => s.id === selectedSite);
                toast.success('Connected', `Successfully connected to ${site.display_name}`);
            }, 1500);
        }
        
        function disconnectFromSite(siteId) {
            siteStatus[siteId] = { status: 'disconnected' };
            isConnected = false;
            selectedSite = null;
            renderSiteList();
            disableSidebarIcons();
            updateStatusBar(null);
            hideEquipmentInfo();
            currentMode = null;
            document.getElementById('current-mode').textContent = '‚Äî';
            document.getElementById('current-submode').textContent = '';
            document.getElementById('test-controls').style.display = 'none';
            
            // Clear submenu active states
            document.querySelectorAll('#monitoring-submenu .submenu-item').forEach(item => item.classList.remove('active'));
            
            toast.info('Disconnected', 'Database connection closed');
        }
        
        function refreshDatabaseInfo() {
            toast.success('Refreshed', 'Database information updated');
        }
        
        function enableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-debug'].forEach(id => {
                document.getElementById(id).classList.remove('disabled');
            });
            document.getElementById('btn-monitoring-wrapper').classList.remove('disabled');
            if (devModeEnabled) document.getElementById('btn-layout').classList.remove('disabled');
        }
        
        function disableSidebarIcons() {
            ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-debug', 'btn-layout'].forEach(id => {
                document.getElementById(id).classList.add('disabled');
            });
            document.getElementById('btn-monitoring-wrapper').classList.add('disabled');
            document.querySelectorAll('.icon-btn').forEach(btn => btn.classList.remove('selected'));
        }
        
        function updateStatusBar(siteId) {
            document.getElementById('backend-dot').className = `status-dot ${siteId ? 'connected' : 'disconnected'}`;
            document.getElementById('backend-value').textContent = siteId ? 'Connected' : 'Disconnected';
            document.getElementById('db-dot').className = `status-dot ${siteId ? 'connected' : 'disconnected'}`;
            document.getElementById('db-value').textContent = siteId ? siteId.replace(/_/g, '-') : 'None';
        }

        // =============================================
        // Mode & Submenu Functions
        // =============================================
        function setMode(mode) {
            currentMode = mode;
            currentSubMode = null;
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('current-submode').textContent = '';
            
            // Hide test controls unless in monitoring mode
            document.getElementById('test-controls').style.display = mode === 'monitoring' ? 'block' : 'none';
            
            // Clear submenu active states
            document.querySelectorAll('.submenu-item').forEach(item => item.classList.remove('active'));
        }

        function setSubMode(mode, submode) {
            currentMode = mode;
            currentSubMode = submode;
            
            document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
            if (mode === 'monitoring') document.getElementById('btn-monitoring').classList.add('selected');
            
            // [v2.8] Only add .active to the clicked submenu item
            document.querySelectorAll(`#${mode}-submenu .submenu-item`).forEach(item => {
                item.classList.toggle('active', item.dataset.submode === submode);
            });
            
            document.getElementById('current-mode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            document.getElementById('current-submode').textContent = `‚Üí ${submode === '3d-view' ? '3D View' : submode}`;
            
            // Show test controls in monitoring mode
            document.getElementById('test-controls').style.display = mode === 'monitoring' ? 'block' : 'none';
            
            toast.info('Mode Changed', `${mode} ‚Üí ${submode}`);
        }
        
        function toggleDevMode() {
            devModeEnabled = !devModeEnabled;
            const layoutBtn = document.getElementById('btn-layout');
            const label = document.getElementById('dev-mode-label');
            if (devModeEnabled) {
                layoutBtn.classList.remove('hidden');
                if (isConnected) layoutBtn.classList.remove('disabled');
                label.textContent = 'Dev Mode: ON';
                toast.info('Dev Mode', 'Developer mode enabled');
            } else {
                layoutBtn.classList.add('hidden');
                label.textContent = 'Dev Mode: OFF';
                toast.info('Dev Mode', 'Developer mode disabled');
            }
        }

        function setupSidebarEvents() {
            document.querySelectorAll('.icon-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    if (this.id === 'btn-connection') { openConnectionModal(); return; }
                    if (this.id === 'btn-settings') return;
                    if (this.closest('.has-submenu')) return;
                    
                    document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    setMode(this.dataset.mode);
                });
            });
            
            document.getElementById('btn-monitoring').addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;
                document.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                setMode('monitoring');
            });
        }

        // =============================================
        // Initialize
        // =============================================
        function init() {
            loadTheme();
            siteProfiles.forEach(site => { siteStatus[site.id] = { status: 'disconnected' }; });
            renderSiteList();
            setupSidebarEvents();
            initThreeJS();
            
            // Performance simulation
            setInterval(() => {
                const fps = 58 + Math.floor(Math.random() * 5);
                document.getElementById('fps-value').textContent = fps;
                document.getElementById('fps-bar').style.width = `${(fps / 60) * 100}%`;
                const mem = 128 + Math.floor((Math.random() - 0.5) * 20);
                document.getElementById('memory-value').textContent = mem;
            }, 2000);
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.matches('input, textarea')) return;
            const key = e.key.toLowerCase();
            if ((e.ctrlKey || e.metaKey) && key === 'k') { e.preventDefault(); document.getElementById('connection-modal').classList.toggle('active'); return; }
            if (key === 'escape') {
                document.getElementById('connection-modal').classList.remove('active');
                hideEquipmentInfo();
                return;
            }
            if (!isConnected) return;
            switch(key) {
                case 'm': if (!document.getElementById('btn-monitoring').classList.contains('disabled')) document.getElementById('btn-monitoring').click(); break;
                case 'a': if (!document.getElementById('btn-analysis').classList.contains('disabled')) document.getElementById('btn-analysis').click(); break;
                case 's': if (!e.ctrlKey && !document.getElementById('btn-simulation').classList.contains('disabled')) document.getElementById('btn-simulation').click(); break;
                case 'd': if (!document.getElementById('btn-debug').classList.contains('disabled')) document.getElementById('btn-debug').click(); break;
            }
        });

        document.addEventListener('DOMContentLoaded', init);
        console.log('üß™ Sidebar Test v2.8 Loaded');
        console.log('Features: Three.js 3D View, Equipment Info Panel, Test Controls');
    </script>

</body>
</html>
