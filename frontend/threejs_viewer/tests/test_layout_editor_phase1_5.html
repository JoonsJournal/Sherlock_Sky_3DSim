<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1.5 - LayoutEditorMain ë…ë¦½ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        /* Control Panel */
        .control-panel {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group:last-child {
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        select {
            width: 100%;
            max-width: 400px;
            padding: 10px 15px;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        select:hover {
            border-color: #4CAF50;
        }
        
        select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        button {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.secondary {
            background: #2196F3;
        }
        
        button.secondary:hover {
            background: #0b7dda;
        }
        
        /* Status Display */
        .status-display {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        
        .status-display h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 600;
            color: #555;
        }
        
        .status-value {
            color: #333;
            font-family: 'Courier New', monospace;
        }
        
        .status-value.mode-viewer {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .status-value.mode-editor {
            color: #FF9800;
            font-weight: bold;
        }
        
        .status-value.dirty {
            color: #f44336;
        }
        
        .status-value.clean {
            color: #4CAF50;
        }
        
        /* Content Areas */
        .content-area {
            min-height: 400px;
            border: 2px dashed #ddd;
            border-radius: 6px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
        }
        
        .content-area.hidden {
            display: none;
        }
        
        .placeholder {
            text-align: center;
            color: #999;
        }
        
        .placeholder h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .placeholder p {
            font-size: 14px;
        }
        
        /* Log Display */
        .log-display {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            line-height: 1.6;
        }
        
        .log-entry.success {
            color: #4EC9B0;
        }
        
        .log-entry.error {
            color: #f48771;
        }
        
        .log-entry.info {
            color: #9CDCFE;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            select {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Phase 1.5 - LayoutEditorMain ë…ë¦½ í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">ëª¨ë“  ì˜ì¡´ì„± í¬í•¨ - Site ì„ íƒ â†’ Layout í™•ì¸ â†’ Editor/Viewer ëª¨ë“œ ì „í™˜ í…ŒìŠ¤íŠ¸</p>
        
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="control-group">
                <label for="site-selector">ğŸ­ Site ì„ íƒ</label>
                <select id="site-selector">
                    <option value="">-- Siteë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                    <option value="korea_site1_line1">Korea Site 1 - Line 1</option>
                    <option value="korea_site1_line2">Korea Site 1 - Line 2</option>
                    <option value="vietnam_site1_line1">Vietnam Site 1 - Line 1</option>
                    <option value="usa_site1_line1">USA Site 1 - Line 1</option>
                    <option value="test_site">Test Site (ì‹ ê·œ)</option>
                </select>
            </div>
            
            <div class="control-group">
                <button onclick="testGetDebugInfo()">ğŸ” ìƒíƒœ í™•ì¸</button>
                <button onclick="testSaveLayout()" class="secondary">ğŸ’¾ Layout ì €ì¥</button>
                <button onclick="clearLogs()" class="secondary">ğŸ—‘ï¸ ë¡œê·¸ ì´ˆê¸°í™”</button>
            </div>
        </div>
        
        <!-- Status Display -->
        <div class="status-display">
            <h2>ğŸ“Š í˜„ì¬ ìƒíƒœ</h2>
            <div class="status-item">
                <span class="status-label">ëª¨ë“œ:</span>
                <span class="status-value" id="status-mode">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">Site ID:</span>
                <span class="status-value" id="status-site">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">Layout ë¡œë“œ ì—¬ë¶€:</span>
                <span class="status-value" id="status-layout">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">ë³€ê²½ì‚¬í•­:</span>
                <span class="status-value" id="status-dirty">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">ì‚¬ìš© ê°€ëŠ¥í•œ Template:</span>
                <span class="status-value" id="status-templates">-</span>
            </div>
        </div>
        
        <!-- Editor Container -->
        <div id="layout-editor-container" class="content-area hidden">
            <div class="placeholder">
                <h3>âœï¸ Layout Editor</h3>
                <p>Phase 2ì—ì„œ Konva.js 2D Canvasê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
            </div>
        </div>
        
        <!-- Viewer Container -->
        <div id="viewer-container" class="content-area hidden">
            <div class="placeholder">
                <h3>ğŸ‘ï¸ 3D Viewer</h3>
                <p>Phase 2ì—ì„œ Three.js 3D Sceneì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
            </div>
        </div>
        
        <!-- Log Display -->
        <div class="log-display" id="log-display">
            <div class="log-entry info">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ. Siteë¥¼ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”.</div>
        </div>
    </div>
    
    <script>
        // ===================================================================
        // LayoutEditorState (ì¸ë¼ì¸)
        // ===================================================================
        class LayoutEditorState {
            constructor() {
                this.state = {
                    mode: null,
                    currentSiteId: null,
                    currentLayout: null,
                    selectedObjects: [],
                    editHistory: [],
                    historyIndex: -1,
                    isDirty: false,
                    lastSaved: null,
                    autoSaveEnabled: false,
                    showGrid: true,
                    snapToGrid: true,
                    gridSize: 10
                };
                
                this.listeners = new Map();
                
                console.log('[LayoutEditorState] ì´ˆê¸°í™” ì™„ë£Œ');
            }
            
            subscribe(key, callback) {
                if (!this.listeners.has(key)) {
                    this.listeners.set(key, []);
                }
                this.listeners.get(key).push(callback);
                
                return () => {
                    const callbacks = this.listeners.get(key);
                    const index = callbacks.indexOf(callback);
                    if (index > -1) {
                        callbacks.splice(index, 1);
                    }
                };
            }
            
            notify(key) {
                if (this.listeners.has(key)) {
                    const value = this.state[key];
                    this.listeners.get(key).forEach(callback => callback(value));
                }
            }
            
            enterEditorMode(siteId, layoutData) {
                console.log(`[LayoutEditorState] Editor ëª¨ë“œ ì§„ì…: ${siteId}`);
                this.state.mode = 'editor';
                this.state.currentSiteId = siteId;
                this.state.currentLayout = layoutData;
                this.state.isDirty = false;
                
                this.notify('mode');
                this.notify('currentSiteId');
                this.notify('currentLayout');
                this.notify('isDirty');
            }
            
            enterViewerMode(siteId, layoutData) {
                console.log(`[LayoutEditorState] Viewer ëª¨ë“œ ì§„ì…: ${siteId}`);
                this.state.mode = 'viewer';
                this.state.currentSiteId = siteId;
                this.state.currentLayout = layoutData;
                this.state.isDirty = false;
                
                this.notify('mode');
                this.notify('currentSiteId');
                this.notify('currentLayout');
                this.notify('isDirty');
            }
            
            markAsSaved() {
                this.state.isDirty = false;
                this.state.lastSaved = new Date();
                this.notify('isDirty');
            }
        }
        
        const layoutEditorState = new LayoutEditorState();
        
        // ===================================================================
        // LayoutFileManager (ì¸ë¼ì¸)
        // ===================================================================
        class LayoutFileManager {
            constructor() {
                // ê²½ë¡œ ìˆ˜ì •: public í´ë” í¬í•¨
                this.basePath = '/public/layouts';
                this.templatePath = '/public/layouts/templates';
                console.log('[LayoutFileManager] ì´ˆê¸°í™” ì™„ë£Œ');
                console.log('[LayoutFileManager] Base Path:', this.basePath);
                console.log('[LayoutFileManager] Template Path:', this.templatePath);
            }
            
            async checkLayout(siteId) {
                const url = `${this.basePath}/${siteId}.json`;
                console.log(`[LayoutFileManager] Layout í™•ì¸: ${url}`);
                
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    return response.ok;
                } catch (error) {
                    console.log(`[LayoutFileManager] Layout íŒŒì¼ ì—†ìŒ: ${siteId}`);
                    return false;
                }
            }
            
            async loadLayout(siteId) {
                const url = `${this.basePath}/${siteId}.json`;
                console.log(`[LayoutFileManager] Layout ë¡œë“œ: ${url}`);
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log('[LayoutFileManager] Layout ë¡œë“œ ì„±ê³µ');
                    return data;
                } catch (error) {
                    console.error('[LayoutFileManager] Layout ë¡œë“œ ì‹¤íŒ¨:', error);
                    return null;
                }
            }
            
            async loadTemplate(filename) {
                const url = `${this.templatePath}/${filename}`;
                console.log(`[LayoutFileManager] Template ë¡œë“œ: ${url}`);
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log('[LayoutFileManager] Template ë¡œë“œ ì„±ê³µ');
                    return data;
                } catch (error) {
                    console.error('[LayoutFileManager] Template ë¡œë“œ ì‹¤íŒ¨:', error);
                    return null;
                }
            }
            
            async loadBackup(siteId) {
                const url = `${this.basePath}/${siteId}.backup.json`;
                console.log(`[LayoutFileManager] ë°±ì—… íŒŒì¼ ë¡œë“œ: ${url}`);
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log('[LayoutFileManager] ë°±ì—… íŒŒì¼ ë¡œë“œ ì„±ê³µ');
                    return data;
                } catch (error) {
                    console.error('[LayoutFileManager] ë°±ì—… íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                    return null;
                }
            }
            
            async saveLayout(siteId, layoutData) {
                console.log(`[LayoutFileManager] Layout ë‹¤ìš´ë¡œë“œ ì‹œì‘: ${siteId}`);
                
                const jsonString = JSON.stringify(layoutData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${siteId}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('[LayoutFileManager] Layout ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
            }
        }
        
        // ===================================================================
        // LayoutEditorMain (ì¸ë¼ì¸)
        // ===================================================================
        class LayoutEditorMain {
            constructor() {
                this.fileManager = new LayoutFileManager();
                this.state = layoutEditorState;
                
                this.elements = {
                    siteSelector: null,
                    editorContainer: null,
                    viewerContainer: null,
                    templateModal: null,
                    recoveryModal: null
                };
                
                this.availableTemplates = [
                    {
                        id: 'standard_26x6',
                        name: 'Standard 26Ã—6 Layout (ê¶Œì¥)',
                        description: '26 rows Ã— 6 cols, ë³µë„ í¬í•¨, Office ê³µê°„',
                        filename: 'standard_26x6.json'
                    },
                    {
                        id: 'compact_13x4',
                        name: 'Compact 13Ã—4 Layout',
                        description: '13 rows Ã— 4 cols, ì†Œí˜• ê³µì¥ìš©',
                        filename: 'compact_13x4.json'
                    },
                    {
                        id: 'default',
                        name: 'ê¸°ë³¸ Template',
                        description: 'ìµœì†Œ êµ¬ì„±',
                        filename: 'default_template.json'
                    }
                ];
                
                console.log('[LayoutEditorMain] ì´ˆê¸°í™” ì™„ë£Œ');
            }
            
            init() {
                console.log('[LayoutEditorMain] ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
                
                this.elements.siteSelector = document.getElementById('site-selector');
                this.elements.editorContainer = document.getElementById('layout-editor-container');
                this.elements.viewerContainer = document.getElementById('viewer-container');
                
                if (!this.elements.siteSelector) {
                    console.error('[LayoutEditorMain] Site Selector ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                this.elements.siteSelector.addEventListener('change', (e) => {
                    const siteId = e.target.value;
                    if (siteId) {
                        this.onSiteSelected(siteId);
                    }
                });
                
                this.state.subscribe('mode', (newMode) => {
                    this.onModeChanged(newMode);
                });
                
                console.log('[LayoutEditorMain] ì´ˆê¸°í™” ì™„ë£Œ');
            }
            
            async onSiteSelected(siteId) {
                console.log(`[LayoutEditorMain] Site ì„ íƒë¨: ${siteId}`);
                
                try {
                    const exists = await this.fileManager.checkLayout(siteId);
                    console.log(`[LayoutEditorMain] Layout íŒŒì¼ ì¡´ì¬: ${exists}`);
                    
                    if (exists) {
                        await this.loadExistingLayout(siteId);
                    } else {
                        await this.showTemplateSelection(siteId);
                    }
                } catch (error) {
                    console.error('[LayoutEditorMain] Site ì„ íƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                    this.showError('Site ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
            
            async loadExistingLayout(siteId) {
                console.log(`[LayoutEditorMain] ê¸°ì¡´ Layout ë¡œë“œ ì‹œì‘: ${siteId}`);
                
                try {
                    const layoutData = await this.fileManager.loadLayout(siteId);
                    
                    if (layoutData) {
                        console.log('[LayoutEditorMain] Layout ë¡œë“œ ì„±ê³µ:', layoutData);
                        
                        this.state.enterViewerMode(siteId, layoutData);
                        this.showSuccess(`Layout "${siteId}" ë¡œë“œ ì™„ë£Œ`);
                        console.log('[LayoutEditorMain] TODO: 3D Scene ë Œë”ë§ (Phase 2)');
                    } else {
                        throw new Error('Layout ë°ì´í„°ê°€ nullì…ë‹ˆë‹¤');
                    }
                } catch (error) {
                    console.error('[LayoutEditorMain] Layout ë¡œë“œ ì‹¤íŒ¨:', error);
                    await this.showRecoveryDialog(siteId);
                }
            }
            
            async showTemplateSelection(siteId) {
                console.log(`[LayoutEditorMain] Template ì„ íƒ UI í‘œì‹œ: ${siteId}`);
                
                const templateOptions = this.availableTemplates
                    .map((t, idx) => `${idx + 1}. ${t.name}\n   ${t.description}`)
                    .join('\n\n');
                
                const message = `ğŸ—ï¸ ìƒˆë¡œìš´ Layout ìƒì„± - ${siteId}\n\nLayout Templateì„ ì„ íƒí•˜ì„¸ìš”:\n\n${templateOptions}\n\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1-${this.availableTemplates.length}):`;
                
                const selection = prompt(message);
                
                if (selection) {
                    const index = parseInt(selection) - 1;
                    
                    if (index >= 0 && index < this.availableTemplates.length) {
                        const selectedTemplate = this.availableTemplates[index];
                        console.log('[LayoutEditorMain] Template ì„ íƒë¨:', selectedTemplate.name);
                        
                        await this.createNewLayout(siteId, selectedTemplate);
                    } else {
                        console.warn('[LayoutEditorMain] ì˜ëª»ëœ ì„ íƒ:', selection);
                        alert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                } else {
                    console.log('[LayoutEditorMain] Template ì„ íƒ ì·¨ì†Œ');
                }
            }
            
            async createNewLayout(siteId, templateInfo) {
                console.log(`[LayoutEditorMain] ì‹ ê·œ Layout ìƒì„±: ${siteId}, Template: ${templateInfo.name}`);
                
                try {
                    const templateData = await this.fileManager.loadTemplate(templateInfo.filename);
                    
                    if (!templateData) {
                        throw new Error(`Template ë¡œë“œ ì‹¤íŒ¨: ${templateInfo.filename}`);
                    }
                    
                    console.log('[LayoutEditorMain] Template ë¡œë“œ ì„±ê³µ:', templateData);
                    
                    const newLayout = {
                        ...templateData,
                        site_id: siteId,
                        template_source: templateInfo.id,
                        created_at: new Date().toISOString(),
                        layout_version: 1,
                        is_new: true
                    };
                    
                    console.log('[LayoutEditorMain] ì‹ ê·œ Layout ë°ì´í„°:', newLayout);
                    
                    this.state.enterEditorMode(siteId, newLayout);
                    this.showSuccess(`ì‹ ê·œ Layout ìƒì„±ë¨: ${siteId} (Template: ${templateInfo.name})`);
                    console.log('[LayoutEditorMain] TODO: Canvas2DEditor ì´ˆê¸°í™” (Phase 2)');
                } catch (error) {
                    console.error('[LayoutEditorMain] ì‹ ê·œ Layout ìƒì„± ì‹¤íŒ¨:', error);
                    this.showError(`Layout ìƒì„± ì¤‘ ì˜¤ë¥˜: ${error.message}`);
                }
            }
            
            async showRecoveryDialog(siteId) {
                console.log(`[LayoutEditorMain] ë³µêµ¬ Dialog í‘œì‹œ: ${siteId}`);
                
                const options = [
                    '1. ë°±ì—… íŒŒì¼ì—ì„œ ë³µêµ¬ ì‹œë„',
                    '2. Templateìœ¼ë¡œ ìƒˆë¡œ ìƒì„±',
                    '3. ì·¨ì†Œ'
                ].join('\n');
                
                const message = `âŒ Layout íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${siteId}\n\në³µêµ¬ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”:\n\n${options}\n\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`;
                
                const choice = prompt(message);
                
                switch (choice) {
                    case '1':
                        console.log('[LayoutEditorMain] ë°±ì—… íŒŒì¼ ë³µêµ¬ ì‹œë„');
                        const backupData = await this.fileManager.loadBackup(siteId);
                        if (backupData) {
                            this.state.enterViewerMode(siteId, backupData);
                            this.showSuccess('ë°±ì—… íŒŒì¼ë¡œ ë³µêµ¬ ì„±ê³µ');
                        } else {
                            this.showError('ë°±ì—… íŒŒì¼ë„ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤');
                            await this.showTemplateSelection(siteId);
                        }
                        break;
                        
                    case '2':
                        await this.showTemplateSelection(siteId);
                        break;
                        
                    case '3':
                    default:
                        console.log('[LayoutEditorMain] ë³µêµ¬ ì·¨ì†Œ');
                        break;
                }
            }
            
            onModeChanged(newMode) {
                console.log(`[LayoutEditorMain] ëª¨ë“œ ë³€ê²½: ${newMode}`);
                
                if (newMode === 'editor') {
                    if (this.elements.editorContainer) {
                        this.elements.editorContainer.style.display = 'block';
                    }
                    if (this.elements.viewerContainer) {
                        this.elements.viewerContainer.style.display = 'none';
                    }
                    console.log('[LayoutEditorMain] Editor UI í‘œì‹œ');
                } else if (newMode === 'viewer') {
                    if (this.elements.editorContainer) {
                        this.elements.editorContainer.style.display = 'none';
                    }
                    if (this.elements.viewerContainer) {
                        this.elements.viewerContainer.style.display = 'block';
                    }
                    console.log('[LayoutEditorMain] Viewer UI í‘œì‹œ');
                }
            }
            
            async saveCurrentLayout() {
                const currentLayout = this.state.state.currentLayout;
                const siteId = this.state.state.currentSiteId;
                
                if (!currentLayout || !siteId) {
                    this.showError('ì €ì¥í•  Layoutì´ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                console.log(`[LayoutEditorMain] Layout ì €ì¥: ${siteId}`);
                
                try {
                    await this.fileManager.saveLayout(siteId, currentLayout);
                    this.state.markAsSaved();
                    this.showSuccess(`Layout ì €ì¥ ì™„ë£Œ: ${siteId}.json`);
                } catch (error) {
                    console.error('[LayoutEditorMain] Layout ì €ì¥ ì‹¤íŒ¨:', error);
                    this.showError(`ì €ì¥ ì¤‘ ì˜¤ë¥˜: ${error.message}`);
                }
            }
            
            showSuccess(message) {
                console.log(`[LayoutEditorMain] âœ… ${message}`);
                alert(`âœ… ${message}`);
            }
            
            showError(message) {
                console.error(`[LayoutEditorMain] âŒ ${message}`);
                alert(`âŒ ${message}`);
            }
            
            getDebugInfo() {
                return {
                    mode: this.state.state.mode,
                    siteId: this.state.state.currentSiteId,
                    hasLayout: !!this.state.state.currentLayout,
                    isDirty: this.state.state.isDirty,
                    availableTemplates: this.availableTemplates.length
                };
            }
        }
        
        // ===================================================================
        // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë°”ì¸ë”©
        // ===================================================================
        const layoutEditorMain = new LayoutEditorMain();
        window.layoutEditorMain = layoutEditorMain;
        
        layoutEditorMain.init();
        
        layoutEditorMain.state.subscribe('mode', updateStatusDisplay);
        layoutEditorMain.state.subscribe('currentSiteId', updateStatusDisplay);
        layoutEditorMain.state.subscribe('currentLayout', updateStatusDisplay);
        layoutEditorMain.state.subscribe('isDirty', updateStatusDisplay);
        
        updateStatusDisplay();
        
        function addLog(message, type = 'info') {
            const logDisplay = document.getElementById('log-display');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDisplay.appendChild(logEntry);
            logDisplay.scrollTop = logDisplay.scrollHeight;
        }
        
        function updateStatusDisplay() {
            const debugInfo = layoutEditorMain.getDebugInfo();
            
            const modeEl = document.getElementById('status-mode');
            const siteEl = document.getElementById('status-site');
            const layoutEl = document.getElementById('status-layout');
            const dirtyEl = document.getElementById('status-dirty');
            const templatesEl = document.getElementById('status-templates');
            
            modeEl.textContent = debugInfo.mode || 'None';
            modeEl.className = `status-value ${debugInfo.mode ? 'mode-' + debugInfo.mode : ''}`;
            
            siteEl.textContent = debugInfo.siteId || 'None';
            layoutEl.textContent = debugInfo.hasLayout ? 'Loaded âœ…' : 'Not Loaded âŒ';
            dirtyEl.textContent = debugInfo.isDirty ? 'Unsaved Changes âš ï¸' : 'Saved âœ…';
            dirtyEl.className = `status-value ${debugInfo.isDirty ? 'dirty' : 'clean'}`;
            templatesEl.textContent = `${debugInfo.availableTemplates} Templates`;
        }
        
        window.testGetDebugInfo = function() {
            const debugInfo = layoutEditorMain.getDebugInfo();
            console.log('Debug Info:', debugInfo);
            addLog(`Debug Info: ${JSON.stringify(debugInfo)}`, 'info');
            alert('Debug Info logged to console');
        };
        
        window.testSaveLayout = async function() {
            try {
                await layoutEditorMain.saveCurrentLayout();
                addLog('Layout ì €ì¥ ì„±ê³µ', 'success');
            } catch (error) {
                addLog(`Layout ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        };
        
        window.clearLogs = function() {
            const logDisplay = document.getElementById('log-display');
            logDisplay.innerHTML = '<div class="log-entry info">ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
        };
        
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        addLog('LayoutEditorMain ì´ˆê¸°í™” ì™„ë£Œ', 'success');
    </script>
</body>
</html>