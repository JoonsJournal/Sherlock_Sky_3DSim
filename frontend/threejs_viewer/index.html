<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sherlock Sky 3DSim - ì„¤ë¹„ 3D ì‹œë®¬ë ˆì´ì…˜</title>

	<!-- ============================================
		â­ CSS Import
		============================================ -->
	<link rel="stylesheet" href="src/styles/modal.css">
	<link rel="stylesheet" href="src/styles/connection-panel.css">
	<link rel="stylesheet" href="src/styles/toast.css">
	<!-- â­ ìƒˆë¡œ ì¶”ê°€: Equipment Edit CSS -->
	<link rel="stylesheet" href="src/styles/equipment-edit.css">
	

	<style>
		body {
			margin: 0;
			overflow: hidden;
			font-family: 'Segoe UI', Arial, sans-serif;
			background: #f5f5f5;
		}

		/* â­ í¸ì§‘ ëª¨ë“œ í™œì„±í™” ì‹œ ì»¤ì„œ ë³€ê²½ */
		body.edit-mode-active {
			cursor: crosshair !important;
		}

		body.edit-mode-active canvas {
			cursor: crosshair !important;
		}

		canvas {
			display: block;
			cursor: grab;
		}

		canvas:active {
			cursor: grabbing;
		}

		/* ============================================
			â­ ë§ˆìš°ìŠ¤ ì‚¬ìš©ë²• ì •ë³´ íŒ¨ë„ - ì˜¤ë¥¸ìª½ ìƒë‹¨ìœ¼ë¡œ ì´ë™
		   ============================================ */
		#info {
			position: absolute;
			top: 10px;
			right: 10px;  /* leftì—ì„œ rightë¡œ ë³€ê²½ */
			color: white;
			background: rgba(0, 0, 0, 0.8);
			padding: 15px;
			border-radius: 8px;
			font-size: 14px;
			z-index: 100;
			max-width: 300px;
		}

		#info h3 {
			margin: 0 0 10px 0;
			color: #3498db;
		}

		#info p {
			margin: 5px 0;
		}

		/* ë¡œë”© ìƒíƒœ í‘œì‹œ */
		#loadingStatus {
			position: absolute;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0, 0, 0, 0.9);
			color: #2ecc71;
			padding: 15px 30px;
			border-radius: 25px;
			font-size: 16px;
			font-weight: bold;
			z-index: 100;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
			animation: pulse 2s infinite;
		}

		@keyframes pulse {
			0%, 100% {
				opacity: 1;
			}
			50% {
				opacity: 0.7;
			}
		}

		/* ì„¤ë¹„ ì •ë³´ íŒ¨ë„ */
		#equipmentInfo {
			position: absolute;
			top: 10px;
			right: 10px;
			width: 350px;
			max-height: 85vh;
			overflow-y: auto;
			background: rgba(255, 255, 255, 0.95);
			border-radius: 12px;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
			padding: 20px;
			color: #333;
			display: none;
			z-index: 100;
		}

		#equipmentInfo.active {
			display: block;
			animation: slideIn 0.3s ease-out;
		}

		@keyframes slideIn {
			from {
				transform: translateX(100%);
				opacity: 0;
			}
			to {
				transform: translateX(0);
				opacity: 1;
			}
		}

		#equipmentInfo h2 {
			margin: 0 0 15px 0;
			color: #3498db;
			font-size: 20px;
			border-bottom: 2px solid #3498db;
			padding-bottom: 10px;
		}

		#equipmentInfo .close-btn {
			position: absolute;
			top: 15px;
			right: 15px;
			background: #e74c3c;
			color: white;
			border: none;
			border-radius: 50%;
			width: 30px;
			height: 30px;
			cursor: pointer;
			font-size: 18px;
			line-height: 30px;
			text-align: center;
			transition: background 0.3s;
		}

		#equipmentInfo .close-btn:hover {
			background: #c0392b;
		}

		#equipmentInfo .info-row {
			margin: 10px 0;
			padding: 8px;
			background: #f8f9fa;
			border-radius: 5px;
		}

		#equipmentInfo .info-label {
			font-weight: bold;
			color: #555;
			display: inline-block;
			width: 120px;
		}

		#equipmentInfo .info-value {
			color: #333;
		}

		#equipmentInfo .status-indicator {
			display: inline-block;
			width: 12px;
			height: 12px;
			border-radius: 50%;
			margin-right: 5px;
		}

		#equipmentInfo .status-running {
			background: #2ecc71;
			box-shadow: 0 0 8px #2ecc71;
		}

		#equipmentInfo .status-idle {
			background: #f39c12;
		}

		#equipmentInfo .status-error {
			background: #e74c3c;
			box-shadow: 0 0 8px #e74c3c;
		}

		/* ë‹¤ì¤‘ ì„ íƒ í—¤ë” ìŠ¤íƒ€ì¼ */
		#equipmentInfo .multi-select-header {
			background: #e3f2fd !important;
			border-left: 4px solid #2196F3 !important;
			margin-bottom: 15px !important;
			font-weight: bold;
			color: #1976D2;
		}

		/* ============================================
			â­ ë””ë²„ê·¸ ì»¨íŠ¸ë¡¤ - ì™¼ìª½ ì•„ë˜ë¡œ ì´ë™
		   ============================================ */
		#debugControls {
			position: absolute;
			bottom: 20px;
			left: 80px;  /* debugToggle ì˜¤ë¥¸ìª½ì— ë‚˜íƒ€ë‚˜ë„ë¡ */
			background: rgba(0, 0, 0, 0.8);
			color: white;
			padding: 15px;
			border-radius: 8px;
			font-size: 12px;
			z-index: 100;
			display: none;
		}

		#debugControls.active {
			display: block;
		}

		#debugControls h4 {
			margin: 0 0 10px 0;
			color: #3498db;
			font-size: 14px;
		}

		#debugControls button {
			display: block;
			width: 100%;
			margin: 5px 0;
			padding: 8px;
			background: #3498db;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			transition: background 0.3s;
		}

		#debugControls button:hover {
			background: #2980b9;
		}

		/* ============================================
			â­ ë””ë²„ê·¸ í† ê¸€ ë²„íŠ¼ - ì™¼ìª½ ì•„ë˜ë¡œ ì´ë™
		   ============================================ */
		#debugToggle {
			position: absolute;
			bottom: 20px;
			left: 20px;  /* rightì—ì„œ leftë¡œ ë³€ê²½ */
			background: rgba(52, 152, 219, 0.9);  /* ê¸°ë³¸: íŒŒë€ìƒ‰ */
			color: white;
			border: none;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			font-size: 24px;
			cursor: pointer;
			z-index: 101;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
			transition: all 0.3s;
		}

		#debugToggle:hover {
			background: rgba(41, 128, 185, 0.9);
			transform: scale(1.1);
		}

		#debugToggle.active {
			background: rgba(255, 152, 0, 0.9);  /* í™œì„±í™”: ì£¼í™©ìƒ‰ */
			box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
		}

		/* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
		#equipmentInfo::-webkit-scrollbar {
			width: 8px;
		}

		#equipmentInfo::-webkit-scrollbar-track {
			background: #f1f1f1;
			border-radius: 4px;
		}

		#equipmentInfo::-webkit-scrollbar-thumb {
			background: #888;
			border-radius: 4px;
		}

		#equipmentInfo::-webkit-scrollbar-thumb:hover {
			background: #555;
		}

		/* í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì•ˆë‚´ */
		.keyboard-hint {
			font-size: 11px;
			color: #95a5a6;
			margin-top: 10px;
			padding-top: 10px;
			border-top: 1px solid rgba(255, 255, 255, 0.2);
		}

		/* ë‹¤ì¤‘ ì„ íƒ ê°•ì¡° */
		.multi-select-tip {
			background: #e8f5e9;
			border-left: 4px solid #4caf50;
			padding: 8px;
			margin-top: 10px;
			border-radius: 4px;
			font-size: 12px;
			color: #2e7d32;
		}

		/* ============================================
			â­ Connection Button - ì™¼ìª½ ìƒë‹¨ ìµœìƒìœ„
		   ============================================ */
		#connectionBtn {
			position: absolute;
			top: 10px;  /* ìµœìƒë‹¨ */
			left: 10px;
			background: rgba(52, 152, 219, 0.9);  /* ê¸°ë³¸: íŒŒë€ìƒ‰ */
			color: white;
			border: none;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			font-size: 24px;
			cursor: pointer;
			z-index: 101;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
			transition: all 0.3s;
		}

		#connectionBtn:hover {
			background: rgba(41, 128, 185, 0.9);
			transform: scale(1.1);
		}

		#connectionBtn.active {
			background: rgba(255, 152, 0, 0.9);  /* í™œì„±í™”: ì£¼í™©ìƒ‰ */
			box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
		}

		#connectionBtn::after {
			content: 'Database Connection (Ctrl+K)';
			position: absolute;
			left: 60px;
			top: 50%;
			transform: translateY(-50%);
			background: rgba(0, 0, 0, 0.8);
			color: white;
			padding: 8px 12px;
			border-radius: 6px;
			font-size: 12px;
			white-space: nowrap;
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.2s ease;
		}

		#connectionBtn:hover::after {
			opacity: 1;
		}

		/* ============================================
			â­ Edit Button - connectionBtn ë°”ë¡œ ì•„ë˜
		   ============================================ */
		#editBtn {
			position: absolute;
			top: 70px;  /* connectionBtn ì•„ë˜ */
			left: 10px;
			background: rgba(52, 152, 219, 0.9);  /* ê¸°ë³¸: íŒŒë€ìƒ‰ */
			color: white;
			border: none;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			font-size: 24px;
			cursor: pointer;
			z-index: 101;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
			transition: all 0.3s;
		}

		#editBtn:hover {
			background: rgba(41, 128, 185, 0.9);
			transform: scale(1.1);
		}

		#editBtn.active {
			background: rgba(255, 152, 0, 0.9);  /* í™œì„±í™”: ì£¼í™©ìƒ‰ */
			box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
		}

		#editBtn::after {
			content: 'Equipment Edit Mode (E)';
			position: absolute;
			left: 60px;
			top: 50%;
			transform: translateY(-50%);
			background: rgba(0, 0, 0, 0.8);
			color: white;
			padding: 8px 12px;
			border-radius: 6px;
			font-size: 12px;
			white-space: nowrap;
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.2s ease;
		}

		#editBtn:hover::after {
			opacity: 1;
		}
	</style>
</head>

<body>
	<!-- ============================================
		â­ ë§ˆìš°ìŠ¤ ì‚¬ìš©ë²• ì •ë³´ íŒ¨ë„ - ì˜¤ë¥¸ìª½ ìƒë‹¨
	   ============================================ -->
	<div id="info">
		<h3>ğŸ­ Sherlock Sky 3DSim</h3>
		<p>ğŸ–±ï¸ <strong>ì¢Œí´ë¦­ + ë“œë˜ê·¸:</strong> íšŒì „</p>
		<p>ğŸ–±ï¸ <strong>íœ :</strong> ì¤Œ ì¸/ì•„ì›ƒ</p>
		<p>ğŸ–±ï¸ <strong>ìš°í´ë¦­ + ë“œë˜ê·¸:</strong> ì´ë™</p>
		<p>ğŸ‘† <strong>ì„¤ë¹„ í´ë¦­:</strong> ì •ë³´ ë³´ê¸°</p>

		<div class="multi-select-tip">
			<strong>âœ¨ ë‹¤ì¤‘ ì„ íƒ:</strong><br>
			Ctrl+í´ë¦­ìœ¼ë¡œ ì—¬ëŸ¬ ì„¤ë¹„ ì„ íƒ<br>
			ì„ íƒ ì‹œ í‰ê· ê°’ ìë™ ê³„ì‚°
		</div>

		<div class="keyboard-hint">
			ğŸ’¡ <strong>F12</strong>ë¡œ ì½˜ì†” ì—´ê¸°<br>
			ğŸ’¡ <strong>debugHelp()</strong> ì…ë ¥ìœ¼ë¡œ ëª…ë ¹ì–´ ë³´ê¸°
		</div>
	</div>

	<!-- ë¡œë”© ìƒíƒœ -->
	<div id="loadingStatus">
		ğŸ”„ ì´ˆê¸°í™” ì¤‘...
	</div>

	<!-- ì„¤ë¹„ ì •ë³´ íŒ¨ë„ -->
	<div id="equipmentInfo">
		<button class="close-btn" onclick="closeEquipmentInfo()">Ã—</button>
		<h2 id="equipName">ì„¤ë¹„ ì •ë³´</h2>
		<div id="equipDetails"></div>
	</div>

	<!-- ============================================
		â­ Connection Button - ì™¼ìª½ ìƒë‹¨ ìµœìƒìœ„
		============================================ -->
	<button id="connectionBtn" title="Database Connection (Ctrl+K)">
		ğŸ”Œ
	</button>

	<!-- ============================================
		â­ Equipment Edit Button - Connection ë²„íŠ¼ ì•„ë˜
		============================================ -->
	<button id="editBtn" title="Equipment Edit Mode (E)">
		âœï¸
	</button>

	<!-- ============================================
		â­ ë””ë²„ê·¸ í† ê¸€ ë²„íŠ¼ - ì™¼ìª½ ì•„ë˜
		============================================ -->
	<button id="debugToggle" onclick="toggleDebugPanel()" title="ë””ë²„ê·¸ íŒ¨ë„">
		ğŸ”§
	</button>

	<!-- ============================================
		â­ ë””ë²„ê·¸ ì»¨íŠ¸ë¡¤ íŒ¨ë„ - ë””ë²„ê·¸ ë²„íŠ¼ ì˜¤ë¥¸ìª½
		============================================ -->
	<div id="debugControls">
		<h4>ğŸ”§ ë””ë²„ê·¸ ì»¨íŠ¸ë¡¤</h4>
		<button onclick="window.debugScene()">ğŸ“¦ ì”¬ ì •ë³´</button>
		<button onclick="window.debugRenderer()">ğŸ¨ ë Œë”ëŸ¬ ì •ë³´</button>
		<button onclick="window.getPerformanceStats()">âš¡ ì„±ëŠ¥ ì¸¡ì •</button>
		<button onclick="window.getMemoryInfo()">ğŸ’¾ ë©”ëª¨ë¦¬ ì •ë³´</button>
		<button onclick="window.debugHelp()">â“ ë„ì›€ë§</button>
		<button onclick="window.getSelectedEquipments()">ğŸ“Š ì„ íƒëœ ì„¤ë¹„</button>
		<button onclick="window.clearSelections()">âŒ ì„ íƒ í•´ì œ</button>
	</div>

	<!-- ============================================
		Connection Modal HTML
		============================================ -->
	<div id="connection-modal" class="modal">
		<div class="modal-overlay"></div>
		<div class="modal-content">
			<div class="modal-header">
				<h2>ğŸ”Œ Database Connection Manager</h2>
				<button class="modal-close" aria-label="Close">&times;</button>
			</div>
			<div class="modal-body">
				<!-- Connection Status Panel -->
				<div id="connection-status-panel"></div>
				
				<!-- Site Selection Panel -->
				<div id="site-selection-panel"></div>
				
				<!-- Database List Panel -->
				<div id="database-list-panel"></div>
			</div>
		</div>
	</div>

	<!-- ============================================
		Toast Container
		============================================ -->
	<div id="toast-container"></div>


	<!-- Three.js Import Map -->
	<script type="importmap">
		{
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

	<!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
	<script type="module" src="./src/main.js"></script>

	<script>
		// ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€
		function toggleDebugPanel() {
			const panel = document.getElementById('debugControls');
			const button = document.getElementById('debugToggle');
			panel.classList.toggle('active');
			button.classList.toggle('active');  /* ë²„íŠ¼ í™œì„±í™” ìƒíƒœ í† ê¸€ */
		}

		// ì„¤ë¹„ ì •ë³´ íŒ¨ë„ ë‹«ê¸°
		function closeEquipmentInfo() {
			const panel = document.getElementById('equipmentInfo');
			if (panel) {
				panel.classList.remove('active');
			}

			// ì„ íƒ í•´ì œ
			if (window.clearSelections) {
				window.clearSelections();
			}
		}

		// ë¡œë”© ìƒíƒœ 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
		setTimeout(() => {
			const loadingStatus = document.getElementById('loadingStatus');
			if (loadingStatus) {
				loadingStatus.style.transition = 'opacity 0.5s';
				loadingStatus.style.opacity = '0';
				setTimeout(() => {
					loadingStatus.style.display = 'none';
				}, 500);
			}
		}, 3000);

		// í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
		document.addEventListener('keydown', (event) => {
			// 'D' í‚¤: ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€
			if (event.key === 'd' || event.key === 'D') {
				toggleDebugPanel();
			}
			// ESC í‚¤: ì •ë³´ íŒ¨ë„ ë‹«ê¸°
			if (event.key === 'Escape') {
				closeEquipmentInfo();
			}
			// 'C' í‚¤: ì„ íƒ í•´ì œ
			if (event.key === 'c' || event.key === 'C') {
				if (window.clearSelections) {
					window.clearSelections();
				}
			}
			// â­ ìƒˆë¡œ ì¶”ê°€: 'E' í‚¤: Equipment Edit ëª¨ë“œ í† ê¸€
			if (event.key === 'e' || event.key === 'E') {
				if (window.toggleEditMode) {
					window.toggleEditMode();
				}
			}
		});

		// í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
		window.addEventListener('load', () => {
			console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
			console.log('ğŸ’¡ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤:');
			console.log('   D - ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€');
			console.log('   C - ì„ íƒ í•´ì œ');
			console.log('   E - Equipment Edit ëª¨ë“œ í† ê¸€');
			console.log('   ESC - ì •ë³´ íŒ¨ë„ ë‹«ê¸°');
			console.log('');
			console.log('ğŸ”§ ë””ë²„ê·¸ ëª…ë ¹ì–´:');
			console.log('   debugHelp() - ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ í™•ì¸');
		});

		// ì—ëŸ¬ í•¸ë“¤ë§
		window.addEventListener('error', (event) => {
			console.error('ì „ì—­ ì—ëŸ¬ ë°œìƒ:', event.error);

			// ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê²½ë¡œ íŒíŠ¸
			if (event.message && event.message.includes('Failed to load module')) {
				console.error('âŒ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨!');
				console.error('ğŸ’¡ í•´ê²° ë°©ë²•:');
				console.error('   1. index.htmlì˜ script src ê²½ë¡œ í™•ì¸');
				console.error('   2. í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° í™•ì¸');
				console.error('   3. http-serverë¡œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸ (file:// í”„ë¡œí† ì½œ ì‚¬ìš© ë¶ˆê°€)');
			}
		});
	</script>
</body>

</html>
