<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<!--
 * index.html
 * ==========
 * SHERLOCK SKY 3DSim - Cleanroom Sidebar Theme
 * 
 * @version 5.0.0
 * @created 2026-01-11
 * 
 * [MIGRATION FROM]
 * - ê¸°ì¡´ index.html (Floating Buttons)
 * - test_sidebar_standalone.html v2.10 (Cleanroom Theme)
 * 
 * [FEATURES]
 * - Sidebar-based navigation (Sidebar.js ë™ì  ìƒì„±)
 * - Cover Screen with connection status (CoverScreen.js)
 * - Status Bar with NET/API/DB/FPS/MEM (StatusBar.js)
 * - ê¸°ì¡´ ê¸°ëŠ¥ 100% ë³´ì¡´ (Connection Modal, Edit Mode, etc.)
 * 
 * [PRESERVED FUNCTIONS - from main.js]
 * - toggleEditMode() - Equipment Edit (E key)
 * - toggleMonitoringMode() - Monitoring (M key)
 * - toggleConnectionModal() - Connection (Ctrl+K)
 * - toggleDebugPanel() - Debug (D key)
 * - appModeManager - ì¤‘ì•™ ëª¨ë“œ ê´€ë¦¬
 * 
 * ìœ„ì¹˜: frontend/threejs_viewer/index.html
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ­ Sherlock Sky 3DSim v5.0</title>
    
    <!-- ============================================
         í†µí•© ìŠ¤íƒ€ì¼ì‹œíŠ¸ (CSS ë³€ìˆ˜ + ì»´í¬ë„ŒíŠ¸)
         styles/main.cssì—ì„œ ëª¨ë“  CSSë¥¼ import
         ============================================ -->
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <!-- ============================================
         LAYER 1: Global Notifications (ìµœìƒìœ„)
         ============================================ -->
    
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Dev Mode Badge -->
    <div class="dev-mode-badge" id="dev-mode-badge">âš¡ DEV MODE</div>
    
    <!-- ============================================
         LAYER 2: Main Layout (Flex: Sidebar + Content)
         ============================================ -->
    
    <!-- SIDEBAR: Sidebar.jsê°€ ë™ì  ìƒì„± -->
    <aside class="sidebar" id="sidebar">
        <!-- 
            Sidebar.jsì—ì„œ innerHTMLë¡œ ìƒì„±ë¨
            ë˜ëŠ” main.js ì´ˆê¸°í™” ì „ê¹Œì§€ ë¹ˆ ìƒíƒœ ìœ ì§€
            
            êµ¬ì¡° ì˜ˆì‹œ:
            - btn-connection (Database ì—°ê²°)
            - btn-monitoring (Monitoring + submenu)
            - btn-analysis (ë¶„ì„ - disabled)
            - btn-simulation (ì‹œë®¬ë ˆì´ì…˜ - disabled)
            - btn-layout (Layout Editor - Dev Mode)
            - btn-debug (Debug + submenu)
            - btn-settings (Settings + Theme toggle)
        -->
    </aside>
    
    <!-- MAIN CONTENT -->
    <main class="main-content" id="main-content">
        <!-- ==========================================
             Cover Screen: CoverScreen.jsê°€ ë™ì  ìƒì„±
             - ì—°ê²° ì „ ê¸°ë³¸ í™”ë©´
             - API/DB ìƒíƒœ í‘œì‹œ
             - Ctrl+K íŒíŠ¸
             ========================================== -->
        <div id="cover-screen">
            <!-- CoverScreen.jsì—ì„œ innerHTMLë¡œ ìƒì„± ë˜ëŠ” ì•„ë˜ ì •ì  ë‚´ìš© ì‚¬ìš© -->
            <div class="cover-logo">ğŸ­</div>
            <div class="cover-title">SHERLOCK SKY 3D SIM</div>
            <div class="cover-subtitle">Industrial Equipment Monitoring & Simulation Platform</div>
            
            <div class="cover-status">
                <div class="cover-status-item">
                    <span class="cover-status-dot disconnected" id="cover-api-dot"></span>
                    <span class="cover-status-text">Backend API</span>
                    <span class="cover-status-value" id="cover-api-status">Checking...</span>
                </div>
                <div class="cover-status-item">
                    <span class="cover-status-dot disconnected" id="cover-db-dot"></span>
                    <span class="cover-status-text">Database</span>
                    <span class="cover-status-value" id="cover-db-status">Not Connected</span>
                </div>
            </div>
            
            <div class="cover-hint">
                Press <kbd>Ctrl+K</kbd> to connect database, or select <kbd>Monitoring â†’ 3D View</kbd> after connection
            </div>
        </div>
        
        <!-- ==========================================
             Three.js Container
             - Monitoring â†’ 3D View ì„ íƒ ì‹œ í‘œì‹œ
             - ê¸°ì¡´ main.jsì—ì„œ ì´ˆê¸°í™”
             ========================================== -->
        <div id="threejs-container"></div>
        
        <!-- ==========================================
             Overlay UI (3D View ìœ„ì— í‘œì‹œ)
             - Mode Indicator
             - Test Controls (Dev Mode)
             ========================================== -->
        <div class="overlay-ui" id="overlay-ui">
            <div class="mode-indicator">
                <div class="mode-label">Current Mode</div>
                <div class="mode-value" id="current-mode">â€”</div>
                <div class="submode-value" id="current-submode"></div>
            </div>
        </div>
    </main>
    
    <!-- ============================================
         LAYER 3: Modals & Panels (ê¸°ì¡´ êµ¬ì¡° ìœ ì§€)
         ============================================ -->
    
    <!-- ==========================================
         CONNECTION MODAL (ê¸°ì¡´ main.js ë¡œì§ ì‚¬ìš©)
         - Ctrl+Kë¡œ ì—´ê¸°/ë‹«ê¸°
         - ConnectionModal.jsì—ì„œ ë™ì  ì±„ì›€
         ========================================== -->
    <div id="connection-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ”Œ Database Connection Manager</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Connection Status Panel -->
                <div id="connection-status-panel"></div>
                
                <!-- Site Selection Panel -->
                <div id="site-selection-panel"></div>
                
                <!-- Database List Panel -->
                <div id="database-list-panel"></div>
            </div>
        </div>
    </div>
    
    <!-- ==========================================
         EQUIPMENT INFO PANEL (ê¸°ì¡´ êµ¬ì¡° ìœ ì§€)
         - ì„¤ë¹„ í´ë¦­ ì‹œ í‘œì‹œ
         - EquipmentInfoPanel.jsì—ì„œ ë™ì  ì±„ì›€
         ========================================== -->
    <div id="equipmentInfo">
        <button class="close-btn" onclick="closeEquipmentInfo()">Ã—</button>
        <h2 id="equipName">ì„¤ë¹„ ì •ë³´</h2>
        <div id="equipDetails"></div>
    </div>
    
    <!-- ==========================================
         DEBUG PANEL
         - D í‚¤ë¡œ í† ê¸€
         - DebugPanel.js ë˜ëŠ” ê¸°ì¡´ debugControls
         ========================================== -->
    <div id="debug-panel">
        <div class="debug-panel-header">
            <span class="debug-panel-title">ğŸ› Debug Panel</span>
            <button class="close-btn" onclick="toggleDebugPanel()">Ã—</button>
        </div>
        <div class="debug-panel-content">
            <div class="debug-section">
                <div class="debug-section-title">ğŸ“Š Application State</div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Mode:</span>
                    <span class="debug-state-value" id="debug-mode">N/A</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">SubMode:</span>
                    <span class="debug-state-value" id="debug-submode">N/A</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Connected:</span>
                    <span class="debug-state-value off" id="debug-connected">NO</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Dev Mode:</span>
                    <span class="debug-state-value off" id="debug-devmode">OFF</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">3D Active:</span>
                    <span class="debug-state-value off" id="debug-3d">NO</span>
                </div>
            </div>
            <div class="debug-section">
                <div class="debug-section-title">âš¡ Performance</div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Time:</span>
                    <span class="debug-state-value" id="debug-time">-</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Memory:</span>
                    <span class="debug-state-value" id="debug-memory">-</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ==========================================
         ê¸°ì¡´ DEBUG CONTROLS (ë ˆê±°ì‹œ í˜¸í™˜)
         - ê¸°ì¡´ ì½”ë“œì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ ì§€
         - hidden ìƒíƒœë¡œ ì‹œì‘
         ========================================== -->
    <div id="debugControls" style="display: none;">
        <h4>ğŸ”§ ë””ë²„ê·¸ ì»¨íŠ¸ë¡¤</h4>
        <button onclick="window.debugScene?.()">ğŸ“¦ ì”¬ ì •ë³´</button>
        <button onclick="window.debugRenderer?.()">ğŸ¨ ë Œë”ëŸ¬ ì •ë³´</button>
        <button onclick="window.getPerformanceStats?.()">âš¡ ì„±ëŠ¥ ì¸¡ì •</button>
        <button onclick="window.getMemoryInfo?.()">ğŸ’¾ ë©”ëª¨ë¦¬ ì •ë³´</button>
        <button onclick="window.debugHelp?.()">â“ ë„ì›€ë§</button>
        <button onclick="window.getSelectedEquipments?.()">ğŸ“Š ì„ íƒëœ ì„¤ë¹„</button>
        <button onclick="window.clearSelections?.()">âŒ ì„ íƒ í•´ì œ</button>
    </div>
    
    <!-- ==========================================
         PREVIEW MODAL (Editor ëª¨ë“œìš©)
         - P í‚¤ë¡œ ì—´ê¸°
         - Layout Editorì—ì„œ 3D ë¯¸ë¦¬ë³´ê¸°
         ========================================== -->
    <div id="preview-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content preview-modal-content">
            <div class="modal-header preview-header">
                <h2>ğŸ” 3D Preview - ì €ì¥ ì „ ë¯¸ë¦¬ë³´ê¸°</h2>
                <button class="modal-close" id="preview-close">&times;</button>
            </div>
            <div class="modal-body preview-body">
                <div class="preview-controls">
                    <button class="preview-view-btn" data-view="perspective" title="ì›ê·¼ ë·°">â†» ì›ê·¼</button>
                    <button class="preview-view-btn" data-view="top" title="ìœ„ì—ì„œ ë³´ê¸°">â¬†ï¸ Top</button>
                    <button class="preview-view-btn" data-view="front" title="ì•ì—ì„œ ë³´ê¸°">â¡ï¸ Front</button>
                    <button class="preview-view-btn" data-view="side" title="ì˜†ì—ì„œ ë³´ê¸°">â¬‡ï¸ Side</button>
                </div>
                <div class="preview-canvas-container">
                    <canvas id="preview-canvas"></canvas>
                </div>
                <div class="preview-info-panel">
                    <div class="preview-info-title">ğŸ“‹ ë³€ê²½ì‚¬í•­ ìš”ì•½</div>
                    <div id="preview-summary">
                        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                    </div>
                    <div class="preview-notice">
                        <span class="notice-icon">â„¹ï¸</span>
                        <span>ë¯¸ë¦¬ë³´ê¸°ì…ë‹ˆë‹¤. ì €ì¥ í›„ ì‹¤ì œ 3D Viewerì— ì ìš©ë©ë‹ˆë‹¤.</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer preview-footer">
                <button class="btn btn-secondary" id="preview-back-edit">
                    âœï¸ Back to Edit
                </button>
                <button class="btn btn-primary" id="preview-save-apply">
                    ğŸ’¾ Save & Apply
                </button>
            </div>
        </div>
    </div>
    
    <!-- ==========================================
         COMPONENT PALETTE (Editor ëª¨ë“œìš©)
         - Layout Editorì—ì„œ ì»´í¬ë„ŒíŠ¸ ì„ íƒ
         ========================================== -->
    <div id="component-palette" class="hidden">
        <!-- ComponentPalette.jsê°€ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
    </div>
    
    <!-- ==========================================
         ë¡œë”© ìƒíƒœ (ê¸°ì¡´ í˜¸í™˜)
         - ì´ˆê¸°í™” ì¤‘ í‘œì‹œ, 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
         ========================================== -->
    <div id="loadingStatus" style="display: none;">
        ğŸ”„ ì´ˆê¸°í™” ì¤‘...
    </div>
    
    <!-- ============================================
         LAYER 4: Status Bar
         StatusBar.jsê°€ ë™ì  ìƒì„±
         ============================================ -->
    <footer class="status-bar" id="status-bar">
        <!-- StatusBar.jsì—ì„œ innerHTMLë¡œ ìƒì„± ë˜ëŠ” ì•„ë˜ ì •ì  ë‚´ìš© ì‚¬ìš© -->
        <div class="status-group">
            <div class="status-item">
                <span class="country-code" id="status-country">KR</span>
            </div>
            <div class="status-item">
                <span class="status-dot connected" id="net-dot"></span>
                <span class="status-label">NET</span>
                <span class="status-value" id="net-value">Online</span>
            </div>
            <div class="status-item">
                <span class="status-dot disconnected" id="api-dot"></span>
                <span class="status-label">API</span>
                <span class="status-value" id="api-value">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-dot disconnected" id="db-dot"></span>
                <span class="status-label">DB</span>
                <span class="status-value" id="db-value">None</span>
            </div>
        </div>
        <div class="status-group">
            <div class="status-item">
                <span class="status-label">FPS</span>
                <span class="status-value" id="fps-value">60</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="fps-bar" style="width: 100%;"></div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-label">MEM</span>
                <span class="status-value"><span id="memory-value">128</span>MB</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="memory-bar" style="width: 30%;"></div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- ============================================
         ê¸°ì¡´ FLOATING BUTTONS (ë ˆê±°ì‹œ í˜¸í™˜)
         ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•´ hidden ìƒíƒœë¡œ ìœ ì§€
         Sidebar ì™„ì „ ì ìš© í›„ ì œê±° ì˜ˆì •
         ============================================ -->
    <div id="legacy-floating-buttons" style="display: none;">
        <!-- Connection Button -->
        <button id="connectionBtn" class="floating-btn" title="Database Connection (Ctrl+K)">
            ğŸ”Œ
        </button>
        
        <!-- Equipment Edit Button -->
        <button id="editBtn" class="floating-btn" title="Equipment Edit Mode (E)">
            âœï¸
        </button>
        
        <!-- Monitoring Button -->
        <button id="monitoringBtn" class="floating-btn" title="Monitoring Mode (M)">
            ğŸš¨
        </button>
        
        <!-- Preview Button (Editor ëª¨ë“œ) -->
        <button id="previewBtn" class="floating-btn" title="3D Preview (P)">
            ğŸ”
        </button>
        
        <!-- Debug Toggle Button -->
        <button id="debugToggle" class="floating-btn" title="ë””ë²„ê·¸ íŒ¨ë„ (D)">
            ğŸ”§
        </button>
    </div>
    
    <!-- ============================================
         ê¸°ì¡´ INFO PANEL (ë ˆê±°ì‹œ í˜¸í™˜)
         Sidebar ì™„ì „ ì ìš© í›„ ì œê±° ì˜ˆì •
         ============================================ -->
    <div id="info" style="display: none;">
        <h3>ğŸ­ Sherlock Sky 3DSim</h3>
        <p>ğŸ–±ï¸ <strong>ì¢Œí´ë¦­ + ë“œë˜ê·¸:</strong> íšŒì „</p>
        <p>ğŸ–±ï¸ <strong>íœ :</strong> ì¤Œ ì¸/ì•„ì›ƒ</p>
        <p>ğŸ–±ï¸ <strong>ìš°í´ë¦­ + ë“œë˜ê·¸:</strong> ì´ë™</p>
        <p>ğŸ‘† <strong>ì„¤ë¹„ í´ë¦­:</strong> ì •ë³´ ë³´ê¸°</p>
    </div>
    
    <!-- ============================================
         SCRIPTS
         ============================================ -->
    
    <!-- Three.js Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <!-- ==========================================
         í˜¸í™˜ì„± ìœ ì§€ë¥¼ ìœ„í•œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸
         - ê¸°ì¡´ index.htmlì˜ ì „ì—­ í•¨ìˆ˜
         - main.js ì´ˆê¸°í™” ì „ ì„ì‹œ stub
         ========================================== -->
    <script>
        // =============================================
        // ì „ì—­ ìƒíƒœ (Sidebarì™€ ì—°ë™)
        // =============================================
        window.sidebarState = {
            currentMode: null,
            currentSubMode: null,
            isConnected: false,
            devModeEnabled: false,
            debugPanelVisible: false
        };
        
        // =============================================
        // ê¸°ì¡´ ì „ì—­ í•¨ìˆ˜ - main.jsì—ì„œ ì˜¤ë²„ë¼ì´ë“œë¨
        // =============================================
        
        /**
         * ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€ (ë ˆê±°ì‹œ í˜¸í™˜ + Sidebar ì—°ë™)
         */
        function toggleDebugPanel() {
            // main.jsì˜ debugManagerë¡œ ìœ„ì„ (ìˆìœ¼ë©´)
            if (window.debugManager?.toggle) {
                window.debugManager.toggle();
                return;
            }
            
            // Sidebarìš© Debug Panel í† ê¸€
            const panel = document.getElementById('debug-panel');
            if (panel) {
                window.sidebarState.debugPanelVisible = !window.sidebarState.debugPanelVisible;
                panel.classList.toggle('active', window.sidebarState.debugPanelVisible);
            }
            
            // ë ˆê±°ì‹œ debugControls (ìˆìœ¼ë©´)
            const legacyPanel = document.getElementById('debugControls');
            const legacyBtn = document.getElementById('debugToggle');
            if (legacyPanel) {
                legacyPanel.classList.toggle('active');
            }
            if (legacyBtn) {
                legacyBtn.classList.toggle('active');
            }
        }
        
        /**
         * ì„¤ë¹„ ì •ë³´ íŒ¨ë„ ë‹«ê¸° (ë ˆê±°ì‹œ í˜¸í™˜)
         */
        function closeEquipmentInfo() {
            const panel = document.getElementById('equipmentInfo');
            if (panel) {
                panel.classList.remove('active');
            }
            
            // main.jsì˜ equipmentInfoPanelë¡œ ìœ„ì„ (ìˆìœ¼ë©´)
            if (window.equipmentInfoPanel?.hide) {
                window.equipmentInfoPanel.hide();
            }
            
            // ì„ íƒ í•´ì œ
            if (window.clearSelections) {
                window.clearSelections();
            }
        }
        
        /**
         * Preview Modal ë‹«ê¸° (ë ˆê±°ì‹œ í˜¸í™˜)
         */
        function closePreviewModal() {
            const modal = document.getElementById('preview-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
            
            // main.jsì˜ previewGeneratorë¡œ ìœ„ì„ (ìˆìœ¼ë©´)
            if (window.previewGenerator?.close) {
                window.previewGenerator.close();
            }
        }
        
        // =============================================
        // í…Œë§ˆ ê´€ë¦¬ (Sidebar Settingsì™€ ì—°ë™)
        // =============================================
        
        /**
         * í…Œë§ˆ í† ê¸€
         */
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // í…Œë§ˆ ìŠ¤ìœ„ì¹˜ UI ì—…ë°ì´íŠ¸ (Sidebarì— ìˆìœ¼ë©´)
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                themeSwitch.classList.toggle('active', newTheme === 'light');
            }
            
            // Three.js ì”¬ ë°°ê²½ìƒ‰ ì—…ë°ì´íŠ¸ (ìˆìœ¼ë©´)
            if (window.sceneManager?.scene) {
                const bgColor = newTheme === 'dark' ? 0x1e293b : 0xf1f5f9;
                window.sceneManager.scene.background = new THREE.Color(bgColor);
            }
            
            console.log(`ğŸ¨ Theme changed to: ${newTheme}`);
        }
        
        /**
         * ì €ì¥ëœ í…Œë§ˆ ë¡œë“œ
         */
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) {
                themeSwitch.classList.toggle('active', savedTheme === 'light');
            }
        }
        
        // =============================================
        // Cover Screen ìƒíƒœ ê´€ë¦¬
        // =============================================
        
        /**
         * Cover Screen í‘œì‹œ
         */
        function showCoverScreen() {
            const coverScreen = document.getElementById('cover-screen');
            const threejsContainer = document.getElementById('threejs-container');
            const overlayUI = document.getElementById('overlay-ui');
            
            if (coverScreen) coverScreen.classList.remove('hidden');
            if (threejsContainer) threejsContainer.classList.remove('active');
            if (overlayUI) overlayUI.style.display = 'none';
        }
        
        /**
         * 3D View í‘œì‹œ
         */
        function show3DView() {
            const coverScreen = document.getElementById('cover-screen');
            const threejsContainer = document.getElementById('threejs-container');
            const overlayUI = document.getElementById('overlay-ui');
            
            if (coverScreen) coverScreen.classList.add('hidden');
            if (threejsContainer) threejsContainer.classList.add('active');
            if (overlayUI) overlayUI.style.display = 'flex';
        }
        
        /**
         * Cover Screen API ìƒíƒœ ì—…ë°ì´íŠ¸
         */
        function updateCoverStatus(apiConnected, dbConnected, dbName) {
            const apiDot = document.getElementById('cover-api-dot');
            const apiStatus = document.getElementById('cover-api-status');
            const dbDot = document.getElementById('cover-db-dot');
            const dbStatus = document.getElementById('cover-db-status');
            
            if (apiDot) {
                apiDot.classList.toggle('connected', apiConnected);
                apiDot.classList.toggle('disconnected', !apiConnected);
            }
            if (apiStatus) {
                apiStatus.textContent = apiConnected ? 'Connected' : 'Disconnected';
            }
            
            if (dbDot) {
                dbDot.classList.toggle('connected', dbConnected);
                dbDot.classList.toggle('disconnected', !dbConnected);
            }
            if (dbStatus) {
                dbStatus.textContent = dbConnected ? (dbName || 'Connected') : 'Not Connected';
            }
        }
        
        // =============================================
        // Status Bar ì—…ë°ì´íŠ¸
        // =============================================
        
        /**
         * Status Bar API/DB ìƒíƒœ ì—…ë°ì´íŠ¸
         */
        function updateStatusBar(apiConnected, dbConnected, siteId) {
            const apiDot = document.getElementById('api-dot');
            const apiValue = document.getElementById('api-value');
            const dbDot = document.getElementById('db-dot');
            const dbValue = document.getElementById('db-value');
            
            if (apiDot) {
                apiDot.classList.toggle('connected', apiConnected);
                apiDot.classList.toggle('disconnected', !apiConnected);
            }
            if (apiValue) {
                apiValue.textContent = apiConnected ? 'Connected' : 'Disconnected';
            }
            
            if (dbDot) {
                dbDot.classList.toggle('connected', dbConnected);
                dbDot.classList.toggle('disconnected', !dbConnected);
            }
            if (dbValue) {
                dbValue.textContent = siteId ? siteId.replace(/_/g, '-').toUpperCase() : 'None';
            }
        }
        
        // =============================================
        // Mode Indicator ì—…ë°ì´íŠ¸
        // =============================================
        
        /**
         * í˜„ì¬ ëª¨ë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
         */
        function updateModeIndicator(mode, submode) {
            const modeValue = document.getElementById('current-mode');
            const submodeValue = document.getElementById('current-submode');
            
            if (modeValue) {
                modeValue.textContent = mode ? (mode.charAt(0).toUpperCase() + mode.slice(1)) : 'â€”';
            }
            if (submodeValue) {
                submodeValue.textContent = submode ? `â†’ ${submode}` : '';
            }
            
            window.sidebarState.currentMode = mode;
            window.sidebarState.currentSubMode = submode;
        }
        
        // =============================================
        // Dev Mode í† ê¸€
        // =============================================
        
        /**
         * Dev Mode í† ê¸€
         */
        function toggleDevMode() {
            window.sidebarState.devModeEnabled = !window.sidebarState.devModeEnabled;
            
            const badge = document.getElementById('dev-mode-badge');
            const layoutWrapper = document.getElementById('btn-layout-wrapper');
            const devModeLabel = document.getElementById('dev-mode-label');
            const mockTestSection = document.getElementById('mock-test-section');
            
            if (badge) {
                badge.classList.toggle('active', window.sidebarState.devModeEnabled);
            }
            
            if (layoutWrapper) {
                layoutWrapper.classList.toggle('hidden', !window.sidebarState.devModeEnabled);
                if (window.sidebarState.isConnected && window.sidebarState.devModeEnabled) {
                    layoutWrapper.classList.remove('disabled');
                }
            }
            
            if (devModeLabel) {
                devModeLabel.textContent = `Dev Mode: ${window.sidebarState.devModeEnabled ? 'ON' : 'OFF'}`;
            }
            
            if (mockTestSection) {
                mockTestSection.style.display = window.sidebarState.devModeEnabled ? 'block' : 'none';
            }
            
            // Toast ì•Œë¦¼ (ìˆìœ¼ë©´)
            if (window.toast) {
                if (window.sidebarState.devModeEnabled) {
                    window.toast.show('Dev Mode ON', 'warning');
                } else {
                    window.toast.show('Dev Mode OFF', 'info');
                }
            }
            
            console.log(`âš¡ Dev Mode: ${window.sidebarState.devModeEnabled ? 'ON' : 'OFF'}`);
        }
        
        // =============================================
        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (ê¸°ë³¸ - main.jsì—ì„œ í™•ì¥ë¨)
        // =============================================
        
        document.addEventListener('keydown', (event) => {
            // ì…ë ¥ í•„ë“œì—ì„œëŠ” ë¬´ì‹œ
            if (event.target.matches('input, textarea, select')) return;
            
            const key = event.key.toLowerCase();
            
            // Ctrl+K: Connection Modal
            if ((event.ctrlKey || event.metaKey) && key === 'k') {
                event.preventDefault();
                
                // main.jsì˜ toggleConnectionModalë¡œ ìœ„ì„ (ìˆìœ¼ë©´)
                if (window.toggleConnectionModal) {
                    window.toggleConnectionModal();
                } else {
                    // Sidebarì—ì„œ Connection Modal ì—´ê¸°
                    const modal = document.getElementById('connection-modal');
                    if (modal) {
                        modal.classList.toggle('active');
                    }
                }
                return;
            }
            
            // ESC: ëª¨ë‹¬/íŒ¨ë„ ë‹«ê¸°
            if (key === 'escape') {
                // Connection Modal ë‹«ê¸°
                const connModal = document.getElementById('connection-modal');
                if (connModal?.classList.contains('active')) {
                    connModal.classList.remove('active');
                    return;
                }
                
                // Preview Modal ë‹«ê¸°
                const previewModal = document.getElementById('preview-modal');
                if (previewModal && !previewModal.classList.contains('hidden')) {
                    closePreviewModal();
                    return;
                }
                
                // Equipment Info ë‹«ê¸°
                const equipInfo = document.getElementById('equipmentInfo');
                if (equipInfo?.classList.contains('active')) {
                    closeEquipmentInfo();
                    return;
                }
                
                // Debug Panel ë‹«ê¸°
                if (window.sidebarState.debugPanelVisible) {
                    toggleDebugPanel();
                    return;
                }
            }
            
            // ì—°ê²° ìƒíƒœ ë˜ëŠ” Dev Modeì—ì„œë§Œ ì‘ë™í•˜ëŠ” ë‹¨ì¶•í‚¤
            if (!window.sidebarState.isConnected && !window.sidebarState.devModeEnabled) {
                return;
            }
            
            // D: Debug Panel í† ê¸€
            if (key === 'd') {
                toggleDebugPanel();
                return;
            }
            
            // E: Equipment Edit Mode í† ê¸€
            if (key === 'e') {
                if (window.toggleEditMode) {
                    window.toggleEditMode();
                }
                return;
            }
            
            // M: Monitoring Mode í† ê¸€
            if (key === 'm') {
                if (window.toggleMonitoringMode) {
                    window.toggleMonitoringMode();
                }
                return;
            }
            
            // P: Preview í‘œì‹œ (Editor ëª¨ë“œì—ì„œ)
            if (key === 'p') {
                if (window.showPreview3D) {
                    window.showPreview3D();
                }
                return;
            }
        });
        
        // =============================================
        // ì´ˆê¸°í™”
        // =============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ­ Sherlock Sky 3DSim v5.0 - Cleanroom Sidebar Theme');
            
            // ì €ì¥ëœ í…Œë§ˆ ë¡œë“œ
            loadSavedTheme();
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì´ˆê¸°í™”
            const netDot = document.getElementById('net-dot');
            const netValue = document.getElementById('net-value');
            if (netDot) {
                netDot.classList.toggle('connected', navigator.onLine);
                netDot.classList.toggle('disconnected', !navigator.onLine);
            }
            if (netValue) {
                netValue.textContent = navigator.onLine ? 'Online' : 'Offline';
            }
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ë³€ê²½ ê°ì§€
            window.addEventListener('online', () => {
                if (netDot) {
                    netDot.classList.add('connected');
                    netDot.classList.remove('disconnected');
                }
                if (netValue) netValue.textContent = 'Online';
            });
            
            window.addEventListener('offline', () => {
                if (netDot) {
                    netDot.classList.remove('connected');
                    netDot.classList.add('disconnected');
                }
                if (netValue) netValue.textContent = 'Offline';
            });
            
            // ì„±ëŠ¥ ì§€í‘œ ì‹œë®¬ë ˆì´ì…˜ (StatusBar.jsê°€ ì´ˆê¸°í™”ë˜ê¸° ì „)
            setInterval(() => {
                const fpsValue = document.getElementById('fps-value');
                const memValue = document.getElementById('memory-value');
                
                if (fpsValue) {
                    fpsValue.textContent = 58 + Math.floor(Math.random() * 5);
                }
                if (memValue) {
                    memValue.textContent = 128 + Math.floor((Math.random() - 0.5) * 20);
                }
            }, 2000);
            
            console.log('ğŸ’¡ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤:');
            console.log('   Ctrl+K - Connection Modal');
            console.log('   D - Debug Panel');
            console.log('   E - Equipment Edit Mode');
            console.log('   M - Monitoring Mode');
            console.log('   P - Preview (Editor Mode)');
            console.log('   ESC - ëª¨ë‹¬/íŒ¨ë„ ë‹«ê¸°');
        });
        
        // =============================================
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ
        // =============================================
        
        window.addEventListener('load', () => {
            console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            console.log('ğŸ“¦ main.js ëª¨ë“ˆ ë¡œë”© ì‹œì‘...');
        });
        
        // =============================================
        // ì—ëŸ¬ í•¸ë“¤ë§
        // =============================================
        
        window.addEventListener('error', (event) => {
            console.error('âŒ ì „ì—­ ì—ëŸ¬ ë°œìƒ:', event.error);
            
            if (event.message && event.message.includes('Failed to load module')) {
                console.error('âŒ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨!');
                console.error('ğŸ’¡ í•´ê²° ë°©ë²•:');
                console.error('   1. http-serverë¡œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸');
                console.error('   2. íŒŒì¼ ê²½ë¡œ í™•ì¸');
                console.error('   3. ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ (Ctrl+Shift+R)');
            }
        });
    </script>
    
    <!-- ==========================================
         ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ (ES Module)
         - ê¸°ì¡´ main.js ê·¸ëŒ€ë¡œ ì‚¬ìš©
         - ìœ„ ì „ì—­ í•¨ìˆ˜ë“¤ì„ ì˜¤ë²„ë¼ì´ë“œ
         ========================================== -->
    <script type="module" src="./src/main.js"></script>
</body>

</html>