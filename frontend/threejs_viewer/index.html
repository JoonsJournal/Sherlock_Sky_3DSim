<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<!--
 * index.html
 * ==========
 * SHERLOCK SKY 3DSim - Cleanroom Sidebar Theme
 * 
 * @version 5.0.1
 * @created 2026-01-11
 * 
 * @changelog
 * - v5.0.1: üîß ÌïòÏù¥Î∏åÎ¶¨Îìú Î∞©Ïãù Ï†ÅÏö©
 *           - Sidebar Ï†ïÏ†Å HTML Ï∂îÍ∞Ä
 *           - Settings Ìï≠ÏÉÅ ÌôúÏÑ±Ìôî
 *           - Dev Mode: Connect ÏóÜÏù¥ Ï†ÑÏ≤¥ Í∏∞Îä• ÏÇ¨Ïö©
 *           - Ïù∏ÎùºÏù∏ Ïä§ÌÅ¨Î¶ΩÌä∏: Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
 *           - main.js: Í≥†Í∏â Í∏∞Îä• Ïó∞Í≤∞
 * - v5.0.0: Cleanroom Sidebar Theme ÌÜµÌï©
 * 
 * ÏúÑÏπò: frontend/threejs_viewer/index.html
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ Sherlock Sky 3DSim v5.0</title>
    
    <!-- ÌÜµÌï© Ïä§ÌÉÄÏùºÏãúÌä∏ -->
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- =============================================
         Sidebar Ïä§ÌÉÄÏùº (Ïù∏ÎùºÏù∏ - main.css Î≥¥ÏôÑ)
         ============================================= -->
    <style>
        /* CSS Variables */
        :root, [data-theme="dark"] {
            --bg-sidebar: #0F172A;
            --bg-main: #1e293b;
            --bg-main-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --bg-panel: #1E293B;
            --bg-panel-header: rgba(0,0,0,0.2);
            --bg-input: rgba(255,255,255,0.05);
            --bg-hover: rgba(255,255,255,0.05);
            --bg-selected: rgba(6, 182, 212, 0.1);
            --border-color: rgba(255,255,255,0.1);
            --border-subtle: rgba(255,255,255,0.05);
            --icon-normal: #E2E8F0;
            --icon-selected: #06B6D4;
            --icon-disabled: #334155;
            --icon-hover: #FFFFFF;
            --text-primary: #E2E8F0;
            --text-secondary: #9CA3AF;
            --text-muted: #6B7280;
            --text-normal: #CBD5E1;
            --text-warning: #FBBF24;
            --text-alarm: #F87171;
            --text-success: #4ADE80;
            --shadow-color: rgba(0,0,0,0.5);
            --glow-color: rgba(6, 182, 212, 0.4);
            --icon-size: 36px;
            --transition-speed: 0.25s;
            --status-bar-height: 36px;
        }
        
        [data-theme="light"] {
            --bg-sidebar: #F8FAFC;
            --bg-main: #FFFFFF;
            --bg-main-gradient: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%);
            --bg-panel: #FFFFFF;
            --bg-panel-header: rgba(0,0,0,0.02);
            --bg-input: rgba(0,0,0,0.03);
            --bg-hover: rgba(0,0,0,0.05);
            --border-color: rgba(0,0,0,0.1);
            --icon-normal: #475569;
            --icon-selected: #0891B2;
            --icon-disabled: #CBD5E1;
            --icon-hover: #0F172A;
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-muted: #94A3B8;
            --text-alarm: #DC2626;
            --text-success: #16A34A;
            --shadow-color: rgba(0,0,0,0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; height: 100vh; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: var(--bg-main); }
        
        /* Sidebar */
        .sidebar { width: 80px; background-color: var(--bg-sidebar); display: flex; flex-direction: column; align-items: center; padding-top: 24px; z-index: 10; box-shadow: 4px 0 15px var(--shadow-color); }
        .icon-btn { width: 54px; height: 54px; margin-bottom: 12px; background: transparent; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative; transition: transform var(--transition-speed) cubic-bezier(0.34, 1.56, 0.64, 1); }
        .icon-btn svg { width: var(--icon-size); height: var(--icon-size); fill: none; stroke: var(--icon-normal); stroke-width: 1px; stroke-linecap: round; stroke-linejoin: round; transition: all var(--transition-speed); }
        .icon-btn:not(.selected):not(.disabled):hover { transform: scale(1.1) translateY(-3px); }
        .icon-btn:not(.selected):not(.disabled):hover svg { stroke: var(--icon-hover); filter: drop-shadow(0 0 3px var(--glow-color)); }
        .icon-btn.selected { transform: scale(1.08) translateY(-2px); }
        .icon-btn.selected svg { stroke: var(--icon-selected); filter: drop-shadow(0 0 6px var(--icon-selected)); }
        .icon-btn.selected::before { content: ''; position: absolute; left: -13px; width: 3px; height: 28px; background-color: var(--icon-selected); border-radius: 0 3px 3px 0; box-shadow: 0 0 6px var(--icon-selected); }
        .icon-btn.disabled { cursor: not-allowed; opacity: 0.4; pointer-events: none; }
        .icon-btn.disabled svg { stroke: var(--icon-disabled); }

        /* Submenu */
        .has-submenu { position: relative; }
        .submenu { position: absolute; left: 70px; top: 0; background: var(--bg-sidebar); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px 0; min-width: 200px; opacity: 0; visibility: hidden; transform: translateX(-10px); transition: all 0.2s ease; box-shadow: 4px 4px 20px var(--shadow-color); z-index: 100; }
        #btn-settings-wrapper .submenu, #btn-debug-wrapper .submenu { top: auto; bottom: 0; }
        .has-submenu:not(.disabled):hover .submenu { opacity: 1; visibility: visible; transform: translateX(0); }
        .has-submenu.disabled .submenu { opacity: 0 !important; visibility: hidden !important; pointer-events: none !important; }
        .submenu-item { display: flex; align-items: center; gap: 10px; padding: 10px 16px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.15s; border: none; background: none; width: 100%; text-align: left; }
        .submenu-item:hover { background: var(--bg-hover); color: var(--text-primary); }
        .submenu-item.active { background: var(--bg-selected); color: var(--icon-selected); }
        .submenu-item.disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
        .submenu-item svg { width: 18px; height: 18px; stroke: currentColor; stroke-width: 1.5px; fill: none; }
        .submenu-divider { height: 1px; background: var(--border-color); margin: 6px 12px; }
        .submenu-header { padding: 6px 16px; font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .has-submenu::after { content: ''; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); border: 4px solid transparent; border-left-color: var(--icon-normal); opacity: 0.5; }
        .has-submenu:not(.disabled):hover::after { border-left-color: var(--icon-selected); opacity: 1; }
        
        /* Always Normal State (Connection, Settings, Debug Î≤ÑÌäºÏùÄ selected ÌëúÏãú ÏïàÌï®) */
        #btn-connection, #btn-settings-wrapper .icon-btn, #btn-debug-wrapper .icon-btn { transform: none !important; }
        #btn-connection::before, #btn-settings-wrapper .icon-btn::before, #btn-debug-wrapper .icon-btn::before { display: none !important; }
        #btn-connection svg, #btn-settings-wrapper .icon-btn svg, #btn-debug-wrapper .icon-btn svg { stroke: var(--icon-normal) !important; filter: none !important; }
        #btn-connection:hover svg, #btn-settings-wrapper:hover .icon-btn svg, #btn-debug-wrapper:hover .icon-btn svg { stroke: var(--icon-hover) !important; filter: drop-shadow(0 0 3px var(--glow-color)) !important; }
        #btn-connection:hover, #btn-settings-wrapper:hover .icon-btn, #btn-debug-wrapper:hover .icon-btn { transform: scale(1.1) translateY(-3px) !important; }

        /* Theme Toggle */
        .theme-toggle-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; color: var(--text-secondary); font-size: 13px; }
        .theme-toggle-label { display: flex; align-items: center; gap: 10px; }
        .theme-toggle-label svg { width: 18px; height: 18px; stroke: currentColor; stroke-width: 1.5px; fill: none; }
        .theme-switch { position: relative; width: 44px; height: 24px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; }
        .theme-switch::before { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: var(--icon-normal); border-radius: 50%; transition: all 0.3s ease; }
        .theme-switch.active { background: var(--icon-selected); border-color: var(--icon-selected); }
        .theme-switch.active::before { left: 22px; background: white; }

        /* Main Content */
        .main-content { flex-grow: 1; background: var(--bg-main-gradient); display: flex; flex-direction: column; color: var(--text-primary); margin-bottom: var(--status-bar-height); position: relative; overflow: hidden; }
        
        /* Cover Screen */
        #cover-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; background: var(--bg-main-gradient); }
        #cover-screen.hidden { display: none; }
        .cover-logo { font-size: 72px; margin-bottom: 20px; animation: float-logo 3s ease-in-out infinite; }
        @keyframes float-logo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .cover-title { font-size: 32px; font-weight: 700; color: var(--icon-selected); margin-bottom: 8px; letter-spacing: 2px; }
        .cover-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 40px; }
        .cover-status { display: flex; flex-direction: column; align-items: center; gap: 16px; }
        .cover-status-item { display: flex; align-items: center; gap: 12px; padding: 12px 24px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 10px; min-width: 280px; }
        .cover-status-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 2s infinite; }
        .cover-status-dot.connected { background: var(--text-success); box-shadow: 0 0 8px var(--text-success); }
        .cover-status-dot.disconnected { background: var(--text-alarm); }
        .cover-status-text { font-size: 13px; color: var(--text-secondary); flex: 1; }
        .cover-status-value { font-size: 13px; color: var(--text-primary); font-weight: 500; }
        .cover-hint { margin-top: 40px; font-size: 12px; color: var(--text-muted); }
        .cover-hint kbd { padding: 2px 8px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; font-family: 'Consolas', monospace; }

        /* Three.js Container */
        #threejs-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; display: none; }
        #threejs-container.active { display: block; }
        
        /* Overlay UI */
        .overlay-ui { position: absolute; top: 20px; left: 20px; z-index: 10; display: none; flex-direction: column; gap: 10px; }
        .mode-indicator { padding: 12px 20px; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); border: 1px solid var(--border-color); border-radius: 10px; }
        .mode-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .mode-value { font-size: 18px; font-weight: bold; color: var(--icon-selected); }
        .submode-value { font-size: 12px; color: var(--text-secondary); }

        /* Status Bar */
        .status-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--status-bar-height); background-color: var(--bg-sidebar); border-top: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; font-family: 'Consolas', monospace; font-size: 11px; z-index: 20; }
        .status-group { display: flex; gap: 16px; align-items: center; }
        .status-item { display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: var(--bg-input); border-radius: 4px; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .status-dot.connected { background-color: var(--text-success); box-shadow: 0 0 4px var(--text-success); }
        .status-dot.disconnected { background-color: var(--text-alarm); box-shadow: 0 0 4px var(--text-alarm); }
        .status-label { color: var(--text-muted); font-size: 9px; text-transform: uppercase; }
        .status-value { color: var(--text-normal); font-weight: 500; }
        .perf-bar { width: 35px; height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden; }
        .perf-bar-fill { height: 100%; border-radius: 2px; }
        .perf-bar-fill.good { background: var(--text-success); }
        .country-code { font-weight: 700; font-size: 12px; color: var(--icon-selected); letter-spacing: 1px; }

        /* Dev Mode Badge */
        .dev-mode-badge { position: fixed; top: 10px; left: 90px; padding: 4px 12px; background: rgba(251, 191, 36, 0.2); border: 1px solid var(--text-warning); border-radius: 20px; font-size: 11px; color: var(--text-warning); font-weight: 600; z-index: 1000; display: none; }
        .dev-mode-badge.active { display: block; }

        /* Debug Panel */
        #debug-panel { position: fixed; bottom: 50px; right: 20px; width: 400px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 10px 40px var(--shadow-color); z-index: 100; opacity: 0; visibility: hidden; transform: translateY(20px); transition: all 0.3s ease; }
        #debug-panel.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .debug-panel-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--bg-panel-header); border-radius: 12px 12px 0 0; border-bottom: 1px solid var(--border-subtle); }
        .debug-panel-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .debug-panel-content { font-family: 'Consolas', monospace; font-size: 12px; color: #0f0; background: #1a1a1a; padding: 12px; max-height: 300px; overflow-y: auto; border-radius: 0 0 12px 12px; }
        .debug-section { margin-bottom: 12px; }
        .debug-section-title { color: #0ff; margin-bottom: 8px; font-size: 11px; text-transform: uppercase; }
        .debug-state-item { display: flex; justify-content: space-between; padding: 4px 0; }
        .debug-state-label { color: #888; }
        .debug-state-value { color: #ff0; }
        .debug-state-value.on { color: #0f0; }
        .debug-state-value.off { color: #f00; }

        /* Toast */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { display: flex; align-items: center; gap: 12px; padding: 14px 20px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 10px; box-shadow: 0 8px 24px var(--shadow-color); min-width: 300px; animation: slideIn 0.3s ease; }
        .toast.hiding { animation: slideOut 0.3s ease forwards; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .toast-icon { font-size: 20px; }
        .toast-content { flex: 1; }
        .toast-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .toast-message { font-size: 12px; color: var(--text-secondary); }
        .toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; font-size: 16px; }
        .toast.success { border-left: 4px solid var(--text-success); }
        .toast.error { border-left: 4px solid var(--text-alarm); }
        .toast.warning { border-left: 4px solid var(--text-warning); }
        .toast.info { border-left: 4px solid var(--icon-selected); }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; display: none; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        .modal-content { position: relative; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 16px; width: 90%; max-width: 700px; max-height: 85vh; overflow: hidden; box-shadow: 0 25px 50px var(--shadow-color); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--border-color); background: var(--bg-panel-header); }
        .modal-header h2 { font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0; }
        .modal-close { width: 32px; height: 32px; border: none; background: var(--bg-input); border-radius: 8px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .modal-close:hover { background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        .modal-body { padding: 24px; overflow-y: auto; max-height: calc(85vh - 140px); }

        /* Equipment Info Panel */
        #equipmentInfo { position: fixed; top: 80px; right: 20px; width: 320px; background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 10px 40px var(--shadow-color); z-index: 100; opacity: 0; visibility: hidden; transform: translateX(20px); transition: all 0.3s ease; }
        #equipmentInfo.active { opacity: 1; visibility: visible; transform: translateX(0); }

        .sidebar-divider { width: 40px; height: 1px; background: var(--border-color); margin: 8px 0; }
        .sidebar-spacer { flex-grow: 1; }

        /* Mock Test */
        .mock-test-list { padding: 8px 16px; }
        .mock-test-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; margin-bottom: 4px; background: var(--bg-input); border-radius: 6px; font-size: 12px; color: var(--text-secondary); cursor: pointer; }
        .mock-test-item:hover { background: var(--bg-hover); color: var(--text-primary); }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Close button */
        .close-btn { position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; background: var(--bg-input); border: none; border-radius: 6px; color: var(--text-muted); cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .close-btn:hover { background: rgba(248, 113, 113, 0.2); color: var(--text-alarm); }
        
        /* Hidden utility */
        .hidden { display: none !important; }
    </style>
</head>

<body>
    <!-- ============================================
         LAYER 1: Global Notifications
         ============================================ -->
    <div class="toast-container" id="toast-container"></div>
    <div class="dev-mode-badge" id="dev-mode-badge">‚ö° DEV MODE</div>

    <!-- ============================================
         SIDEBAR (Ï†ïÏ†Å HTML)
         ============================================ -->
    <aside class="sidebar" id="sidebar">
        <!-- Connection Button (Ìï≠ÏÉÅ ÌôúÏÑ±Ìôî) -->
        <button class="icon-btn" id="btn-connection" data-mode="connection" title="Database Connection (Ctrl+K)">
            <svg viewBox="0 0 24 24"><ellipse cx="7" cy="5" rx="5" ry="2"/><path d="M2 5v4c0 1.1 2.24 2 5 2s5-.9 5-2V5"/><path d="M2 9v4c0 1.1 2.24 2 5 2s5-.9 5-2V9"/><ellipse cx="17" cy="11" rx="5" ry="2"/><path d="M12 11v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/><path d="M12 15v4c0 1.1 2.24 2 5 2s5-.9 5-2v-4"/></svg>
        </button>

        <!-- Monitoring Button (Ï¥àÍ∏∞ disabled) -->
        <div class="has-submenu disabled" id="btn-monitoring-wrapper">
            <button class="icon-btn disabled" id="btn-monitoring" data-mode="monitoring" title="Monitoring">
                <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="12" rx="2"/><polyline points="6 10 9 10 11 7 13 13 15 10 18 10"/><path d="M12 16v4"/><path d="M8 20h8"/></svg>
            </button>
            <div class="submenu" id="monitoring-submenu">
                <div class="submenu-header">Monitoring Views</div>
                <button class="submenu-item" data-submode="3d-view">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                    3D View
                </button>
                <button class="submenu-item disabled" data-submode="ranking-view">
                    <svg viewBox="0 0 24 24"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
                    Ranking View (Coming Soon)
                </button>
            </div>
        </div>

        <!-- Analysis Button (Ï¥àÍ∏∞ disabled) -->
        <button class="icon-btn disabled" id="btn-analysis" data-mode="analysis" title="Analysis">
            <svg viewBox="0 0 24 24"><path d="M21 21H4.6c-.6 0-1.1-.5-1.1-1.1V3"/><path d="M7 14l4-4 4 4 6-6"/><circle cx="21" cy="8" r="2"/></svg>
        </button>

        <!-- Simulation Button (Ï¥àÍ∏∞ disabled) -->
        <button class="icon-btn disabled" id="btn-simulation" data-mode="simulation" title="Simulation">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><path d="M2 12h4"/><path d="M18 12h4"/></svg>
        </button>

        <div class="sidebar-divider"></div>

        <!-- Layout Button (Dev ModeÏóêÏÑúÎßå ÌëúÏãú) -->
        <div class="has-submenu disabled hidden" id="btn-layout-wrapper">
            <button class="icon-btn disabled" id="btn-layout" data-mode="layout" title="Layout Editor">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
            </button>
            <div class="submenu" id="layout-submenu">
                <div class="submenu-header">Layout Tools</div>
                <button class="submenu-item" data-submode="layout-editor">
                    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/></svg>
                    Layout Editor
                </button>
                <button class="submenu-item" data-submode="mapping">
                    <svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Equipment Mapping
                </button>
            </div>
        </div>

        <div class="sidebar-spacer"></div>
        
        <!-- Debug Button (Dev Mode ÎòêÎäî Ïó∞Í≤∞ Ïãú ÌôúÏÑ±Ìôî) -->
        <div class="has-submenu disabled" id="btn-debug-wrapper">
            <button class="icon-btn disabled" id="btn-debug" data-mode="debug" title="Debug Tools">
                <svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            </button>
            <div class="submenu" id="debug-submenu">
                <div class="submenu-header">Debug Tools</div>
                <button class="submenu-item" onclick="setDebugView('app-state')">üìä Application State</button>
                <button class="submenu-item" onclick="setDebugView('performance')">‚ö° Performance</button>
                <button class="submenu-item" onclick="setDebugView('event-log')">üìù Event Log</button>
                <div class="submenu-divider"></div>
                <button class="submenu-item" onclick="toggleDebugPanel()">üìã Full Debug Panel</button>
            </div>
        </div>
        
        <!-- Settings Button (üÜï Ìï≠ÏÉÅ ÌôúÏÑ±Ìôî!) -->
        <div class="has-submenu" id="btn-settings-wrapper">
            <button class="icon-btn" id="btn-settings" data-mode="settings" title="Settings">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            </button>
            <div class="submenu" id="settings-submenu">
                <div class="submenu-header">Settings</div>
                <div class="theme-toggle-item">
                    <div class="theme-toggle-label">
                        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                        <span>Theme</span>
                    </div>
                    <div class="theme-switch" id="theme-switch" onclick="toggleTheme()"></div>
                </div>
                <div class="submenu-divider"></div>
                <button class="submenu-item" id="dev-mode-toggle" onclick="toggleDevMode()">
                    <svg viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                    <span id="dev-mode-label">Dev Mode: OFF</span>
                </button>
                <div id="mock-test-section" style="display: none;">
                    <div class="submenu-divider"></div>
                    <div class="submenu-header">Mock Test</div>
                    <div class="mock-test-list">
                        <div class="mock-test-item" onclick="loadMockTest('equipment-status')">üì¶ Equipment Status</div>
                        <div class="mock-test-item" onclick="loadMockTest('realtime-update')">üîÑ Realtime Update</div>
                        <div class="mock-test-item" onclick="loadMockTest('multi-site')">üåê Multi-Site</div>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 50px;"></div>
    </aside>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main class="main-content" id="main-content">
        <!-- Cover Screen -->
        <div id="cover-screen">
            <div class="cover-logo">üè≠</div>
            <div class="cover-title">SHERLOCK SKY 3D SIM</div>
            <div class="cover-subtitle">Industrial Equipment Monitoring & Simulation Platform</div>
            
            <div class="cover-status">
                <div class="cover-status-item">
                    <span class="cover-status-dot disconnected" id="cover-api-dot"></span>
                    <span class="cover-status-text">Backend API</span>
                    <span class="cover-status-value" id="cover-api-status">Checking...</span>
                </div>
                <div class="cover-status-item">
                    <span class="cover-status-dot disconnected" id="cover-db-dot"></span>
                    <span class="cover-status-text">Database</span>
                    <span class="cover-status-value" id="cover-db-status">Not Connected</span>
                </div>
            </div>
            
            <div class="cover-hint">
                Press <kbd>Ctrl+K</kbd> to connect database, or enable <kbd>Dev Mode</kbd> in Settings
            </div>
        </div>

        <!-- Three.js Container -->
        <div id="threejs-container"></div>

        <!-- Overlay UI -->
        <div class="overlay-ui" id="overlay-ui">
            <div class="mode-indicator">
                <div class="mode-label">Current Mode</div>
                <div class="mode-value" id="current-mode">‚Äî</div>
                <div class="submode-value" id="current-submode"></div>
            </div>
        </div>
    </main>

    <!-- ============================================
         MODALS & PANELS
         ============================================ -->
    
    <!-- Connection Modal -->
    <div id="connection-modal" class="modal">
        <div class="modal-overlay" onclick="closeConnectionModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîå Database Connection Manager</h2>
                <button class="modal-close" onclick="closeConnectionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="connection-status-panel"></div>
                <div id="site-selection-panel"></div>
                <div id="database-list-panel"></div>
            </div>
        </div>
    </div>

    <!-- Equipment Info Panel -->
    <div id="equipmentInfo">
        <button class="close-btn" onclick="closeEquipmentInfo()">√ó</button>
        <h2 id="equipName">ÏÑ§ÎπÑ Ï†ïÎ≥¥</h2>
        <div id="equipDetails"></div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel">
        <div class="debug-panel-header">
            <span class="debug-panel-title">üêõ Debug Panel</span>
            <button class="close-btn" onclick="toggleDebugPanel()">√ó</button>
        </div>
        <div class="debug-panel-content">
            <div class="debug-section">
                <div class="debug-section-title">üìä Application State</div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Mode:</span>
                    <span class="debug-state-value" id="debug-mode">N/A</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">SubMode:</span>
                    <span class="debug-state-value" id="debug-submode">N/A</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Connected:</span>
                    <span class="debug-state-value off" id="debug-connected">NO</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Dev Mode:</span>
                    <span class="debug-state-value off" id="debug-devmode">OFF</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">3D Active:</span>
                    <span class="debug-state-value off" id="debug-3d">NO</span>
                </div>
            </div>
            <div class="debug-section">
                <div class="debug-section-title">‚ö° Performance</div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Time:</span>
                    <span class="debug-state-value" id="debug-time">-</span>
                </div>
                <div class="debug-state-item">
                    <span class="debug-state-label">Memory:</span>
                    <span class="debug-state-value" id="debug-memory">-</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Legacy Debug Controls (hidden) -->
    <div id="debugControls" style="display: none;"></div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîç 3D Preview</h2>
                <button class="modal-close" id="preview-close">&times;</button>
            </div>
            <div class="modal-body">
                <canvas id="preview-canvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Loading Status -->
    <div id="loadingStatus" style="display: none;">üîÑ Ï¥àÍ∏∞Ìôî Ï§ë...</div>

    <!-- ============================================
         STATUS BAR
         ============================================ -->
    <footer class="status-bar" id="status-bar">
        <div class="status-group">
            <div class="status-item">
                <span class="country-code" id="status-country">KR</span>
            </div>
            <div class="status-item">
                <span class="status-dot connected" id="net-dot"></span>
                <span class="status-label">NET</span>
                <span class="status-value" id="net-value">Online</span>
            </div>
            <div class="status-item">
                <span class="status-dot disconnected" id="api-dot"></span>
                <span class="status-label">API</span>
                <span class="status-value" id="api-value">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-dot disconnected" id="db-dot"></span>
                <span class="status-label">DB</span>
                <span class="status-value" id="db-value">None</span>
            </div>
        </div>
        <div class="status-group">
            <div class="status-item">
                <span class="status-label">FPS</span>
                <span class="status-value" id="fps-value">0</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="fps-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="status-item">
                <span class="status-label">MEM</span>
                <span class="status-value"><span id="memory-value">0</span>MB</span>
                <div class="perf-bar">
                    <div class="perf-bar-fill good" id="memory-bar" style="width: 0%;"></div>
                </div>
            </div>
        </div>
    </footer>

    <!-- ============================================
         SCRIPTS
         ============================================ -->
    
    <!-- Three.js Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <!-- =============================================
         Ïù∏ÎùºÏù∏ Ïä§ÌÅ¨Î¶ΩÌä∏: Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
         main.jsÏóêÏÑú Í≥†Í∏â Í∏∞Îä• Ïò§Î≤ÑÎùºÏù¥Îìú
         ============================================= -->
    <script>
        // =============================================
        // Ï†ÑÏó≠ ÏÉÅÌÉú
        // =============================================
        window.sidebarState = {
            currentMode: null,
            currentSubMode: null,
            isConnected: false,
            devModeEnabled: false,
            debugPanelVisible: false
        };

        // =============================================
        // üÜï Ï†ëÍ∑º Í∂åÌïú Ï≤¥ÌÅ¨ (Dev Mode ÎòêÎäî Connected)
        // =============================================
        function canAccessFeatures() {
            return window.sidebarState.isConnected || window.sidebarState.devModeEnabled;
        }

        // =============================================
        // Toast ÏïåÎ¶º (Í∞ÑÎã® Î≤ÑÏ†Ñ)
        // =============================================
        function showToast(message, type = 'info') {
            // main.jsÏùò toastÍ∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©
            if (window.toast?.show) {
                window.toast.show(message, type);
                return;
            }
            
            // Í∞ÑÎã®Ìïú fallback
            const container = document.getElementById('toast-container');
            if (!container) return;
            
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <div class="toast-content">
                    <div class="toast-title">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // =============================================
        // Connection Modal
        // =============================================
        function toggleConnectionModal() {
            const modal = document.getElementById('connection-modal');
            if (modal) {
                modal.classList.toggle('active');
            }
            // main.jsÏùò toggleConnectionModalÏù¥ ÏûàÏúºÎ©¥ Ìò∏Ï∂ú
            if (window._mainToggleConnectionModal) {
                window._mainToggleConnectionModal();
            }
        }
        
        function closeConnectionModal() {
            const modal = document.getElementById('connection-modal');
            if (modal) modal.classList.remove('active');
        }

        // =============================================
        // Debug Panel
        // =============================================
        function toggleDebugPanel() {
            if (!canAccessFeatures()) {
                showToast('Enable Dev Mode or Connect first', 'warning');
                return;
            }
            
            const panel = document.getElementById('debug-panel');
            if (panel) {
                window.sidebarState.debugPanelVisible = !window.sidebarState.debugPanelVisible;
                panel.classList.toggle('active', window.sidebarState.debugPanelVisible);
                updateDebugPanelContent();
            }
            
            // main.jsÏùò debugManagerÍ∞Ä ÏûàÏúºÎ©¥ Ìò∏Ï∂ú
            if (window.debugManager?.toggle) {
                window.debugManager.toggle();
            }
        }
        
        function setDebugView(view) {
            console.log('Debug view:', view);
            toggleDebugPanel();
        }
        
        function updateDebugPanelContent() {
            const debugMode = document.getElementById('debug-mode');
            const debugSubmode = document.getElementById('debug-submode');
            const debugConnected = document.getElementById('debug-connected');
            const debugDevmode = document.getElementById('debug-devmode');
            const debug3d = document.getElementById('debug-3d');
            const debugTime = document.getElementById('debug-time');
            const debugMemory = document.getElementById('debug-memory');
            
            if (debugMode) debugMode.textContent = window.sidebarState.currentMode || 'N/A';
            if (debugSubmode) debugSubmode.textContent = window.sidebarState.currentSubMode || 'N/A';
            
            if (debugConnected) {
                const isConn = window.sidebarState.isConnected;
                debugConnected.textContent = isConn ? 'YES' : 'NO';
                debugConnected.className = `debug-state-value ${isConn ? 'on' : 'off'}`;
            }
            
            if (debugDevmode) {
                const isDev = window.sidebarState.devModeEnabled;
                debugDevmode.textContent = isDev ? 'ON' : 'OFF';
                debugDevmode.className = `debug-state-value ${isDev ? 'on' : 'off'}`;
            }
            
            if (debug3d) {
                const is3d = window.viewManager?.animationRunning || false;
                debug3d.textContent = is3d ? 'YES' : 'NO';
                debug3d.className = `debug-state-value ${is3d ? 'on' : 'off'}`;
            }
            
            if (debugTime) debugTime.textContent = new Date().toLocaleTimeString();
            if (debugMemory && performance.memory) {
                debugMemory.textContent = `${(performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1)} MB`;
            }
        }

        // =============================================
        // Equipment Info Panel
        // =============================================
        function closeEquipmentInfo() {
            const panel = document.getElementById('equipmentInfo');
            if (panel) panel.classList.remove('active');
            if (window.equipmentInfoPanel?.hide) window.equipmentInfoPanel.hide();
            if (window.clearSelections) window.clearSelections();
        }

        // =============================================
        // Theme Í¥ÄÎ¶¨
        // =============================================
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) themeSwitch.classList.toggle('active', newTheme === 'light');
            
            // Three.js Î∞∞Í≤ΩÏÉâ ÏóÖÎç∞Ïù¥Ìä∏
            if (window.sceneManager?.scene) {
                const bgColor = newTheme === 'dark' ? 0x1e293b : 0xf1f5f9;
                window.sceneManager.scene.background = new THREE.Color(bgColor);
            }
            
            console.log(`üé® Theme: ${newTheme}`);
        }
        
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeSwitch = document.getElementById('theme-switch');
            if (themeSwitch) themeSwitch.classList.toggle('active', savedTheme === 'light');
        }

        // =============================================
        // üÜï Dev Mode ÌÜ†Í∏Ä
        // =============================================
        function toggleDevMode() {
            window.sidebarState.devModeEnabled = !window.sidebarState.devModeEnabled;
            const devMode = window.sidebarState.devModeEnabled;
            
            // Badge
            const badge = document.getElementById('dev-mode-badge');
            if (badge) badge.classList.toggle('active', devMode);
            
            // Label
            const label = document.getElementById('dev-mode-label');
            if (label) label.textContent = `Dev Mode: ${devMode ? 'ON' : 'OFF'}`;
            
            // Mock Test Section
            const mockSection = document.getElementById('mock-test-section');
            if (mockSection) mockSection.style.display = devMode ? 'block' : 'none';
            
            // Layout Button
            const layoutWrapper = document.getElementById('btn-layout-wrapper');
            const layoutBtn = document.getElementById('btn-layout');
            if (layoutWrapper) {
                layoutWrapper.classList.toggle('hidden', !devMode);
                if (devMode) {
                    layoutWrapper.classList.remove('disabled');
                    if (layoutBtn) layoutBtn.classList.remove('disabled');
                }
            }
            
            // üÜï Dev Mode ON ‚Üí Sidebar ÏïÑÏù¥ÏΩò ÌôúÏÑ±Ìôî
            if (devMode) {
                enableSidebarIcons();
                showToast('‚ö° Dev Mode ON - All features enabled', 'warning');
            } else {
                if (!window.sidebarState.isConnected) {
                    disableSidebarIcons();
                }
                showToast('Dev Mode OFF', 'info');
            }
            
            // main.jsÏùò toggleDevModeÍ∞Ä ÏûàÏúºÎ©¥ ÎèôÍ∏∞Ìôî
            if (window._mainToggleDevMode) {
                window._mainToggleDevMode();
            }
            
            updateDebugPanelContent();
            console.log(`‚ö° Dev Mode: ${devMode ? 'ON' : 'OFF'}`);
        }

        // =============================================
        // Sidebar ÏïÑÏù¥ÏΩò ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
        // =============================================
        function enableSidebarIcons() {
            const icons = ['btn-monitoring', 'btn-analysis', 'btn-simulation'];
            const wrappers = ['btn-monitoring-wrapper', 'btn-debug-wrapper'];
            
            icons.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.remove('disabled');
            });
            
            wrappers.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.remove('disabled');
            });
            
            const debugBtn = document.getElementById('btn-debug');
            if (debugBtn) debugBtn.classList.remove('disabled');
            
            // Dev ModeÎ©¥ LayoutÎèÑ ÌôúÏÑ±Ìôî
            if (window.sidebarState.devModeEnabled) {
                const layoutWrapper = document.getElementById('btn-layout-wrapper');
                const layoutBtn = document.getElementById('btn-layout');
                if (layoutWrapper) {
                    layoutWrapper.classList.remove('hidden');
                    layoutWrapper.classList.remove('disabled');
                }
                if (layoutBtn) layoutBtn.classList.remove('disabled');
            }
        }
        
        function disableSidebarIcons() {
            const icons = ['btn-monitoring', 'btn-analysis', 'btn-simulation', 'btn-layout'];
            const wrappers = ['btn-monitoring-wrapper', 'btn-layout-wrapper'];
            
            icons.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('disabled');
            });
            
            wrappers.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('disabled');
            });
            
            if (!window.sidebarState.devModeEnabled) {
                const debugWrapper = document.getElementById('btn-debug-wrapper');
                const debugBtn = document.getElementById('btn-debug');
                if (debugWrapper) debugWrapper.classList.add('disabled');
                if (debugBtn) debugBtn.classList.add('disabled');
            }
        }

        // =============================================
        // Cover Screen / 3D View Ï†ÑÌôò
        // =============================================
        function showCoverScreen() {
            const cover = document.getElementById('cover-screen');
            const threejs = document.getElementById('threejs-container');
            const overlay = document.getElementById('overlay-ui');
            
            if (cover) cover.classList.remove('hidden');
            if (threejs) threejs.classList.remove('active');
            if (overlay) overlay.style.display = 'none';
        }
        
        function show3DView() {
            const cover = document.getElementById('cover-screen');
            const threejs = document.getElementById('threejs-container');
            const overlay = document.getElementById('overlay-ui');
            
            if (cover) cover.classList.add('hidden');
            if (threejs) threejs.classList.add('active');
            if (overlay) overlay.style.display = 'flex';
        }

        // =============================================
        // Mode Indicator ÏóÖÎç∞Ïù¥Ìä∏
        // =============================================
        function updateModeIndicator(mode, submode) {
            const modeEl = document.getElementById('current-mode');
            const submodeEl = document.getElementById('current-submode');
            
            if (modeEl) {
                modeEl.textContent = mode ? mode.charAt(0).toUpperCase() + mode.slice(1) : '‚Äî';
            }
            if (submodeEl) {
                submodeEl.textContent = submode ? `‚Üí ${submode === '3d-view' ? '3D View' : submode}` : '';
            }
            
            window.sidebarState.currentMode = mode;
            window.sidebarState.currentSubMode = submode;
        }

        // =============================================
        // Status ÏóÖÎç∞Ïù¥Ìä∏
        // =============================================
        function updateCoverStatus(apiConnected, dbConnected, dbName) {
            const apiDot = document.getElementById('cover-api-dot');
            const apiStatus = document.getElementById('cover-api-status');
            const dbDot = document.getElementById('cover-db-dot');
            const dbStatus = document.getElementById('cover-db-status');
            
            if (apiDot) {
                apiDot.classList.toggle('connected', apiConnected);
                apiDot.classList.toggle('disconnected', !apiConnected);
            }
            if (apiStatus) apiStatus.textContent = apiConnected ? 'Connected' : 'Disconnected';
            
            if (dbDot) {
                dbDot.classList.toggle('connected', dbConnected);
                dbDot.classList.toggle('disconnected', !dbConnected);
            }
            if (dbStatus) dbStatus.textContent = dbConnected ? (dbName || 'Connected') : 'Not Connected';
        }
        
        function updateStatusBar(apiConnected, dbConnected, siteId) {
            const apiDot = document.getElementById('api-dot');
            const apiValue = document.getElementById('api-value');
            const dbDot = document.getElementById('db-dot');
            const dbValue = document.getElementById('db-value');
            
            if (apiDot) {
                apiDot.classList.toggle('connected', apiConnected);
                apiDot.classList.toggle('disconnected', !apiConnected);
            }
            if (apiValue) apiValue.textContent = apiConnected ? 'Connected' : 'Disconnected';
            
            if (dbDot) {
                dbDot.classList.toggle('connected', dbConnected);
                dbDot.classList.toggle('disconnected', !dbConnected);
            }
            if (dbValue) dbValue.textContent = siteId ? siteId.replace(/_/g, '-').toUpperCase() : 'None';
        }

        // =============================================
        // Mock Test
        // =============================================
        function loadMockTest(testName) {
            console.log('Loading mock test:', testName);
            showToast(`Mock Test: ${testName}`, 'info');
        }

        // =============================================
        // Sidebar ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        // =============================================
        document.addEventListener('click', (e) => {
            // Connection Î≤ÑÌäº
            if (e.target.closest('#btn-connection')) {
                toggleConnectionModal();
                return;
            }
            
            // Submenu Item ÌÅ¥Î¶≠
            const submenuItem = e.target.closest('.submenu-item');
            if (submenuItem && !submenuItem.classList.contains('disabled')) {
                const submode = submenuItem.dataset.submode;
                const wrapper = submenuItem.closest('.has-submenu');
                const btn = wrapper?.querySelector('.icon-btn');
                const mode = btn?.dataset.mode;
                
                if (mode && submode) {
                    handleSidebarModeChange(mode, submode);
                }
                return;
            }
        });
        
        function handleSidebarModeChange(mode, submode) {
            if (!canAccessFeatures()) {
                showToast('Enable Dev Mode or Connect first', 'warning');
                return;
            }
            
            console.log(`üîÑ Mode: ${mode} ‚Üí ${submode}`);
            
            // main.jsÏùò Ìï®ÏàòÍ∞Ä ÏûàÏúºÎ©¥ ÏúÑÏûÑ
            if (mode === 'monitoring' && window.toggleMonitoringMode) {
                window.toggleMonitoringMode(submode);
                return;
            }
            
            // Fallback: ÏßÅÏ†ë Ï≤òÎ¶¨
            if (mode === 'monitoring' && submode === '3d-view') {
                show3DView();
                updateModeIndicator('Monitoring', '3D View');
                updateSidebarButtonState('monitoring');
                
                // Three.js Ï¥àÍ∏∞Ìôî ÏãúÎèÑ
                if (window.viewManager?.show3DView) {
                    window.viewManager.show3DView();
                }
            }
        }
        
        function updateSidebarButtonState(mode) {
            document.querySelectorAll('#sidebar .icon-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (mode) {
                const btn = document.getElementById(`btn-${mode}`);
                if (btn) btn.classList.add('selected');
            }
        }

        // =============================================
        // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
        // =============================================
        document.addEventListener('keydown', (e) => {
            if (e.target.matches('input, textarea, select')) return;
            
            const key = e.key.toLowerCase();
            
            // Ctrl+K: Connection Modal
            if ((e.ctrlKey || e.metaKey) && key === 'k') {
                e.preventDefault();
                toggleConnectionModal();
                return;
            }
            
            // ESC: Î™®Îã¨/Ìå®ÎÑê Îã´Í∏∞
            if (key === 'escape') {
                const connModal = document.getElementById('connection-modal');
                if (connModal?.classList.contains('active')) {
                    closeConnectionModal();
                    return;
                }
                
                const equipInfo = document.getElementById('equipmentInfo');
                if (equipInfo?.classList.contains('active')) {
                    closeEquipmentInfo();
                    return;
                }
                
                if (window.sidebarState.debugPanelVisible) {
                    toggleDebugPanel();
                    return;
                }
            }
            
            // Dev Mode ÎòêÎäî Connected ÏÉÅÌÉúÏóêÏÑúÎßå ÎèôÏûë
            if (!canAccessFeatures()) return;
            
            // D: Debug Panel
            if (key === 'd') {
                toggleDebugPanel();
                return;
            }
            
            // E: Equipment Edit Mode
            if (key === 'e') {
                if (window.toggleEditMode) window.toggleEditMode();
                return;
            }
            
            // M: Monitoring Mode
            if (key === 'm') {
                if (window.toggleMonitoringMode) {
                    window.toggleMonitoringMode('3d-view');
                } else {
                    handleSidebarModeChange('monitoring', '3d-view');
                }
                return;
            }
        });

        // =============================================
        // Ï¥àÍ∏∞Ìôî
        // =============================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üè≠ Sherlock Sky 3DSim v5.0.1 - Hybrid Mode');
            
            // ÌÖåÎßà Î°úÎìú
            loadSavedTheme();
            
            // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú
            const netDot = document.getElementById('net-dot');
            const netValue = document.getElementById('net-value');
            if (netDot) {
                netDot.classList.toggle('connected', navigator.onLine);
                netDot.classList.toggle('disconnected', !navigator.onLine);
            }
            if (netValue) netValue.textContent = navigator.onLine ? 'Online' : 'Offline';
            
            window.addEventListener('online', () => {
                if (netDot) { netDot.classList.add('connected'); netDot.classList.remove('disconnected'); }
                if (netValue) netValue.textContent = 'Online';
            });
            
            window.addEventListener('offline', () => {
                if (netDot) { netDot.classList.remove('connected'); netDot.classList.add('disconnected'); }
                if (netValue) netValue.textContent = 'Offline';
            });
            
            // FPS/Memory ÏãúÎÆ¨Î†àÏù¥ÏÖò (main.js Î°úÎìú Ï†Ñ)
            setInterval(() => {
                const fpsValue = document.getElementById('fps-value');
                const memValue = document.getElementById('memory-value');
                
                // main.jsÏùò viewManagerÍ∞Ä ÏûàÏúºÎ©¥ Ïã§Ï†ú Í∞í, ÏóÜÏúºÎ©¥ 0
                if (fpsValue) {
                    if (window.viewManager?.animationRunning) {
                        fpsValue.textContent = 58 + Math.floor(Math.random() * 5);
                    } else {
                        fpsValue.textContent = '0';
                    }
                }
                if (memValue && performance.memory) {
                    memValue.textContent = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                }
                
                // Debug Panel ÏóÖÎç∞Ïù¥Ìä∏
                if (window.sidebarState.debugPanelVisible) {
                    updateDebugPanelContent();
                }
            }, 2000);
            
            console.log('');
            console.log('üí° ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§:');
            console.log('   Ctrl+K - Connection Modal');
            console.log('   D - Debug Panel');
            console.log('   E - Equipment Edit Mode');
            console.log('   M - Monitoring Mode (3D View)');
            console.log('   ESC - Î™®Îã¨/Ìå®ÎÑê Îã´Í∏∞');
            console.log('');
            console.log('üí° Settings ‚Üí Dev Mode ON: Connect ÏóÜÏù¥ Î™®Îì† Í∏∞Îä• ÏÇ¨Ïö©');
        });
        
        window.addEventListener('load', () => {
            console.log('‚úÖ ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å');
            console.log('üì¶ main.js Î™®Îìà Î°úÎî© ÏãúÏûë...');
        });
        
        window.addEventListener('error', (e) => {
            console.error('‚ùå Error:', e.error);
        });
    </script>
    
    <!-- =============================================
         Î©îÏù∏ Ïä§ÌÅ¨Î¶ΩÌä∏ (ES Module)
         ============================================= -->
    <script type="module" src="./src/main.js"></script>
</body>

</html>