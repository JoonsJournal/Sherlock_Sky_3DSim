<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sherlock Sky 3DSim - ì„¤ë¹„ 3D ì‹œë®¬ë ˆì´ì…˜</title>

	<!-- ============================================
		â­ CSS Import (í†µí•©ëœ ìŠ¤íƒ€ì¼ì‹œíŠ¸)
		============================================ -->
	<link rel="stylesheet" href="styles/main.css">
</head>

<body>
	<!-- ============================================
		â­ ë§ˆìš°ìŠ¤ ì‚¬ìš©ë²• ì •ë³´ íŒ¨ë„ - ì˜¤ë¥¸ìª½ ìƒë‹¨
	   ============================================ -->
	<div id="info">
		<h3>ğŸ­ Sherlock Sky 3DSim</h3>
		<p>ğŸ–±ï¸ <strong>ì¢Œí´ë¦­ + ë“œë˜ê·¸:</strong> íšŒì „</p>
		<p>ğŸ–±ï¸ <strong>íœ :</strong> ì¤Œ ì¸/ì•„ì›ƒ</p>
		<p>ğŸ–±ï¸ <strong>ìš°í´ë¦­ + ë“œë˜ê·¸:</strong> ì´ë™</p>
		<p>ğŸ‘† <strong>ì„¤ë¹„ í´ë¦­:</strong> ì •ë³´ ë³´ê¸°</p>

		<div class="multi-select-tip">
			<strong>âœ¨ ë‹¤ì¤‘ ì„ íƒ:</strong><br>
			Ctrl+í´ë¦­ìœ¼ë¡œ ì—¬ëŸ¬ ì„¤ë¹„ ì„ íƒ<br>
			ì„ íƒ ì‹œ í‰ê· ê°’ ìë™ ê³„ì‚°
		</div>

		<div class="keyboard-hint">
			ğŸ’¡ <strong>F12</strong>ë¡œ ì½˜ì†” ì—´ê¸°<br>
			ğŸ’¡ <strong>debugHelp()</strong> ì…ë ¥ìœ¼ë¡œ ëª…ë ¹ì–´ ë³´ê¸°
		</div>
	</div>

	<!-- ë¡œë”© ìƒíƒœ -->
	<div id="loadingStatus">
		ğŸ”„ ì´ˆê¸°í™” ì¤‘...
	</div>

	<!-- ì„¤ë¹„ ì •ë³´ íŒ¨ë„ -->
	<div id="equipmentInfo">
		<button class="close-btn" onclick="closeEquipmentInfo()">Ã—</button>
		<h2 id="equipName">ì„¤ë¹„ ì •ë³´</h2>
		<div id="equipDetails"></div>
	</div>

	<!-- ============================================
		â­ Connection Button - ì™¼ìª½ ìƒë‹¨ ìµœìƒìœ„
		============================================ -->
	<button id="connectionBtn" class="floating-btn" title="Database Connection (Ctrl+K)">
		ğŸ”Œ
	</button>

	<!-- ============================================
		â­ Equipment Edit Button - Connection ë²„íŠ¼ ì•„ë˜
		============================================ -->
	<button id="editBtn" class="floating-btn" title="Equipment Edit Mode (E)">
		âœï¸
	</button>

	<!-- ============================================
		â­ Phase 2: Monitoring Button
		============================================ -->
	<button id="monitoringBtn" class="floating-btn" title="Monitoring Mode (M)">
		ğŸš¨
	</button>

	<!-- ============================================
		âœ¨ Phase 4.5: Preview Button (NEW - Editor ëª¨ë“œì—ì„œë§Œ í‘œì‹œ)
		============================================ -->
	<button id="previewBtn" class="floating-btn" title="3D Preview (P)">
		ğŸ”
	</button>

	<!-- ============================================
		âœ¨ Phase 2.6: Component Palette
		============================================ -->
	<div id="component-palette" class="hidden">
		<!-- ComponentPalette.jsê°€ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
	</div>

	<!-- ============================================
		âœ¨ Phase 4.5: 3D Preview Modal (NEW)
		============================================ -->
	<div id="preview-modal" class="modal">
		<div class="modal-overlay"></div>
		<div class="modal-content preview-modal-content">
			<div class="modal-header preview-header">
				<h2>ğŸ” 3D Preview - ì €ì¥ ì „ ë¯¸ë¦¬ë³´ê¸°</h2>
				<button class="modal-close" id="preview-close">&times;</button>
			</div>
			<div class="modal-body preview-body">
				<div class="preview-controls">
					<button class="preview-view-btn" data-view="perspective" title="ì›ê·¼ ë·°">â†» ì›ê·¼</button>
					<button class="preview-view-btn" data-view="top" title="ìœ„ì—ì„œ ë³´ê¸°">â¬†ï¸ Top</button>
					<button class="preview-view-btn" data-view="front" title="ì•ì—ì„œ ë³´ê¸°">â¡ï¸ Front</button>
					<button class="preview-view-btn" data-view="side" title="ì˜†ì—ì„œ ë³´ê¸°">â¬‡ï¸ Side</button>
				</div>
				<div class="preview-canvas-container">
					<canvas id="preview-canvas"></canvas>
				</div>
				<div class="preview-info-panel">
					<div class="preview-info-title">ğŸ“‹ ë³€ê²½ì‚¬í•­ ìš”ì•½</div>
					<div id="preview-summary">
						<!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
					</div>
					<div class="preview-notice">
						<span class="notice-icon">â„¹ï¸</span>
						<span>ë¯¸ë¦¬ë³´ê¸°ì…ë‹ˆë‹¤. ì €ì¥ í›„ ì‹¤ì œ 3D Viewerì— ì ìš©ë©ë‹ˆë‹¤.</span>
					</div>
				</div>
			</div>
			<div class="modal-footer preview-footer">
				<button class="btn btn-secondary" id="preview-back-edit">
					âœï¸ Back to Edit
				</button>
				<button class="btn btn-primary" id="preview-save-apply">
					ğŸ’¾ Save & Apply
				</button>
			</div>
		</div>
	</div>

	<!-- ============================================
		â­ ë””ë²„ê·¸ í† ê¸€ ë²„íŠ¼ - ì™¼ìª½ ì•„ë˜
		============================================ -->
	<button id="debugToggle" class="floating-btn" onclick="toggleDebugPanel()" title="ë””ë²„ê·¸ íŒ¨ë„">
		ğŸ”§
	</button>

	<!-- ============================================
		â­ ë””ë²„ê·¸ ì»¨íŠ¸ë¡¤ íŒ¨ë„ - ë””ë²„ê·¸ ë²„íŠ¼ ì˜¤ë¥¸ìª½
		============================================ -->
	<div id="debugControls">
		<h4>ğŸ”§ ë””ë²„ê·¸ ì»¨íŠ¸ë¡¤</h4>
		<button onclick="window.debugScene()">ğŸ“¦ ì”¬ ì •ë³´</button>
		<button onclick="window.debugRenderer()">ğŸ¨ ë Œë”ëŸ¬ ì •ë³´</button>
		<button onclick="window.getPerformanceStats()">âš¡ ì„±ëŠ¥ ì¸¡ì •</button>
		<button onclick="window.getMemoryInfo()">ğŸ’¾ ë©”ëª¨ë¦¬ ì •ë³´</button>
		<button onclick="window.debugHelp()">â“ ë„ì›€ë§</button>
		<button onclick="window.getSelectedEquipments()">ğŸ“Š ì„ íƒëœ ì„¤ë¹„</button>
		<button onclick="window.clearSelections()">âŒ ì„ íƒ í•´ì œ</button>
	</div>

	<!-- ============================================
		Connection Modal HTML
		============================================ -->
	<div id="connection-modal" class="modal">
		<div class="modal-overlay"></div>
		<div class="modal-content">
			<div class="modal-header">
				<h2>ğŸ”Œ Database Connection Manager</h2>
				<button class="modal-close" aria-label="Close">&times;</button>
			</div>
			<div class="modal-body">
				<!-- Connection Status Panel -->
				<div id="connection-status-panel"></div>
				
				<!-- Site Selection Panel -->
				<div id="site-selection-panel"></div>
				
				<!-- Database List Panel -->
				<div id="database-list-panel"></div>
			</div>
		</div>
	</div>

	<!-- ============================================
		Toast Container
		============================================ -->
	<div id="toast-container" class="toast-container"></div>


	<!-- Three.js Import Map -->
	<script type="importmap">
		{
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

	<!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
	<script type="module" src="./src/main.js"></script>

	<script>
		// ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€
		function toggleDebugPanel() {
			const panel = document.getElementById('debugControls');
			const button = document.getElementById('debugToggle');
			panel.classList.toggle('active');
			button.classList.toggle('active');  /* ë²„íŠ¼ í™œì„±í™” ìƒíƒœ í† ê¸€ */
		}

		// ì„¤ë¹„ ì •ë³´ íŒ¨ë„ ë‹«ê¸°
		function closeEquipmentInfo() {
			const panel = document.getElementById('equipmentInfo');
			if (panel) {
				panel.classList.remove('active');
			}

			// ì„ íƒ í•´ì œ
			if (window.clearSelections) {
				window.clearSelections();
			}
		}

		// ë¡œë”© ìƒíƒœ 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
		setTimeout(() => {
			const loadingStatus = document.getElementById('loadingStatus');
			if (loadingStatus) {
				loadingStatus.style.transition = 'opacity 0.5s';
				loadingStatus.style.opacity = '0';
				setTimeout(() => {
					loadingStatus.style.display = 'none';
				}, 500);
			}
		}, 3000);

		// í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
		document.addEventListener('keydown', (event) => {
			// 'D' í‚¤: ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€
			if (event.key === 'd' || event.key === 'D') {
				toggleDebugPanel();
			}
			// ESC í‚¤: ì •ë³´ íŒ¨ë„ ë‹«ê¸° ë° Preview Modal ë‹«ê¸°
			if (event.key === 'Escape') {
				closeEquipmentInfo();
				// âœ¨ Phase 4.5: Preview Modal ë‹«ê¸° ì¶”ê°€
				if (window.closePreviewModal) {
					window.closePreviewModal();
				}
			}
			// 'C' í‚¤: ì„ íƒ í•´ì œ
			if (event.key === 'c' || event.key === 'C') {
				if (window.clearSelections) {
					window.clearSelections();
				}
			}
			// â­ ìƒˆë¡œ ì¶”ê°€: 'E' í‚¤: Equipment Edit ëª¨ë“œ í† ê¸€
			if (event.key === 'e' || event.key === 'E') {
				if (window.toggleEditMode) {
					window.toggleEditMode();
				}
			}
			// â­ Phase 2: 'M' í‚¤: Monitoring ëª¨ë“œ í† ê¸€
			if (event.key === 'm' || event.key === 'M') {
				if (window.toggleMonitoringMode) {
					window.toggleMonitoringMode();
				}
			}
			// âœ¨ Phase 4.5: 'P' í‚¤: Preview ëª¨ë“œ í† ê¸€ (NEW)
			if (event.key === 'p' || event.key === 'P') {
				if (window.showPreview3D) {
					window.showPreview3D();
				}
			}
		});

		// í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
		window.addEventListener('load', () => {
			console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
			console.log('ğŸ’¡ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤:');
			console.log('   D - ë””ë²„ê·¸ íŒ¨ë„ í† ê¸€');
			console.log('   C - ì„ íƒ í•´ì œ');
			console.log('   E - Equipment Edit ëª¨ë“œ í† ê¸€');
			console.log('   M - Monitoring ëª¨ë“œ í† ê¸€');
			console.log('   P - 3D Preview (Editor ëª¨ë“œì—ì„œ)');  // âœ¨ Phase 4.5 ì¶”ê°€
			console.log('   ESC - ì •ë³´ íŒ¨ë„/ëª¨ë‹¬ ë‹«ê¸°');
			console.log('');
			console.log('ğŸ”§ ë””ë²„ê·¸ ëª…ë ¹ì–´:');
			console.log('   debugHelp() - ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ í™•ì¸');
		});

		// ì—ëŸ¬ í•¸ë“¤ë§
		window.addEventListener('error', (event) => {
			console.error('ì „ì—­ ì—ëŸ¬ ë°œìƒ:', event.error);

			// ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê²½ë¡œ íŒíŠ¸
			if (event.message && event.message.includes('Failed to load module')) {
				console.error('âŒ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨!');
				console.error('ğŸ’¡ í•´ê²° ë°©ë²•:');
				console.error('   1. index.htmlì˜ script src ê²½ë¡œ í™•ì¸');
				console.error('   2. í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° í™•ì¸');
				console.error('   3. http-serverë¡œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸ (file:// í”„ë¡œí† ì½œ ì‚¬ìš© ë¶ˆê°€)');
			}
		});
	</script>
</body>

</html>