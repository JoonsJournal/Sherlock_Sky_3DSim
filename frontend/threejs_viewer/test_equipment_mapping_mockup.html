<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Mapping Mockup Test</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
        }
        
        h1 {
            color: #4ecdc4;
            border-bottom: 2px solid #4ecdc4;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #ff6b6b;
            margin-top: 30px;
        }
        
        h3 {
            color: #ffd93d;
            margin-top: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #0f3460;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: #1a1a2e;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #eb3349, #f45c43);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #606c88, #3f4c6b);
            color: white;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #0f3460;
            border-radius: 8px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-label {
            color: #888;
            font-size: 12px;
        }
        
        .status-value {
            font-weight: bold;
            font-size: 14px;
        }
        
        .status-value.connected {
            color: #38ef7d;
        }
        
        .status-value.disconnected {
            color: #f45c43;
        }
        
        .log-container {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            border: 1px solid #30363d;
        }
        
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #21262d;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #666;
            margin-right: 10px;
        }
        
        .log-success {
            color: #38ef7d;
        }
        
        .log-error {
            color: #f45c43;
        }
        
        .log-info {
            color: #4facfe;
        }
        
        .log-warn {
            color: #ffd93d;
        }
        
        .json-preview {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            border: 1px solid #30363d;
        }
        
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #0f3460;
            border-radius: 8px;
        }
        
        .equipment-item {
            padding: 8px;
            background: #16213e;
            border-radius: 6px;
            text-align: center;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .equipment-item:hover {
            background: #1a2744;
        }
        
        .equipment-item.mapped {
            border-color: #38ef7d;
            background: rgba(56, 239, 125, 0.1);
        }
        
        .equipment-item.selected {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.2);
        }
        
        .equipment-item .eq-id {
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .equipment-item .eq-name {
            font-size: 10px;
            color: #888;
            margin-top: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .db-equipment-list {
            max-height: 200px;
            overflow-y: auto;
            background: #0f3460;
            border-radius: 8px;
            padding: 10px;
        }
        
        .db-equipment-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #16213e;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .db-equipment-item:hover {
            background: #1a2744;
        }
        
        .db-equipment-item.used {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .mode-indicator {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .mode-view {
            background: #3f4c6b;
        }
        
        .mode-dev {
            background: #f5576c;
        }
        
        .mode-mapping {
            background: #38ef7d;
            color: #1a1a2e;
        }
        
        .mode-monitoring {
            background: #4facfe;
            color: #1a1a2e;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
        
        .file-info {
            background: #0f3460;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .file-info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #16213e;
        }
        
        .file-info-row:last-child {
            border-bottom: none;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .badge-success {
            background: #38ef7d;
            color: #1a1a2e;
        }
        
        .badge-warning {
            background: #ffd93d;
            color: #1a1a2e;
        }
        
        .badge-error {
            background: #f45c43;
            color: white;
        }
        
        .progress-bar {
            height: 20px;
            background: #0f3460;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38ef7d, #11998e);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            color: #1a1a2e;
        }
        
        .tab-container {
            margin: 20px 0;
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: #0f3460;
            border: none;
            border-radius: 8px 8px 0 0;
            color: #888;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-btn.active {
            background: #16213e;
            color: #4ecdc4;
        }
        
        .tab-content {
            display: none;
            background: #16213e;
            padding: 20px;
            border-radius: 0 8px 8px 8px;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Equipment Mapping Mockup Test</h1>
        <p>Backend ì„œë²„ ì—†ì´ Equipment Mapping ì „ì²´ íë¦„ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        
        <!-- í˜„ì¬ ìƒíƒœ í‘œì‹œ -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">í˜„ì¬ ëª¨ë“œ:</span>
                <span id="current-mode" class="mode-indicator mode-view">View Mode</span>
            </div>
            <div class="status-item">
                <span class="status-label">DB ì—°ê²°:</span>
                <span id="db-status" class="status-value disconnected">ë¯¸ì—°ê²°</span>
            </div>
            <div class="status-item">
                <span class="status-label">Site ID:</span>
                <span id="site-id" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">ë§¤í•‘ ì§„í–‰ë¥ :</span>
                <span id="mapping-progress" class="status-value">0/117 (0%)</span>
            </div>
        </div>
        
        <!-- íƒ­ ì»¨í…Œì´ë„ˆ -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('connection')">1ï¸âƒ£ DB ì—°ê²°</button>
                <button class="tab-btn" onclick="showTab('mode')">2ï¸âƒ£ ëª¨ë“œ ì „í™˜</button>
                <button class="tab-btn" onclick="showTab('mapping')">3ï¸âƒ£ ë§¤í•‘ ì‘ì—…</button>
                <button class="tab-btn" onclick="showTab('save')">4ï¸âƒ£ ì €ì¥/ë¡œë“œ</button>
                <button class="tab-btn" onclick="showTab('validation')">5ï¸âƒ£ ê²€ì¦</button>
            </div>
            
            <!-- Tab 1: DB ì—°ê²° -->
            <div id="tab-connection" class="tab-content active">
                <h3>ğŸ“¡ Database ì—°ê²° ì‹œë®¬ë ˆì´ì…˜</h3>
                <p>Connection Managerë¥¼ í†µí•œ DB ì—°ê²°ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="connectDatabase('korea_site1', 'line1')">
                        ğŸ‡°ğŸ‡· Korea Site1 - Line1 ì—°ê²°
                    </button>
                    <button class="btn-primary" onclick="connectDatabase('korea_site1', 'line2')">
                        ğŸ‡°ğŸ‡· Korea Site1 - Line2 ì—°ê²°
                    </button>
                    <button class="btn-primary" onclick="connectDatabase('vietnam_site', 'production')">
                        ğŸ‡»ğŸ‡³ Vietnam - Production ì—°ê²°
                    </button>
                    <button class="btn-danger" onclick="disconnectDatabase()">
                        âš¡ ì—°ê²° í•´ì œ
                    </button>
                </div>
                
                <div class="file-info">
                    <h4>ì—°ê²°ëœ ì‚¬ì´íŠ¸ ì •ë³´</h4>
                    <div id="connection-info">ì—°ê²°ëœ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
            
            <!-- Tab 2: ëª¨ë“œ ì „í™˜ -->
            <div id="tab-mode" class="tab-content">
                <h3>ğŸ”„ ëª¨ë“œ ì „í™˜ í…ŒìŠ¤íŠ¸</h3>
                <p>ë‹¤ì–‘í•œ ê²½ë¡œë¡œ Equipment Mapping ëª¨ë“œì— ì§„ì…í•©ë‹ˆë‹¤.</p>
                
                <h4>Case 1: ë©”ì¸ ë©”ë‰´ â†’ Dev Mode â†’ Layout Tools â†’ Equipment Mapping</h4>
                <div class="button-group">
                    <button class="btn-secondary" onclick="enterDevMode()">
                        1. Dev Mode ì§„ì…
                    </button>
                    <button class="btn-secondary" onclick="openLayoutTools()" id="btn-layout-tools" disabled>
                        2. Layout Tools ì—´ê¸°
                    </button>
                    <button class="btn-success" onclick="enterMappingMode()" id="btn-mapping-mode" disabled>
                        3. Equipment Mapping ëª¨ë“œ
                    </button>
                </div>
                
                <h4>Case 2: ì§ì ‘ Equipment Mapping ëª¨ë“œ ì§„ì…</h4>
                <div class="button-group">
                    <button class="btn-warning" onclick="directEnterMappingMode()">
                        âš¡ ì§ì ‘ Mapping ëª¨ë“œ ì§„ì…
                    </button>
                </div>
                
                <h4>Case 3: Monitoring Mode â†’ Mapping Mode ì „í™˜</h4>
                <div class="button-group">
                    <button class="btn-info" onclick="enterMonitoringMode()">
                        ğŸ“Š Monitoring Mode ì§„ì…
                    </button>
                    <button class="btn-warning" onclick="switchToMappingFromMonitoring()" id="btn-switch-mapping" disabled>
                        ğŸ”„ Mapping Modeë¡œ ì „í™˜
                    </button>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="exitToViewMode()">
                        ğŸ  View Modeë¡œ ë³µê·€
                    </button>
                </div>
            </div>
            
            <!-- Tab 3: ë§¤í•‘ ì‘ì—… -->
            <div id="tab-mapping" class="tab-content">
                <h3>ğŸ”— Equipment ë§¤í•‘ ì‘ì—…</h3>
                
                <div class="two-column">
                    <div>
                        <h4>3D ì„¤ë¹„ ëª©ë¡ (Frontend ID)</h4>
                        <p style="font-size:12px; color:#888;">ì„¤ë¹„ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                        <div class="equipment-grid" id="equipment-grid">
                            <!-- ë™ì  ìƒì„± -->
                        </div>
                    </div>
                    
                    <div>
                        <h4>DB ì„¤ë¹„ ëª©ë¡ (Equipment ID)</h4>
                        <p style="font-size:12px; color:#888;">ì„ íƒí•œ 3D ì„¤ë¹„ì— ë§¤í•‘í•  DB ì„¤ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                        <div id="selected-equipment" class="file-info" style="margin-bottom:10px;">
                            ì„ íƒëœ ì„¤ë¹„: <strong>ì—†ìŒ</strong>
                        </div>
                        <div class="db-equipment-list" id="db-equipment-list">
                            <!-- ë™ì  ìƒì„± -->
                        </div>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="mapping-progress-bar" style="width: 0%;">0%</div>
                </div>
                
                <div class="button-group">
                    <button class="btn-info" onclick="autoMapSequential()">
                        ğŸ¤– ìˆœì°¨ ìë™ ë§¤í•‘ (10ê°œ)
                    </button>
                    <button class="btn-info" onclick="autoMapAll()">
                        ğŸš€ ì „ì²´ ìë™ ë§¤í•‘
                    </button>
                    <button class="btn-danger" onclick="clearAllMappings()">
                        ğŸ—‘ï¸ ì „ì²´ ë§¤í•‘ ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
            
            <!-- Tab 4: ì €ì¥/ë¡œë“œ -->
            <div id="tab-save" class="tab-content">
                <h3>ğŸ’¾ ì„œë²„ ì €ì¥/ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜</h3>
                
                <div class="two-column">
                    <div>
                        <h4>â˜ï¸ ì„œë²„ì— ì €ì¥</h4>
                        <p style="font-size:12px; color:#888;">í˜„ì¬ ë§¤í•‘ì„ ì„œë²„ì— ì €ì¥í•©ë‹ˆë‹¤. (Mock)</p>
                        <div class="button-group">
                            <button class="btn-success" onclick="saveToServer()">
                                â˜ï¸ ì„œë²„ì— ì €ì¥
                            </button>
                            <button class="btn-secondary" onclick="exportToFile()">
                                ğŸ“ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
                            </button>
                        </div>
                        
                        <div class="file-info" id="save-result" style="display:none;">
                            <h4>ì €ì¥ ê²°ê³¼</h4>
                            <div id="save-result-content"></div>
                        </div>
                    </div>
                    
                    <div>
                        <h4>ğŸ“¥ ì„œë²„ì—ì„œ ë¡œë“œ</h4>
                        <p style="font-size:12px; color:#888;">ì„œë²„ì—ì„œ ë§¤í•‘ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. (Mock)</p>
                        <div class="button-group">
                            <button class="btn-info" onclick="loadFromServer()">
                                ğŸ“¥ ì„œë²„ì—ì„œ ë¡œë“œ
                            </button>
                            <button class="btn-secondary" onclick="importFromFile()">
                                ğŸ“‚ íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                            </button>
                        </div>
                        
                        <h4 style="margin-top:20px;">ì €ì¥ëœ íŒŒì¼ ëª©ë¡ (Mock)</h4>
                        <div id="saved-files-list" class="db-equipment-list">
                            <div style="color:#888; padding:20px; text-align:center;">
                                ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab 5: ê²€ì¦ -->
            <div id="tab-validation" class="tab-content">
                <h3>âœ… ë°ì´í„° ê²€ì¦</h3>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="validateMappingFormat()">
                        ğŸ“‹ ë§¤í•‘ í˜•ì‹ ê²€ì¦
                    </button>
                    <button class="btn-primary" onclick="validateDuplicates()">
                        ğŸ” ì¤‘ë³µ ê²€ì‚¬
                    </button>
                    <button class="btn-primary" onclick="checkCompleteness()">
                        ğŸ“Š ì™„ë£Œë„ ê²€ì‚¬
                    </button>
                    <button class="btn-info" onclick="showCurrentState()">
                        ğŸ”§ í˜„ì¬ ìƒíƒœ ì¶œë ¥
                    </button>
                </div>
                
                <h4>ìƒì„±ë  JSON íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</h4>
                <div class="json-preview" id="json-preview">
                    // ë§¤í•‘ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
                
                <h4>ê²€ì¦ ê²°ê³¼</h4>
                <div id="validation-result" class="file-info">
                    ê²€ì¦ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>
        
        <!-- ë¡œê·¸ ì„¹ì…˜ -->
        <div class="test-section">
            <h3>ğŸ“œ ì‹¤í–‰ ë¡œê·¸</h3>
            <div class="button-group">
                <button class="btn-secondary" onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            </div>
            <div class="log-container" id="log-container">
                <div class="log-entry log-info">
                    <span class="log-time">[ì‹œì‘]</span>
                    Equipment Mapping Mockup Testê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden file input -->
    <input type="file" id="file-input" accept=".json" style="display:none" onchange="handleFileImport(event)">
    
    <script>
        // ============================================
        // Mock Data & State
        // ============================================
        
        const state = {
            currentMode: 'view',  // view, dev, mapping, monitoring
            isConnected: false,
            connectedSite: null,
            siteId: null,
            selectedEquipment: null,
            devModeEnabled: false,
            layoutToolsOpen: false
        };
        
        // Mock EquipmentEditState
        const editState = {
            mappings: {},
            equipmentIdIndex: {},
            
            setMapping(frontendId, dbEquipment) {
                // ì¤‘ë³µ ê²€ì‚¬
                const existing = this.findDuplicate(dbEquipment.equipment_id);
                if (existing && existing !== frontendId) {
                    log(`âš ï¸ Equipment ID ${dbEquipment.equipment_id}ëŠ” ì´ë¯¸ ${existing}ì— ë§¤í•‘ë¨`, 'warn');
                    return false;
                }
                
                // ê¸°ì¡´ ë§¤í•‘ ì œê±°
                if (this.mappings[frontendId]) {
                    delete this.equipmentIdIndex[this.mappings[frontendId].equipment_id];
                }
                
                this.mappings[frontendId] = {
                    frontend_id: frontendId,
                    equipment_id: dbEquipment.equipment_id,
                    equipment_name: dbEquipment.equipment_name,
                    equipment_code: dbEquipment.equipment_code || null,
                    line_name: dbEquipment.line_name || null,
                    mapped_at: new Date().toISOString()
                };
                
                this.equipmentIdIndex[dbEquipment.equipment_id] = frontendId;
                return true;
            },
            
            removeMapping(frontendId) {
                if (this.mappings[frontendId]) {
                    delete this.equipmentIdIndex[this.mappings[frontendId].equipment_id];
                    delete this.mappings[frontendId];
                    return true;
                }
                return false;
            },
            
            getMapping(frontendId) {
                return this.mappings[frontendId] || null;
            },
            
            getMappingCount() {
                return Object.keys(this.mappings).length;
            },
            
            findDuplicate(equipmentId) {
                return this.equipmentIdIndex[equipmentId] || null;
            },
            
            toServerFormat() {
                return Object.values(this.mappings);
            },
            
            reset() {
                this.mappings = {};
                this.equipmentIdIndex = {};
            },
            
            loadFromServer(serverMappings) {
                this.mappings = {};
                this.equipmentIdIndex = {};
                
                for (const [frontendId, item] of Object.entries(serverMappings)) {
                    this.mappings[frontendId] = {
                        frontend_id: frontendId,
                        equipment_id: item.equipment_id,
                        equipment_name: item.equipment_name,
                        equipment_code: item.equipment_code || null,
                        line_name: item.line_name || null,
                        mapped_at: item.mapped_at || new Date().toISOString()
                    };
                    this.equipmentIdIndex[item.equipment_id] = frontendId;
                }
            }
        };
        
        // Mock saved files (localStorage simulation)
        const mockServerStorage = {};
        
        // Generate mock equipment data
        function generateFrontendEquipment() {
            const equipment = [];
            for (let row = 1; row <= 26; row++) {
                for (let col = 1; col <= 6; col++) {
                    // ì¼ë¶€ëŠ” ë³µë„ë¡œ ë¹„ì›€
                    if (col === 3 && row % 2 === 0) continue;
                    equipment.push({
                        id: `EQ-${String(row).padStart(2, '0')}-${String(col).padStart(2, '0')}`,
                        row,
                        col
                    });
                }
            }
            return equipment.slice(0, 117); // 117ê°œë¡œ ì œí•œ
        }
        
        function generateDbEquipment(siteName, lineName) {
            const equipment = [];
            const prefix = siteName === 'korea_site1' ? 'SMD' : (siteName === 'vietnam_site' ? 'VN' : 'US');
            
            for (let i = 1; i <= 120; i++) {
                equipment.push({
                    equipment_id: 100 + i,
                    equipment_name: `${prefix}-MOUNTER-${String(i).padStart(3, '0')}`,
                    equipment_code: `${prefix}${String(i).padStart(4, '0')}`,
                    line_name: lineName.toUpperCase()
                });
            }
            return equipment;
        }
        
        const frontendEquipment = generateFrontendEquipment();
        let dbEquipment = [];
        
        // ============================================
        // UI Functions
        // ============================================
        
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            event.target.classList.add('active');
        }
        
        function updateStatusBar() {
            // ëª¨ë“œ í‘œì‹œ
            const modeEl = document.getElementById('current-mode');
            modeEl.className = `mode-indicator mode-${state.currentMode}`;
            const modeNames = {
                'view': 'View Mode',
                'dev': 'Dev Mode',
                'mapping': 'Equipment Mapping',
                'monitoring': 'Monitoring Mode'
            };
            modeEl.textContent = modeNames[state.currentMode];
            
            // DB ì—°ê²° ìƒíƒœ
            const dbStatusEl = document.getElementById('db-status');
            dbStatusEl.textContent = state.isConnected ? 'ì—°ê²°ë¨' : 'ë¯¸ì—°ê²°';
            dbStatusEl.className = `status-value ${state.isConnected ? 'connected' : 'disconnected'}`;
            
            // Site ID
            document.getElementById('site-id').textContent = state.siteId || '-';
            
            // ë§¤í•‘ ì§„í–‰ë¥ 
            const count = editState.getMappingCount();
            const total = 117;
            const percent = Math.round((count / total) * 100);
            document.getElementById('mapping-progress').textContent = `${count}/${total} (${percent}%)`;
        }
        
        function updateProgressBar() {
            const count = editState.getMappingCount();
            const total = 117;
            const percent = Math.round((count / total) * 100);
            
            const bar = document.getElementById('mapping-progress-bar');
            bar.style.width = `${percent}%`;
            bar.textContent = `${percent}%`;
        }
        
        function renderEquipmentGrid() {
            const grid = document.getElementById('equipment-grid');
            grid.innerHTML = '';
            
            frontendEquipment.forEach(eq => {
                const div = document.createElement('div');
                div.className = 'equipment-item';
                div.dataset.id = eq.id;
                
                const mapping = editState.getMapping(eq.id);
                if (mapping) {
                    div.classList.add('mapped');
                }
                
                if (state.selectedEquipment === eq.id) {
                    div.classList.add('selected');
                }
                
                div.innerHTML = `
                    <div class="eq-id">${eq.id}</div>
                    <div class="eq-name">${mapping ? mapping.equipment_name : '-'}</div>
                `;
                
                div.onclick = () => selectEquipment(eq.id);
                grid.appendChild(div);
            });
        }
        
        function renderDbEquipmentList() {
            const list = document.getElementById('db-equipment-list');
            
            if (!state.isConnected) {
                list.innerHTML = '<div style="color:#888; padding:20px; text-align:center;">ë¨¼ì € DBì— ì—°ê²°í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            list.innerHTML = '';
            
            dbEquipment.forEach(eq => {
                const div = document.createElement('div');
                div.className = 'db-equipment-item';
                
                const usedBy = editState.findDuplicate(eq.equipment_id);
                if (usedBy) {
                    div.classList.add('used');
                }
                
                div.innerHTML = `
                    <div>
                        <strong>${eq.equipment_name}</strong>
                        <div style="font-size:11px; color:#888;">ID: ${eq.equipment_id} | ${eq.line_name}</div>
                    </div>
                    <div>
                        ${usedBy ? `<span class="badge badge-warning">â†’ ${usedBy}</span>` : ''}
                    </div>
                `;
                
                if (!usedBy) {
                    div.onclick = () => mapEquipment(eq);
                }
                
                list.appendChild(div);
            });
        }
        
        function selectEquipment(frontendId) {
            state.selectedEquipment = frontendId;
            
            const mapping = editState.getMapping(frontendId);
            const selectedEl = document.getElementById('selected-equipment');
            
            if (mapping) {
                selectedEl.innerHTML = `
                    ì„ íƒëœ ì„¤ë¹„: <strong>${frontendId}</strong>
                    <br>í˜„ì¬ ë§¤í•‘: ${mapping.equipment_name} (ID: ${mapping.equipment_id})
                    <br><button class="btn-danger" style="margin-top:8px; padding:4px 8px; font-size:11px;" 
                        onclick="unmapEquipment('${frontendId}')">ë§¤í•‘ í•´ì œ</button>
                `;
            } else {
                selectedEl.innerHTML = `ì„ íƒëœ ì„¤ë¹„: <strong>${frontendId}</strong> (ë¯¸ë§¤í•‘)`;
            }
            
            renderEquipmentGrid();
            log(`ğŸ¯ ì„¤ë¹„ ì„ íƒ: ${frontendId}`, 'info');
        }
        
        function mapEquipment(dbEq) {
            if (!state.selectedEquipment) {
                log('âŒ ë¨¼ì € 3D ì„¤ë¹„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                alert('ë¨¼ì € 3D ì„¤ë¹„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const success = editState.setMapping(state.selectedEquipment, dbEq);
            
            if (success) {
                log(`âœ… ë§¤í•‘ ì™„ë£Œ: ${state.selectedEquipment} â†’ ${dbEq.equipment_name} (ID: ${dbEq.equipment_id})`, 'success');
                
                // ë‹¤ìŒ ë¯¸ë§¤í•‘ ì„¤ë¹„ë¡œ ìë™ ì„ íƒ
                const nextUnmapped = frontendEquipment.find(eq => !editState.getMapping(eq.id));
                if (nextUnmapped) {
                    selectEquipment(nextUnmapped.id);
                } else {
                    state.selectedEquipment = null;
                }
                
                renderEquipmentGrid();
                renderDbEquipmentList();
                updateStatusBar();
                updateProgressBar();
                updateJsonPreview();
            }
        }
        
        function unmapEquipment(frontendId) {
            const mapping = editState.getMapping(frontendId);
            if (mapping) {
                editState.removeMapping(frontendId);
                log(`ğŸ—‘ï¸ ë§¤í•‘ í•´ì œ: ${frontendId}`, 'warn');
                
                selectEquipment(frontendId);
                renderEquipmentGrid();
                renderDbEquipmentList();
                updateStatusBar();
                updateProgressBar();
                updateJsonPreview();
            }
        }
        
        // ============================================
        // Connection Functions
        // ============================================
        
        function connectDatabase(siteName, dbName) {
            state.isConnected = true;
            state.connectedSite = { siteName, dbName };
            state.siteId = `${siteName}_${dbName}`;
            
            // DB ì„¤ë¹„ ëª©ë¡ ìƒì„±
            dbEquipment = generateDbEquipment(siteName, dbName);
            
            log(`ğŸ“¡ Database ì—°ê²°: ${state.siteId}`, 'success');
            
            document.getElementById('connection-info').innerHTML = `
                <div class="file-info-row">
                    <span>Site Name:</span>
                    <strong>${siteName}</strong>
                </div>
                <div class="file-info-row">
                    <span>DB Name:</span>
                    <strong>${dbName}</strong>
                </div>
                <div class="file-info-row">
                    <span>Site ID:</span>
                    <strong>${state.siteId}</strong>
                </div>
                <div class="file-info-row">
                    <span>ì„¤ë¹„ ìˆ˜:</span>
                    <strong>${dbEquipment.length}ê°œ</strong>
                </div>
            `;
            
            updateStatusBar();
            renderDbEquipmentList();
        }
        
        function disconnectDatabase() {
            state.isConnected = false;
            state.connectedSite = null;
            state.siteId = null;
            dbEquipment = [];
            
            log('âš¡ Database ì—°ê²° í•´ì œ', 'warn');
            
            document.getElementById('connection-info').textContent = 'ì—°ê²°ëœ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';
            
            updateStatusBar();
            renderDbEquipmentList();
        }
        
        // ============================================
        // Mode Transition Functions
        // ============================================
        
        function enterDevMode() {
            state.currentMode = 'dev';
            state.devModeEnabled = true;
            
            document.getElementById('btn-layout-tools').disabled = false;
            
            log('ğŸ”§ Dev Mode ì§„ì…', 'info');
            updateStatusBar();
        }
        
        function openLayoutTools() {
            if (!state.devModeEnabled) {
                log('âŒ Dev Modeê°€ ì•„ë‹™ë‹ˆë‹¤.', 'error');
                return;
            }
            
            state.layoutToolsOpen = true;
            document.getElementById('btn-mapping-mode').disabled = false;
            
            log('ğŸ› ï¸ Layout Tools ì—´ë¦¼', 'info');
        }
        
        function enterMappingMode() {
            if (!state.devModeEnabled) {
                log('âŒ Dev Modeì—ì„œë§Œ ì§„ì… ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            state.currentMode = 'mapping';
            log('âœ… Equipment Mapping Mode ì§„ì… (ë©”ë‰´ ê²½ë¡œ)', 'success');
            
            updateStatusBar();
            renderEquipmentGrid();
        }
        
        function directEnterMappingMode() {
            // ì§ì ‘ ì§„ì… - Dev Mode ìë™ í™œì„±í™”
            state.devModeEnabled = true;
            state.currentMode = 'mapping';
            
            log('âš¡ Equipment Mapping Mode ì§ì ‘ ì§„ì…', 'success');
            log('  â†’ Dev Mode ìë™ í™œì„±í™”ë¨', 'info');
            
            updateStatusBar();
            renderEquipmentGrid();
        }
        
        function enterMonitoringMode() {
            if (!state.isConnected) {
                log('âŒ DB ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                alert('ë¨¼ì € DBì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            state.currentMode = 'monitoring';
            document.getElementById('btn-switch-mapping').disabled = false;
            
            log('ğŸ“Š Monitoring Mode ì§„ì…', 'info');
            log(`  â†’ Site: ${state.siteId}`, 'info');
            
            updateStatusBar();
        }
        
        function switchToMappingFromMonitoring() {
            if (state.currentMode !== 'monitoring') {
                log('âŒ Monitoring Modeì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            state.devModeEnabled = true;
            state.currentMode = 'mapping';
            
            log('ğŸ”„ Monitoring â†’ Mapping Mode ì „í™˜', 'success');
            
            updateStatusBar();
            renderEquipmentGrid();
        }
        
        function exitToViewMode() {
            state.currentMode = 'view';
            state.devModeEnabled = false;
            state.layoutToolsOpen = false;
            
            document.getElementById('btn-layout-tools').disabled = true;
            document.getElementById('btn-mapping-mode').disabled = true;
            document.getElementById('btn-switch-mapping').disabled = true;
            
            log('ğŸ  View Modeë¡œ ë³µê·€', 'info');
            updateStatusBar();
        }
        
        // ============================================
        // Auto Mapping Functions
        // ============================================
        
        function autoMapSequential() {
            if (!state.isConnected) {
                log('âŒ DB ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            let count = 0;
            for (const feq of frontendEquipment) {
                if (count >= 10) break;
                if (editState.getMapping(feq.id)) continue;
                
                const availableDb = dbEquipment.find(db => !editState.findDuplicate(db.equipment_id));
                if (availableDb) {
                    editState.setMapping(feq.id, availableDb);
                    count++;
                }
            }
            
            log(`ğŸ¤– ìˆœì°¨ ìë™ ë§¤í•‘: ${count}ê°œ ì™„ë£Œ`, 'success');
            
            renderEquipmentGrid();
            renderDbEquipmentList();
            updateStatusBar();
            updateProgressBar();
            updateJsonPreview();
        }
        
        function autoMapAll() {
            if (!state.isConnected) {
                log('âŒ DB ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            let count = 0;
            let dbIndex = 0;
            
            for (const feq of frontendEquipment) {
                if (editState.getMapping(feq.id)) continue;
                
                while (dbIndex < dbEquipment.length && editState.findDuplicate(dbEquipment[dbIndex].equipment_id)) {
                    dbIndex++;
                }
                
                if (dbIndex < dbEquipment.length) {
                    editState.setMapping(feq.id, dbEquipment[dbIndex]);
                    count++;
                    dbIndex++;
                }
            }
            
            log(`ğŸš€ ì „ì²´ ìë™ ë§¤í•‘: ${count}ê°œ ì™„ë£Œ`, 'success');
            
            renderEquipmentGrid();
            renderDbEquipmentList();
            updateStatusBar();
            updateProgressBar();
            updateJsonPreview();
        }
        
        function clearAllMappings() {
            if (!confirm('ëª¨ë“  ë§¤í•‘ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            editState.reset();
            state.selectedEquipment = null;
            
            log('ğŸ—‘ï¸ ì „ì²´ ë§¤í•‘ ì´ˆê¸°í™”', 'warn');
            
            renderEquipmentGrid();
            renderDbEquipmentList();
            updateStatusBar();
            updateProgressBar();
            updateJsonPreview();
            
            document.getElementById('selected-equipment').innerHTML = 'ì„ íƒëœ ì„¤ë¹„: <strong>ì—†ìŒ</strong>';
        }
        
        // ============================================
        // Save/Load Functions
        // ============================================
        
        function saveToServer() {
            if (!state.siteId) {
                log('âŒ ì—°ê²°ëœ Siteê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                alert('ë¨¼ì € DBì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const count = editState.getMappingCount();
            if (count === 0) {
                log('âŒ ì €ì¥í•  ë§¤í•‘ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                alert('ì €ì¥í•  ë§¤í•‘ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // íŒŒì¼ í˜•ì‹ ìƒì„±
            const config = generateMappingConfig();
            
            // Mock ì €ì¥
            const filename = `equipment_mapping_${state.siteId}.json`;
            mockServerStorage[filename] = {
                config,
                savedAt: new Date().toISOString()
            };
            
            log(`â˜ï¸ ì„œë²„ ì €ì¥ ì™„ë£Œ: ${filename}`, 'success');
            log(`  â†’ ë§¤í•‘ ìˆ˜: ${count}ê°œ`, 'info');
            
            // ê²°ê³¼ í‘œì‹œ
            const resultEl = document.getElementById('save-result');
            resultEl.style.display = 'block';
            document.getElementById('save-result-content').innerHTML = `
                <div class="file-info-row">
                    <span>íŒŒì¼ëª…:</span>
                    <strong>${filename}</strong>
                </div>
                <div class="file-info-row">
                    <span>Site ID:</span>
                    <strong>${config.site_id}</strong>
                </div>
                <div class="file-info-row">
                    <span>ë§¤í•‘ ìˆ˜:</span>
                    <strong>${count}ê°œ</strong>
                </div>
                <div class="file-info-row">
                    <span>ì €ì¥ ì‹œê°„:</span>
                    <strong>${new Date().toLocaleString()}</strong>
                </div>
            `;
            
            updateSavedFilesList();
        }
        
        function loadFromServer() {
            if (!state.siteId) {
                log('âŒ ì—°ê²°ëœ Siteê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                alert('ë¨¼ì € DBì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const filename = `equipment_mapping_${state.siteId}.json`;
            const saved = mockServerStorage[filename];
            
            if (!saved) {
                log(`âŒ ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: ${filename}`, 'error');
                alert(`ì €ì¥ëœ ë§¤í•‘ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.\níŒŒì¼ëª…: ${filename}`);
                return;
            }
            
            // ë§¤í•‘ ë¡œë“œ
            const serverMappings = saved.config.mappings;
            editState.loadFromServer(serverMappings);
            
            log(`ğŸ“¥ ì„œë²„ ë¡œë“œ ì™„ë£Œ: ${filename}`, 'success');
            log(`  â†’ ë§¤í•‘ ìˆ˜: ${Object.keys(serverMappings).length}ê°œ`, 'info');
            
            renderEquipmentGrid();
            renderDbEquipmentList();
            updateStatusBar();
            updateProgressBar();
            updateJsonPreview();
        }
        
        function exportToFile() {
            const config = generateMappingConfig();
            const json = JSON.stringify(config, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `equipment_mapping_${state.siteId || 'default'}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log(`ğŸ“ íŒŒì¼ ë‚´ë³´ë‚´ê¸°: ${a.download}`, 'success');
        }
        
        function importFromFile() {
            document.getElementById('file-input').click();
        }
        
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const config = JSON.parse(e.target.result);
                    
                    if (config.mappings) {
                        editState.loadFromServer(config.mappings);
                        
                        log(`ğŸ“‚ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ: ${file.name}`, 'success');
                        log(`  â†’ Site: ${config.site_id || 'Unknown'}`, 'info');
                        log(`  â†’ ë§¤í•‘ ìˆ˜: ${Object.keys(config.mappings).length}ê°œ`, 'info');
                        
                        renderEquipmentGrid();
                        renderDbEquipmentList();
                        updateStatusBar();
                        updateProgressBar();
                        updateJsonPreview();
                    } else {
                        throw new Error('Invalid mapping file format');
                    }
                } catch (error) {
                    log(`âŒ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${error.message}`, 'error');
                    alert(`íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n${error.message}`);
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }
        
        function updateSavedFilesList() {
            const list = document.getElementById('saved-files-list');
            const files = Object.keys(mockServerStorage);
            
            if (files.length === 0) {
                list.innerHTML = '<div style="color:#888; padding:20px; text-align:center;">ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            list.innerHTML = '';
            files.forEach(filename => {
                const saved = mockServerStorage[filename];
                const div = document.createElement('div');
                div.className = 'db-equipment-item';
                div.innerHTML = `
                    <div>
                        <strong>${filename}</strong>
                        <div style="font-size:11px; color:#888;">
                            ${Object.keys(saved.config.mappings).length}ê°œ ë§¤í•‘ | 
                            ${new Date(saved.savedAt).toLocaleString()}
                        </div>
                    </div>
                    <button class="btn-info" style="padding:4px 8px; font-size:11px;" 
                        onclick="previewSavedFile('${filename}')">ë¯¸ë¦¬ë³´ê¸°</button>
                `;
                list.appendChild(div);
            });
        }
        
        function previewSavedFile(filename) {
            const saved = mockServerStorage[filename];
            if (saved) {
                document.getElementById('json-preview').textContent = JSON.stringify(saved.config, null, 2);
                showTab('validation');
            }
        }
        
        // ============================================
        // Validation Functions
        // ============================================
        
        function generateMappingConfig() {
            const mappingsObj = {};
            
            for (const [frontendId, mapping] of Object.entries(editState.mappings)) {
                mappingsObj[frontendId] = {
                    frontend_id: mapping.frontend_id,
                    equipment_id: mapping.equipment_id,
                    equipment_name: mapping.equipment_name,
                    equipment_code: mapping.equipment_code,
                    line_name: mapping.line_name,
                    mapped_at: mapping.mapped_at
                };
            }
            
            // Parse site_id
            let siteName = 'unknown';
            let dbName = 'unknown';
            if (state.siteId) {
                const parts = state.siteId.split('_');
                if (parts.length >= 2) {
                    siteName = parts.slice(0, -1).join('_');
                    dbName = parts[parts.length - 1];
                }
            }
            
            return {
                site_id: state.siteId || 'default_site',
                site_name: siteName,
                db_name: dbName,
                display_name: state.connectedSite ? 
                    `${state.connectedSite.siteName} - ${state.connectedSite.dbName}` : 
                    'Default Site',
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
                created_by: 'admin',
                version: '1.0.0',
                total_mappings: editState.getMappingCount(),
                mappings: mappingsObj
            };
        }
        
        function updateJsonPreview() {
            const config = generateMappingConfig();
            document.getElementById('json-preview').textContent = JSON.stringify(config, null, 2);
        }
        
        function validateMappingFormat() {
            const config = generateMappingConfig();
            const errors = [];
            const warnings = [];
            
            // Required fields check
            if (!config.site_id) errors.push('site_id í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
            if (!config.mappings) errors.push('mappings í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
            
            // Mapping format check
            for (const [frontendId, mapping] of Object.entries(config.mappings)) {
                if (!mapping.frontend_id) errors.push(`${frontendId}: frontend_id ëˆ„ë½`);
                if (!mapping.equipment_id) errors.push(`${frontendId}: equipment_id ëˆ„ë½`);
                if (!mapping.equipment_name) warnings.push(`${frontendId}: equipment_name ëˆ„ë½`);
            }
            
            const resultEl = document.getElementById('validation-result');
            
            if (errors.length === 0) {
                resultEl.innerHTML = `
                    <span class="badge badge-success">âœ… í˜•ì‹ ê²€ì¦ í†µê³¼</span>
                    <p style="margin-top:10px; color:#888;">ëª¨ë“  í•„ìˆ˜ í•„ë“œê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                    ${warnings.length > 0 ? `<p style="color:#ffd93d;">âš ï¸ ê²½ê³ : ${warnings.join(', ')}</p>` : ''}
                `;
                log('âœ… ë§¤í•‘ í˜•ì‹ ê²€ì¦ í†µê³¼', 'success');
            } else {
                resultEl.innerHTML = `
                    <span class="badge badge-error">âŒ í˜•ì‹ ì˜¤ë¥˜ ë°œê²¬</span>
                    <ul style="margin-top:10px; color:#f45c43;">
                        ${errors.map(e => `<li>${e}</li>`).join('')}
                    </ul>
                `;
                log(`âŒ ë§¤í•‘ í˜•ì‹ ì˜¤ë¥˜: ${errors.length}ê°œ`, 'error');
            }
        }
        
        function validateDuplicates() {
            const mappings = editState.toServerFormat();
            const equipmentIds = mappings.map(m => m.equipment_id);
            const duplicates = equipmentIds.filter((id, i) => equipmentIds.indexOf(id) !== i);
            
            const resultEl = document.getElementById('validation-result');
            
            if (duplicates.length === 0) {
                resultEl.innerHTML = `
                    <span class="badge badge-success">âœ… ì¤‘ë³µ ì—†ìŒ</span>
                    <p style="margin-top:10px; color:#888;">ëª¨ë“  equipment_idê°€ ê³ ìœ í•©ë‹ˆë‹¤.</p>
                `;
                log('âœ… ì¤‘ë³µ ê²€ì‚¬ í†µê³¼', 'success');
            } else {
                resultEl.innerHTML = `
                    <span class="badge badge-error">âŒ ì¤‘ë³µ ë°œê²¬</span>
                    <p style="margin-top:10px; color:#f45c43;">
                        ì¤‘ë³µëœ Equipment ID: ${[...new Set(duplicates)].join(', ')}
                    </p>
                `;
                log(`âŒ ì¤‘ë³µ ë°œê²¬: ${duplicates.length}ê°œ`, 'error');
            }
        }
        
        function checkCompleteness() {
            const total = 117;
            const mapped = editState.getMappingCount();
            const percent = Math.round((mapped / total) * 100);
            
            const unmapped = frontendEquipment.filter(eq => !editState.getMapping(eq.id)).slice(0, 10);
            
            const resultEl = document.getElementById('validation-result');
            resultEl.innerHTML = `
                <span class="badge ${percent === 100 ? 'badge-success' : 'badge-warning'}">
                    ${percent === 100 ? 'âœ… ì™„ë£Œ' : `âš ï¸ ${percent}%`}
                </span>
                <p style="margin-top:10px;">
                    ë§¤í•‘ë¨: <strong>${mapped}</strong> / ${total}
                </p>
                ${unmapped.length > 0 ? `
                    <p style="color:#888; font-size:12px;">
                        ë¯¸ë§¤í•‘ ì„¤ë¹„ (ì¼ë¶€): ${unmapped.map(e => e.id).join(', ')}
                        ${mapped + unmapped.length < total ? '...' : ''}
                    </p>
                ` : ''}
            `;
            
            log(`ğŸ“Š ì™„ë£Œë„: ${mapped}/${total} (${percent}%)`, percent === 100 ? 'success' : 'warn');
        }
        
        function showCurrentState() {
            console.group('ğŸ”§ EquipmentEditState Debug Info');
            console.log('Mapping Count:', editState.getMappingCount());
            console.log('Mappings:', editState.mappings);
            console.log('Equipment ID Index:', editState.equipmentIdIndex);
            console.log('State:', state);
            console.table(editState.toServerFormat().slice(0, 20));
            console.groupEnd();
            
            log('ğŸ”§ í˜„ì¬ ìƒíƒœê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. (F12)', 'info');
            
            updateJsonPreview();
        }
        
        // ============================================
        // Logging
        // ============================================
        
        function log(message, type = 'info') {
            const container = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `<span class="log-time">[${time}]</span>${message}`;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        function clearLogs() {
            const container = document.getElementById('log-container');
            container.innerHTML = `
                <div class="log-entry log-info">
                    <span class="log-time">[ì´ˆê¸°í™”]</span>
                    ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
        
        // ============================================
        // Initialize
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            updateStatusBar();
            renderEquipmentGrid();
            renderDbEquipmentList();
            updateJsonPreview();
            
            log('ğŸš€ Mockup Test í™˜ê²½ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            log('ğŸ“Œ Step 1: "DB ì—°ê²°" íƒ­ì—ì„œ ì‚¬ì´íŠ¸ë¥¼ ì—°ê²°í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html>