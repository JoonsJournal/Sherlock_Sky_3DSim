<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<!--
 * ranking-view-test.html v4.0
 * ===========================
 * ğŸ†• ëª¨ë“  DB í•„ë“œ Mock í…ŒìŠ¤íŠ¸ ë²„ì „
 * 
 * ğŸ“Š í‘œì‹œë˜ëŠ” ëª¨ë“  í•„ë“œ (DB â†’ Frontend 100% ì—°ê²°):
 *    âœ… equipment_id, equipment_name, frontend_id
 *    âœ… status, occurredAt (Duration ê³„ì‚°ìš©)
 *    âœ… alarmCode, alarmMessage, alarmRepeatCount
 *    âœ… productionCount, targetCount (Progress Bar)
 *    âœ… lotId, lotStartTime (Lot Time)
 *    âœ… stateHistory (MiniTimeline)
 * 
 * ğŸ“¦ Import ëª¨ë“ˆ ëª©ë¡:
 *    - EventBus
 *    - RankingView, RankingLane, EquipmentCard
 *    - AnimationManager, PositionCalculator, BatchAnimator
 *    - MiniTimeline (EquipmentCard ë‚´ë¶€)
 * 
 * ì‘ì„±ì¼: 2026-01-23
 * ìˆ˜ì •ì¼: 2026-01-24 (v4.0 - Full DB Fields Mock)
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Ranking View Test v4.0 - All DB Fields Mock</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; flex-direction: column; height: 100vh; overflow: hidden; font-family: 'Inter', 'Segoe UI', sans-serif; background: var(--bg-main, #0a0a0f); color: #fff; }
        
        .test-header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .test-header h1 { font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .test-header .version { font-size: 11px; background: #8b5cf6; padding: 2px 6px; border-radius: 4px; }
        .test-header .badge { font-size: 10px; background: #22c55e; padding: 2px 6px; border-radius: 4px; margin-left: 4px; }
        .test-header .badge-api { background: #06b6d4; }
        
        .test-content { flex: 1; display: flex; overflow: hidden; }
        .ranking-container { flex: 1; position: relative; overflow: hidden; }
        
        .test-panel { width: 320px; background: #111; border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; overflow-y: auto; }
        .panel-section { border-bottom: 1px solid rgba(255,255,255,0.1); }
        .panel-section-header { padding: 10px 12px; background: rgba(255,255,255,0.03); font-weight: 600; font-size: 12px; color: #888; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }
        .panel-section-content { padding: 10px 12px; }
        
        .control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .control-btn { padding: 10px 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .control-btn .icon { font-size: 18px; }
        .control-btn .label { font-size: 10px; }
        .control-btn .key { font-size: 9px; opacity: 0.6; background: rgba(0,0,0,0.2); padding: 1px 4px; border-radius: 3px; }
        .control-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .control-btn:hover:not(:disabled) { transform: translateY(-1px); filter: brightness(1.1); }
        
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #22c55e; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-purple { background: #8b5cf6; color: white; }
        .btn-cyan { background: #06b6d4; color: white; }
        .btn-gray { background: #4b5563; color: white; }
        .btn-wide { grid-column: span 2; }
        
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; }
        .toggle-row label { font-size: 11px; color: #ccc; }
        .toggle-switch { position: relative; width: 40px; height: 22px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: 0.3s; border-radius: 22px; }
        .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: #888; transition: 0.3s; border-radius: 50%; }
        .toggle-switch input:checked + .toggle-slider { background-color: #8b5cf6; }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(18px); background-color: white; }
        
        .auto-row { display: flex; gap: 6px; align-items: center; margin: 6px 0; }
        .auto-row label { font-size: 11px; color: #aaa; min-width: 40px; }
        .auto-row input[type="range"] { flex: 1; height: 6px; border-radius: 3px; background: #333; appearance: none; }
        .auto-row input[type="range"]::-webkit-slider-thumb { appearance: none; width: 14px; height: 14px; border-radius: 50%; background: #8b5cf6; cursor: pointer; }
        .auto-row .value { font-size: 11px; font-weight: 600; min-width: 35px; text-align: right; color: #8b5cf6; }
        
        .status-box { display: flex; align-items: center; gap: 8px; padding: 8px 10px; background: rgba(255,255,255,0.03); border-radius: 6px; font-size: 11px; margin-top: 6px; }
        .status-box .dot { width: 8px; height: 8px; border-radius: 50%; background: #ef4444; }
        .status-box.active .dot { background: #22c55e; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 8px 4px; border-radius: 4px; text-align: center; }
        .stat-box .val { font-size: 16px; font-weight: 700; }
        .stat-box .lbl { font-size: 8px; color: #888; text-transform: uppercase; }
        .stat-box.run .val { color: #22c55e; }
        .stat-box.idle .val { color: #f59e0b; }
        .stat-box.stop .val { color: #f97316; }
        .stat-box.sudden .val { color: #ef4444; }
        
        /* ğŸ“‹ DB í•„ë“œ ì²´í¬ë¦¬ìŠ¤íŠ¸ */
        .field-checklist { font-size: 10px; }
        .field-item { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .field-item:last-child { border-bottom: none; }
        .field-item .name { color: #aaa; }
        .field-item .status { font-weight: 600; }
        .field-item .status.ok { color: #22c55e; }
        .field-item .status.pending { color: #f59e0b; }
        
        /* ğŸ“Š ì„ íƒëœ ì¹´ë“œ ìƒì„¸ ì •ë³´ */
        .detail-panel { background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; padding: 10px; margin-top: 8px; }
        .detail-panel h4 { font-size: 11px; color: #8b5cf6; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 10px; }
        .detail-item { background: rgba(0,0,0,0.2); padding: 4px 6px; border-radius: 4px; }
        .detail-item .label { color: #888; font-size: 9px; }
        .detail-item .value { color: #fff; font-weight: 600; word-break: break-all; }
        .detail-item.full { grid-column: span 2; }
        .detail-item.alarm { background: rgba(239, 68, 68, 0.2); }
        .detail-item.production { background: rgba(34, 197, 94, 0.2); }
        .detail-item.timeline { background: rgba(6, 182, 212, 0.2); }
        
        /* ëª¨ë“ˆ ë¦¬ìŠ¤íŠ¸ */
        .module-list { font-size: 10px; color: #666; }
        .module-list .item { padding: 3px 0; display: flex; justify-content: space-between; }
        .module-list .ok { color: #22c55e; }
        .module-list .fail { color: #ef4444; }
        
        /* ë¡œê·¸ íŒ¨ë„ */
        .test-log { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 150px; }
        .test-log-header { padding: 8px 12px; background: rgba(255,255,255,0.03); font-size: 12px; display: flex; justify-content: space-between; }
        .test-log-header button { font-size: 10px; padding: 2px 6px; background: #333; border: none; border-radius: 3px; color: #aaa; cursor: pointer; }
        .test-log-content { flex: 1; overflow-y: auto; padding: 8px; font-family: monospace; font-size: 10px; line-height: 1.5; background: #0a0a0a; }
        .log-entry { padding: 2px 0; }
        .log-entry.success { color: #22c55e; }
        .log-entry.error { color: #ef4444; }
        .log-entry.warning { color: #f59e0b; }
        .log-entry.info { color: #60a5fa; }
        .log-entry.move { color: #c084fc; }
        .log-entry.anim { color: #f472b6; }
        .log-entry.sort { color: #34d399; }
        .log-entry.data { color: #06b6d4; }
        .log-entry.divider { color: #444; }
        
        .ranking-view { position: relative !important; left: 0 !important; width: 100% !important; }
        
        /* í‚¤ë³´ë“œ ë„ì›€ë§ */
        .keyboard-help { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 8px 12px; border-radius: 6px; font-size: 10px; color: #888; z-index: 1000; }
        .keyboard-help kbd { background: #333; padding: 2px 6px; border-radius: 3px; margin: 0 2px; color: #fff; }
    </style>
</head>
<body>
    <header class="test-header">
        <h1>
            ğŸ§ª Ranking View Test 
            <span class="version">v4.0</span>
            <span class="badge">ğŸ“¦ Mock Data</span>
            <span class="badge badge-api">âœ… All DB Fields</span>
        </h1>
        <div style="font-size: 11px; color: #888;">
            Press <kbd style="background:#333;padding:2px 6px;border-radius:3px;">H</kbd> for help
        </div>
    </header>
    
    <div class="test-content">
        <div class="ranking-container" id="ranking-container"></div>
        
        <div class="test-panel">
            <!-- ëª¨ë“ˆ ìƒíƒœ -->
            <div class="panel-section">
                <div class="panel-section-header">ğŸ”Œ Imported Modules</div>
                <div class="panel-section-content">
                    <div class="module-list" id="module-status"></div>
                </div>
            </div>
            
            <!-- DB í•„ë“œ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
            <div class="panel-section">
                <div class="panel-section-header">
                    ğŸ“Š DB Fields Status
                    <span style="font-size:10px;color:#22c55e;">âœ… 100%</span>
                </div>
                <div class="panel-section-content">
                    <div class="field-checklist" id="field-checklist">
                        <div class="field-item"><span class="name">equipment_name</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">status</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">occurredAt (Duration)</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">alarmCode</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">alarmMessage</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">alarmRepeatCount</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">productionCount</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">targetCount (LotQty)</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">lotId</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">lotStartTime</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                        <div class="field-item"><span class="name">stateHistory (Timeline)</span><span class="status ok">âœ“ ì—°ê²°ë¨</span></div>
                    </div>
                </div>
            </div>
            
            <!-- ë°ì´í„° ì»¨íŠ¸ë¡¤ -->
            <div class="panel-section">
                <div class="panel-section-header">ğŸ“¦ Data Control</div>
                <div class="panel-section-content">
                    <div class="control-grid">
                        <button class="control-btn btn-primary btn-wide" onclick="loadMockData()">
                            <span class="icon">ğŸ“¦</span>
                            <span class="label">Mock ë°ì´í„° ë¡œë“œ</span>
                            <span class="key">D</span>
                        </button>
                        <button class="control-btn btn-gray" onclick="clearAllData()">
                            <span class="icon">ğŸ—‘ï¸</span>
                            <span class="label">ì´ˆê¸°í™”</span>
                            <span class="key">C</span>
                        </button>
                        <button class="control-btn btn-cyan" onclick="debugSnapshot()">
                            <span class="icon">ğŸ“Š</span>
                            <span class="label">ìŠ¤ëƒ…ìƒ·</span>
                            <span class="key">S</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ì• ë‹ˆë©”ì´ì…˜ ì„¤ì • -->
            <div class="panel-section">
                <div class="panel-section-header">ğŸ¬ Animation</div>
                <div class="panel-section-content">
                    <div class="toggle-row">
                        <label>4-Phase ì• ë‹ˆë©”ì´ì…˜</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="use-animation" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <label>ì •ë ¬ ìœ„ì¹˜ ê³„ì‚°</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="use-sorting" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="status-box" id="anim-status">
                        <span class="dot"></span>
                        <span id="anim-status-text">ëŒ€ê¸° ì¤‘</span>
                    </div>
                </div>
            </div>
            
            <!-- ìˆ˜ë™ ì´ë™ -->
            <div class="panel-section">
                <div class="panel-section-header">ğŸ¯ Manual Move</div>
                <div class="panel-section-content">
                    <div class="control-grid">
                        <button class="control-btn btn-success" onclick="testMoveToRun()">
                            <span class="icon">ğŸŸ¢</span>
                            <span class="label">RUN</span>
                            <span class="key">1</span>
                        </button>
                        <button class="control-btn btn-warning" onclick="testMoveToIdle()">
                            <span class="icon">ğŸŸ¡</span>
                            <span class="label">IDLE</span>
                            <span class="key">2</span>
                        </button>
                        <button class="control-btn btn-danger" onclick="testMoveToStop()">
                            <span class="icon">ğŸ›‘</span>
                            <span class="label">STOP</span>
                            <span class="key">3</span>
                        </button>
                        <button class="control-btn btn-purple" onclick="testMoveToSuddenStop()">
                            <span class="icon">âš ï¸</span>
                            <span class="label">SUDDEN</span>
                            <span class="key">4</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ìë™ ì´ë™ -->
            <div class="panel-section">
                <div class="panel-section-header">ğŸ”„ Auto Random</div>
                <div class="panel-section-content">
                    <div class="auto-row">
                        <label>ê°„ê²©</label>
                        <input type="range" id="auto-interval" min="1000" max="5000" value="2500" step="100">
                        <span class="value" id="interval-value">2.5s</span>
                    </div>
                    <div class="control-grid">
                        <button class="control-btn btn-success" onclick="startAutoMove()" id="btn-start">
                            <span class="icon">â–¶ï¸</span>
                            <span class="label">ì‹œì‘</span>
                            <span class="key">Space</span>
                        </button>
                        <button class="control-btn btn-danger" onclick="stopAutoMove()" id="btn-stop" disabled>
                            <span class="icon">â¹ï¸</span>
                            <span class="label">ì¤‘ì§€</span>
                        </button>
                    </div>
                    <div class="status-box" id="auto-status">
                        <span class="dot"></span>
                        <span>ìë™: <strong id="auto-status-text">ì¤‘ì§€</strong></span>
                        <span id="auto-count" style="margin-left:auto;color:#888;">0íšŒ</span>
                    </div>
                </div>
            </div>
            
            <!-- í†µê³„ -->
            <div class="panel-section">
                <div class="panel-section-header">ğŸ“ˆ Stats</div>
                <div class="panel-section-content">
                    <div class="stats-grid">
                        <div class="stat-box run">
                            <div class="val" id="stat-run">0</div>
                            <div class="lbl">RUN</div>
                        </div>
                        <div class="stat-box idle">
                            <div class="val" id="stat-idle">0</div>
                            <div class="lbl">IDLE</div>
                        </div>
                        <div class="stat-box stop">
                            <div class="val" id="stat-stop">0</div>
                            <div class="lbl">STOP</div>
                        </div>
                        <div class="stat-box sudden">
                            <div class="val" id="stat-sudden">0</div>
                            <div class="lbl">SUDDEN</div>
                        </div>
                    </div>
                    
                    <!-- ì„ íƒëœ ì¹´ë“œ ìƒì„¸ ì •ë³´ -->
                    <div class="detail-panel" id="detail-panel" style="display:none;">
                        <h4>ğŸ“‹ ì„ íƒëœ ì„¤ë¹„ ì •ë³´</h4>
                        <div class="detail-grid" id="detail-content"></div>
                    </div>
                </div>
            </div>
            
            <!-- ë¡œê·¸ -->
            <div class="panel-section test-log">
                <div class="test-log-header">
                    <span>ğŸ“‹ Log</span>
                    <button onclick="clearLog()">Clear</button>
                </div>
                <div class="test-log-content" id="test-log"></div>
            </div>
        </div>
    </div>
    
    <!-- í‚¤ë³´ë“œ ë„ì›€ë§ -->
    <div class="keyboard-help">
        <kbd>D</kbd> ë¡œë“œ 
        <kbd>C</kbd> ì´ˆê¸°í™” 
        <kbd>1-4</kbd> ì´ë™ 
        <kbd>R</kbd> ëœë¤ 
        <kbd>Space</kbd> ìë™
    </div>
    
    <script type="importmap">
    {
        "imports": {
            "three": "./node_modules/three/build/three.module.js",
            "three/addons/": "./node_modules/three/examples/jsm/"
        }
    }
    </script>
    
    <script type="module">
        // ========================================
        // ğŸ“¦ IMPORTS - ê¸°ì¡´ ëª¨ë“ˆ ì „ì²´ í™œìš©
        // ========================================
        import { eventBus } from './src/core/managers/EventBus.js';
        import { RankingView } from './src/ui/ranking-view/RankingView.js';
        import { RankingLane } from './src/ui/ranking-view/components/RankingLane.js';
        import { EquipmentCard } from './src/ui/ranking-view/components/EquipmentCard.js';
        import { AnimationManager } from './src/ui/ranking-view/managers/AnimationManager.js';
        import { PositionCalculator } from './src/ui/ranking-view/utils/PositionCalculator.js';
        import { BatchAnimator } from './src/ui/ranking-view/utils/BatchAnimator.js';
        
        // ========================================
        // ğŸ”Œ Module Status Check
        // ========================================
        const modules = { 
            EventBus: eventBus, 
            RankingView, 
            RankingLane, 
            EquipmentCard, 
            AnimationManager, 
            PositionCalculator, 
            BatchAnimator 
        };
        
        function checkModules() {
            const el = document.getElementById('module-status');
            el.innerHTML = Object.entries(modules).map(([n, m]) => 
                `<div class="item"><span>${n}</span><span class="${m ? 'ok' : 'fail'}">${m ? 'âœ“' : 'âœ—'}</span></div>`
            ).join('');
        }
        
        // ========================================
        // ğŸŒ Globals
        // ========================================
        let rankingView = null;
        let animationManager = null;
        let positionCalculator = null;
        let testEquipments = [];
        let autoMoveInterval = null;
        let autoMoveCount = 0;
        let isAnimating = false;
        let selectedEquipmentId = null;
        
        // ========================================
        // ğŸ“ Logger
        // ========================================
        function log(msg, type = 'info') {
            const el = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString('ko-KR', { 
                hour: '2-digit', minute: '2-digit', second: '2-digit' 
            });
            entry.textContent = `[${time}] ${msg}`;
            el.appendChild(entry);
            el.scrollTop = el.scrollHeight;
            while (el.children.length > 150) el.removeChild(el.firstChild);
        }
        window.log = log;
        window.clearLog = () => { 
            document.getElementById('test-log').innerHTML = ''; 
            log('ğŸ“‹ ë¡œê·¸ ì´ˆê¸°í™”'); 
        };
        
        function setAnimStatus(text, active = false) {
            document.getElementById('anim-status-text').textContent = text;
            document.getElementById('anim-status').classList.toggle('active', active);
        }
        
        // ========================================
        // ğŸš€ Initialize
        // ========================================
        function init() {
            log('ğŸš€ ì´ˆê¸°í™” ì‹œì‘ (v4.0 - All DB Fields)...', 'info');
            checkModules();
            
            const container = document.getElementById('ranking-container');
            rankingView = new RankingView({ 
                container, 
                webSocketClient: null, 
                useUDS: false 
            });
            rankingView.show();
            
            // AnimationManager & PositionCalculator
            animationManager = rankingView._animationManager || new AnimationManager({
                container: rankingView._lanesContainer,
                lanesMap: rankingView._lanes,
                cardsMap: rankingView._cardsMap
            });
            
            positionCalculator = animationManager._positionCalculator || new PositionCalculator({
                container: rankingView._lanesContainer,
                lanesMap: rankingView._lanes
            });
            
            // EventBus ë¦¬ìŠ¤ë„ˆ - ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
            eventBus.on('equipment:select', (data) => {
                selectedEquipmentId = data.frontendId;
                showEquipmentDetail(data.cardData);
                log(`ğŸ–±ï¸ ì¹´ë“œ ì„ íƒ: ${data.frontendId}`, 'info');
            });
            
            // Global expose for debugging
            window.rankingView = rankingView;
            window.animationManager = animationManager;
            window.positionCalculator = positionCalculator;
            window.eventBus = eventBus;
            
            log('âœ… ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            log(`ğŸ“Š ëª¨ë“  DB í•„ë“œ Mock ë°ì´í„° ì¤€ë¹„ë¨`, 'data');
        }
        
        // ========================================
        // ğŸ“Š ì„ íƒëœ ì„¤ë¹„ ìƒì„¸ ì •ë³´ í‘œì‹œ
        // ========================================
        function showEquipmentDetail(data) {
            const panel = document.getElementById('detail-panel');
            const content = document.getElementById('detail-content');
            
            if (!data) {
                panel.style.display = 'none';
                return;
            }
            
            panel.style.display = 'block';
            
            // ìƒíƒœ íˆìŠ¤í† ë¦¬ ìš”ì•½
            const historyCount = data.stateHistory?.length || 0;
            const lastHistory = data.stateHistory?.[data.stateHistory.length - 1];
            
            content.innerHTML = `
                <div class="detail-item">
                    <div class="label">Equipment ID</div>
                    <div class="value">${data.equipmentId || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="label">Frontend ID</div>
                    <div class="value">${data.frontendId || '-'}</div>
                </div>
                <div class="detail-item full">
                    <div class="label">Equipment Name</div>
                    <div class="value">${data.equipmentName || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="label">Status</div>
                    <div class="value" style="color:${getStatusColor(data.status)}">${data.status || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="label">Duration</div>
                    <div class="value">${formatDuration(data.occurredAt)}</div>
                </div>
                ${data.alarmCode ? `
                <div class="detail-item alarm">
                    <div class="label">âš ï¸ Alarm Code</div>
                    <div class="value">${data.alarmCode}</div>
                </div>
                <div class="detail-item alarm full">
                    <div class="label">Alarm Message</div>
                    <div class="value">${data.alarmMessage || '-'}</div>
                </div>
                <div class="detail-item alarm">
                    <div class="label">ğŸ”„ Repeat Count</div>
                    <div class="value">${data.alarmRepeatCount || 0}íšŒ</div>
                </div>
                ` : ''}
                <div class="detail-item production">
                    <div class="label">ğŸ“¦ Production</div>
                    <div class="value">${data.productionCount || 0} / ${data.targetCount || 0}</div>
                </div>
                <div class="detail-item production">
                    <div class="label">Progress</div>
                    <div class="value">${data.targetCount ? Math.round((data.productionCount / data.targetCount) * 100) : 0}%</div>
                </div>
                ${data.lotId ? `
                <div class="detail-item full">
                    <div class="label">ğŸ·ï¸ Lot ID</div>
                    <div class="value">${data.lotId}</div>
                </div>
                <div class="detail-item full">
                    <div class="label">â³ Lot Start</div>
                    <div class="value">${formatDateTime(data.lotStartTime)}</div>
                </div>
                ` : ''}
                <div class="detail-item timeline full">
                    <div class="label">ğŸ“ˆ State History</div>
                    <div class="value">${historyCount}ê°œ ê¸°ë¡ ${lastHistory ? `(ìµœê·¼: ${lastHistory.status})` : ''}</div>
                </div>
            `;
        }
        
        function getStatusColor(status) {
            const colors = { 'RUN': '#22c55e', 'IDLE': '#f59e0b', 'STOP': '#f97316', 'SUDDENSTOP': '#ef4444' };
            return colors[status] || '#888';
        }
        
        function formatDuration(isoTime) {
            if (!isoTime) return '00:00:00';
            const ms = Date.now() - new Date(isoTime).getTime();
            const s = Math.floor(ms / 1000) % 60;
            const m = Math.floor(ms / 60000) % 60;
            const h = Math.floor(ms / 3600000);
            return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }
        
        function formatDateTime(isoTime) {
            if (!isoTime) return '-';
            return new Date(isoTime).toLocaleString('ko-KR', { 
                month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' 
            });
        }
        
        // ========================================
        // ğŸ“¦ Mock Data Generator - ëª¨ë“  DB í•„ë“œ í¬í•¨!
        // ========================================
        
        // ì•ŒëŒ ë©”ì‹œì§€ ëª©ë¡ (ì‹¤ì œ DBì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì²˜ëŸ¼)
        const ALARM_MESSAGES = {
            // SUDDENSTOP ì•ŒëŒ (ê¸´ê¸‰)
            1001: 'SENSOR ERROR - Position sensor malfunction',
            1002: 'MOTOR OVERHEAT - Temperature exceeded limit',
            1003: 'PRESSURE LOW - Hydraulic pressure below threshold',
            1004: 'CONVEYOR JAM - Material stuck in conveyor',
            1005: 'EMERGENCY STOP - Manual emergency button pressed',
            10047: 'Remote Emergency Stop',
            10048: 'Remote Interlock Error',
            // STOP ì•ŒëŒ (ìœ ì§€ë³´ìˆ˜)
            3001: 'SCHEDULED MAINTENANCE - Routine check required',
            3002: 'TOOL CHANGE - Blade replacement needed',
            3003: 'CALIBRATION - Sensor calibration required'
        };
        
        // ìƒíƒœ íˆìŠ¤í† ë¦¬ ìƒì„± (MiniTimelineìš©)
        function generateStateHistory(currentStatus, count = 5) {
            const history = [];
            const statuses = ['RUN', 'IDLE', 'STOP', 'RUN', 'IDLE', 'RUN'];
            let time = Date.now() - (count * 10 * 60000); // 10ë¶„ ê°„ê²©
            
            for (let i = 0; i < count; i++) {
                history.push({
                    status: statuses[i % statuses.length],
                    timestamp: new Date(time).toISOString()
                });
                time += (5 + Math.random() * 15) * 60000; // 5~20ë¶„ ê°„ê²©
            }
            
            // í˜„ì¬ ìƒíƒœ ì¶”ê°€
            history.push({
                status: currentStatus,
                timestamp: new Date().toISOString()
            });
            
            return history;
        }
        
        // ì™„ì „í•œ Mock ì„¤ë¹„ ë°ì´í„° ìƒì„±
        function generateMockEquipment(index, status, options = {}) {
            const row = Math.floor(index / 6) + 17;
            const col = (index % 6) + 1;
            const frontendId = `EQ-${String(row).padStart(2, '0')}-${String(col).padStart(2, '0')}`;
            const equipmentId = 1000 + index;
            
            // ê¸°ë³¸ ë°ì´í„°
            const equipment = {
                // âœ… ê¸°ë³¸ ì •ë³´ (core.Equipment)
                equipmentId: equipmentId,
                equipment_id: equipmentId,  // snake_case í˜¸í™˜
                frontendId: frontendId,
                frontend_id: frontendId,
                equipmentName: options.name || `DRY-${String(index + 1).padStart(3, '0')}`,
                equipment_name: options.name || `DRY-${String(index + 1).padStart(3, '0')}`,
                
                // âœ… ìƒíƒœ ì •ë³´ (log.EquipmentState)
                status: status,
                occurredAt: new Date(Date.now() - (1 + Math.random() * 59) * 60000).toISOString(),
                statusStartTime: null, // ì•„ë˜ì—ì„œ ì„¤ì •
                
                // âœ… ìƒì‚° ì •ë³´ (log.CycleTime COUNT, log.Lotinfo.LotQty)
                productionCount: options.productionCount ?? Math.floor(Math.random() * 80 + 20),
                production_count: null,
                targetCount: options.targetCount ?? 100,
                target_count: null,
                
                // âœ… ìƒíƒœ íˆìŠ¤í† ë¦¬ (log.EquipmentState íˆìŠ¤í† ë¦¬) - MiniTimelineìš©!
                stateHistory: generateStateHistory(status, 3 + Math.floor(Math.random() * 4)),
                state_history: null
            };
            
            // snake_case í˜¸í™˜
            equipment.statusStartTime = equipment.occurredAt;
            equipment.status_start_time = equipment.occurredAt;
            equipment.production_count = equipment.productionCount;
            equipment.target_count = equipment.targetCount;
            equipment.state_history = equipment.stateHistory;
            
            // âœ… Lot ì •ë³´ (log.Lotinfo) - RUN ìƒíƒœë§Œ
            if (status === 'RUN') {
                equipment.lotId = `LOT-2026-${String(Math.floor(Math.random() * 9999)).padStart(4, '0')}`;
                equipment.lot_id = equipment.lotId;
                equipment.lotStartTime = new Date(Date.now() - (1 + Math.random() * 3) * 3600000).toISOString();
                equipment.lot_start_time = equipment.lotStartTime;
            }
            
            // âœ… ì•ŒëŒ ì •ë³´ (log.AlarmEvent) - STOP, SUDDENSTOPë§Œ
            if (status === 'SUDDENSTOP') {
                const alarmCodes = [1001, 1002, 1003, 1004, 1005, 10047, 10048];
                equipment.alarmCode = options.alarmCode ?? alarmCodes[Math.floor(Math.random() * alarmCodes.length)];
                equipment.alarm_code = equipment.alarmCode;
                equipment.alarmMessage = ALARM_MESSAGES[equipment.alarmCode] || 'Unknown Error';
                equipment.alarm_message = equipment.alarmMessage;
                equipment.alarmRepeatCount = options.alarmRepeatCount ?? Math.floor(Math.random() * 5) + 1;
                equipment.alarm_repeat_count = equipment.alarmRepeatCount;
            } else if (status === 'STOP') {
                const alarmCodes = [3001, 3002, 3003];
                equipment.alarmCode = options.alarmCode ?? alarmCodes[Math.floor(Math.random() * alarmCodes.length)];
                equipment.alarm_code = equipment.alarmCode;
                equipment.alarmMessage = ALARM_MESSAGES[equipment.alarmCode] || 'Maintenance Required';
                equipment.alarm_message = equipment.alarmMessage;
                equipment.alarmRepeatCount = 0;
                equipment.alarm_repeat_count = 0;
            }
            
            return equipment;
        }
        
        // ========================================
        // ğŸ“¦ Load Mock Data
        // ========================================
        window.loadMockData = function() {
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'divider');
            log('ğŸ“¦ Mock ë°ì´í„° ë¡œë“œ (v4.0 All DB Fields)...', 'data');
            
            // ì´ˆê¸°í™”
            rankingView.clearAllData();
            rankingView._cardsMap.clear();
            testEquipments = [];
            
            // Mock ë°ì´í„° ìƒì„± - ì´ 16ê°œ ì„¤ë¹„
            const mockData = [
                // RUN ìƒíƒœ (6ê°œ) - Lot ì •ë³´ í¬í•¨
                ...Array(6).fill(null).map((_, i) => generateMockEquipment(i, 'RUN', {
                    productionCount: 70 + Math.floor(Math.random() * 25)
                })),
                
                // IDLE ìƒíƒœ (4ê°œ)
                ...Array(4).fill(null).map((_, i) => generateMockEquipment(6 + i, 'IDLE', {
                    productionCount: 40 + Math.floor(Math.random() * 30)
                })),
                
                // STOP ìƒíƒœ (3ê°œ) - ìœ ì§€ë³´ìˆ˜ ì•ŒëŒ
                ...Array(3).fill(null).map((_, i) => generateMockEquipment(10 + i, 'STOP', {
                    productionCount: 20 + Math.floor(Math.random() * 30)
                })),
                
                // SUDDENSTOP ìƒíƒœ (3ê°œ) - ê¸´ê¸‰ ì•ŒëŒ
                ...Array(3).fill(null).map((_, i) => generateMockEquipment(13 + i, 'SUDDENSTOP', {
                    productionCount: 50 + Math.floor(Math.random() * 30),
                    alarmRepeatCount: Math.floor(Math.random() * 5) + 1
                }))
            ];
            
            testEquipments = mockData;
            
            // ë°ì´í„° ë¡œë“œ ë¡œê¹…
            log(`ğŸ“Š ìƒì„±ëœ Mock ë°ì´í„°:`, 'data');
            log(`   - RUN: 6ê°œ (Lot ì •ë³´ í¬í•¨)`, 'data');
            log(`   - IDLE: 4ê°œ`, 'data');
            log(`   - STOP: 3ê°œ (ìœ ì§€ë³´ìˆ˜ ì•ŒëŒ)`, 'data');
            log(`   - SUDDENSTOP: 3ê°œ (ê¸´ê¸‰ ì•ŒëŒ + ë°˜ë³µíšŸìˆ˜)`, 'data');
            log(`   - ì´ ${mockData.length}ê°œ ì„¤ë¹„`, 'data');
            
            // ì²« ë²ˆì§¸ SUDDENSTOP ë°ì´í„° ìƒ˜í”Œ ë¡œê¹…
            const suddenSample = mockData.find(e => e.status === 'SUDDENSTOP');
            if (suddenSample) {
                log(`ğŸ“‹ SUDDENSTOP ìƒ˜í”Œ ë°ì´í„°:`, 'data');
                log(`   alarmCode: ${suddenSample.alarmCode}`, 'data');
                log(`   alarmMessage: ${suddenSample.alarmMessage}`, 'data');
                log(`   alarmRepeatCount: ${suddenSample.alarmRepeatCount}`, 'data');
                log(`   stateHistory: ${suddenSample.stateHistory.length}ê°œ ê¸°ë¡`, 'data');
            }
            
            // ì¹´ë“œ ìƒì„± ë° ë ˆì¸ì— ì¶”ê°€
            mockData.forEach(eq => {
                const laneId = getLaneId(eq.status);
                const card = rankingView.addEquipment(laneId, eq);
                if (card) {
                    rankingView._cardsMap.set(eq.frontendId, card);
                }
            });
            
            // AnimationManager ì—…ë°ì´íŠ¸
            if (animationManager) {
                animationManager.setCardsMap(rankingView._cardsMap);
            }
            
            log(`âœ… ${testEquipments.length}ê°œ ì„¤ë¹„ ë¡œë“œ ì™„ë£Œ`, 'success');
            log(`ğŸ’¡ ì¹´ë“œ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ í™•ì¸ ê°€ëŠ¥!`, 'info');
            updateStats();
        };
        
        window.clearAllData = function() {
            stopAutoMove();
            rankingView.clearAllData();
            rankingView._cardsMap.clear();
            testEquipments = [];
            selectedEquipmentId = null;
            document.getElementById('detail-panel').style.display = 'none';
            log('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ', 'warning');
            updateStats();
        };
        
        // ========================================
        // ğŸ”„ Lane/Status Mapping
        // ========================================
        function getLaneId(status) {
            return { 
                'RUN': 'run', 
                'IDLE': 'idle', 
                'STOP': 'stop', 
                'SUDDENSTOP': 'sudden-stop' 
            }[status] || 'idle';
        }
        
        function getStatus(laneId) {
            return { 
                'run': 'RUN', 
                'idle': 'IDLE', 
                'stop': 'STOP', 
                'sudden-stop': 'SUDDENSTOP' 
            }[laneId] || 'IDLE';
        }
        
        // ========================================
        // ğŸ¯ Move Functions
        // ========================================
        window.testMoveToRun = () => moveRandomTo('run');
        window.testMoveToIdle = () => moveRandomTo('idle');
        window.testMoveToStop = () => moveRandomTo('stop');
        window.testMoveToSuddenStop = () => moveRandomTo('sudden-stop');
        
        function moveRandomTo(targetLane) {
            if (isAnimating) {
                log('â³ ì• ë‹ˆë©”ì´ì…˜ ì§„í–‰ ì¤‘...', 'warning');
                return;
            }
            
            const candidates = [];
            rankingView._lanes.forEach((lane, laneId) => {
                if (laneId !== targetLane) {
                    lane._cards.forEach((card, fid) => {
                        candidates.push({ fid, fromLane: laneId, card });
                    });
                }
            });
            
            if (candidates.length === 0) {
                log(`âš ï¸ ${targetLane}ìœ¼ë¡œ ì´ë™í•  ëŒ€ìƒ ì—†ìŒ`, 'warning');
                return;
            }
            
            const sel = candidates[Math.floor(Math.random() * candidates.length)];
            performMove(sel.fid, sel.fromLane, targetLane);
        }
        
        window.performRandomMove = function() {
            if (isAnimating) return;
            
            const lanes = ['run', 'idle', 'stop', 'sudden-stop'];
            const all = [];
            
            rankingView._lanes.forEach((lane, lid) => {
                if (lanes.includes(lid)) {
                    lane._cards.forEach((card, fid) => {
                        all.push({ fid, fromLane: lid });
                    });
                }
            });
            
            if (all.length === 0) return;
            
            const sel = all[Math.floor(Math.random() * all.length)];
            const others = lanes.filter(l => l !== sel.fromLane);
            const targetLane = others[Math.floor(Math.random() * others.length)];
            
            performMove(sel.fid, sel.fromLane, targetLane);
        };
        
        async function performMove(frontendId, fromLane, toLane) {
            const useAnim = document.getElementById('use-animation').checked;
            const useSorting = document.getElementById('use-sorting').checked;
            const newStatus = getStatus(toLane);
            
            log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'divider');
            log(`ğŸš€ ${frontendId}: ${fromLane} â†’ ${toLane} (${newStatus})`, 'move');
            
            const card = rankingView._cardsMap.get(frontendId);
            if (!card) {
                log(`âŒ ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${frontendId}`, 'error');
                return;
            }
            
            const currentData = card.getData();
            
            // ğŸ†• v4.0: ì™„ì „í•œ newData ìƒì„± (ëª¨ë“  DB í•„ë“œ í¬í•¨)
            const newData = {
                ...currentData,
                status: newStatus,
                occurredAt: new Date().toISOString(),
                statusStartTime: new Date().toISOString()
            };
            
            // ìƒíƒœë³„ ë°ì´í„° ì²˜ë¦¬
            if (toLane === 'run') {
                // RUN: ì•ŒëŒ ì œê±°, Lot ì •ë³´ ì¶”ê°€
                newData.alarmCode = null;
                newData.alarmMessage = null;
                newData.alarmRepeatCount = 0;
                newData.lotId = `LOT-2026-${String(Math.floor(Math.random() * 9999)).padStart(4, '0')}`;
                newData.lotStartTime = new Date().toISOString();
                log(`   ğŸ“¦ Lot ì‹œì‘: ${newData.lotId}`, 'data');
            } else if (toLane === 'idle') {
                // IDLE: ì•ŒëŒ ì œê±°
                newData.alarmCode = null;
                newData.alarmMessage = null;
                newData.alarmRepeatCount = 0;
            } else if (toLane === 'stop') {
                // STOP: ìœ ì§€ë³´ìˆ˜ ì•ŒëŒ
                const codes = [3001, 3002, 3003];
                newData.alarmCode = codes[Math.floor(Math.random() * codes.length)];
                newData.alarmMessage = ALARM_MESSAGES[newData.alarmCode];
                newData.alarmRepeatCount = 0;
                log(`   âš ï¸ ìœ ì§€ë³´ìˆ˜ ì•ŒëŒ: ${newData.alarmCode}`, 'data');
            } else if (toLane === 'sudden-stop') {
                // SUDDENSTOP: ê¸´ê¸‰ ì•ŒëŒ + ë°˜ë³µ íšŸìˆ˜ ì¦ê°€
                const codes = [1001, 1002, 1003, 1004, 1005, 10047];
                newData.alarmCode = currentData.alarmCode || codes[Math.floor(Math.random() * codes.length)];
                newData.alarmMessage = ALARM_MESSAGES[newData.alarmCode] || 'Critical Error';
                newData.alarmRepeatCount = (currentData.alarmRepeatCount || 0) + 1;
                log(`   ğŸš¨ ê¸´ê¸‰ ì•ŒëŒ: ${newData.alarmCode} (ë°˜ë³µ: ${newData.alarmRepeatCount}íšŒ)`, 'data');
            }
            
            // ìƒíƒœ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸ (MiniTimelineìš©)
            if (!newData.stateHistory) {
                newData.stateHistory = [];
            }
            newData.stateHistory = [
                ...newData.stateHistory,
                { status: newStatus, timestamp: new Date().toISOString() }
            ];
            log(`   ğŸ“ˆ ìƒíƒœ íˆìŠ¤í† ë¦¬: ${newData.stateHistory.length}ê°œ ê¸°ë¡`, 'data');
            
            const toLaneComponent = rankingView._lanes.get(toLane);
            const fromLaneComponent = rankingView._lanes.get(fromLane);
            
            // ì •ë ¬ ìœ„ì¹˜ ê³„ì‚°
            let targetIndex = 0;
            if (useSorting && toLaneComponent && typeof toLaneComponent._findInsertIndex === 'function') {
                targetIndex = toLaneComponent._findInsertIndex(newData);
                log(`ğŸ“ ì •ë ¬ ìœ„ì¹˜: ${targetIndex} (sortKey: ${toLaneComponent._sortKey})`, 'sort');
            }
            
            if (useAnim && animationManager) {
                isAnimating = true;
                setAnimStatus('ì‹¤í–‰ ì¤‘...', true);
                log(`ğŸ¬ AnimationManager.animateLaneChange() í˜¸ì¶œ`, 'anim');
                
                try {
                    await animationManager.animateLaneChange(frontendId, fromLane, toLane, {
                        targetIndex: targetIndex,
                        newData: newData,
                        onComplete: (el, data) => {
                            if (card.updateStatus) {
                                card.updateStatus(data, { resetDuration: true });
                            }
                            log(`   âœ… onComplete ì½œë°± ì‹¤í–‰`, 'anim');
                        }
                    });
                    
                    // Lane ì¹´ë“œ ë§µ ì—…ë°ì´íŠ¸
                    if (fromLaneComponent && toLaneComponent) {
                        fromLaneComponent._cards.delete(frontendId);
                        toLaneComponent._cards.set(frontendId, card);
                        fromLaneComponent._updateEmptyState();
                        fromLaneComponent._updateStats();
                        toLaneComponent._updateEmptyState();
                        toLaneComponent._updateStats();
                    }
                    
                    log(`âœ… ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ`, 'success');
                } catch (err) {
                    log(`âŒ ì• ë‹ˆë©”ì´ì…˜ ì—ëŸ¬: ${err.message}`, 'error');
                    directMove(frontendId, fromLane, toLane, card, newData, targetIndex);
                } finally {
                    isAnimating = false;
                    setAnimStatus('ëŒ€ê¸° ì¤‘', false);
                }
            } else {
                directMove(frontendId, fromLane, toLane, card, newData, targetIndex);
            }
            
            // ì„ íƒëœ ì¹´ë“œë©´ ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
            if (selectedEquipmentId === frontendId) {
                showEquipmentDetail(newData);
            }
            
            updateStats();
        }
        
        function directMove(fid, from, to, card, newData, targetIndex) {
            log(`ğŸ“¦ ì§ì ‘ ì´ë™ (targetIndex=${targetIndex})`, 'info');
            
            card.updateStatus(newData, { resetDuration: true });
            
            const fromLane = rankingView._lanes.get(from);
            const toLane = rankingView._lanes.get(to);
            
            if (fromLane && toLane) {
                fromLane._cards.delete(fid);
                toLane._cards.set(fid, card);
                
                const container = toLane._cardsContainer;
                if (targetIndex < container.children.length) {
                    container.insertBefore(card.element, container.children[targetIndex]);
                } else {
                    container.appendChild(card.element);
                }
                
                fromLane._updateEmptyState();
                fromLane._updateStats();
                toLane._updateEmptyState();
                toLane._updateStats();
            }
            
            log(`âœ… ì´ë™ ì™„ë£Œ`, 'success');
        }
        
        // ========================================
        // ğŸ”„ Auto Move
        // ========================================
        window.startAutoMove = function() {
            if (autoMoveInterval) return;
            
            const interval = parseInt(document.getElementById('auto-interval').value);
            
            autoMoveInterval = setInterval(() => {
                if (!isAnimating) {
                    performRandomMove();
                    autoMoveCount++;
                    document.getElementById('auto-count').textContent = `${autoMoveCount}íšŒ`;
                }
            }, interval);
            
            document.getElementById('btn-start').disabled = true;
            document.getElementById('btn-stop').disabled = false;
            document.getElementById('auto-status').classList.add('active');
            document.getElementById('auto-status-text').textContent = 'ì‹¤í–‰ ì¤‘';
            
            log(`â–¶ï¸ ìë™ ì´ë™ ì‹œì‘ (${interval}ms ê°„ê²©)`, 'success');
        };
        
        window.stopAutoMove = function() {
            if (autoMoveInterval) {
                clearInterval(autoMoveInterval);
                autoMoveInterval = null;
            }
            
            document.getElementById('btn-start').disabled = false;
            document.getElementById('btn-stop').disabled = true;
            document.getElementById('auto-status').classList.remove('active');
            document.getElementById('auto-status-text').textContent = 'ì¤‘ì§€';
            
            log(`â¹ï¸ ìë™ ì´ë™ ì¤‘ì§€ (ì´ ${autoMoveCount}íšŒ)`, 'warning');
        };
        
        window.toggleAutoMove = () => autoMoveInterval ? stopAutoMove() : startAutoMove();
        
        // ========================================
        // ğŸ“ˆ Stats Update
        // ========================================
        function updateStats() {
            const stats = { run: 0, idle: 0, stop: 0, sudden: 0 };
            
            rankingView._lanes.forEach((lane, lid) => {
                const count = lane._cards.size;
                if (lid === 'run') stats.run = count;
                else if (lid === 'idle') stats.idle = count;
                else if (lid === 'stop') stats.stop = count;
                else if (lid === 'sudden-stop') stats.sudden = count;
            });
            
            document.getElementById('stat-run').textContent = stats.run;
            document.getElementById('stat-idle').textContent = stats.idle;
            document.getElementById('stat-stop').textContent = stats.stop;
            document.getElementById('stat-sudden').textContent = stats.sudden;
        }
        
        // ========================================
        // ğŸ“Š Debug Snapshot
        // ========================================
        window.debugSnapshot = function() {
            log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'divider');
            log(`ğŸ“Š í˜„ì¬ ìƒíƒœ ìŠ¤ëƒ…ìƒ·`, 'info');
            log(`_cardsMap: ${rankingView._cardsMap.size}ê°œ ì¹´ë“œ`, 'info');
            
            rankingView._lanes.forEach((lane, lid) => {
                if (lane._cards.size > 0) {
                    const cards = Array.from(lane._cards.values());
                    const prods = cards.map(c => c.getData()?.productionCount || 0);
                    const alarms = cards.filter(c => c.getData()?.alarmCode).length;
                    
                    log(`  ${lid.toUpperCase()}: ${lane._cards.size}ê°œ`, 'info');
                    log(`    ìƒì‚°ëŸ‰: [${prods.join(', ')}]`, 'data');
                    if (alarms > 0) {
                        log(`    ì•ŒëŒ: ${alarms}ê°œ`, 'warning');
                    }
                }
            });
            
            log(`AnimationManager: ${animationManager?.isAnimating() ? 'ì‹¤í–‰ ì¤‘' : 'ëŒ€ê¸° ì¤‘'}`, 'info');
        };
        
        // ========================================
        // âŒ¨ï¸ Keyboard Shortcuts
        // ========================================
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            
            switch (e.key.toLowerCase()) {
                case 'd':
                    e.preventDefault();
                    loadMockData();
                    break;
                case 'c':
                    e.preventDefault();
                    clearAllData();
                    break;
                case 's':
                    e.preventDefault();
                    debugSnapshot();
                    break;
                case '1':
                    e.preventDefault();
                    testMoveToRun();
                    break;
                case '2':
                    e.preventDefault();
                    testMoveToIdle();
                    break;
                case '3':
                    e.preventDefault();
                    testMoveToStop();
                    break;
                case '4':
                    e.preventDefault();
                    testMoveToSuddenStop();
                    break;
                case 'r':
                    e.preventDefault();
                    performRandomMove();
                    break;
                case ' ':
                    e.preventDefault();
                    toggleAutoMove();
                    break;
                case 'a':
                    e.preventDefault();
                    const toggle = document.getElementById('use-animation');
                    toggle.checked = !toggle.checked;
                    log(`ğŸ¬ ì• ë‹ˆë©”ì´ì…˜: ${toggle.checked ? 'ON' : 'OFF'}`, 'info');
                    break;
                case 'h':
                    e.preventDefault();
                    log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'divider');
                    log(`âŒ¨ï¸ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤:`, 'info');
                    log(`   D = Mock ë°ì´í„° ë¡œë“œ`, 'info');
                    log(`   C = ë°ì´í„° ì´ˆê¸°í™”`, 'info');
                    log(`   S = ìƒíƒœ ìŠ¤ëƒ…ìƒ·`, 'info');
                    log(`   1 = RUNìœ¼ë¡œ ì´ë™`, 'info');
                    log(`   2 = IDLEë¡œ ì´ë™`, 'info');
                    log(`   3 = STOPìœ¼ë¡œ ì´ë™`, 'info');
                    log(`   4 = SUDDENSTOPìœ¼ë¡œ ì´ë™`, 'info');
                    log(`   R = ëœë¤ ì´ë™`, 'info');
                    log(`   Space = ìë™ ì´ë™ í† ê¸€`, 'info');
                    log(`   A = ì• ë‹ˆë©”ì´ì…˜ ON/OFF`, 'info');
                    break;
            }
        });
        
        // ì¸í„°ë²Œ ìŠ¬ë¼ì´ë”
        document.getElementById('auto-interval').addEventListener('input', (e) => {
            document.getElementById('interval-value').textContent = 
                (e.target.value / 1000).toFixed(1) + 's';
            
            if (autoMoveInterval) {
                stopAutoMove();
                startAutoMove();
            }
        });
        
        // ========================================
        // ğŸ Start
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'divider');
            log('ğŸ Ranking View Test v4.0 ë¡œë“œ', 'info');
            log('ğŸ“¦ All DB Fields Mock ëª¨ë“œ', 'success');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'divider');
            log('ğŸ“Š í‘œì‹œë˜ëŠ” DB í•„ë“œ:', 'data');
            log('   âœ… equipment_name, frontend_id', 'data');
            log('   âœ… status, occurredAt (Duration)', 'data');
            log('   âœ… alarmCode, alarmMessage', 'data');
            log('   âœ… alarmRepeatCount', 'data');
            log('   âœ… productionCount, targetCount', 'data');
            log('   âœ… lotId, lotStartTime', 'data');
            log('   âœ… stateHistory (MiniTimeline)', 'data');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'divider');
            
            init();
            
            log('ğŸ’¡ Dí‚¤ë¥¼ ëˆŒëŸ¬ Mock ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì„¸ìš”!', 'success');
            log('ğŸ’¡ ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ëª¨ë“  í•„ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'info');
        });
    </script>
</body>
</html>