<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<!--
 * ranking-view-test.html
 * ======================
 * EquipmentCard Î†àÏù∏ Ïù¥Îèô ÌÖåÏä§Ìä∏ ÌéòÏù¥ÏßÄ (Backend ÏóÜÏù¥ ÎèÖÎ¶Ω Ïã§Ìñâ)
 * 
 * üìÅ ÏÇ¨Ïö©Î≤ï: 
 *    1. Ïù¥ ÌååÏùºÏùÑ frontend/threejs_viewer/ Ìè¥ÎçîÏóê Î≥µÏÇ¨
 *    2. Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÅÏ†ë Ïó¥Í∏∞ (http-server ÌïÑÏöî)
 *    3. ÏΩòÏÜîÏóêÏÑú ÌÖåÏä§Ìä∏ Ìï®Ïàò Ïã§Ìñâ
 * 
 * üîß v2.0 Í∞úÏÑ†ÏÇ¨Ìï≠:
 *    - Î†àÏù¥ÏïÑÏõÉ Í∞úÏÑ† (ÌÖåÏä§Ìä∏ Î≤ÑÌäº Ïò§Î•∏Ï™Ω Î∞∞Ïπò)
 *    - ÏûêÎèô ÎûúÎç§ Ïù¥Îèô Í∏∞Îä• Ï∂îÍ∞Ä
 *    - ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§ ÏßÄÏõê
 *    - Îçî ÎßéÏùÄ ÌÖåÏä§Ìä∏ ÏÑ§ÎπÑ
 * 
 * ÏûëÏÑ±Ïùº: 2026-01-23
 * ÏàòÏ†ïÏùº: 2026-01-23 (v2.0)
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Ranking View - Lane Move Test</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            display: flex; 
            flex-direction: column;
            height: 100vh; 
            overflow: hidden; 
            font-family: 'Inter', 'Segoe UI', sans-serif; 
            background: var(--bg-main, #0a0a0f);
            color: #fff;
        }
        
        /* ===== Test Header ===== */
        .test-header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }
        
        .test-header h1 {
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-header h1 .version {
            font-size: 11px;
            background: #3b82f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        /* ===== Test Content ===== */
        .test-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        /* ===== Ranking View Container ===== */
        .ranking-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        /* ===== Test Control Panel (Right Side) ===== */
        .test-panel {
            width: 280px;
            background: #111;
            border-left: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .panel-section {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .panel-section-header {
            padding: 10px 12px;
            background: rgba(255,255,255,0.03);
            font-weight: 600;
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .panel-section-content {
            padding: 10px 12px;
        }
        
        /* ===== Control Buttons ===== */
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        .control-btn {
            padding: 10px 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .control-btn .icon {
            font-size: 18px;
        }
        
        .control-btn .label {
            font-size: 10px;
            opacity: 0.9;
        }
        
        .control-btn .key {
            font-size: 9px;
            opacity: 0.6;
            background: rgba(0,0,0,0.2);
            padding: 1px 4px;
            border-radius: 3px;
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        /* Button Colors */
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        
        .btn-success { background: #22c55e; color: white; }
        .btn-success:hover { background: #16a34a; }
        
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        .btn-purple { background: #8b5cf6; color: white; }
        .btn-purple:hover { background: #7c3aed; }
        
        .btn-cyan { background: #06b6d4; color: white; }
        .btn-cyan:hover { background: #0891b2; }
        
        .btn-gray { background: #4b5563; color: white; }
        .btn-gray:hover { background: #374151; }
        
        .btn-wide { grid-column: span 2; }
        
        /* ===== Auto Move Controls ===== */
        .auto-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .auto-row {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        
        .auto-row label {
            font-size: 11px;
            color: #aaa;
            min-width: 50px;
        }
        
        .auto-row input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #333;
            appearance: none;
        }
        
        .auto-row input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        
        .auto-row .value {
            font-size: 11px;
            font-weight: 600;
            min-width: 40px;
            text-align: right;
            color: #3b82f6;
        }
        
        .auto-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 6px;
            font-size: 11px;
        }
        
        .auto-status .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
        }
        
        .auto-status.running .indicator {
            background: #22c55e;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* ===== Keyboard Shortcuts ===== */
        .shortcuts-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            padding: 4px 0;
        }
        
        .shortcut-item .keys {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #ffd700;
        }
        
        .shortcut-item .desc {
            color: #888;
        }
        
        /* ===== Test Log ===== */
        .test-log {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .test-log-header {
            padding: 10px 12px;
            background: rgba(255,255,255,0.03);
            font-weight: 600;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-log-header button {
            font-size: 10px;
            padding: 3px 8px;
            background: #333;
            border: none;
            border-radius: 3px;
            color: #aaa;
            cursor: pointer;
        }
        
        .test-log-header button:hover {
            background: #444;
            color: #fff;
        }
        
        .test-log-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 10px;
            line-height: 1.5;
            background: #0a0a0a;
        }
        
        .log-entry {
            padding: 2px 0;
        }
        
        .log-entry.success { color: #22c55e; }
        .log-entry.error { color: #ef4444; }
        .log-entry.warning { color: #f59e0b; }
        .log-entry.info { color: #60a5fa; }
        .log-entry.move { color: #c084fc; }
        .log-entry.divider { color: #444; }
        
        /* ===== Override ranking-view ===== */
        .ranking-view {
            position: relative !important;
            left: 0 !important;
            width: 100% !important;
        }
        
        /* ===== Stats Display ===== */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.03);
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        
        .stat-item .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #fff;
        }
        
        .stat-item .stat-label {
            font-size: 9px;
            color: #888;
            text-transform: uppercase;
        }
        
        .stat-item.run .stat-value { color: #22c55e; }
        .stat-item.idle .stat-value { color: #f59e0b; }
        .stat-item.stop .stat-value { color: #ef4444; }
    </style>
</head>
<body>
    <!-- Test Header -->
    <header class="test-header">
        <h1>
            üß™ EquipmentCard Lane Move Test
            <span class="version">v2.0</span>
        </h1>
        <div style="font-size: 11px; color: #888;">
            Press <kbd style="background:#333;padding:2px 6px;border-radius:3px;">H</kbd> for help
        </div>
    </header>
    
    <!-- Test Content -->
    <div class="test-content">
        <!-- Ranking View Container -->
        <div class="ranking-container" id="ranking-container"></div>
        
        <!-- Test Control Panel -->
        <div class="test-panel">
            <!-- Data Controls -->
            <div class="panel-section">
                <div class="panel-section-header">üì¶ Data Controls</div>
                <div class="panel-section-content">
                    <div class="control-grid">
                        <button class="control-btn btn-primary btn-wide" onclick="loadTestData()">
                            <span class="icon">üì¶</span>
                            <span class="label">ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú</span>
                            <span class="key">D</span>
                        </button>
                        <button class="control-btn btn-gray" onclick="clearAllData()">
                            <span class="icon">üóëÔ∏è</span>
                            <span class="label">Ï¥àÍ∏∞Ìôî</span>
                            <span class="key">C</span>
                        </button>
                        <button class="control-btn btn-cyan" onclick="debugSnapshot()">
                            <span class="icon">üìä</span>
                            <span class="label">Ïä§ÎÉÖÏÉ∑</span>
                            <span class="key">S</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Manual Move Controls -->
            <div class="panel-section">
                <div class="panel-section-header">üéØ Manual Move</div>
                <div class="panel-section-content">
                    <div class="control-grid">
                        <button class="control-btn btn-success" onclick="testMoveToRun()">
                            <span class="icon">üü¢</span>
                            <span class="label">RUNÏúºÎ°ú</span>
                            <span class="key">1</span>
                        </button>
                        <button class="control-btn btn-warning" onclick="testMoveToIdle()">
                            <span class="icon">üü°</span>
                            <span class="label">IDLEÎ°ú</span>
                            <span class="key">2</span>
                        </button>
                        <button class="control-btn btn-danger" onclick="testMoveToStop()">
                            <span class="icon">üõë</span>
                            <span class="label">STOPÏúºÎ°ú</span>
                            <span class="key">3</span>
                        </button>
                        <button class="control-btn btn-purple" onclick="testMoveToSuddenStop()">
                            <span class="icon">‚ö†Ô∏è</span>
                            <span class="label">SUDDEN</span>
                            <span class="key">4</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Auto Move Controls -->
            <div class="panel-section">
                <div class="panel-section-header">üîÑ Auto Random Move</div>
                <div class="panel-section-content">
                    <div class="auto-controls">
                        <div class="auto-row">
                            <label>Í∞ÑÍ≤©</label>
                            <input type="range" id="auto-interval" min="500" max="5000" value="2000" step="100">
                            <span class="value" id="interval-value">2.0s</span>
                        </div>
                        <div class="control-grid">
                            <button class="control-btn btn-success" onclick="startAutoMove()" id="btn-start-auto">
                                <span class="icon">‚ñ∂Ô∏è</span>
                                <span class="label">ÏãúÏûë</span>
                                <span class="key">Space</span>
                            </button>
                            <button class="control-btn btn-danger" onclick="stopAutoMove()" id="btn-stop-auto" disabled>
                                <span class="icon">‚èπÔ∏è</span>
                                <span class="label">Ï§ëÏßÄ</span>
                                <span class="key">Space</span>
                            </button>
                        </div>
                        <div class="auto-status" id="auto-status">
                            <span class="indicator"></span>
                            <span>ÏûêÎèô Ïù¥Îèô: <strong id="auto-status-text">Ï§ëÏßÄÎê®</strong></span>
                            <span id="auto-count" style="margin-left:auto; color:#888;">0Ìöå</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="panel-section">
                <div class="panel-section-header">üìà Current Stats</div>
                <div class="panel-section-content">
                    <div class="stats-display">
                        <div class="stat-item run">
                            <div class="stat-value" id="stat-run">0</div>
                            <div class="stat-label">RUN</div>
                        </div>
                        <div class="stat-item idle">
                            <div class="stat-value" id="stat-idle">0</div>
                            <div class="stat-label">IDLE</div>
                        </div>
                        <div class="stat-item stop">
                            <div class="stat-value" id="stat-stop">0</div>
                            <div class="stat-label">STOP</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Keyboard Shortcuts -->
            <div class="panel-section">
                <div class="panel-section-header">‚å®Ô∏è Shortcuts</div>
                <div class="panel-section-content">
                    <div class="shortcuts-list">
                        <div class="shortcut-item">
                            <span class="keys">D</span>
                            <span class="desc">Îç∞Ïù¥ÌÑ∞ Î°úÎìú</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="keys">1-4</span>
                            <span class="desc">Î†àÏù∏ Ïù¥Îèô</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="keys">Space</span>
                            <span class="desc">ÏûêÎèô ÏãúÏûë/Ï§ëÏßÄ</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="keys">R</span>
                            <span class="desc">ÎûúÎç§ 1Ìöå Ïù¥Îèô</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="keys">S</span>
                            <span class="desc">Ïä§ÎÉÖÏÉ∑</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="keys">C</span>
                            <span class="desc">Ï¥àÍ∏∞Ìôî</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Test Log -->
            <div class="panel-section test-log">
                <div class="test-log-header">
                    <span>üìã Log</span>
                    <button onclick="clearLog()">Clear</button>
                </div>
                <div class="test-log-content" id="test-log"></div>
            </div>
        </div>
    </div>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "./node_modules/three/build/three.module.js",
            "three/addons/": "./node_modules/three/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        // ========================================
        // Imports
        // ========================================
        import { eventBus } from './src/core/managers/EventBus.js';
        import { RankingView } from './src/ui/ranking-view/RankingView.js';
        import { EquipmentCard } from './src/ui/ranking-view/components/EquipmentCard.js';
        
        // ========================================
        // Globals
        // ========================================
        let rankingView = null;
        let testEquipments = [];
        let autoMoveInterval = null;
        let autoMoveCount = 0;
        
        // ========================================
        // Logger
        // ========================================
        function log(message, type = 'info') {
            const logEl = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            
            const time = new Date().toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            
            entry.textContent = `[${time}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
            
            // Keep only last 100 entries
            while (logEl.children.length > 100) {
                logEl.removeChild(logEl.firstChild);
            }
        }
        
        window.log = log;
        
        window.clearLog = function() {
            document.getElementById('test-log').innerHTML = '';
            log('üìã Î°úÍ∑∏ Ï¥àÍ∏∞ÌôîÎê®', 'info');
        };
        
        // ========================================
        // Initialize RankingView
        // ========================================
        function initRankingView() {
            log('üöÄ RankingView Ï¥àÍ∏∞Ìôî...', 'info');
            
            const container = document.getElementById('ranking-container');
            
            rankingView = new RankingView({
                container: container,
                webSocketClient: null,
                useUDS: false
            });
            
            rankingView.show();
            
            window.rankingView = rankingView;
            window.eventBus = eventBus;
            
            log('‚úÖ RankingView Ï§ÄÎπÑ ÏôÑÎ£å', 'success');
        }
        
        // ========================================
        // Test Data
        // ========================================
        window.loadTestData = function() {
            log('üì¶ ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú...', 'info');
            
            // Clear existing
            rankingView.clearAllData();
            rankingView._cardsMap.clear();
            
            testEquipments = [
                // RUN (4Í∞ú)
                { equipmentId: '1001', frontendId: 'EQ-17-01', equipmentName: 'ÏÑ§ÎπÑ 17-01', status: 'RUN', productionCount: 85, targetCount: 100 },
                { equipmentId: '1002', frontendId: 'EQ-17-02', equipmentName: 'ÏÑ§ÎπÑ 17-02', status: 'RUN', productionCount: 67, targetCount: 100 },
                { equipmentId: '1003', frontendId: 'EQ-17-03', equipmentName: 'ÏÑ§ÎπÑ 17-03', status: 'RUN', productionCount: 92, targetCount: 100 },
                { equipmentId: '1004', frontendId: 'EQ-17-04', equipmentName: 'ÏÑ§ÎπÑ 17-04', status: 'RUN', productionCount: 78, targetCount: 100 },
                
                // IDLE (3Í∞ú)
                { equipmentId: '1005', frontendId: 'EQ-18-01', equipmentName: 'ÏÑ§ÎπÑ 18-01', status: 'IDLE', productionCount: 50, targetCount: 100 },
                { equipmentId: '1006', frontendId: 'EQ-18-02', equipmentName: 'ÏÑ§ÎπÑ 18-02', status: 'IDLE', productionCount: 45, targetCount: 100 },
                { equipmentId: '1007', frontendId: 'EQ-18-03', equipmentName: 'ÏÑ§ÎπÑ 18-03', status: 'IDLE', productionCount: 62, targetCount: 100 },
                
                // STOP (3Í∞ú)
                { equipmentId: '1008', frontendId: 'EQ-19-01', equipmentName: 'ÏÑ§ÎπÑ 19-01', status: 'STOP', productionCount: 33, targetCount: 100 },
                { equipmentId: '1009', frontendId: 'EQ-19-02', equipmentName: 'ÏÑ§ÎπÑ 19-02', status: 'STOP', productionCount: 28, targetCount: 100 },
                { equipmentId: '1010', frontendId: 'EQ-17-05', equipmentName: 'ÏÑ§ÎπÑ 17-05', status: 'STOP', productionCount: 41, targetCount: 100 },
                
                // SUDDEN-STOP (2Í∞ú)
                { equipmentId: '1011', frontendId: 'EQ-20-01', equipmentName: 'ÏÑ§ÎπÑ 20-01', status: 'SUDDENSTOP', alarmCode: 1234, alarmMessage: 'SENSOR ERROR', alarmRepeatCount: 2, productionCount: 72, targetCount: 100 },
                { equipmentId: '1012', frontendId: 'EQ-20-02', equipmentName: 'ÏÑ§ÎπÑ 20-02', status: 'SUDDENSTOP', alarmCode: 5678, alarmMessage: 'MOTOR OVERHEAT', alarmRepeatCount: 1, productionCount: 55, targetCount: 100 }
            ];
            
            // Add timestamp
            testEquipments.forEach(eq => {
                eq.occurredAt = new Date(Date.now() - Math.random() * 60 * 60 * 1000).toISOString();
            });
            
            // Add to lanes
            testEquipments.forEach(eq => {
                const laneId = getLaneIdFromStatus(eq.status);
                const card = rankingView.addEquipment(laneId, eq);
                if (card) {
                    rankingView._cardsMap.set(eq.frontendId, card);
                }
            });
            
            log(`‚úÖ ${testEquipments.length}Í∞ú ÏÑ§ÎπÑ Î°úÎìú ÏôÑÎ£å`, 'success');
            updateStats();
        };
        
        window.clearAllData = function() {
            stopAutoMove();
            rankingView.clearAllData();
            rankingView._cardsMap.clear();
            testEquipments = [];
            log('üóëÔ∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞ÌôîÎê®', 'warning');
            updateStats();
        };
        
        function getLaneIdFromStatus(status) {
            const map = {
                'RUN': 'run',
                'IDLE': 'idle',
                'STOP': 'stop',
                'SUDDENSTOP': 'sudden-stop',
                'REMOTE': 'remote',
                'WAIT': 'wait'
            };
            return map[status] || 'idle';
        }
        
        function getStatusFromLaneId(laneId) {
            const map = {
                'run': 'RUN',
                'idle': 'IDLE',
                'stop': 'STOP',
                'sudden-stop': 'SUDDENSTOP',
                'remote': 'REMOTE',
                'wait': 'WAIT'
            };
            return map[laneId] || 'IDLE';
        }
        
        // ========================================
        // Move Functions
        // ========================================
        window.testMoveToRun = function() {
            moveRandomEquipmentToLane('run');
        };
        
        window.testMoveToIdle = function() {
            moveRandomEquipmentToLane('idle');
        };
        
        window.testMoveToStop = function() {
            moveRandomEquipmentToLane('stop');
        };
        
        window.testMoveToSuddenStop = function() {
            moveRandomEquipmentToLane('sudden-stop');
        };
        
        function moveRandomEquipmentToLane(targetLane) {
            // Find equipment NOT in target lane
            const candidates = [];
            
            rankingView._lanes.forEach((lane, laneId) => {
                if (laneId !== targetLane) {
                    lane._cards.forEach((card, frontendId) => {
                        candidates.push({ frontendId, fromLane: laneId, card });
                    });
                }
            });
            
            if (candidates.length === 0) {
                log(`‚ö†Ô∏è Ïù¥ÎèôÌï† ÏÑ§ÎπÑ ÏóÜÏùå (Î™®Îëê ${targetLane}Ïóê ÏûàÏùå)`, 'warning');
                return;
            }
            
            // Pick random
            const selected = candidates[Math.floor(Math.random() * candidates.length)];
            performMove(selected.frontendId, selected.fromLane, targetLane);
        }
        
        window.performRandomMove = function() {
            const lanes = ['run', 'idle', 'stop', 'sudden-stop'];
            const allCards = [];
            
            rankingView._lanes.forEach((lane, laneId) => {
                if (lanes.includes(laneId)) {
                    lane._cards.forEach((card, frontendId) => {
                        allCards.push({ frontendId, fromLane: laneId, card });
                    });
                }
            });
            
            if (allCards.length === 0) {
                log('‚ö†Ô∏è Ïù¥ÎèôÌï† ÏÑ§ÎπÑ ÏóÜÏùå', 'warning');
                return;
            }
            
            // Pick random card
            const selected = allCards[Math.floor(Math.random() * allCards.length)];
            
            // Pick random target (different from current)
            const otherLanes = lanes.filter(l => l !== selected.fromLane);
            const targetLane = otherLanes[Math.floor(Math.random() * otherLanes.length)];
            
            performMove(selected.frontendId, selected.fromLane, targetLane);
        };
        
        function performMove(frontendId, fromLane, toLane) {
            const newStatus = getStatusFromLaneId(toLane);
            
            log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'divider');
            log(`üöÄ ${frontendId}: ${fromLane} ‚Üí ${toLane}`, 'move');
            
            // 1. Get card
            const card = rankingView._cardsMap.get(frontendId);
            if (!card) {
                log(`‚ùå Ïπ¥Îìú ÏóÜÏùå: ${frontendId}`, 'error');
                return;
            }
            
            // 2. Get current data
            const currentData = card.getData();
            
            // 3. Prepare new data
            const newData = {
                ...currentData,
                status: newStatus,
                occurredAt: new Date().toISOString(),
                alarmCode: (toLane === 'run' || toLane === 'idle') ? null : (currentData.alarmCode || Math.floor(Math.random() * 9000) + 1000),
                alarmMessage: (toLane === 'run' || toLane === 'idle') ? null : (currentData.alarmMessage || 'AUTO TEST ALARM')
            };
            
            // 4. Update status (icon change)
            try {
                card.updateStatus(newData, { resetDuration: true });
                
                const iconEl = card._statusIndicatorElement;
                const newIcon = iconEl ? iconEl.textContent : '?';
                log(`   ÏïÑÏù¥ÏΩò: ${newIcon} / ÏÉÅÌÉú: ${newStatus}`, 'info');
            } catch (err) {
                log(`‚ùå updateStatus ÏóêÎü¨: ${err.message}`, 'error');
                return;
            }
            
            // 5. DOM Move
            const fromLaneComponent = rankingView._lanes.get(fromLane);
            const toLaneComponent = rankingView._lanes.get(toLane);
            
            if (fromLaneComponent && toLaneComponent) {
                fromLaneComponent._cards.delete(frontendId);
                toLaneComponent._cards.set(frontendId, card);
                toLaneComponent._cardsContainer.appendChild(card.element);
                
                fromLaneComponent._updateEmptyState();
                fromLaneComponent._updateStats();
                toLaneComponent._updateEmptyState();
                toLaneComponent._updateStats();
            }
            
            log(`‚úÖ Ïù¥Îèô ÏôÑÎ£å`, 'success');
            updateStats();
        }
        
        // ========================================
        // Auto Move
        // ========================================
        window.startAutoMove = function() {
            if (autoMoveInterval) return;
            
            const interval = parseInt(document.getElementById('auto-interval').value);
            
            autoMoveInterval = setInterval(() => {
                performRandomMove();
                autoMoveCount++;
                document.getElementById('auto-count').textContent = `${autoMoveCount}Ìöå`;
            }, interval);
            
            document.getElementById('btn-start-auto').disabled = true;
            document.getElementById('btn-stop-auto').disabled = false;
            document.getElementById('auto-status').classList.add('running');
            document.getElementById('auto-status-text').textContent = 'Ïã§Ìñâ Ï§ë';
            
            log(`‚ñ∂Ô∏è ÏûêÎèô Ïù¥Îèô ÏãúÏûë (Í∞ÑÍ≤©: ${interval}ms)`, 'success');
        };
        
        window.stopAutoMove = function() {
            if (autoMoveInterval) {
                clearInterval(autoMoveInterval);
                autoMoveInterval = null;
            }
            
            document.getElementById('btn-start-auto').disabled = false;
            document.getElementById('btn-stop-auto').disabled = true;
            document.getElementById('auto-status').classList.remove('running');
            document.getElementById('auto-status-text').textContent = 'Ï§ëÏßÄÎê®';
            
            log(`‚èπÔ∏è ÏûêÎèô Ïù¥Îèô Ï§ëÏßÄ (Ï¥ù ${autoMoveCount}Ìöå)`, 'warning');
        };
        
        window.toggleAutoMove = function() {
            if (autoMoveInterval) {
                stopAutoMove();
            } else {
                startAutoMove();
            }
        };
        
        // ========================================
        // Stats Update
        // ========================================
        function updateStats() {
            const stats = { run: 0, idle: 0, stop: 0 };
            
            rankingView._lanes.forEach((lane, laneId) => {
                const count = lane._cards.size;
                if (laneId === 'run') stats.run = count;
                else if (laneId === 'idle') stats.idle = count;
                else if (laneId === 'stop' || laneId === 'sudden-stop') stats.stop += count;
            });
            
            document.getElementById('stat-run').textContent = stats.run;
            document.getElementById('stat-idle').textContent = stats.idle;
            document.getElementById('stat-stop').textContent = stats.stop;
        }
        
        // ========================================
        // Debug Snapshot
        // ========================================
        window.debugSnapshot = function() {
            log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'divider');
            log(`üìä ÏÉÅÌÉú Ïä§ÎÉÖÏÉ∑`, 'info');
            
            const cardsMapKeys = Array.from(rankingView._cardsMap.keys());
            log(`_cardsMap: ${cardsMapKeys.length}Í∞ú`, 'info');
            
            rankingView._lanes.forEach((lane, laneId) => {
                const count = lane._cards.size;
                if (count > 0) {
                    const keys = Array.from(lane._cards.keys()).join(', ');
                    log(`  ${laneId}: ${count}Í∞ú [${keys}]`, 'info');
                }
            });
            
            log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'divider');
        };
        
        // ========================================
        // Keyboard Shortcuts
        // ========================================
        document.addEventListener('keydown', (e) => {
            // Ignore if typing in input
            if (e.target.tagName === 'INPUT') return;
            
            switch (e.key.toLowerCase()) {
                case 'd':
                    e.preventDefault();
                    loadTestData();
                    break;
                case 'c':
                    e.preventDefault();
                    clearAllData();
                    break;
                case 's':
                    e.preventDefault();
                    debugSnapshot();
                    break;
                case '1':
                    e.preventDefault();
                    testMoveToRun();
                    break;
                case '2':
                    e.preventDefault();
                    testMoveToIdle();
                    break;
                case '3':
                    e.preventDefault();
                    testMoveToStop();
                    break;
                case '4':
                    e.preventDefault();
                    testMoveToSuddenStop();
                    break;
                case 'r':
                    e.preventDefault();
                    performRandomMove();
                    break;
                case ' ':
                    e.preventDefault();
                    toggleAutoMove();
                    break;
                case 'h':
                    e.preventDefault();
                    showHelp();
                    break;
            }
        });
        
        function showHelp() {
            log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'divider');
            log(`‚å®Ô∏è ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§`, 'info');
            log(`  D: ÌÖåÏä§Ìä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú`, 'info');
            log(`  C: Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî`, 'info');
            log(`  S: ÏÉÅÌÉú Ïä§ÎÉÖÏÉ∑`, 'info');
            log(`  1: RUNÏúºÎ°ú Ïù¥Îèô`, 'info');
            log(`  2: IDLEÎ°ú Ïù¥Îèô`, 'info');
            log(`  3: STOPÏúºÎ°ú Ïù¥Îèô`, 'info');
            log(`  4: SUDDEN STOPÏúºÎ°ú Ïù¥Îèô`, 'info');
            log(`  R: ÎûúÎç§ 1Ìöå Ïù¥Îèô`, 'info');
            log(`  Space: ÏûêÎèô Ïù¥Îèô ÏãúÏûë/Ï§ëÏßÄ`, 'info');
            log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`, 'divider');
        }
        
        // ========================================
        // Interval Slider
        // ========================================
        document.getElementById('auto-interval').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('interval-value').textContent = (value / 1000).toFixed(1) + 's';
            
            // If running, restart with new interval
            if (autoMoveInterval) {
                stopAutoMove();
                startAutoMove();
            }
        });
        
        // ========================================
        // Initialize
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            log('üèÅ ÌÖåÏä§Ìä∏ ÌéòÏù¥ÏßÄ Î°úÎìúÎê® (v2.0)', 'info');
            log('', 'info');
            
            initRankingView();
            
            log('', 'info');
            log('üí° DÌÇ§Î°ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú, SpaceÎ°ú ÏûêÎèô Ïù¥Îèô!', 'success');
            log('', 'info');
        });
    </script>
</body>
</html>